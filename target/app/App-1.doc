
0:F:\git\coin\bisheng commerce\App\Common\Common\class.smtp.php
<?php
/*~ class.smtp.php
.---------------------------------------------------------------------------.
|  Software: PHPMailer - PHP email class                                    |
|   Version: 2.3                                                            |
|   Contact: via sourceforge.net support pages (also www.codeworxtech.com)  |
|      Info: http://phpmailer.sourceforge.net                               |
|   Support: http://sourceforge.net/projects/phpmailer/                     |
| ------------------------------------------------------------------------- |
|    Author: Andy Prevost (project admininistrator)                         |
|    Author: Brent R. Matzelle (original founder)                           |
| Copyright (c) 2004-2007, Andy Prevost. All Rights Reserved.               |
| Copyright (c) 2001-2003, Brent R. Matzelle                                |
| ------------------------------------------------------------------------- |
|   License: Distributed under the Lesser General Public License (LGPL)     |
|            http://www.gnu.org/copyleft/lesser.html                        |
| This program is distributed in the hope that it will be useful - WITHOUT  |
| ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or     |
| FITNESS FOR A PARTICULAR PURPOSE.                                         |
| ------------------------------------------------------------------------- |
| We offer a number of paid services (www.codeworxtech.com):                |
| - Web Hosting on highly optimized fast and secure servers                 |
| - Technology Consulting                                                   |
| - Oursourcing (highly qualified programmers and graphic designers)        |
'---------------------------------------------------------------------------'

/**
 * SMTP is rfc 821 compliant and implements all the rfc 821 SMTP
 * commands except TURN which will always return a not implemented
 * error. SMTP also provides some utility methods for sending mail
 * to an SMTP server.
 * @package PHPMailer
 * @author Chris Ryan
 */

class SMTP {
  /**
   *  SMTP server port
   *  @var int
   */
  public $SMTP_PORT = 25;

  /**
   *  SMTP reply line ending
   *  @var string
   */
  public $CRLF = "\r\n";

  /**
   *  Sets whether debugging is turned on
   *  @var bool
   */
  public $do_debug;       // the level of debug to perform

  /**
   *  Sets VERP use on/off (default is off)
   *  @var bool
   */
  public $do_verp = false;

  /**#@+
   * @access private
   */
  private $smtp_conn;      // the socket to the server
  private $error;          // error if any on the last call
  private $helo_rply;      // the reply the server sent to us for HELO
  /**#@-*/

  /**
   * Initialize the class so that the data is in a known state.
   * @access public
   * @return void
   */
  public function __construct() {
    $this->smtp_conn = 0;
    $this->error = null;
    $this->helo_rply = null;

    $this->do_debug = 0;
  }

  /*************************************************************
   *                    CONNECTION FUNCTIONS                  *
   ***********************************************************/

  /**
   * Connect to the server specified on the port specified.
   * If the port is not specified use the default SMTP_PORT.
   * If tval is specified then a connection will try and be
   * established with the server for that number of seconds.
   * If tval is not specified the default is 30 seconds to
   * try on the connection.
   *
   * SMTP CODE SUCCESS: 220
   * SMTP CODE FAILURE: 421
   * @access public
   * @return bool
   */
  public function Connect($host,$port=0,$tval=30) {
    /* set the error val to null so there is no confusion */
    $this->error = null;

    /* make sure we are __not__ connected */
    if($this->connected()) {
      /* ok we are connected! what should we do?
       * for now we will just give an error saying we
       * are already connected
       */
      $this->error = array("error" => "Already connected to a server");
      return false;
    }

    if(empty($port)) {
      $port = $this->SMTP_PORT;
    }

    /* connect to the smtp server */
    $this->smtp_conn = fsockopen($host,    // the host of the server
                                 $port,    // the port to use
                                 $errno,   // error number if any
                                 $errstr,  // error message if any
                                 $tval);   // give up after ? secs
    /* verify we connected properly */
    if(empty($this->smtp_conn)) {
      $this->error = array("error" => "Failed to connect to server",
                           "errno" => $errno,
                           "errstr" => $errstr);
      if($this->do_debug >= 1) {
        echo "SMTP -> ERROR: " . $this->error["error"] .
                 ": $errstr ($errno)" . $this->CRLF;
      }
      return false;
    }

    /* sometimes the SMTP server takes a little longer to respond
     * so we will give it a longer timeout for the first read
     * - Windows still does not have support for this timeout function
     */
    if(substr(PHP_OS, 0, 3) != "WIN")
     socket_set_timeout($this->smtp_conn, $tval, 0);

    /* get any announcement stuff */
    $announce = $this->get_lines();

    /* set the timeout  of any socket functions at 1/10 of a second */
    //if(function_exists("socket_set_timeout"))
    //   socket_set_timeout($this->smtp_conn, 0, 100000);

    if($this->do_debug >= 2) {
      echo "SMTP -> FROM SERVER:" . $this->CRLF . $announce;
    }

    return true;
  }

  /**
   * Initiate a TSL communication with the server.
   *
   * SMTP CODE 220 Ready to start TLS
   * SMTP CODE 501 Syntax error (no parameters allowed)
   * SMTP CODE 454 TLS not available due to temporary reason
   * @access public
   * @return bool success
   */
  public function StartTLS() {
    $this->error = null; # to avoid confusion

    if(!$this->connected()) {
      $this->error = array("error" => "Called StartTLS() without being connected");
      return false;
    }

    fputs($this->smtp_conn,"STARTTLS" . $this->CRLF);

    $rply = $this->get_lines();
    $code = substr($rply,0,3);

    if($this->do_debug >= 2) {
      echo "SMTP -> FROM SERVER:" . $this->CRLF . $rply;
    }

    if($code != 220) {
      $this->error =
         array("error"     => "STARTTLS not accepted from server",
               "smtp_code" => $code,
               "smtp_msg"  => substr($rply,4));
      if($this->do_debug >= 1) {
        echo "SMTP -> ERROR: " . $this->error["error"] . ": " . $rply . $this->CRLF;
      }
      return false;
    }

    //Begin encrypted connection
    if(!stream_socket_enable_crypto($this->smtp_conn, true, STREAM_CRYPTO_METHOD_TLS_CLIENT)) {
      return false;
    }

    return true;
  }

  /**
   * Performs SMTP authentication.  Must be run after running the
   * Hello() method.  Returns true if successfully authenticated.
   * @access public
   * @return bool
   */
  public function Authenticate($username, $password) {
    // Start authentication
    fputs($this->smtp_conn,"AUTH LOGIN" . $this->CRLF);

    $rply = $this->get_lines();
    $code = substr($rply,0,3);

    if($code != 334) {
      $this->error =
        array("error" => "AUTH not accepted from server",
              "smtp_code" => $code,
              "smtp_msg" => substr($rply,4));
      if($this->do_debug >= 1) {
        echo "SMTP -> ERROR: " . $this->error["error"] .
                 ": " . $rply . $this->CRLF;
      }
      return false;
    }

    // Send encoded username
    fputs($this->smtp_conn, base64_encode($username) . $this->CRLF);

    $rply = $this->get_lines();
    $code = substr($rply,0,3);

    if($code != 334) {
      $this->error =
        array("error" => "Username not accepted from server",
              "smtp_code" => $code,
              "smtp_msg" => substr($rply,4));
      if($this->do_debug >= 1) {
        echo "SMTP -> ERROR: " . $this->error["error"] .
                 ": " . $rply . $this->CRLF;
      }
      return false;
    }

    // Send encoded password
    fputs($this->smtp_conn, base64_encode($password) . $this->CRLF);

    $rply = $this->get_lines();
    $code = substr($rply,0,3);

    if($code != 235) {
      $this->error =
        array("error" => "Password not accepted from server",
              "smtp_code" => $code,
              "smtp_msg" => substr($rply,4));
      if($this->do_debug >= 1) {
        echo "SMTP -> ERROR: " . $this->error["error"] .
                 ": " . $rply . $this->CRLF;
      }
      return false;
    }

    return true;
  }

  /**
   * Returns true if connected to a server otherwise false
   * @access public
   * @return bool
   */
  public function Connected() {
    if(!empty($this->smtp_conn)) {
      $sock_status = socket_get_status($this->smtp_conn);
      if($sock_status["eof"]) {
        // hmm this is an odd situation... the socket is
        // valid but we are not connected anymore
        if($this->do_debug >= 1) {
            echo "SMTP -> NOTICE:" . $this->CRLF .
                 "EOF caught while checking if connected";
        }
        $this->Close();
        return false;
      }
      return true; // everything looks good
    }
    return false;
  }

  /**
   * Closes the socket and cleans up the state of the class.
   * It is not considered good to use this function without
   * first trying to use QUIT.
   * @access public
   * @return void
   */
  public function Close() {
    $this->error = null; // so there is no confusion
    $this->helo_rply = null;
    if(!empty($this->smtp_conn)) {
      // close the connection and cleanup
      fclose($this->smtp_conn);
      $this->smtp_conn = 0;
    }
  }

  /***************************************************************
   *                        SMTP COMMANDS                       *
   *************************************************************/

  /**
   * Issues a data command and sends the msg_data to the server
   * finializing the mail transaction. $msg_data is the message
   * that is to be send with the headers. Each header needs to be
   * on a single line followed by a <CRLF> with the message headers
   * and the message body being seperated by and additional <CRLF>.
   *
   * Implements rfc 821: DATA <CRLF>
   *
   * SMTP CODE INTERMEDIATE: 354
   *     [data]
   *     <CRLF>.<CRLF>
   *     SMTP CODE SUCCESS: 250
   *     SMTP CODE FAILURE: 552,554,451,452
   * SMTP CODE FAILURE: 451,554
   * SMTP CODE ERROR  : 500,501,503,421
   * @access public
   * @return bool
   */
  public function Data($msg_data) {
    $this->error = null; // so no confusion is caused

    if(!$this->connected()) {
      $this->error = array(
              "error" => "Called Data() without being connected");
      return false;
    }

    fputs($this->smtp_conn,"DATA" . $this->CRLF);

    $rply = $this->get_lines();
    $code = substr($rply,0,3);

    if($this->do_debug >= 2) {
      echo "SMTP -> FROM SERVER:" . $this->CRLF . $rply;
    }

    if($code != 354) {
      $this->error =
        array("error" => "DATA command not accepted from server",
              "smtp_code" => $code,
              "smtp_msg" => substr($rply,4));
      if($this->do_debug >= 1) {
        echo "SMTP -> ERROR: " . $this->error["error"] .
                 ": " . $rply . $this->CRLF;
      }
      return false;
    }

    /* the server is ready to accept data!
     * according to rfc 821 we should not send more than 1000
     * including the CRLF
     * characters on a single line so we will break the data up
     * into lines by \r and/or \n then if needed we will break
     * each of those into smaller lines to fit within the limit.
     * in addition we will be looking for lines that start with
     * a period '.' and append and additional period '.' to that
     * line. NOTE: this does not count towards are limit.
     */

    // normalize the line breaks so we know the explode works
    $msg_data = str_replace("\r\n","\n",$msg_data);
    $msg_data = str_replace("\r","\n",$msg_data);
    $lines = explode("\n",$msg_data);

    /* we need to find a good way to determine is headers are
     * in the msg_data or if it is a straight msg body
     * currently I am assuming rfc 822 definitions of msg headers
     * and if the first field of the first line (':' sperated)
     * does not contain a space then it _should_ be a header
     * and we can process all lines before a blank "" line as
     * headers.
     */
    $field = substr($lines[0],0,strpos($lines[0],":"));
    $in_headers = false;
    if(!empty($field) && !strstr($field," ")) {
      $in_headers = true;
    }

    $max_line_length = 998; // used below; set here for ease in change

    while(list(,$line) = @each($lines)) {
      $lines_out = null;
      if($line == "" && $in_headers) {
        $in_headers = false;
      }
      // ok we need to break this line up into several smaller lines
      while(strlen($line) > $max_line_length) {
        $pos = strrpos(substr($line,0,$max_line_length)," ");

        // Patch to fix DOS attack
        if(!$pos) {
          $pos = $max_line_length - 1;
          $lines_out[] = substr($line,0,$pos);
          $line = substr($line,$pos);
        } else {
          $lines_out[] = substr($line,0,$pos);
          $line = substr($line,$pos + 1);
        }

        /* if we are processing headers we need to
         * add a LWSP-char to the front of the new line
         * rfc 822 on long msg headers
         */
        if($in_headers) {
          $line = "\t" . $line;
        }
      }
      $lines_out[] = $line;

      // now send the lines to the server
      while(list(,$line_out) = @each($lines_out)) {
        if(strlen($line_out) > 0)
        {
          if(substr($line_out, 0, 1) == ".") {
            $line_out = "." . $line_out;
          }
        }
        fputs($this->smtp_conn,$line_out . $this->CRLF);
      }
    }

    // ok all the message data has been sent so lets get this
    // over with aleady
    fputs($this->smtp_conn, $this->CRLF . "." . $this->CRLF);

    $rply = $this->get_lines();
    $code = substr($rply,0,3);

    if($this->do_debug >= 2) {
      echo "SMTP -> FROM SERVER:" . $this->CRLF . $rply;
    }

    if($code != 250) {
      $this->error =
        array("error" => "DATA not accepted from server",
              "smtp_code" => $code,
              "smtp_msg" => substr($rply,4));
      if($this->do_debug >= 1) {
        echo "SMTP -> ERROR: " . $this->error["error"] .
                 ": " . $rply . $this->CRLF;
      }
      return false;
    }
    return true;
  }

  /**
   * Expand takes the name and asks the server to list all the
   * people who are members of the _list_. Expand will return
   * back and array of the result or false if an error occurs.
   * Each value in the array returned has the format of:
   *     [ <full-name> <sp> ] <path>
   * The definition of <path> is defined in rfc 821
   *
   * Implements rfc 821: EXPN <SP> <string> <CRLF>
   *
   * SMTP CODE SUCCESS: 250
   * SMTP CODE FAILURE: 550
   * SMTP CODE ERROR  : 500,501,502,504,421
   * @access public
   * @return string array
   */
  public function Expand($name) {
    $this->error = null; // so no confusion is caused

    if(!$this->connected()) {
      $this->error = array(
            "error" => "Called Expand() without being connected");
      return false;
    }

    fputs($this->smtp_conn,"EXPN " . $name . $this->CRLF);

    $rply = $this->get_lines();
    $code = substr($rply,0,3);

    if($this->do_debug >= 2) {
      echo "SMTP -> FROM SERVER:" . $this->CRLF . $rply;
    }

    if($code != 250) {
      $this->error =
        array("error" => "EXPN not accepted from server",
              "smtp_code" => $code,
              "smtp_msg" => substr($rply,4));
      if($this->do_debug >= 1) {
        echo "SMTP -> ERROR: " . $this->error["error"] .
                 ": " . $rply . $this->CRLF;
      }
      return false;
    }

    // parse the reply and place in our array to return to user
    $entries = explode($this->CRLF,$rply);
    while(list(,$l) = @each($entries)) {
      $list[] = substr($l,4);
    }

    return $list;
  }

  /**
   * Sends the HELO command to the smtp server.
   * This makes sure that we and the server are in
   * the same known state.
   *
   * Implements from rfc 821: HELO <SP> <domain> <CRLF>
   *
   * SMTP CODE SUCCESS: 250
   * SMTP CODE ERROR  : 500, 501, 504, 421
   * @access public
   * @return bool
   */
  public function Hello($host="") {
    $this->error = null; // so no confusion is caused

    if(!$this->connected()) {
      $this->error = array(
            "error" => "Called Hello() without being connected");
      return false;
    }

    // if a hostname for the HELO was not specified determine
    //a suitable one to send
    if(empty($host)) {
      // we need to determine some sort of appopiate default
      // to send to the server
      $host = "localhost";
    }

    // Send extended hello first (RFC 2821)
    if(!$this->SendHello("EHLO", $host))
    {
      if(!$this->SendHello("HELO", $host))
          return false;
    }

    return true;
  }

  /**
   * Sends a HELO/EHLO command.
   * @access private
   * @return bool
   */
  private function SendHello($hello, $host) {
    fputs($this->smtp_conn, $hello . " " . $host . $this->CRLF);

    $rply = $this->get_lines();
    $code = substr($rply,0,3);

    if($this->do_debug >= 2) {
      echo "SMTP -> FROM SERVER: " . $this->CRLF . $rply;
    }

    if($code != 250) {
      $this->error =
        array("error" => $hello . " not accepted from server",
              "smtp_code" => $code,
              "smtp_msg" => substr($rply,4));
      if($this->do_debug >= 1) {
        echo "SMTP -> ERROR: " . $this->error["error"] .
                 ": " . $rply . $this->CRLF;
      }
      return false;
    }

    $this->helo_rply = $rply;

    return true;
  }

  /**
   * Gets help information on the keyword specified. If the keyword
   * is not specified then returns generic help, ussually contianing
   * A list of keywords that help is available on. This function
   * returns the results back to the user. It is up to the user to
   * handle the returned data. If an error occurs then false is
   * returned with $this->error set appropiately.
   *
   * Implements rfc 821: HELP [ <SP> <string> ] <CRLF>
   *
   * SMTP CODE SUCCESS: 211,214
   * SMTP CODE ERROR  : 500,501,502,504,421
   * @access public
   * @return string
   */
  public function Help($keyword="") {
    $this->error = null; // to avoid confusion

    if(!$this->connected()) {
      $this->error = array(
              "error" => "Called Help() without being connected");
      return false;
    }

    $extra = "";
    if(!empty($keyword)) {
      $extra = " " . $keyword;
    }

    fputs($this->smtp_conn,"HELP" . $extra . $this->CRLF);

    $rply = $this->get_lines();
    $code = substr($rply,0,3);

    if($this->do_debug >= 2) {
      echo "SMTP -> FROM SERVER:" . $this->CRLF . $rply;
    }

    if($code != 211 && $code != 214) {
      $this->error =
        array("error" => "HELP not accepted from server",
              "smtp_code" => $code,
              "smtp_msg" => substr($rply,4));
      if($this->do_debug >= 1) {
        echo "SMTP -> ERROR: " . $this->error["error"] .
                 ": " . $rply . $this->CRLF;
      }
      return false;
    }

    return $rply;
  }

  /**
   * Starts a mail transaction from the email address specified in
   * $from. Returns true if successful or false otherwise. If True
   * the mail transaction is started and then one or more Recipient
   * commands may be called followed by a Data command.
   *
   * Implements rfc 821: MAIL <SP> FROM:<reverse-path> <CRLF>
   *
   * SMTP CODE SUCCESS: 250
   * SMTP CODE SUCCESS: 552,451,452
   * SMTP CODE SUCCESS: 500,501,421
   * @access public
   * @return bool
   */
  public function Mail($from) {
    $this->error = null; // so no confusion is caused

    if(!$this->connected()) {
      $this->error = array(
              "error" => "Called Mail() without being connected");
      return false;
    }

    $useVerp = ($this->do_verp ? "XVERP" : "");
    fputs($this->smtp_conn,"MAIL FROM:<" . $from . ">" . $useVerp . $this->CRLF);

    $rply = $this->get_lines();
    $code = substr($rply,0,3);

    if($this->do_debug >= 2) {
      echo "SMTP -> FROM SERVER:" . $this->CRLF . $rply;
    }

    if($code != 250) {
      $this->error =
        array("error" => "MAIL not accepted from server",
              "smtp_code" => $code,
              "smtp_msg" => substr($rply,4));
      if($this->do_debug >= 1) {
        echo "SMTP -> ERROR: " . $this->error["error"] .
                 ": " . $rply . $this->CRLF;
      }
      return false;
    }
    return true;
  }

  /**
   * Sends the command NOOP to the SMTP server.
   *
   * Implements from rfc 821: NOOP <CRLF>
   *
   * SMTP CODE SUCCESS: 250
   * SMTP CODE ERROR  : 500, 421
   * @access public
   * @return bool
   */
  public function Noop() {
    $this->error = null; // so no confusion is caused

    if(!$this->connected()) {
      $this->error = array(
              "error" => "Called Noop() without being connected");
      return false;
    }

    fputs($this->smtp_conn,"NOOP" . $this->CRLF);

    $rply = $this->get_lines();
    $code = substr($rply,0,3);

    if($this->do_debug >= 2) {
      echo "SMTP -> FROM SERVER:" . $this->CRLF . $rply;
    }

    if($code != 250) {
      $this->error =
        array("error" => "NOOP not accepted from server",
              "smtp_code" => $code,
              "smtp_msg" => substr($rply,4));
      if($this->do_debug >= 1) {
        echo "SMTP -> ERROR: " . $this->error["error"] .
                 ": " . $rply . $this->CRLF;
      }
      return false;
    }
    return true;
  }

  /**
   * Sends the quit command to the server and then closes the socket
   * if there is no error or the $close_on_error argument is true.
   *
   * Implements from rfc 821: QUIT <CRLF>
   *
   * SMTP CODE SUCCESS: 221
   * SMTP CODE ERROR  : 500
   * @access public
   * @return bool
   */
  public function Quit($close_on_error=true) {
    $this->error = null; // so there is no confusion

    if(!$this->connected()) {
      $this->error = array(
              "error" => "Called Quit() without being connected");
      return false;
    }

    // send the quit command to the server
    fputs($this->smtp_conn,"quit" . $this->CRLF);

    // get any good-bye messages
    $byemsg = $this->get_lines();

    if($this->do_debug >= 2) {
      echo "SMTP -> FROM SERVER:" . $this->CRLF . $byemsg;
    }

    $rval = true;
    $e = null;

    $code = substr($byemsg,0,3);
    if($code != 221) {
      // use e as a tmp var cause Close will overwrite $this->error
      $e = array("error" => "SMTP server rejected quit command",
                 "smtp_code" => $code,
                 "smtp_rply" => substr($byemsg,4));
      $rval = false;
      if($this->do_debug >= 1) {
        echo "SMTP -> ERROR: " . $e["error"] . ": " .
                 $byemsg . $this->CRLF;
      }
    }

    if(empty($e) || $close_on_error) {
      $this->Close();
    }

    return $rval;
  }

  /**
   * Sends the command RCPT to the SMTP server with the TO: argument of $to.
   * Returns true if the recipient was accepted false if it was rejected.
   *
   * Implements from rfc 821: RCPT <SP> TO:<forward-path> <CRLF>
   *
   * SMTP CODE SUCCESS: 250,251
   * SMTP CODE FAILURE: 550,551,552,553,450,451,452
   * SMTP CODE ERROR  : 500,501,503,421
   * @access public
   * @return bool
   */
  public function Recipient($to) {
    $this->error = null; // so no confusion is caused

    if(!$this->connected()) {
      $this->error = array(
              "error" => "Called Recipient() without being connected");
      return false;
    }

    fputs($this->smtp_conn,"RCPT TO:<" . $to . ">" . $this->CRLF);

    $rply = $this->get_lines();
    $code = substr($rply,0,3);

    if($this->do_debug >= 2) {
      echo "SMTP -> FROM SERVER:" . $this->CRLF . $rply;
    }

    if($code != 250 && $code != 251) {
      $this->error =
        array("error" => "RCPT not accepted from server",
              "smtp_code" => $code,
              "smtp_msg" => substr($rply,4));
      if($this->do_debug >= 1) {
        echo "SMTP -> ERROR: " . $this->error["error"] .
                 ": " . $rply . $this->CRLF;
      }
      return false;
    }
    return true;
  }

  /**
   * Sends the RSET command to abort and transaction that is
   * currently in progress. Returns true if successful false
   * otherwise.
   *
   * Implements rfc 821: RSET <CRLF>
   *
   * SMTP CODE SUCCESS: 250
   * SMTP CODE ERROR  : 500,501,504,421
   * @access public
   * @return bool
   */
  public function Reset() {
    $this->error = null; // so no confusion is caused

    if(!$this->connected()) {
      $this->error = array(
              "error" => "Called Reset() without being connected");
      return false;
    }

    fputs($this->smtp_conn,"RSET" . $this->CRLF);

    $rply = $this->get_lines();
    $code = substr($rply,0,3);

    if($this->do_debug >= 2) {
      echo "SMTP -> FROM SERVER:" . $this->CRLF . $rply;
    }

    if($code != 250) {
      $this->error =
        array("error" => "RSET failed",
              "smtp_code" => $code,
              "smtp_msg" => substr($rply,4));
      if($this->do_debug >= 1) {
        echo "SMTP -> ERROR: " . $this->error["error"] .
                 ": " . $rply . $this->CRLF;
      }
      return false;
    }

    return true;
  }

  /**
   * Starts a mail transaction from the email address specified in
   * $from. Returns true if successful or false otherwise. If True
   * the mail transaction is started and then one or more Recipient
   * commands may be called followed by a Data command. This command
   * will send the message to the users terminal if they are logged
   * in.
   *
   * Implements rfc 821: SEND <SP> FROM:<reverse-path> <CRLF>
   *
   * SMTP CODE SUCCESS: 250
   * SMTP CODE SUCCESS: 552,451,452
   * SMTP CODE SUCCESS: 500,501,502,421
   * @access public
   * @return bool
   */
  public function Send($from) {
    $this->error = null; // so no confusion is caused

    if(!$this->connected()) {
      $this->error = array(
              "error" => "Called Send() without being connected");
      return false;
    }

    fputs($this->smtp_conn,"SEND FROM:" . $from . $this->CRLF);

    $rply = $this->get_lines();
    $code = substr($rply,0,3);

    if($this->do_debug >= 2) {
      echo "SMTP -> FROM SERVER:" . $this->CRLF . $rply;
    }

    if($code != 250) {
      $this->error =
        array("error" => "SEND not accepted from server",
              "smtp_code" => $code,
              "smtp_msg" => substr($rply,4));
      if($this->do_debug >= 1) {
        echo "SMTP -> ERROR: " . $this->error["error"] .
                 ": " . $rply . $this->CRLF;
      }
      return false;
    }
    return true;
  }

  /**
   * Starts a mail transaction from the email address specified in
   * $from. Returns true if successful or false otherwise. If True
   * the mail transaction is started and then one or more Recipient
   * commands may be called followed by a Data command. This command
   * will send the message to the users terminal if they are logged
   * in and send them an email.
   *
   * Implements rfc 821: SAML <SP> FROM:<reverse-path> <CRLF>
   *
   * SMTP CODE SUCCESS: 250
   * SMTP CODE SUCCESS: 552,451,452
   * SMTP CODE SUCCESS: 500,501,502,421
   * @access public
   * @return bool
   */
  public function SendAndMail($from) {
    $this->error = null; // so no confusion is caused

    if(!$this->connected()) {
      $this->error = array(
          "error" => "Called SendAndMail() without being connected");
      return false;
    }

    fputs($this->smtp_conn,"SAML FROM:" . $from . $this->CRLF);

    $rply = $this->get_lines();
    $code = substr($rply,0,3);

    if($this->do_debug >= 2) {
      echo "SMTP -> FROM SERVER:" . $this->CRLF . $rply;
    }

    if($code != 250) {
      $this->error =
        array("error" => "SAML not accepted from server",
              "smtp_code" => $code,
              "smtp_msg" => substr($rply,4));
      if($this->do_debug >= 1) {
        echo "SMTP -> ERROR: " . $this->error["error"] .
                 ": " . $rply . $this->CRLF;
      }
      return false;
    }
    return true;
  }

  /**
   * Starts a mail transaction from the email address specified in
   * $from. Returns true if successful or false otherwise. If True
   * the mail transaction is started and then one or more Recipient
   * commands may be called followed by a Data command. This command
   * will send the message to the users terminal if they are logged
   * in or mail it to them if they are not.
   *
   * Implements rfc 821: SOML <SP> FROM:<reverse-path> <CRLF>
   *
   * SMTP CODE SUCCESS: 250
   * SMTP CODE SUCCESS: 552,451,452
   * SMTP CODE SUCCESS: 500,501,502,421
   * @access public
   * @return bool
   */
  public function SendOrMail($from) {
    $this->error = null; // so no confusion is caused

    if(!$this->connected()) {
      $this->error = array(
          "error" => "Called SendOrMail() without being connected");
      return false;
    }

    fputs($this->smtp_conn,"SOML FROM:" . $from . $this->CRLF);

    $rply = $this->get_lines();
    $code = substr($rply,0,3);

    if($this->do_debug >= 2) {
      echo "SMTP -> FROM SERVER:" . $this->CRLF . $rply;
    }

    if($code != 250) {
      $this->error =
        array("error" => "SOML not accepted from server",
              "smtp_code" => $code,
              "smtp_msg" => substr($rply,4));
      if($this->do_debug >= 1) {
        echo "SMTP -> ERROR: " . $this->error["error"] .
                 ": " . $rply . $this->CRLF;
      }
      return false;
    }
    return true;
  }

  /**
   * This is an optional command for SMTP that this class does not
   * support. This method is here to make the RFC821 Definition
   * complete for this class and __may__ be implimented in the future
   *
   * Implements from rfc 821: TURN <CRLF>
   *
   * SMTP CODE SUCCESS: 250
   * SMTP CODE FAILURE: 502
   * SMTP CODE ERROR  : 500, 503
   * @access public
   * @return bool
   */
  public function Turn() {
    $this->error = array("error" => "This method, TURN, of the SMTP ".
                                    "is not implemented");
    if($this->do_debug >= 1) {
      echo "SMTP -> NOTICE: " . $this->error["error"] . $this->CRLF;
    }
    return false;
  }

  /**
   * Verifies that the name is recognized by the server.
   * Returns false if the name could not be verified otherwise
   * the response from the server is returned.
   *
   * Implements rfc 821: VRFY <SP> <string> <CRLF>
   *
   * SMTP CODE SUCCESS: 250,251
   * SMTP CODE FAILURE: 550,551,553
   * SMTP CODE ERROR  : 500,501,502,421
   * @access public
   * @return int
   */
  public function Verify($name) {
    $this->error = null; // so no confusion is caused

    if(!$this->connected()) {
      $this->error = array(
              "error" => "Called Verify() without being connected");
      return false;
    }

    fputs($this->smtp_conn,"VRFY " . $name . $this->CRLF);

    $rply = $this->get_lines();
    $code = substr($rply,0,3);

    if($this->do_debug >= 2) {
      echo "SMTP -> FROM SERVER:" . $this->CRLF . $rply;
    }

    if($code != 250 && $code != 251) {
      $this->error =
        array("error" => "VRFY failed on name '$name'",
              "smtp_code" => $code,
              "smtp_msg" => substr($rply,4));
      if($this->do_debug >= 1) {
        echo "SMTP -> ERROR: " . $this->error["error"] .
                 ": " . $rply . $this->CRLF;
      }
      return false;
    }
    return $rply;
  }

  /*******************************************************************
   *                       INTERNAL FUNCTIONS                       *
   ******************************************************************/

  /**
   * Read in as many lines as possible
   * either before eof or socket timeout occurs on the operation.
   * With SMTP we can tell if we have more lines to read if the
   * 4th character is '-' symbol. If it is a space then we don't
   * need to read anything else.
   * @access private
   * @return string
   */
  private function get_lines() {
    $data = "";
    while($str = @fgets($this->smtp_conn,515)) {
      if($this->do_debug >= 4) {
        echo "SMTP -> get_lines(): \$data was \"$data\"" .
                 $this->CRLF;
        echo "SMTP -> get_lines(): \$str is \"$str\"" .
                 $this->CRLF;
      }
      $data .= $str;
      if($this->do_debug >= 4) {
        echo "SMTP -> get_lines(): \$data is \"$data\"" . $this->CRLF;
      }
      // if the 4th character is a space then we are done reading
      // so just break the loop
      if(substr($str,3,1) == " ") { break; }
    }
    return $data;
  }

}

?>

1:F:\git\coin\bisheng commerce\App\Common\Common\easybitcoin.php
<?php
/*
EasyBitcoin-PHP

A simple class for making calls to Bitcoin's API using PHP.
https://github.com/aceat64/EasyBitcoin-PHP

====================

The MIT License (MIT)

Copyright (c) 2013 Andrew LeCody

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

====================

// Initialize Bitcoin connection/object
$bitcoin = new Bitcoin('username','password');

// Optionally, you can specify a host and port.
$bitcoin = new Bitcoin('username','password','host','port');
// Defaults are:
//	host = localhost
//	port = 8332
//	proto = http

// If you wish to make an SSL connection you can set an optional CA certificate or leave blank
// This will set the protocol to HTTPS and some CURL flags
$bitcoin->setSSL('/full/path/to/mycertificate.cert');

// Make calls to bitcoind as methods for your object. Responses are returned as an array.
// Examples:
$bitcoin->getinfo();
$bitcoin->getrawtransaction('0e3e2357e806b6cdb1f70b54c3a3a17b6714ee1f0e68bebb44a74b1efd512098',1);
$bitcoin->getblock('000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f');

// The full response (not usually needed) is stored in $this->response while the raw JSON is stored in $this->raw_response

// When a call fails for any reason, it will return FALSE and put the error message in $this->error
// Example:
echo $bitcoin->error;

// The HTTP status code can be found in $this->status and will either be a valid HTTP status code or will be 0 if cURL was unable to connect.
// Example:
echo $bitcoin->status;

*/

class Bitcoin {
    // Configuration options
    private $username;
    private $password;
    private $proto;
    private $host;
    private $port;
    private $url;
    private $CACertificate;

    // Information and debugging
    public $status;
    public $error;
    public $raw_response;
    public $response;

    private $id = 0;

    /**
     * @param string $username
     * @param string $password
     * @param string $host
     * @param int $port
     * @param string $proto
     * @param string $url
     */
    function __construct($username, $password, $host = 'localhost', $port = 8332, $url = null) {
        $this->username      = $username;
        $this->password      = $password;
        $this->host          = $host;
        $this->port          = $port;
        $this->url           = $url;

        // Set some defaults
        $this->proto         = 'http';
        $this->CACertificate = null;
    }

    /**
     * @param string|null $certificate
     */
    function setSSL($certificate = null) {
        $this->proto         = 'https'; // force HTTPS
        $this->CACertificate = $certificate;
    }

    function __call($method, $params) {
        $this->status       = null;
        $this->error        = null;
        $this->raw_response = null;
        $this->response     = null;

        // If no parameters are passed, this will be an empty array
        $params = array_values($params);

        // The ID should be unique for each call
        $this->id++;

        // Build the request, it's ok that params might have any empty array
        $request = json_encode(array(
            'method' => $method,
            'params' => $params,
            'id'     => $this->id
        ));

        // Build the cURL session
        $curl    = curl_init("{$this->proto}://{$this->username}:{$this->password}@{$this->host}:{$this->port}/{$this->url}");
        $options = array(
            CURLOPT_RETURNTRANSFER => TRUE,
            CURLOPT_FOLLOWLOCATION => TRUE,
            CURLOPT_MAXREDIRS      => 10,
            CURLOPT_HTTPHEADER     => array('Content-type: application/json'),
            CURLOPT_POST           => TRUE,
            CURLOPT_POSTFIELDS     => $request
        );

        // This prevents users from getting the following warning when open_basedir is set:
        // Warning: curl_setopt() [function.curl-setopt]: CURLOPT_FOLLOWLOCATION cannot be activated when in safe_mode or an open_basedir is set
        if (ini_get('open_basedir')) {
            unset($options[CURLOPT_FOLLOWLOCATION]);
        }

        if ($this->proto == 'https') {
            // If the CA Certificate was specified we change CURL to look for it
            if ($this->CACertificate != null) {
                $options[CURLOPT_CAINFO] = $this->CACertificate;
                $options[CURLOPT_CAPATH] = DIRNAME($this->CACertificate);
            }
            else {
                // If not we need to assume the SSL cannot be verified so we set this flag to FALSE to allow the connection
                $options[CURLOPT_SSL_VERIFYPEER] = FALSE;
            }
        }

        curl_setopt_array($curl, $options);

        // Execute the request and decode to an array
        $this->raw_response = curl_exec($curl);
        $this->response     = json_decode($this->raw_response, TRUE);

        // If the status is not 200, something is wrong
        $this->status = curl_getinfo($curl, CURLINFO_HTTP_CODE);

        // If there was no error, this will be an empty string
        $curl_error = curl_error($curl);

        curl_close($curl);

        if (!empty($curl_error)) {
            $this->error = $curl_error;
        }

        if ($this->response['error']) {
            // If bitcoind returned an error, put that in $this->error
            $this->error = $this->response['error']['message'];
        }
        elseif ($this->status != 200) {
            // If bitcoind didn't return a nice error message, we need to make our own
            switch ($this->status) {
                case 400:
                    $this->error = 'HTTP_BAD_REQUEST';
                    break;
                case 401:
                    $this->error = 'HTTP_UNAUTHORIZED';
                    break;
                case 403:
                    $this->error = 'HTTP_FORBIDDEN';
                    break;
                case 404:
                    $this->error = 'HTTP_NOT_FOUND';
                    break;
            }
        }

        if ($this->error) {
            return FALSE;
        }

        return $this->response['result'];
    }
}

2:F:\git\coin\bisheng commerce\App\Common\Common\function.php
<?php
/**
 * Created by PhpStorm.
 * User: "姜鹏"
 * Date: 16-3-8
 * Time: 下午4:57
 */
/**
 * 格式化信息类型
 * @param $type 参数(信息类型的参数）
 * @return string 返回值 把数字类型的参数 转换成汉字类型
 *
 */
function message_format_type($type){
    switch($type){
        case 1:$name="";break;
    }
    return $name;
}


/**
 * 验证邮箱
 * @param $email
 * @return bool
 */
function checkEmail($email){
    $pattern = "/^([0-9A-Za-z\\-_\\.]+)@([0-9a-z]+\\.[a-z]{2,3}(\\.[a-z]{2})?)$/i";
    if(preg_match($pattern, $email)){
        return true;
    }else{
        return false;
    }
}
/**
 * 验证手机号支持以下号段
 *      移动：134、135、136、137、138、139、150、151、152、157、158、159、182、183、184、187、188、178(4G)、147(上网卡)；
联通：130、131、132、155、156、185、186、176(4G)、145(上网卡)；
电信：133、153、180、181、189 、177(4G)；
卫星通信：1349
虚拟运营商：170
 * @param $mobile
 * @return bool
 */
function checkMobile($mobile) {
    if (!is_numeric($mobile)) {
        return false;
    }
    return preg_match('#^13[\d]{9}$|^14[5,7]{1}\d{8}$|^15[^4]{1}\d{8}$|^17[0,6,7,8]{1}\d{8}$|^18[\d]{9}$#', $mobile) ? true : false;
}

/**
 * 截取字符串
 * @param $str
 * @param int $start
 * @param $length
 * @param string $charset
 * @param bool $suffix
 * @return string
 */

function msubstr($str, $start=0, $length, $charset="utf-8", $suffix=true){
    if(function_exists("mb_substr")){
        $slice= mb_substr($str, $start, $length, $charset);
    }elseif(function_exists('iconv_substr')) {
        $slice= iconv_substr($str,$start,$length,$charset);
    }else{
        $re['utf-8'] = "/[x01-x7f]|[xc2-xdf][x80-xbf]|[xe0-xef][x80-xbf]{2}|[xf0-xff][x80-xbf]{3}/";
        $re['gb2312'] = "/[x01-x7f]|[xb0-xf7][xa0-xfe]/";
        $re['gbk'] = "/[x01-x7f]|[x81-xfe][x40-xfe]/";
        $re['big5'] = "/[x01-x7f]|[x81-xfe]([x40-x7e]|xa1-xfe])/";
        preg_match_all($re[$charset], $str, $match);
        $slice = join("",array_slice($match[0], $start, $length));
    }
    $fix='';
    if(strlen($slice) < strlen($str)){
        $fix='';
    }
    return $suffix ? $slice.$fix : $slice;
}
//委托状态格式化
function enstrustStatus($num){
    switch ($num){
        case 0:$data="未成交";break;
        case 1:$data="部分成交";break;
        case 2:$data="已成交";break;
        case 3:$data="已撤销";break;
        case 4:$data="全部";break;
        default:$data="暂无";
    }
    return $data;
}
//充值状态格式化
function payStatus($num){
    switch ($num){
        case 0:$data="请付款";break;
        case 1:$data="充值成功";break;
        case 2:$data="充值失败";break;
        case 3:$data="已失效";break;
        default:$data="暂无";
    }
    return $data;
}
//提现状态格式化
function drawStatus($num){
    switch ($num){
        case 0:$data="未通过";break;
        case 1:$data="未通过";break;
        case 2:$data="通过";break;
        case 3:$data="审核中";break;
        default:$data="暂无";
    }
    return $data;
}
//充值状态格式化
function zhongchouStatus($num){
    switch ($num){
        case 0:$data="新众筹";break;
        case 1:$data="众筹开始";break;
        case 2:$data="众筹结束";break;
        case 3:$data="众筹结束";break;
        default:$data="暂无";
    }
    return $data;
}

/**委托记录状态
 * @param $status  状态
 * @return string
 */
function getOrdersStatus($status){
    switch($status){
        case 0 : $data =  "挂单";
            break;
        case 1 : $data =  "部分成交";
            break;
        case 2 : $data =  "成交";
            break;
        case -1 : $data =  "已撤销";
            break;
        default: $data="未知状态";
    }
    return $data;
}

/**委托记录type
 * @param $type
 * @return string
 */
function getOrdersType($type){
    switch($type){
        case "buy": $data="买入";
            break;
        case "sell" : $data="卖出";
            break;
        default: $data="未知状态";
    }
    return $data;
}

/**
 * 验证密码长度在6-20个字符之间
 * @param $pwd
 * @return bool
 */
function checkPwd($pwd){
    $pattern="/^[\\w-\\.]{6,20}$/";
    if(preg_match($pattern, $pwd)){
        return true;
    }else{
        return false;
    }
}


/**
 *  发送邮箱
 * @param String $emailHost 您的企业邮局域名
 * @param String $emailUserName 邮局用户名(请填写完整的email地址)
 * @param String $emailPassWord 邮局密码
 * @param String $formName 邮件发送者名称
 * @param String $email  收件人邮箱，收件人姓名
 * @param String $title	发送标题
 * @param String $body	发送内容
 * @return boolean
 */
function setPostEmail($emailHost,$emailUserName,$emailPassWord,$formName,$email,$title,$body) {
    // 以下内容为发送邮件
    require_once('class.phpmailer.php');//下载的文件必须放在该文件所在目录
    $mail=new PHPMailer();//建立邮件发送类
    $mail->IsSMTP();//使用SMTP方式发送 设置设置邮件的字符编码，若不指定，则为'UTF-8
    $mail->Host=$emailHost;//'smtp.qq.com';//您的企业邮局域名
    $mail->SMTPAuth=true;//启用SMTP验证功能   设置用户名和密码。
    $mail->Username=$emailUserName;//'mail@koumang.com'//邮局用户名(请填写完整的email地址)
//    $mail->Username='admin@shikeh.com';//邮局用户名(请填写完整的email地址)
//    $mail->Password='WWW15988999998com';//邮局密码
    $mail->Password=$emailPassWord;//'xiaowei7758258'//邮局密码
    $mail->From=$emailUserName;//'mail@koumang.com'//邮件发送者email地址
    $mail->FromName=$formName;//邮件发送者名称
    $mail->AddAddress($email);// 收件人邮箱，收件人姓名
    //$mail->AddBCC('chnsos@126.com',$_SESSION['clean']['name']);//收件人地址，可以替换成任何想要接收邮件的email信箱,格式是AddAddress("收件人email","收件人姓名")
    $mail->IsHTML(true); // set email format to HTML //是否使用HTML格式
    $mail->Subject="=?UTF-8?B?".base64_encode($title)."?=";
    $mail->Body=$body; //邮件内容
    $mail->AltBody = "这是一封HTML格式的电子邮件。"; //附加信息，可以省略
    $mail->Send();
    return $mail->ErrorInfo;
}

/**
 * 人民币格式化
 * @param $num
 * @return array|bool|string
 */
function num_format($num){
    if(!is_numeric($num)){
        return false;
    }
    $rvalue='';
    $num = explode('.',$num);//把整数和小数分开
    $rl = !isset($num['1']) ? '' : $num['1'];//小数部分的值
    $j = strlen($num[0]) % 3;//整数有多少位
    $sl = substr($num[0], 0, $j);//前面不满三位的数取出来
    $sr = substr($num[0], $j);//后面的满三位的数取出来
    $i = 0;
    while($i <= strlen($sr)){
        $rvalue = $rvalue.','.substr($sr, $i, 3);//三位三位取出再合并，按逗号隔开
        $i = $i + 3;
    }
    $rvalue = $sl.$rvalue;
    $rvalue = substr($rvalue,0,strlen($rvalue)-1);//去掉最后一个逗号
    $rvalue = explode(',',$rvalue);//分解成数组
    if($rvalue[0]==0){
        array_shift($rvalue);//如果第一个元素为0，删除第一个元素
    }
    $rv = $rvalue[0];//前面不满三位的数
    for($i = 1; $i < count($rvalue); $i++){
        $rv = $rv.','.$rvalue[$i];
    }
    if(!empty($rl)){
        $rvalue = $rv.'.'.$rl;//小数不为空，整数和小数合并
    }else{
        $rvalue = $rv;//小数为空，只有整数
    }
    return $rvalue;
}
//******************************
/**
 * 发送短信
*
* @param string $mobile 手机号码
* @param string $name 短信头
* @param string $user_name 短信账户
* @param string $user_password 短息密码
* @param string $needstatus 是否需要状态报告
* @param string $product 产品id，可选
* @param string $extno   扩展码，可选
*/
function sandPhone( $mobile, $name, $user_name, $user_password, $needstatus = 'true', $product = '', $extno = '') {
	$PORT=80;//端口号默认80
	$IP="222.73.117.156";
	$chuanglan_config['api_account']=iconv('UTF-8', 'UTF-8',$user_name);
	$chuanglan_config['api_password']=iconv('UTF-8', 'UTF-8', $user_password);
	$chuanglan_config['api_send_url']="http://".$IP.":".$PORT."/msg/HttpBatchSendSM";
	$code = rand(100000,999999);
	session(array('name'=>'code','expire'=>600));
	session('code',$code);  //设置session
	session('num',session('num')+1);  //设置session
	session('time',time());
	
	/*if (session('num')>3){	
			$arr[1]="121";
			return $arr;
 	}*/
	
	$data="您好，您的验证码是".$code;//要发送的短信内容
	$content=mb_convert_encoding("$data",'UTF-8', 'UTF-8');
	//创蓝接口参数
	$postArr = array (
			'account' => $chuanglan_config['api_account'],
			'pswd' => $chuanglan_config['api_password'],
			'msg' => $content,
			'mobile' => $mobile,
			'needstatus' => $needstatus,
			'product' => $product,
			'extno' => $extno
	);

	$result = curlPost( $chuanglan_config['api_send_url'] , $postArr);
	$result=execResult($result);
	return $result;
}

/**
 * 处理返回值
 *
 */
function execResult($result){
	$result=preg_split("/[,\r\n]/",$result);
	return $result;
}


/**
 * 通过CURL发送HTTP请求
 * @param string $url  //请求URL
 * @param array $postFields //请求参数
 * @return mixed
 */
function curlPost($url,$postFields){
	$postFields = http_build_query($postFields);
	$ch = curl_init ();
	curl_setopt ( $ch, CURLOPT_POST, 1 );
	curl_setopt ( $ch, CURLOPT_HEADER, 0 );
	curl_setopt ( $ch, CURLOPT_RETURNTRANSFER, 1 );
	curl_setopt ( $ch, CURLOPT_URL, $url );
	curl_setopt ( $ch, CURLOPT_POSTFIELDS, $postFields );
	$result = curl_exec ( $ch );
	curl_close ( $ch );

	return $result;
}

function chuanglan_status($num){
	switch ($num){
		case 0;$name="短消息发送成功";break;
		case 101;$name="无此用户";break;
		case 102;$name="密码错";break;
		case 103;$name="提交过快(提交速度超过流速限制)";break;
		case 104;$name="系统忙（因平台侧原因，暂时无法处理提交的短信）";break;
		case 105;$name="敏感短信（短信内容包含敏感词）";break;
		case 106;$name="消息长度错（>536或<=0）";break;
		case 107;$name="包含错误的手机号码";break;
		case 108;$name="手机号码个数错（群发>50000或<=0;单发>200或<=0）";break;
		case 109:$name="无发送额度（该用户可用短信数已使用完）";break;
		case 110:$name="不在发送时间内";break;
		case 111:$name="超出该账户当月发送额度限制";break;
		case 112:$name="无此产品，用户没有订购该产品";break;
		case 113:$name="extno格式错（非数字或者长度不对)";break;
		case 115:$name="自动审核驳回";break;
		case 116:$name="签名不合法，未带签名（用户必须带签名的前提下）";break;
		case 117:$name="IP地址认证错,请求调用的IP地址不是系统登记的IP地址";break;
		case 118:$name="用户没有相应的发送权限";break;
		case 119:$name="用户已过期";break;
		case 120:$name="短信内容不在白名单中";break;
		case 121:$name="您已经超出短信发送次数限制";break;
		default:$name="系统错误，请及时联系管理员";break;
	}
	return $name;

}
//********************

/** 短信宝短信认证
 * @param $phone 电话号码
 * @param $name  发送标题
 * @param $user  短息接口用户名
 * @param $pass  短信接口密码
 * @return mixed 错误信息
 */
function sandPhone1 ($phone,$name,$user,$pass){
    $statusStr = array(
        "0" => "短信发送成功",
        "-1" => "参数不全",
        "-2" => "服务器空间不支持,请确认支持curl或者fsocket，联系您的空间商解决或者更换空间！",
        "30" => "密码错误",
        "40" => "账号不存在",
        "41" => "余额不足",
        "42" => "帐户已过期",
        "43" => "IP地址限制",
        "50" => "内容含有敏感词",
        "100"=>'您操作太频繁，请稍后再试',
        "101"=>'您已经超出短信发送次数限制'
    );
    if (session('num')>3){
        return $statusStr['101'];
    }
    $smsapi = "http://api.smsbao.com/";
    $pass = md5($pass); //短信平台密码
    $time=session('time');
    if (time()-$time<180&&!empty($time)){
        return $statusStr['100'];
    }
    $code=rand(1000, 9999);
    session(array('name'=>'code','expire'=>600));
    session('code',$code);  //设置session
    session('num',session('num')+1);  //设置session
    session('time',time());
    $content="【".$name."】您的验证码为".$code."，请不要泄漏给他人。";//要发送的短信内容
    $sendurl = $smsapi."sms?u=".$user."&p=".$pass."&m=".$phone."&c=".urlencode($content);
    $result =file_get_contents($sendurl) ;
//     dump($user);dump($pass);dump($phone);dump($content);die;
    return $statusStr[$result];
}
/**
 * 验证手机
 * @param $code
 * @return bool
 */
function checkPhoneCode($code){
    if (session('code')!=$code){
        return  false;
    }else {
        return true;
    }
}

/**
 * 随机数字英文字符
 * @param $param 长度
 * @return string 随机数
 */
function getRandom($param){
    $str="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
    $key = "";
    for($i=0;$i<$param;$i++)
    {
        $key .= $str{mt_rand(0,32)};    //生成php随机数
    }
    return $key;
}
/**
 * 财务日志添加
 * @param unknown $member_id 用户id
 * @param unknown $type	   类型
 * @param unknown $content 说明
 * @param unknown $money	变动资金
 * @param unknown $money_type	支出=2/收入=1
 * @param unknown $currency_id	币种 默认为0 为人民币
 * @return boolean
 */
function  addFinanceLog($member_id,$type,$content,$money,$money_type,$currency_id=0){
	$finance=M('Finance');
	$data['money_type']=$money_type;//收入或者支出
	$data['member_id']=$member_id;//用户id
	$data['type']=$type;//类型
	$data['content']=$content;//变动说明
	$data['money']=$money;//变动资金数量
	$data['add_time']=time();//添加时间
	$data['currency_id']=$currency_id;//币种
	$data['ip']=get_client_ip();//ip
	$data['status']=0;
	$r=$finance->data($data)->add();
	if($r){
		return true;
	}else {
		return false;
	}
}
/**
 * 格式化挂单记录status状态
 * @param unknown $status   状态
 * @return unknown
 */
 function formatOrdersStatus($status){
	switch($status){
		case 0: $status = '未成交' ;break;
		case 1: $status = '部分成交' ;break;
		case 2: $status = '已成交' ;break;
		case -1: $status = '已撤销' ;break;
		default: $status = '未成交' ;break;
	}
	return  $status;
}
/**
 * 格式化用户名
 * @param unknown $currency_id   币种id
 * @return unknown
 */
 function getCurrencynameByCurrency($currency_id){
     if(isset($currency_id)){
     	if($currency_id==0){
             return "人民币";
         }
     	return  M('Currency')->field('currency_name')->where("currency_id='{$currency_id}'")->find()['currency_name'];
	}else{
         return "未知钱币";
     }
}

/**
 * 格式化用户名
 * @param unknown $member_id
 */
 function getMemberNameByMemberid($member_id){
 	$where['member_id']= $member_id;
 	$list = M('Member')->field('name')->where($where)->find();
 	return !empty($list)?$list['name']:'无';
 }

function getMemberEmailByMember_id($member_id){
    $where['member_id']= $member_id;
    $list = M('Member')->field('email')->where($where)->find();
    return !empty($list)?$list['email']:'无';
}

//格式化挂单买单还是卖单
function fomatOrdersType($type){
    switch ($type){
        case 'buy':$type='买';break;
        case 'sell':$type='卖';break;
        default:$type='无';
    }
    return $type;
}

//计算卖出比例
function setOrdersTradeNum($num,$trade_num){
   return 100-($trade_num/$num*100);
}

/**委托记录状态
 * @param $status  状态
 * @return string
 */
function formatMemberStatus($status){
    switch($status){
        case 0 : $status =  "挂单";
            break;
        case 1 : $status =  "部分成交";
            break;
        case 2 : $status =  "成交";
            break;
        default: $status="未知状态";
    }
    return $status;
}

/**
 * 根据众筹id号查找一共众筹次数
 * @param $id 用户ID
 * @return mixed 次数
 */
function getIssueMemberCountByIssueId($id){
    $re = M('Issue_log')->where("iid = '{$id}'")->count("DISTINCT uid");
    if($re){
        return $re;
    }else{
        return 0;
    }
}


/**
 *  给分页传参数
 * @param  mixed $Page 分页对象
 * @param array $parameter 传参数组
 */
function setPageParameter($Page,$parameter){
    foreach ($parameter as $k=> $v){
        if (isset($v)){
            $Page->parameter[$k]=$v;
        }
    }
}
/**
 * 获取用户状态
 * @param string $status 状态
 * @return boolean|string 状态
 */
function getMemberStatus($status){
	if(empty($status)){
		return false;
	}
	switch($status){
		case 0 : $status =  "未填写个人信息";
		break;
		case 1 : $status =  "正常";
		break;
		case 2 : $status =  "禁用";
		break;
		default: $status="未知状态";
	}
	return $status;
}
       /**
 * 导出数据为excel表格
 * 
 * @param $data 一个二维数组,结构如同从数据库查出来的数组        	
 * @param $title excel的第一行标题,一个数组,如果为空则没有标题        	
 * @param $filename 下载的文件名
 *        	@examlpe
 *        	$stu = M ('User');
 *        	$arr = $stu -> select();
 *        	exportexcel($arr,array('id','账户','密码','昵称'),'文件名!');
 */
function exportexcel($data = array(), $title = array(), $filename = 'report') {
	header ( "Content-type:application/octet-stream" );
	header ( "Accept-Ranges:bytes" );
	header ( "Content-type:application/vnd.ms-excel" );
	header ( "Content-Disposition:attachment;filename=" . $filename . ".xls" );
	header ( "Pragma: no-cache" );
	header ( "Expires: 0" );
	// 导出xls 开始
	if (! empty ( $title )) {
		foreach ( $title as $k => $v ) {
			$title [$k] = iconv ( "UTF-8", "GB2312", $v );
		}
		$title = implode ( "\t", $title );
		echo "$title\n";
	}
	if (! empty ( $data )) {
		foreach ( $data as $key => $val ) {
			foreach ( $val as $ck => $cv ) {
				$data [$key] [$ck] = iconv ( "UTF-8", "GB2312", $cv );
			}
			$data [$key] = implode ( "\t", $data [$key] );
		}
		echo implode ( "\n", $data );
	}
}
 
/**
 * 检测sql
 * @param unknown $sql_str 语句
 * @return unknown 
 */
function inject_check($sql_str) {
	$check= eregi('select|insert|update|delete|\'|\/\*|\*|\.\.\/|\.\/|union|into|load_file|outfile', $sql_str);
	if($check){
		return true;
	}else{
		return false;
	}
}


3:F:\git\coin\bisheng commerce\App\Common\Common\index.html
 

4:F:\git\coin\bisheng commerce\App\Common\Common\jsonRPCClient.php
<?php
/*
					COPYRIGHT

Copyright 2007 Sergio Vaccaro <sergio@inservibile.org>

This file is part of JSON-RPC PHP.

JSON-RPC PHP is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

JSON-RPC PHP is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with JSON-RPC PHP; if not, write to the Free Software
Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
*/

/**
 * The object of this class are generic jsonRPC 1.0 clients
 * http://json-rpc.org/wiki/specification
 *
 * @author sergio <jsonrpcphp@inservibile.org>
 */
class jsonRPCClient {
	
	/**
	 * Debug state
	 *
	 * @var boolean
	 */
	private $debug;
	
	/**
	 * The server URL
	 *
	 * @var string
	 */
	private $url;
	/**
	 * The request id
	 *
	 * @var integer
	 */
	private $id;
	/**
	 * If true, notifications are performed instead of requests
	 *
	 * @var boolean
	 */
	private $notification = false;
	
	/**
	 * Takes the connection parameters
	 *
	 * @param string $url
	 * @param boolean $debug
	 */
	public function __construct($url,$debug = false) {
		// server URL
		$this->url = $url;
		// proxy
		empty($proxy) ? $this->proxy = '' : $this->proxy = $proxy;
		// debug state
		empty($debug) ? $this->debug = false : $this->debug = true;
		// message id
		$this->id = 1;
	}
	
	/**
	 * Sets the notification state of the object. In this state, notifications are performed, instead of requests.
	 *
	 * @param boolean $notification
	 */
	public function setRPCNotification($notification) {
		empty($notification) ?
							$this->notification = false
							:
							$this->notification = true;
	}
	
	/**
	 * Performs a jsonRCP request and gets the results as an array
	 *
	 * @param string $method
	 * @param array $params
	 * @return array
	 */
	public function __call($method,$params) {
		
		// check
		if (!is_scalar($method)) {
			throw new Exception('Method name has no scalar value');
		}
		
		// check
		if (is_array($params)) {
			// no keys
			$params = array_values($params);
		} else {
			throw new Exception('Params must be given as array');
		}
		
		// sets notification or request task
		if ($this->notification) {
			$currentId = NULL;
		} else {
			$currentId = $this->id;
		}
		
		// prepares the request
		$request = array(
						'method' => $method,
						'params' => $params,
						'id' => $currentId
						);
		$request = json_encode($request);
		$this->debug && $this->debug.='***** Request *****'."\n".$request."\n".'***** End Of request *****'."\n\n";
		
		// performs the HTTP POST
		$opts = array ('http' => array (
							'method'  => 'POST',
							'header'  => 'Content-type: application/json',
							'content' => $request
							));
		$context  = stream_context_create($opts);
		if ($fp = fopen($this->url, 'r', false, $context)) {
			$response = '';
			while($row = fgets($fp)) {
				$response.= trim($row)."\n";
			}
			$this->debug && $this->debug.='***** Server response *****'."\n".$response.'***** End of server response *****'."\n";
			$response = json_decode($response,true);
		} else {
			throw new Exception('Unable to connect to '.$this->url);
		}
		
		// debug output
		if ($this->debug) {
			echo nl2br($debug);
		}
		
		// final checks and return
		if (!$this->notification) {
			// check
			if ($response['id'] != $currentId) {
				throw new Exception('Incorrect response id (request id: '.$currentId.', response id: '.$response['id'].')');
			}
			if (!is_null($response['error'])) {
				throw new Exception('Request error: '.$response['error']);
			}
			
			return $response['result'];
			
		} else {
			return true;
		}
	}
}
?>

5:F:\git\coin\bisheng commerce\App\Common\Conf\adminEntrance.php
<?php return array (
  'URL_MODULE_MAP' => 
  array (
    'admin' => 'admin',
  ),
);

6:F:\git\coin\bisheng commerce\App\Common\Conf\config.php
<?php
return array (
		// 加载语言包
		'LOAD_EXT_CONFIG' => 'adminEntrance,db', // 加载扩展配置文件
		'LANG_AUTO_DETECT' => false, // 关闭语言的自动检测，如果你是多语言可以开启
		
		'LANG_SWITCH_ON' => TRUE, // 开启语言包功能，这个必须开启
		
		'DEFAULT_LANG' => 'zh-cn', // zh-cn文件夹名字 /lang/zh-cn/common.php
		'TMPL_PARSE_STRING' => array (
				'__ADMINCSS__' => '/Public/admin/css',
				'__ADMINJS__' => '/Public/admin/js',
				'__ADMINIMG__' => '/Public/admin/images',
				'__HOMECSS__' => '/Public/home/css',
				'__HOMEJS__' => '/Public/home/js',
				'__HOMEIMG__' => '/Public/home/images',
				'__STATICCSS__' => '/Public/static/css',
				'__STATICJS__' => '/Public/static/js',
				'__STATICCIMG__' => '/Public/static/images',
				'__ADMIN__' => '/Public/admin',
				'__HOME__' => '/Public/Home',
				'__STATIC__' => '/Public/static',
				'__PLUGINS__' => '/Public/plugins',
				'__PLUGINSJS__' => '/Public/plugins/js',
				'__PLUGINSCSS__' => '/Public/plugins/css',
				'__PUBLICNEWJS__' => '/Public/new/js',
				'__PUBLICNEWCSS__' => '/Public/new/css' 
		)
		,
		'SZ_QQ_SCOPE'=> 'get_user_info,add_share,list_album,add_album,upload_pic,add_topic,add_one_blog,add_weibo,check_page_fans,add_t,add_pic_t,del_t,get_repost_list,get_info,get_other_info,get_fanslist,get_idolist,add_idol,del_idol,get_tenpay_addr',
		'SZ_QQ_APP_ID'=> '101293145',
		'SZ_QQ_CALLBACK'=> 'http://www.bsd38.com/Home/Login/qqLogin',
		'SZ_QQ_APP_KEY'=> '50388dac9fd9fea0ac2e842b46fb9782',
		// URl
		'URL_CASE_INSENSITIVE' => true,
		'URL_MODEL' => 2,
		'URL_HTML_SUFFIX' => 'html',
		'URL_ROUTER_ON' => true, // 是否开启URL路由
		                                  // Cookie
		'COOKIE_PREFIX' => 'odr',
		
		
		'APP_GROUP_LIST' => 'Home,Admin', // 项目分组设定
		                                  // 模版
		'TMPL_ACTION_SUCCESS' => './App/Common/jump.html',
		'TMPL_ACTION_ERROR' => './App/Common/jump.html',
		
		'TMPL_L_DELIM' => '{', // 模板引擎普通标签开始标记
		'TMPL_R_DELIM' => '}', // 模板引擎普通标签结束标记
		                                 
		// 显示错误信息
		'SHOW_ERROR_MSG' => true,
//          'SHOW_PAGE_TRACE' =>true,
		//关闭debug模式错误跳入404 



//   		'TMPL_EXCEPTION_FILE' =>'./404.html' 


);

7:F:\git\coin\bisheng commerce\App\Common\Conf\db.php
<?php return array (
  'DB_TYPE' => 'mysql',

  'DB_HOST' => 'localhost',
  'DB_NAME' => 'haoid',
  'DB_USER' => 'haoid',
  'DB_PWD' => 'haoid.cn',
  'DB_PORT' => '3306',
  'DB_PREFIX' => 'yang_',
  'DB_FIELDS_CACHE' => true,
  'DB_CHARSET' => 'utf8',
);

8:F:\git\coin\bisheng commerce\App\Common\Conf\index.html
 

9:F:\git\coin\bisheng commerce\App\Common\Controller\CommonController.class.php
<?php
namespace Common\Controller;
use Think\Controller;
use Home\Controller\PublicController;
class CommonController extends Controller {
    protected $config;
    protected $trade;
    protected $member;
    protected $dividendConfig;
    public function _initialize(){
    
    	foreach ($_POST as $v){
    		// 正则表达式 判断是否有selert语句 如果有提示错误
    		$re=inject_check($v);
    		if($re){
    			if(IS_AJAX){
    				$data['stauts']=0;
    				$data['info']="非法字符";
    				$this->ajaxReturn($data);exit;
    			}else{
    				$this->display('Public:404');
    				exit;
    			}
    		   
    		}
    	}
    	foreach ($_GET as $v){
    		// 正则表达式 判断是否有selert语句 如果有提示错误
    		$re=inject_check($v);
    		if($re){
    			if(IS_AJAX){
    				$data['stauts']=0;
    				$data['info']="非法字符";
    				$this->ajaxReturn($data);exit;
    			}else{
    				$this->display('Public:404');
    				exit;
    			}
    		}
    	}
    	
    	
        $list=M("Config")->select();
		foreach ($list as $k=>$v){
            $list[$v['key']]=$v['value'];
        }
        $this->config=$list;
        $this->assign('config',$list);
        
		//分红奖励控制参数
        $dividend=M("Dividend_config")->select();
        foreach ($dividend as $k=>$v){
        	$dividendConfig[$v['name']]=$v['value'];
        }
        
        $this->dividendConfig=$dividendConfig;
        $this->assign('dividendConfig',$dividendConfig);
        
        
        $this->login_limit_time();
 		//帮助中心
		$info_help = M('Article_category')->where('parent_id = 6')->limit(4)->select();
		//团队信息显示
		$info_team = M('Article')->where('position_id = 7')->limit(4)->select();

		$this->assign('help',$info_help);
		$this->assign('team',$info_team);

        
        if(!empty($_SESSION['USER_KEY_ID'])){
            $member=M("Member")->field('*,(rmb+forzen_rmb) as count')->where("member_id='{$_SESSION['USER_KEY_ID']}'")->find();
            $this->member=$member;
            $this->assign("member",$member);
        }
        $this->trade=M('Orders');
        //执行抓取条数
        $newMessageCount = $this->pullMessageCount($_SESSION['USER_KEY_ID']);
        $this->assign('newMessageCount',$newMessageCount);
        
		//币种信息
        $currency=$this->currency();
        $this->assign('currency',$currency);

    }

	/**
 	* 检测是否需要进行信息填写(补全)
 	*/
	protected function  User_status(){
		header("Content-type:text/html;charset=utf-8");
		$list = M('Member')->where(array('member_id'=>session('USER_KEY_ID')))->find();
		if($list['status']==0){
			session('STATUS',0);
			$this->redirect('ModifyMember/modify','',1,"<script>alert('请填写个人信息')</script>");
			exit();
		}
	}

	/**
	 * 查询钱包余额
	 * @param unknown $port_number 端口号
	 * @return Ambigous <number, unknown> 剩余的余额
	 */
	protected  function get_qianbao_balance($currency){
		require_once 'App/Common/Common/easybitcoin.php';
		$bitcoin = new \Bitcoin($currency['rpc_user'],$currency['rpc_pwd'],$currency['rpc_url'],$currency['port_number']);
		$money=$bitcoin->getinfo();
		$num=empty($money['balance'])?0:$money['balance'];
		return $num;
	}

    /**
     * 根据ID返回具体分类
     * @param string $id
     * @return boolean|array $list;
     */

    public function getCatById($id=null){
        if (empty($id)){
            return false;
        }
        return M('Article_category')->where("id=$id")->find();
    }

    /**
     * 返回指定父类下面的二级分类
     * @param string $parentId
     * @return boolean|array $list;
     */
    public function getChildCatByParentCat($parentId=null){
        if (empty($parentId)){
            return false;
        }
        return M('Article_category')->where("parent_id=$parentId")->select();
    }
    /**
     * 获取当前币种的信息
     * @param int $id 币种id
     * @return 24H成交量 24H_done_num  24H成交额 24H_done_money 24H涨跌 24H_change 7D涨跌  7D_change
     * @return 最新价格 new_price 买一价 buy_one_price 卖一价 sell_one_price 最高价 max_price 最低价 min_price
     */

    public function getCurrencyMessageById($id){
        $where['currency_id']=$id;
        $time=time();
        //一天前的时间
        $old_time=strtotime(date('Y-m-d',$time));
        //最新价格
        $order='add_time desc';
        $rs=M('Trade')->where($where)->order($order)->find();
        $data['new_price']=$rs['price'];
        //判断价格是升是降
        $re=M('Trade')->where($where)->where("add_time<$old_time")->order($order)->find();
        if($re['price']>$rs['price']){
            //说明价格下降
            $data['new_price_status']=0;
        }else{
            $data['new_price_status']=1;
        }
        //24H涨跌
        $re=M('Trade')->where($where)->where("add_time<$time-60*60*24")->order($order)->find();
        if ($re['price']!=0){
            $data['24H_change']=sprintf("%.2f", ($rs['price']-$re['price'])/$re['price']*100);
            if($data['24H_change']==0){
                $data['24H_change']=100;
            }
        }else {
            $data['24H_change']=100;
        }
        //7D涨跌
        $re=M('Trade')->where($where)->where("add_time<$time-60*60*24*7")->order($order)->find();
        if ($re['price']!=0){
            $data['7D_change']=sprintf("%.2f", ($rs['price']-$re['price'])/$re['price']*100);
            if($data['7D_change']==0){
                $data['7D_change']=100;
            }
        }else {
            $data['7D_change']=100;
        }
        //24H成交量
        $rs=M('Trade')->field('num')->where($where)->where("add_time>$time-60*60*24")->sum('num');
        $data['24H_done_num']=$rs;
        //24H成交额
        $rs=M('Trade')->field('num*price')->where($where)->where("add_time>$time-60*60*24")->sum('num*price');
        $data['24H_done_money']=$rs;
        //最低价
        $data['min_price']=$this->getminPriceTrade($id);
        //最高价
         $data['max_price']=$this->getmaxPriceTrade($id);
        //买一价
        $data['buy_one_price']=$this->getOneOrdersByPrice($id, 'buy');
        //卖一价
        $data['sell_one_price']=$this->getOneOrdersByPrice($id, 'sell');
        //返回
        return $data;
    }
    //获取对应币种，该会员的资产
    public function getCurrencyUser($uid,$cid){
        $where['member_id']=$uid;
        $where['currency_id']=$cid;
        $rs=M('Currency_user')->field('*,(num+forzen_num) as count')->where($where)->find();
        return $rs;
    }
    //获取全部币种信息
    public function currency(){
        $list=M('Currency')->where('is_line=1 ')->order('sort')->select();
        return $list;
    }
    //获取单独币种信息
    public function currency_one($id){
        $list=M('Currency')->where("currency_id=".$id)->find();
        return $list;
    }
    //验证前台登录
    public function checkLogin(){
        if (!$_SESSION['USER_KEY'] || !$_SESSION['USER_KEY_ID']) {
            return false;
        }
        return true;
    }

	//空操作
	public function _empty(){
	    header("HTTP/1.0 404 Not Found");
	    $this->display('Public:404');
	}
	
	
	/**
	 * 根据ID返回具体分类
	 * @param string $id
	 * @return boolean|array $list;
	 */

    /**
     * @param $id 用户ID
     * @return bool 返回用户未读消息条数
     */
    public function pullMessageCount($id){
        if(empty($id)){
            return false;
        }
        if(!$count = M('message')->where(array('member_id'=>$id,'status'=>0))->count()){
            return false;
        }
        return $count;
    }
    /**
     * 添加委托表
     * @param  $member_id   用户id
     * @param  $currency_id 币种id
     * @param  $all_num  全部数量
     * @param  $price
     * @param  $type   卖出单1 还是买入单2
     * @param  $fee  手续费
     * @return
     */
    public function addEntrust($member_id,$currency_id,$all_num,$price,$type,$fee){
        $data['member_id']=$member_id;
        $data['currency_id']=$currency_id;
        $data['all_num']=$all_num;
        $data['surplus_num']=$all_num;
        $data['price']=$price;
        $data['add_time']=time();
        $data['type']=$type;
        $data['fee']=$fee;
        $data['status']=0;
        $list=M('Entrust')->add($data);
        if($list){
            return $list;
        }else{
            return false;
        }
    }

   /**
    *  /**
     * 添加消息库
     * @param int $member_id   用户ID -1 为群发
     * @param int $type    分类  4=系统  -1=文章表系统公告 -2 个人信息
     * @param String $title       标题
     * @param String $content     内容
     * @return bool|mixed  成功返回增加Id 否则 false
     */

    public function addMessage_all($member_id,$type,$title,$content){
        $data['u_id']=$member_id;
        $data['type']=$type;
        $data['title']=$title;
        $data['content']=$content;
        $data['add_time']=time();
        $id=M('Message_all')->add($data);
        if($id){
            return $id;
        }else{
            return false;
        }
    }
    /**
     * 添加财务日志方法
     * @param unknown $member_id
     * @param unknown $type  
     * @param unknown $content
     * @param unknown $money
     * @param unknown $money_type  收入=1/支出=2
     * @param unknown $currency_id  币种id 0是rmb
     * @return 
     */
    public function addFinance($member_id,$type,$content,$money,$money_type,$currency_id){
    	$data['member_id']=$member_id;
    	$data['type']=$type;
    	$data['content']=$content;
    	$data['money_type']=$money_type;
    	$data['money']=$money;
    	$data['add_time']=time();
    	$data['currency_id']=$currency_id;
        $data['ip'] = get_client_ip();
    	$list=M('Finance')->add($data);
    	if($list){
    		return $list;
    	}else{
    		return false;
    	}
    }
    //修正众筹表 计算剩余数量  修改状态
     public function checkZhongchou(){
     	$list=M('Issue')->field('id,add_time,end_time,num,num_nosell,zhongchou_success_bili,status')->select();
     	foreach($list as $k=>$v){
     		$where['id']=$v['id'];
     		if($v['status']==3){
     			M('Issue')->where($where)->setField('end_time',time());
     			continue;
    	 	}
     		if($v['add_time']>time()){
     			M('Issue')->where($where)->setField('status',0);
     		}
     		if($v['add_time']<time()&&$v['end_time']>time()){
     			M('Issue')->where($where)->setField('status',1);
    	 	}
    	 	if($v['end_time']<time()){
    	 		M('Issue')->where($where)->setField('status',2);
    	 		M('Issue')->where($where)->setField('end_time',time());
    	 	}
    	 	$num=M('Issue_log')->where('iid='.$v['id'])->sum('num');
    	 	M('Issue')->where($where)->setField('deal',$v['num']-$num-$v['num_nosell']);
    	 	$limit_num=$v['num']*$v['zhongchou_success_bili']-$v['num_nosell'] ;
    	 	if($num>=$limit_num){
    	 		M('Issue')->where($where)->setField('status',2);
    	 	}
     	}
     }
     //获取会员一次众筹有几次记录
     public function getIssuecountById($uid,$iid){
         if (empty($uid)){
             return 0;
         }
     	$list=M('Issue_log')->where("uid=$uid and iid=$iid")->count();
     	if($list){
     		return $list;
     	}else{
     		return false;
     	}
     }
     //超过时限退出登录方法
     //登录时间存在session里，每次判断当前时间比较，时间过了就清掉SESSION记录
     protected function login_limit_time(){
     	if(!empty($_SESSION['login_time'])){
     		if(!empty($this->config['time_limit'])){
     			if($_SESSION['login_time']<time()-$this->config['time_limit']*60){
     				$_SESSION['login_time']=null;
	     			$_SESSION['USER_KEY_ID']=null;
	       			$_SESSION['USER_KEY']=null;
	       			$_SESSION['STATUS']=null;
	       			$this->redirect('Index/index');
	     		}
     		}
     	}
     	$time=time();
     	$_SESSION['login_time']=$time;
     }
     //设置交易时间，超时不开交易方法
     
     /**
      * 实例化币种
      * @param unknown $currency_id   币种id
      * @return unknown
      */
     public function getCurrencynameById($currency_id){
        if ($currency_id==0){
            return array('currency_name'=>'人民币','currency_mark'=>'CNY','currency_buy_fee'=>0,'currency_sell_fee'=>0);
        }
     	$where['currency_id']= $currency_id;
     	
     	$list = M('Currency')->field('currency_name,currency_mark,currency_buy_fee,currency_sell_fee')->where($where)->find();
     	return $list;
     }
     /**
      *
      * @param int $currency_id 币种id
      * @return array 币种结果集
      */
     protected  function  getCurrencyByCurrencyId($currency_id=0){
		if (empty($currency_id)) {
			$where['currency_id']=array('gt',$currency_id);
		}else{
			$where['currency_id']=array('eq',$currency_id);
		} 	
     	//获取交易币种信息
     	$list= M('Currency')->field("currency_id,price_up,price_down,currency_buy_fee,currency_sell_fee,trade_currency_id,is_lock,rpc_url,rpc_pwd,rpc_user,port_number,currency_all_tibi")->where($where)->select();
    	if (!empty($currency_id)) {
    		return $list[0];  	
     	}else{
     		return $list;
     	}
     }
     
     /**
      * 获取用户名
      * @param unknown $member_id   用户id
      * @return unknown
      */
     public function setUnameById($member_id){
     	 
     	$where['member_id']= $member_id;
     	$list = M('Member')->field('name')->where($where)->find();
     	if(!empty($list)){
     		return $list['name'];
     	}
     }
     /**
      * 设置用户资金表 字段值
      * @param int $member_id  用户id
      * @param int $currenty_id 币种id
      * @param string $key  字段名称
      * @param string $value 字段值
      * @return  boolean 返回执行结果
      */
     protected function  setCurrentyMemberByMemberId($member_id,$currenty_id,$key,$value){
         return   M("Currency_user")->where("member_id=$member_id and  currency_id=$currenty_id")->setField($key,$value);
     

     }
     /**
      * 获取指定数量个人挂单记录
      * @param int $num 数量
      */
     protected function getOrdersByUser($num,$currency_id){
         $where['member_id']=$_SESSION['USER_KEY_ID'];
         $where['status']=array('in',array(0,1));
         $where['currency_id']=$currency_id;
         return  M('Orders')->where($where)->order("add_time desc")->limit($num)->select();
     
     }
     
     /**
      * 设置账户资金
      * @param int $currency_id  币种ID
      * @param int $num 交易数量
      * @param char $inc_dec  setDec setInc 是加钱还是减去
      * @param char forzen_num num
      */
      protected   function setUserMoney($member_id,$currency_id,$num,$inc_dec,$field){
         $inc_dec=strtolower($inc_dec) ;
         $field=strtolower($field) ;
         //允许传入的字段
         if (!in_array($field, array('num','forzen_num'))){
             return false;
         }
         //如果是RMB
         if ($currency_id==0){
             //修正字段
             switch ($field){
                 case 'forzen_num': $field='forzen_rmb';break;
                 case 'num': $field='rmb';break;
             }
             switch ($inc_dec){
                 case 'inc':
                     $msg= M('Member')->where("member_id=$member_id ")->setInc($field,$num);
                     break;
                 case 'dec':
                     $msg= M('Member')->where("member_id=$member_id")->setDec($field,$num);
                     break;
                 default:return false;
             }
             return $msg;
         }else{
             switch ($inc_dec){
                 case 'inc':
                     $msg= M('Currency_user')->where("member_id=$member_id and currency_id=$currency_id")->setInc($field,$num);
                     break;
                 case 'dec':
                     $msg= M('Currency_user')->where("member_id=$member_id and currency_id=$currency_id")->setDec($field,$num);
                     break;
                 default:return false;
             }
             return $msg;
         }
     }
     /**
      * 返回指定状态的挂单记录
      * @param int $status -1 0 1 2
      * @param int $num 数量
      * @param int $currency_id 币种id
      */
    protected function getOrdersByStatus($status,$num,$currency_id){
        $where['currency_id']=$currency_id;
        $where['status']=$status;
        return M('Orders')->where($where)->limit($num)->order('trade_time desc')->select();
    }
     /**
      * 获取指定数量的成交记录
      * @param int $num
      */
     protected function getTradesByNum($num,$currency_id){
         $where['currency_id']=$currency_id;
         return M('Trade')->where($where)->order('add_time desc')->select();
     }
     
     /**
      *  获取当前登陆账号指定币种的金额
      * @param int $currency_id 币种ID
      * @param char $field  num  forzen_num
      * @return array 当前登陆人账号信息
      */
     protected  function getUserMoney($currency_id,$field){
          
         if (empty($currency_id)){
             switch ($field){
                 case 'num':$field='rmb';break;
                 case 'forzen_num':$field='forzen_rmb';break;
                 default:$field='rmb';
             }
             $this->member[$field];
         }else {
             $currency_user= M('Currency_user')->where("member_id={$this->member['member_id']} and currency_id=$currency_id")->find();
         }
         return  isset($this->member[$field])? $this->member[$field]:$currency_user[$field];
     }
      
     /**
      * 返回指定数量排序的挂单记录
      * @param char $type buy sell
      * @param int $num 数量
      * @param char $order 排序 desc asc
      */
       protected function getOrdersByType($currencyid,$type,$num,$order){
         $where['type']=array('eq',$type);
         $where['status']=array('in',array(0,1));
         $where['currency_id']=$currencyid;
         $list= M('Orders')->field("sum(num) as num,sum(trade_num) as trade_num,price,type,status")->where($where)->group('price')->order("price $order, add_time asc")->limit($num)->select();
         foreach ($list as $k=>$v){
             $list[$k]['bili']=100-($v['trade_num']/$v['num']*100);
         }
         if ($type=='sell'){
           $list=  array_reverse($list);
         }
         return $list;
     }

     
//      /**
//       *撤销订单
//       * @param unknown  Int $list  订货单信息
//       * @param unknown  Int $member_id  用户id
//       * @param unknown  Int $order_id  订单号 id
//       */
//      public function cancelByOrderid($list,$member_id,$order_id){
//      	M()->startTrans();
//      	//dump($list['num']);die;
//      	$num = $list['num'];
//      	$trade_num = $list['trade_num'];
//      	$fee = $list['fee'];
//      	$price = $list['price'];
     
//      	if($list['type']  == "sell" ){
//      		$btype = $list['currency_id'];
//      	}else{
//      		$btype = $list['currency_trade_id'];
//      	}
//      	$num = $num - $trade_num;
//      	if($num == 0){
//      		$info['status'] = 4;
//      		$info['info'] = '没有需要撤销的金额';
//      		return $info;
//      	}
     	 
//      	$whereOrder['orders_id'] = $order_id;
//      	$re[] = M('Orders')->where($whereOrder)->setField('status',-1);
     	 
     	 
//      	if($list['currency_trade_id'] == 0){
//      		$whereCurren['member_id'] = $member_id;
//      		$re[] = M('Member')->where($whereCurren)->setInc('rmb',$num);
//      		$re[] = M('Member')->where($whereCurren)->setDec('forzen_rmb',$num);
//      	}else{
//      		$whereCurren['member_id'] = $member_id;
//      		$whereCurren['currency_id'] = $btype;
//      		$re[] = M('currency_user')->where($whereCurren)->setInc('num',$num);
//      		$re[] = M('currency_user')->where($whereCurren)->setDec('forzen_num',$num);
     		 
//      	}
     
//      	if(!in_array(false, $re)){
//      		M()->commit();
//      		$info['status'] = 2;
//      		$info['info'] = '撤销成功';
//      		return $info;
//      	}else{
//      		M()->rollback();
//      		$info['status'] = 3;
//      		$info['info'] = '撤销失败';
     
//      		return $info;
//      	}
//      }
     /**
      * 获取一个挂单记录价格 买一 卖一
      * @param unknown $currencyid
      * @param unknown $type
      * @param unknown $order
      */
     protected function getOneOrdersByPrice($currencyid,$type){
         $where['currency_id']=$currencyid;
         $where['type']=$type;
         $where['status']=array('in',array(0,1));
         switch ($type){
             case 'buy': $order='desc';
             break;
             case 'sell':$order='asc';
             break;
         }
          $orders= M('Orders')->field('price')->where($where)->order('price '.$order)->find();
          return $orders['price'];
     }
     /**
      * 返回最高价
     @param int $currency_id 币种ID
      */
     protected function getMaxPriceTrade($currency_id){
         $order='desc';
         $trade= $this->getTradeByPrice($currency_id,$order);
         return $trade['price'];
     }
     /**
      * 返回最低价
      @param int $currency_id 币种ID
      */
     protected function getminPriceTrade($currency_id){
         $order='asc';
          $trade= $this->getTradeByPrice($currency_id,$order);
          return $trade['price'];
     }
     /**
      * 指定价格一个成交记录
      * @param int $currency_id 币种ID
      * @param char $order 排序
      */
     private function getTradeByPrice($currency_id,$order){
         $where['currency_id']=$currency_id;
        return M('Trade')->field('price')->where($where)->order('price '.$order)->find();

     }

     /**
      * 分红奖励全部
      *@param $money 传入交易金额
      *@param $member_id 用户id 不传自动处理登录用户
      */
     protected function dividend($money,$member_id=''){
     	if(empty($member_id)){
     		$userid=$_SESSION['USER_KEY_ID'];
     	}
     	$num=$this->findDividendMinNum();
     	if(!$num){
     		return ;
     	}
     	//max是还可以获得多少个分红股
     	$max=$this->getUserAddDividendPower($member_id,$num);
     	if(!$max){
     		return ;
     	}
     	//增加用户分红业绩
     	if(!$this->addUserDividendNum($money,$member_id,$max,$num)){
     		return;
     	}
     	$this->addDividend($member_id,$num,$max);
     
     }
     /**
      * 增加用户分红业绩
      * @param $money 用户表dividend_num代表分红业绩与金额等比例
      * @param
      * return 成功失败
      */
     private function addUserDividendNum($money,$member_id,$max){
     	if($money>$max*$this->dividendConfig['money'.$max]){
     		$money=$max*$this->dividendConfig['money'.$max];
     	}
     	$res=M('Member')->where('member_id='.$member_id)->setInc('dividend_num',$money);
     	if($res){
     		return true;
     	}else {
     		return false;
     	}
     }
     /**
      * 判断用户进入获得分红股数量是否超过当日上线
      * @param $money 用户表dividend_num代表分红业绩与金额等比例
      * @param
      * return 还可以获得的分红股数
      */
     private function getUserAddDividendPower($member_id,$num){
     	$max=$this->dividendConfig['max'.$num];
     	$today=strtotime(date('Y-m-d 0:0:0'));
     	$count=M('Finance')
     	->where('type=13 and add_time>'.$today.' and member_id='.$member_id)
     	->select();
     	$money=0;
     	if($count){
     		foreach ($count as $k=>$v){
     			$money+=$v['money'];
     		}
     	}
     	if($money<$this->dividendConfig['max'.$num]){
     		return $this->dividendConfig['max'.$num]-$money;
     	}
     	return false;
     }
     /**
      * 获取触发分红业绩
      * return 触发分红业绩后缀
      */
     private function findDividendMinNum(){
     	$num=M('Currency')
     	->field('currency_all_num')
     	->where('currency_id='.$this->dividendConfig['dividend_id'])
     	->find();
     	if($num['currency_all_num']<$this->dividendConfig['num1']*10000){
     		return false;
     	}
     	if($num['currency_all_num']<$this->dividendConfig['num2']*10000){
     		return 1;
     	}
     	if($num['currency_all_num']<$this->dividendConfig['num3']*10000){
     		return 2;
     	}
     	if($num['currency_all_num']<$this->dividendConfig['num4']*10000){
     		return 3;
     	}
     	return false;
     }
     /**
      * 触发分红业绩
      * $num 最少限制
      * $member_id 用户ID
      */
     private function addDividend($member_id,$num,$max){
     	$member=M('Member')
     	->field('dividend_num')
     	->where('member_id='.$member_id)
     	->find();
     	$money=$this->dividendConfig['get'.$num];
     	$n=floor($member['dividend_num']/$this->dividendConfig['money'.$num]);
     	$n=min($n,$max);
     	if($n){
     		M('Member')->where('member_id='.$member_id)->setDec('dividend_num',$this->dividendConfig['money'.$num]*$n);
     		M('Currency')->where("currency_id=".$this->dividendConfig['dividend_id'])->setInc('currency_all_num',$money*$n);
     		$this->setUserMoney($member_id, $this->dividendConfig['dividend_id'],$money*$n, "inc",'num');
     		$this->addFinance($member_id, 13, "获得分红股",$money*$n,1, $this->dividendConfig['dividend_id']);
     
     		return 2;
     	}
     	return 1;
     }
     
     /**
      * ajax 发送手机号码
      */
     public function ajaxSandPhone(){
     	$phone = urldecode($_POST['phone']);
     	if(empty($phone)){
     		$data['status']=0;
     		$data['info'] = "参数错误";
     		$this->ajaxReturn($data);
     	}
     	if(!preg_match("/^1[34578]{1}\d{9}$/",$phone)){
     		$data['status']=-1;
     		$data['info'] = "手机号码不正确";
     		$this->ajaxReturn($data);
     	}
     	$r = sandPhone($phone,$this->config['CODE_NAME'],$this->config['CODE_USER_NAME'],$this->config['CODE_USER_PASS']);
     	$name=chuanglan_status($r['1']);
     	if($r[1]==0){
     		$data['stauts']=1;
     		$data['info']=$name;
     		$this->ajaxReturn($data);exit;
     	}else{
     		$data['status'] =-2;
     		$data['info']=$name;
     		$this->ajaxReturn($data);exit;
     	}
//      	if($r!="短信发送成功"){
//      		$data['status']=0;
//      		$data['info'] = $r;
//      		$this->ajaxReturn($data);
//      	}else{
//      		$data['status']=1;
//      		$data['info'] = $r;
//      		$this->ajaxReturn($data);
//      	}
     }
   }


10:F:\git\coin\bisheng commerce\App\Common\index.html
 

11:F:\git\coin\bisheng commerce\App\Common\jump.html
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>网站提示</title>
</head>
<body>
<script language="javascript" src="/Public/js/jquery-1.7.2.min.js"></script>
<script language="javascript" src="/Public/js/alert.js"></script>

<script type="text/javascript">
var jurl = "<?php echo($jumpUrl); ?>";
<present name="message">
    if(jurl!="")
	   msgDalog("<?php echo($message); ?>","<?php echo($jumpUrl); ?>",1);
    else
	   msgDalog("<?php echo($message); ?>","",2);
<else/>
	if(jurl!="")
	   msgDalog("<?php echo($error); ?>","<?php echo($jumpUrl); ?>",1);
    else
	   msgDalog("<?php echo($error); ?>","",2);
</present>
</script>

</body>
</html>

12:F:\git\coin\bisheng commerce\App\Common\Model\ArticleModel.class.php
<?php

namespace Common\Model;
use Think\Model;
class ArticleModel extends Model{
	
	public function info($id){
		$article = M('Article');
		$where[C("DB_PREFIX")."article_category.id"] = intval($id);
		$info = $article->join(C("DB_PREFIX")."article_category ON ".C("DB_PREFIX")."article.position_id = ".C("DB_PREFIX")."article_category.id")
						->where($where)
						->order('add_time desc')
						->limit(0,5)
						->select();
		if($info){
			return $info;
		}else{
			return false;
		}
	}
	
	public function info_one($id){
		$article = M('Article');
		$where[C("DB_PREFIX")."article_category.id"] = intval($id);
		$info = $article->join(C("DB_PREFIX")."article_category ON ".C("DB_PREFIX")."article.position_id = ".C("DB_PREFIX")."article_category.id")
		->where($where)
		->order('add_time desc')
		->find();
		if($info){
			return $info;
		}else{
			return false;
		}
	}
}

?>

13:F:\git\coin\bisheng commerce\App\Common\Model\index.html
 

14:F:\git\coin\bisheng commerce\App\Common\Model\MemberModel.class.php
<?php
/**
 * Created by PhpStorm.
 * User: Administrator
 * Date: 16-3-8
 * Time: 下午2:23
 */

namespace Common\Model;
use Think\Model;

class MemberModel extends Model{

    protected $_validate = array(
//        array(验证字段1,验证规则,错误提示,[验证条件,附加规则,验证时间]),
        array('agree','1','条款必须同意',1,'equal',1),//同意条款
        array('email','email','email格式不正确',1,'',1), //验证邮箱
        array('pwd','require','登录密码不能为空',1,'',1),
        array('pwd','checkPwd','密码格式不正确',1,'function',1), //函数认证密码(同样要求)
        array('repwd','pwd','确认密码不正确',1,'confirm',1), //二次密码是否一样


        array('pwdtrade','require','交易密码不能为空',1,'',1),
        array('pwdtrade','checkPwd','交易密码不正确',1,'function',1), // 函数认证支付密码(同样要求)
        array('repwdtrade','pwdtrade','确认交易密码不正确',1,'confirm',1), // 二次密码是否一样

        //modify验证

        array('nick','require','昵称不能为空',1,'',2),
        array('name','require','真实姓名不能为空',1,'',2),
        array('idcard','require','身份证号码必须填写',1,'',2),
        array('mo','require','手机号码必须填写',1,'',2),
    );

    protected $_auto = array(
//       array(完成字段1,完成规则,[完成条件,附加规则]),
        array('pwd','md5',1,'function'), //加密登录密码
        array('pwdtrade','md5',1,'function'), // 加密支付密码
    );

    /**
     * 验证密码长度在6-20个字符之间
     * @param $pwd
     * @return bool
     */
    public function checkPwd($pwd){
        $pattern="/^[\\w-\\.]{6,16}$/";
        if(preg_match($pattern, $pwd)){
            return true;
        }else{
            return false;
        }
    }

    public function logCheckEmail($email){
        $where['email'] = $email;
        $info = $this->where($where)->find();
        if($info){
            return $info;
        }else{
            return false;
        }
    }

    public function logCheckMo($mo){
        $where['mo'] = $mo;
        $info = $this->where($where)->find();
        if($info){
            return $info;
        }else{
            return false;
        }
    }

}

15:F:\git\coin\bisheng commerce\App\Home\Common\index.html
 

16:F:\git\coin\bisheng commerce\App\Home\Conf\config.php
<?php
return array(
);

17:F:\git\coin\bisheng commerce\App\Home\Conf\index.html
 

18:F:\git\coin\bisheng commerce\App\Home\Controller\ArtController.class.php
<?php
namespace Home\Controller;
use Common\Controller\CommonController;
class ArtController extends CommonController {
	//空操作
	public function _empty(){
		header("HTTP/1.0 404 Not Found");
		$this->display('Public:404');
	}
	/**
	 * 消息整体列表展示
	 * return array 文章分类，分页，查询信息
	 */
	public function index(){
		//检测从哪里进来到这里，如果有参数，判断分类（position）1为系统，2为资源，没有参数，正常显示
		$article = M('Article');
		$id = intval(I('get.id'));//强制转换为数字型
		$random_id = intval(I('random_id'));
		if(!$random_id){
			$where['position_id'] = array('in','1,2');
		}
		if(!empty($id)){//有参数，判断1，2，参数数量不确定
			$where['position_id'] = $id;
		}
		$count = $article->where($where)->count();//根据分类查找数据数量
		$page = new \Think\Page($count,10);//实例化分页类，传入总记录数和每页显示数
		$show = $page->show();//分页显示输出性
		$list = $article->where($where)->order('add_time desc')->limit($page->firstRow.','.$page->listRows)->select();//时间降序排列，越接近当前时间越高
		foreach ($list as $k=>$v){
			$list[$k]['title']=strip_tags(html_entity_decode($v['title']));
			$list[$k]['content']=strip_tags(html_entity_decode($v['content']));
		}
		
		$this->assign('page',$show);
		$this->assign('list',$list);
		$this->display();
     }
     /**
	 * 页面左边为选中的信息，通过url传递的id获取，并获取到该文章的position_id，用position_id来确定右边的分类名和分类中需要的多个标题
	 * return array 文章分类，分页，查询信息
	 */
    public function details(){
    	$article = M('Article');
    	$art_cat = M('Article_category');
    	//index 传id
    	$id = I('id');
    	$team_id = I('get.team_id');
    	if(!empty($id)){
    	 $where['article_id'] = $id;
    	}
    	if(!empty($team_id)){
    	 $where['article_id'] = $team_id;
    	}

    	$count = $article->where($where)->count();
		if($count==0){
			$this->display('Public:404');
			return;
		}
			
		$art_one = $article->where($where)->find();//查找到单一的文章	
		//将数据库中html标签字符串化，显示
		$art_one['title']=html_entity_decode($art_one['title']);
		$art_one['content']=html_entity_decode($art_one['content']);
		//根据单一文章的position_id,查找一定量的同类型标题
		$where_artlist['position_id'] = $art_one['position_id'];    	
    	$art_list = $article->where($where_artlist)->order('add_time desc')->limit(0,5)->select();
    	$this->assign('article',$art_one);
		$this->assign('art_one',$art_one);		
    	$this->assign('art_list',$art_list);
    	$this->display();	
    }

}

19:F:\git\coin\bisheng commerce\App\Home\Controller\DowController.class.php
<?php
namespace Home\Controller;
use Common\Controller\CommonController;
use Think\Page;
use Think\Upload;

class DowController extends CommonController {
    //空操作
    public function _initialize(){
        parent::_initialize();
    }
    public function _empty(){
        header("HTTP/1.0 404 Not Found");
        $this->display('Public:404');
    }
	//虚拟币下载
    public function index(){
    	
    	
    	$list=M("Currency")->select();
		foreach($list as $k => $v){
    		$list[$k]['guanwang_url'] = trim(trim($v['guanwang_url'],'https://'),'http://');
    	}
    	$this->assign("list",$list);
        $this->display();
    }
	//浏览器下载
	public function two(){
      
        $this->display();
    }
	//新币上线
	public function newcoin(){
//       	$info = M('Article')->where('position_id = 126')->find();
//         $this->assign('info',$info);
      	$this->display();
    }
}

20:F:\git\coin\bisheng commerce\App\Home\Controller\DrawController.class.php
<?php
namespace Home\Controller;
use Home\Controller\HomeController;
use Think\Page;
use Think\Upload;

class DrawController extends HomeController {
    //空操作
    public function _initialize(){
        parent::_initialize();
    }
    public function _empty(){
        header("HTTP/1.0 404 Not Found");
        $this->display('Public:404');
    }
    public function index(){
      
        $this->display();
    }
}

21:F:\git\coin\bisheng commerce\App\Home\Controller\EmptyController.class.php
<?php

namespace Home\Controller;

use Common\Controller\CommonController;
/**
 * 空模块，主要用于显示404页面，请不要删除
 */
class EmptyController extends CommonController{
	//没有任何方法，直接执行HomeController的_empty方法
	//请不要删除该控制器
	
    //空操作
    public function _empty(){
        header("HTTP/1.0 404 Not Found");
        $this->display('Public:404');
    }
    public function index() {
    	header ( "HTTP/1.0  404  Not Found" );
    	$this->display ( 'Public:404' );
    }
}

22:F:\git\coin\bisheng commerce\App\Home\Controller\EntrustController.class.php
<?php
namespace Home\Controller;
use Home\Controller\TradeFatherController;
class EntrustController extends TradeFatherController {
	public function _initialize(){
		if (empty($_SESSION['USER_KEY_ID'])){
			$this->redirect('Login/login');
		}
		parent::_initialize();
	}
	//空操作
	public function _empty(){
		header("HTTP/1.0 404 Not Found");
		$this->display('Public:404');
	}
    //委托管理
	public function manage(){
	    $this->User_status();//判断是否需要进行信息补全
		//获取主币种
		$currency=$this->getCurrencyByCurrencyId();
		$this->assign('culist',$currency);
		$currencytype = I('currency');
		$status=I('status');
		if(!empty($currencytype)){
			$where['currency_id'] =$currencytype;
		}
		
		$where['status'] = array('in','0,1');
		$where['member_id'] = $_SESSION['USER_KEY_ID'];
		
		if(!empty($status)){
			$where['status'] =array('in',$status);
		}
		
		$count      = M('Orders')->where($where)->count();// 查询满足要求的总记录数
		$Page       = new \Think\Page($count,10);// 实例化分页类 传入总记录数和每页显示的记录数
		
		//给分页传参数
		setPageParameter($Page, array('currency'=>$currencytype,'status'=>$status));
		
		$show       = $Page->show();// 分页显示输出
		// 进行分页数据查询 注意limit方法的参数要使用Page类的属性
		$list = M('Orders')->where($where)->limit($Page->firstRow.','.$Page->listRows)->select();
		
		$this->assign('page',$show);// 赋值分页输出
		$this->assign('list',$list);
		$this->display();
     }
     
    //委托历史
    public function history(){
        $this->User_status();//判断是否需要进行信息补全
    	//获取主币种
		$currency=$this->getCurrencyByCurrencyId();
		$this->assign('culist',$currency);
		
		$currencytype = I('currency');
		$status=I('status');
   	   if(!empty($currencytype)){
			$where['currency_id'] =$currencytype;
		}
		
		$where['status'] = array('in','-1,2');
		$where['member_id'] = $_SESSION['USER_KEY_ID'];
		
    	if(!empty($status)){
			$where['status'] =array('in',$status);
		}
		
    	$count      = M('Orders')->where($where)->count();// 查询满足要求的总记录数
		$Page       = new \Think\Page($count,10);// 实例化分页类 传入总记录数和每页显示的记录数
		
		//给分页传参数
		setPageParameter($Page, array('currency'=>$currencytype,'status'=>$status));
		
		$show       = $Page->show();// 分页显示输出
		// 进行分页数据查询 注意limit方法的参数要使用Page类的属性
		$list = M('Orders')->where($where)->limit($Page->firstRow.','.$Page->listRows)->select();
		
		$this->assign('page',$show);// 赋值分页输出
    
    	$this->assign('list',$list);
     	$this->display();
     }
     
     /**
      *  撤销方法
      */
     public function cancel(){
     		$order_id = I('post.order_id');     		
     		if(empty($order_id)){
     			$info['status'] = 0;
     			$info['info'] = '撤销订单不正确';
     			$this ->ajaxReturn($info);
     		}
     		//获取人的一个订单
     		$one_order=$this->getOneOrdersByMemberAndOrderId($_SESSION['USER_KEY_ID'], $order_id,array(0,1));
     		if(empty($one_order)){
     			$info['status'] = -1;
     			$info['info'] = '传入信息错误';
     			$this ->ajaxReturn($info);
     		}
     		$info = 	$this ->cancelOrdersByOrderId($one_order);
     		$this ->ajaxReturn($info);
     		
     }
     
}

23:F:\git\coin\bisheng commerce\App\Home\Controller\FillByBankController.class.php
<?php

namespace Home\Controller;

use Common\Controller\CommonController;

class FillByBankController extends HomeController {
	protected $pMerCode;
	protected $pMerCert;
	protected $pAccount;
	protected $url;
	public function _initialize() {
		parent::_initialize ();
		$this->User_status ();
		// $this->pMerCode="ADMIN";
		// $this->pMerCert= "aAjjnccOQ8yFHrQHrBZDRjbZDJ1UcSkV0kFT1EAWoV82g9H7pAz0qXFjcEaNQXU2d9xHrvkGUkBJZEXKKDXwZRUTCfdEa7VEGCV6KffDf2gnnohbBmAaPlsK7jkMF0Yc";
		// $this->pAccount="177954";
		
// 		$this->pMerCode = "177954";
// 		$this->pMerCert = "aAjjnccOQ8yFHrQHrBZDRjbZDJ1UcSkV0kFT1EAWoV82g9H7pAz0qXFjcEaNQXU2d9xHrvkGUkBJZEXKKDXwZRUTCfdEa7VEGCV6KffDf2gnnohbBmAaPlsK7jkMF0Yc";
// 		$this->pAccount = "1779540010";
		$this->pMerCode = "179440";
		$this->pMerCert = "FnwQC4trYU7AGeDHe0TcZUAOWjZ3hoGYONU7X9pq8B9nhhgcXHRwBFd1kgoKcaogNBckspMXoaRPt9uu7EMfWuK2wv9JCf2qlCa4LYGOTxBuUx6jOgsu1PNwNJrzdeR3";
		$this->pAccount = "1794400018";
		
		$this->url = $_SERVER ['HTTP_HOST'];
	}
	// 空操作
	Public function _empty() {
		header ( "HTTP/1.0 404 Not Found" ); // 使HTTP返回404状态码
		$this->display ( "Public:404" );
	}
	public function index() {
		$this->display ();
	}
	// 生成订单
	public function bank() {
		if ($_POST ["p3_Amt"] <= $this->config ['pay_min_money']) {
			$this->error ( '充值金额不得小于' . $this->config ['pay_min_money'] ,U('FillByBank/index'));
		}
		// 写入订单
		$orderno = date ( 'YmdHis' ) . mt_rand ( 100000, 999999 );
		;
		$data ['num'] = number_format ( $_POST ["p3_Amt"] );
		$data ['random'] = rand ( 0001, 9999 );
		$data ['uid'] = $_SESSION ['USER_KEY_ID'];
		$data ['email'] = $_SESSION ['USER_KEY'];
		// $data['uname']=$this->getUsernameByid($data['uid']);
		$data ['ctime'] = time ();
		$data ['tradeno'] = $orderno;
		$data ['status'] = 0;
		$data ['bankname'] = $_POST ["pd_FrpId"];
		$data ['type'] = 1;
		$r = M ( 'Fill' )->add ( $data );
		
		$pMerCode = $this->pMerCode;
		$pMerCert = $this->pMerCert;
		$pAccount = $this->pAccount;
		
		$pMerBillNo = $orderno;
		$amount = $_POST ["p3_Amt"];
		$pAmount = number_format ( $amount, 2, '.', '' );
		$pIsCredit = "1"; // '银行直连
		$pBankCode = $_POST ["pd_FrpId"]; // request("rtype")
		$pAttach = $this->auth ['username'];
		
		$pVersion = "v1.0.0";
		$pMerName = $pMerCode;
		$pMsgId = "msg" . mt_rand ( 1000, 9999 );
		$pReqDate = date ( 'YmdHis' );
		// $pReqDate = $pReqDate;
		$pCurrencyType = "GB";
		$pGatewayType = "01";
		$pLang = "156";
		$pDate = date ( 'Ymd' );
		$pMerchanturl = "http://" . $this->url . "/index.php/Home/FillByBank/OrderReturn"; // 成功
		$pFailUrl = "http://" . $this->url . "/index.php/Home/FillByBank/OrderReturn"; // 失败
		
		$pOrderEncodeTyp = "5";
		$pRetEncodeType = "17";
		$pRetType = "1";
		$pServerUrl = "http://" . $this->url . "/index.php/Home/FillByBank/OrderReturn2"; // 异步
		$pBillEXP = 1;
		$pGoodsName = "ipsonlinepay";
		$pProductType = "1";
		
		$reqParam = "【商户号】:" . $pMerCode . "【商户名】:" . $pMerName . " 【账户号】:" . $pAccount . " 【消息编号】:" . $pMsgId . " 【商户请求时间】:" . $pReqDate . " 【商户订单号】:" . $pMerBillNo;
		$reqParam = $reqParam . " 【订单金额】:" . $pAmount . " 【订单日期】:" . $pDate . " 【币种】:" . $pCurrencyType . " 【支付方式】:" . $pGatewayType . " 【语言】:" . $pLang . " 【支付结果成功返回的商户URL】:" . $pMerchanturl;
		$reqParam = $reqParam . " 【支付结果失败返回的商户URL】:" . $pFailUrl . " 【商户数据包】:" . $pAttach . " 【订单支付接口加密方式】:" . $pOrderEncodeTyp . " 【交易返回接口加密方式】:" . $pRetEncodeType;
		$reqParam = $reqParam . " 【返回方式】:" . $pRetType . " 【Server to Server返回页面】:" . $pServerUrl . " 【订单有效期】:" . $pBillEXP . " 【商品名称】:" . $pGoodsName . " 【直连选项】:" . $pIsCredit;
		$reqParam = $reqParam . " 【银行号】:" . $pBankCode . " 【产品类型】:" . $pProductType;
		
		if ($pIsCredit == "0") {
			$pBankCode = "";
			$pProductType = "";
		}
		
		$strbodyxml = "<body><MerBillNo>" . $pMerBillNo . "</MerBillNo><Amount>" . $pAmount . "</Amount>";
		$strbodyxml = $strbodyxml . "<Date>" . $pDate . "</Date><CurrencyType>" . $pCurrencyType . "</CurrencyType>";
		$strbodyxml = $strbodyxml . "<GatewayType>" . $pGatewayType . "</GatewayType><Lang>" . $pLang . "</Lang>";
		$strbodyxml = $strbodyxml . "<Merchanturl>" . $pMerchanturl . "</Merchanturl><FailUrl>" . $pFailUrl . "</FailUrl>";
		$strbodyxml = $strbodyxml . "<Attach>" . $pAttach . "</Attach><OrderEncodeType>" . $pOrderEncodeTyp . "</OrderEncodeType>";
		$strbodyxml = $strbodyxml . "<RetEncodeType>" . $pRetEncodeType . "</RetEncodeType><RetType>" . $pRetType . "</RetType>";
		$strbodyxml = $strbodyxml . "<ServerUrl>" . $pServerUrl . "</ServerUrl><BillEXP>" . $pBillEXP . "</BillEXP>";
		$strbodyxml = $strbodyxml . "<GoodsName>" . $pGoodsName . "</GoodsName><IsCredit>" . $pIsCredit . "</IsCredit>";
		$strbodyxml = $strbodyxml . "<BankCode>" . $pBankCode . "</BankCode><ProductType>" . $pProductType . "</ProductType></body>";
		
		$pSignature = MD5 ( $strbodyxml . $pMerCode . $pMerCert ); // 数字签名
		
		$strheaderxml = "<head><Version>" . $pVersion . "</Version><MerCode>" . $pMerCode . "</MerCode>";
		$strheaderxml = $strheaderxml . "<MerName>" . $pMerName . "</MerName><Account>" . $pAccount . "</Account>";
		$strheaderxml = $strheaderxml . "<MsgId>" . $pMsgId . "</MsgId><ReqDate>" . $pReqDate . "</ReqDate>";
		$strheaderxml = $strheaderxml . "<Signature>" . $pSignature . "</Signature></head>";
		
		$strsubmitxml = "<Ips><GateWayReq>" . $strheaderxml . $strbodyxml . "</GateWayReq></Ips>";
		
		$form_url = "http://newpay.ips.com.cn/psfp-entry/gateway/payment.html";
		// $form_url="http://pay.huatiansc.com/ips31/ips31.php";
		
		$this->assign ( 'strsubmitxml', $strsubmitxml );
		$this->assign ( 'form_url', $form_url );
		
		$this->display ();
	}
	public function OrderReturn() {
		header ( "Content-type:text/html; charset=utf-8" );
		
		$pMerCode = $this->pMerCode;
		$pMerCert = $this->pMerCert;
		$pAccount = $this->pAccount;
		if (isset ( $_POST ["paymentResult"] )) {
			
			$paymentResult = $_POST ["paymentResult"]; // 获取信息
			
			$xml = simplexml_load_string ( $paymentResult, 'SimpleXMLElement', LIBXML_NOCDATA );
			
			// 读取相关xml中信息
			$ReferenceIDs = $xml->xpath ( "GateWayRsp/head/ReferenceID" ); // 关联号
			                                                            // var_dump($ReferenceIDs);
			$ReferenceID = $ReferenceIDs [0]; // 关联号
			$RspCodes = $xml->xpath ( "GateWayRsp/head/RspCode" ); // 响应编码
			$RspCode = $RspCodes [0];
			$RspMsgs = $xml->xpath ( "GateWayRsp/head/RspMsg" ); // 响应说明
			$RspMsg = $RspMsgs [0];
			$ReqDates = $xml->xpath ( "GateWayRsp/head/ReqDate" ); // 接受时间
			$ReqDate = $ReqDates [0];
			$RspDates = $xml->xpath ( "GateWayRsp/head/RspDate" ); // 响应时间
			$RspDate = $RspDates [0];
			$Signatures = $xml->xpath ( "GateWayRsp/head/Signature" ); // 数字签名
			$Signature = $Signatures [0];
			$MerBillNos = $xml->xpath ( "GateWayRsp/body/MerBillNo" ); // 商户订单号
			$MerBillNo = $MerBillNos [0];
			$CurrencyTypes = $xml->xpath ( "GateWayRsp/body/CurrencyType" ); // 币种
			$CurrencyType = $CurrencyTypes [0];
			$Amounts = $xml->xpath ( "GateWayRsp/body/Amount" ); // 订单金额
			$Amount = $Amounts [0];
			$Dates = $xml->xpath ( "GateWayRsp/body/Date" ); // 订单日期
			$Date = $Dates [0];
			$Statuss = $xml->xpath ( "GateWayRsp/body/Status" ); // 交易状态
			$Status = $Statuss [0];
			$Msgs = $xml->xpath ( "GateWayRsp/body/Msg" ); // 发卡行返回信息
			$Msg = $Msgs [0];
			$Attachs = $xml->xpath ( "GateWayRsp/body/Attach" ); // 数据包
			$Attach = $Attachs [0];
			$IpsBillNos = $xml->xpath ( "GateWayRsp/body/IpsBillNo" ); // IPS订单号
			$IpsBillNo = $IpsBillNos [0];
			$IpsTradeNos = $xml->xpath ( "GateWayRsp/body/IpsTradeNo" ); // IPS交易流水号
			$IpsTradeNo = $IpsTradeNos [0];
			$RetEncodeTypes = $xml->xpath ( "GateWayRsp/body/RetEncodeType" ); // 交易返回方式
			$RetEncodeType = $RetEncodeTypes [0];
			$BankBillNos = $xml->xpath ( "GateWayRsp/body/BankBillNo" ); // 银行订单号
			$BankBillNo = $BankBillNos [0];
			$ResultTypes = $xml->xpath ( "GateWayRsp/body/ResultType" ); // 支付返回方式
			$ResultType = $ResultTypes [0];
			$IpsBillTimes = $xml->xpath ( "GateWayRsp/body/IpsBillTime" ); // IPS处理时间
			$IpsBillTime = $IpsBillTimes [0];
			
			$resParam = "关联号:" . $ReferenceID . "响应编码:" . $RspCode . "响应说明:" . $RspMsg . "接受时间:" . $ReqDate . "响应时间:" . $RspDate . "数字签名:" . $Signature . "商户订单号:" . $MerBillNo . "币种:" . $CurrencyType . "订单金额:" . $Amount . "订单日期:" . $Date . "交易状态:" . $Status . "发卡行返回信息:" . $Msg . "数据包:" . $Attach . "IPS订单号:" . $IpsBillNo . "交易返回方式:" . $RetEncodeType . "银行订单号:" . $BankBillNo . "支付返回方式:" . $ResultType . "IPS处理时间:" . $IpsBillTime;
			
			// 验签明文
			// billno+【订单编号】+currencytype+【币种】+amount+【订单金额】+date+【订单日期】+succ+【成功标志】+ipsbillno+【IPS订单编号】+retencodetype +【交易返回签名方式】+【商户内部证书】
			
			$sbReq = "<body>" . "<MerBillNo>" . $MerBillNo . "</MerBillNo>" . "<CurrencyType>" . $CurrencyType . "</CurrencyType>" . "<Amount>" . $Amount . "</Amount>" . "<Date>" . $Date . "</Date>" . "<Status>" . $Status . "</Status>" . "<Msg><![CDATA[" . $Msg . "]]></Msg>" . "<Attach><![CDATA[" . $Attach . "]]></Attach>" . "<IpsBillNo>" . $IpsBillNo . "</IpsBillNo>" . "<IpsTradeNo>" . $IpsTradeNo . "</IpsTradeNo>" . "<RetEncodeType>" . $RetEncodeType . "</RetEncodeType>" . "<BankBillNo>" . $BankBillNo . "</BankBillNo>" . "<ResultType>" . $ResultType . "</ResultType>" . "<IpsBillTime>" . $IpsBillTime . "</IpsBillTime>" . "</body>";
			$sign = $sbReq . $pMerCode . $pMerCert;
			
			$md5sign = md5 ( $sign );
			
			$logName = "11.txt";
			
			$james = fopen ( $logName, "a+" );
			
			fwrite ( $james, "\r\n" . date ( "Y-m-d H:i:s" ) . "|" . $Signature . "|[" . $md5sign . "]|[" . $MerBillNo . "]|[" . $Amount . "]|[" . $Status . "]" );
			
			fwrite ( $james, "\r\n----------------------------------------------------------------------------------------" );
			fclose ( $james );
			
			// 判断签名
			if ($Signature == $md5sign) {
				
				if ($RspCode == '000000') {
					
					$extra_return_param = $Attach;
					$order_no = $MerBillNo;
					$order_amount = $Amount;
					
					$link = mysql_connect ( "localhost", "root", "root" ) or die ( "数据库连接失败" );
					mysql_select_db ( "ybb", $link );
					mysql_set_charset ( "utf8" );
					$result = mysql_query ( "select count(*) from ".C('DB_PREFIX')."fill where uname='{$extra_return_param}'", $link );
					
					$num = mysql_result ( $result, "0" );
					if (! $num) {
						echo "<tr align=center bgcolor=#FFFFFF><td colspan=16>暂无用户数据</td></tr>";
						exit ();
					} else {
						
						$result2 = mysql_query ( "select * from ".C('DB_PREFIX')."fill where uname='{$extra_return_param}'" );
						$row = mysql_fetch_assoc ( $result2 );
						
						$assets = $row ['num'];
						$uid = $row ['uid'];
						$username = $row ['uname'];
					}
					
					$result3 = mysql_query ( "select * from ".C('DB_PREFIX')."fill where tradeno='{$order_no}'" );
					$row3 = mysql_fetch_assoc ( $result3 );
					if (empty ( $row3 )) {
						echo "无此订单号" . $order_no . "订单";
						exit ();
					}
					$m_id = $row3 ['id'];
					$u_id = $row3 ['uid'];
					$p_money = $row3 ['num'];
					
					// $sql2 = "update k_money,k_user set k_money.status=1,k_money.update_time=now(),k_user.money=k_user.money+k_money.m_value,k_money.about='ips chong zhi ok',k_money.sxf=0,k_money.balance=k_user.money+k_money.m_value where k_money.uid=k_user.uid and k_money.m_id=$m_id and k_money.`status`=2";
					
					$sql2 = "UPDATE ".C('DB_PREFIX')."fill SET `status` =1 WHERE id=$m_id";
					
					if (mysql_query ( $sql2 )) {
						echo "";
					} else {
						echo "Error creating database: " . mysql_error ();
					}
					$sql3 = "UPDATE ".C('DB_PREFIX')."member SET rmb=rmb +$p_money WHERE member_id=$u_id";
					if (mysql_query ( $sql3 )) {
						echo "";
					} else {
						echo "Error creating database: " . mysql_error ();
					}
					echo "<Script language=javascript>alert('交易成功,返回订单列表.');window.location.href='index'</script>";
					exit ();
				}
			} else {
				echo "订单签名错误";
			}
		} else {
			echo "非法交易";
		}
	}
	public function OrderReturn2() {
		header ( "Content-type:text/html; charset=utf-8" );
		
		$pMerCode = $this->pMerCode;
		$pMerCert = $this->pMerCert;
		$pAccount = $this->pAccount;
		if (isset ( $_POST ["paymentResult"] )) {
			
			$paymentResult = $_POST ["paymentResult"]; // 获取信息
			
			$xml = simplexml_load_string ( $paymentResult, 'SimpleXMLElement', LIBXML_NOCDATA );
			
			// 读取相关xml中信息
			$ReferenceIDs = $xml->xpath ( "GateWayRsp/head/ReferenceID" ); // 关联号
			                                                            // var_dump($ReferenceIDs);
			$ReferenceID = $ReferenceIDs [0]; // 关联号
			$RspCodes = $xml->xpath ( "GateWayRsp/head/RspCode" ); // 响应编码
			$RspCode = $RspCodes [0];
			$RspMsgs = $xml->xpath ( "GateWayRsp/head/RspMsg" ); // 响应说明
			$RspMsg = $RspMsgs [0];
			$ReqDates = $xml->xpath ( "GateWayRsp/head/ReqDate" ); // 接受时间
			$ReqDate = $ReqDates [0];
			$RspDates = $xml->xpath ( "GateWayRsp/head/RspDate" ); // 响应时间
			$RspDate = $RspDates [0];
			$Signatures = $xml->xpath ( "GateWayRsp/head/Signature" ); // 数字签名
			$Signature = $Signatures [0];
			$MerBillNos = $xml->xpath ( "GateWayRsp/body/MerBillNo" ); // 商户订单号
			$MerBillNo = $MerBillNos [0];
			$CurrencyTypes = $xml->xpath ( "GateWayRsp/body/CurrencyType" ); // 币种
			$CurrencyType = $CurrencyTypes [0];
			$Amounts = $xml->xpath ( "GateWayRsp/body/Amount" ); // 订单金额
			$Amount = $Amounts [0];
			$Dates = $xml->xpath ( "GateWayRsp/body/Date" ); // 订单日期
			$Date = $Dates [0];
			$Statuss = $xml->xpath ( "GateWayRsp/body/Status" ); // 交易状态
			$Status = $Statuss [0];
			$Msgs = $xml->xpath ( "GateWayRsp/body/Msg" ); // 发卡行返回信息
			$Msg = $Msgs [0];
			$Attachs = $xml->xpath ( "GateWayRsp/body/Attach" ); // 数据包
			$Attach = $Attachs [0];
			$IpsBillNos = $xml->xpath ( "GateWayRsp/body/IpsBillNo" ); // IPS订单号
			$IpsBillNo = $IpsBillNos [0];
			$IpsTradeNos = $xml->xpath ( "GateWayRsp/body/IpsTradeNo" ); // IPS交易流水号
			$IpsTradeNo = $IpsTradeNos [0];
			$RetEncodeTypes = $xml->xpath ( "GateWayRsp/body/RetEncodeType" ); // 交易返回方式
			$RetEncodeType = $RetEncodeTypes [0];
			$BankBillNos = $xml->xpath ( "GateWayRsp/body/BankBillNo" ); // 银行订单号
			$BankBillNo = $BankBillNos [0];
			$ResultTypes = $xml->xpath ( "GateWayRsp/body/ResultType" ); // 支付返回方式
			$ResultType = $ResultTypes [0];
			$IpsBillTimes = $xml->xpath ( "GateWayRsp/body/IpsBillTime" ); // IPS处理时间
			$IpsBillTime = $IpsBillTimes [0];
			
			$resParam = "关联号:" . $ReferenceID . "响应编码:" . $RspCode . "响应说明:" . $RspMsg . "接受时间:" . $ReqDate . "响应时间:" . $RspDate . "数字签名:" . $Signature . "商户订单号:" . $MerBillNo . "币种:" . $CurrencyType . "订单金额:" . $Amount . "订单日期:" . $Date . "交易状态:" . $Status . "发卡行返回信息:" . $Msg . "数据包:" . $Attach . "IPS订单号:" . $IpsBillNo . "交易返回方式:" . $RetEncodeType . "银行订单号:" . $BankBillNo . "支付返回方式:" . $ResultType . "IPS处理时间:" . $IpsBillTime;
			
			// 验签明文
			// billno+【订单编号】+currencytype+【币种】+amount+【订单金额】+date+【订单日期】+succ+【成功标志】+ipsbillno+【IPS订单编号】+retencodetype +【交易返回签名方式】+【商户内部证书】
			
			$sbReq = "<body>" . "<MerBillNo>" . $MerBillNo . "</MerBillNo>" . "<CurrencyType>" . $CurrencyType . "</CurrencyType>" . "<Amount>" . $Amount . "</Amount>" . "<Date>" . $Date . "</Date>" . "<Status>" . $Status . "</Status>" . "<Msg><![CDATA[" . $Msg . "]]></Msg>" . "<Attach><![CDATA[" . $Attach . "]]></Attach>" . "<IpsBillNo>" . $IpsBillNo . "</IpsBillNo>" . "<IpsTradeNo>" . $IpsTradeNo . "</IpsTradeNo>" . "<RetEncodeType>" . $RetEncodeType . "</RetEncodeType>" . "<BankBillNo>" . $BankBillNo . "</BankBillNo>" . "<ResultType>" . $ResultType . "</ResultType>" . "<IpsBillTime>" . $IpsBillTime . "</IpsBillTime>" . "</body>";
			$sign = $sbReq . $pMerCode . $pMerCert;
			
			$md5sign = md5 ( $sign );
			
			$logName = "22.txt";
			
			$james = fopen ( $logName, "a+" );
			
			fwrite ( $james, "\r\n" . date ( "Y-m-d H:i:s" ) . "|" . $Signature . "|[" . $md5sign . "]|[" . $MerBillNo . "]|[" . $Amount . "]|[" . $Status . "]" );
			
			fwrite ( $james, "\r\n----------------------------------------------------------------------------------------" );
			fclose ( $james );
			
			// 判断签名
			if ($Signature == $md5sign) {
				
				if ($RspCode == '000000') {
					
					$extra_return_param = $Attach;
					$order_no = $Attach . '_' . $MerBillNo;
					$order_amount = $Amount;
					
					$link = mysql_connect ( "localhost", "root", "root" ) or die ( "数据库连接失败" );
					mysql_select_db ( "ybb", $link );
					mysql_set_charset ( "utf8" );
					$result = mysql_query ( "select count(*) from ".C('DB_PREFIX')."fill where uname='{$extra_return_param}'", $link );
					$num = mysql_result ( $result, "0" );
					if (! $num) {
						echo "<tr align=center bgcolor=#FFFFFF><td colspan=16>{$extra_return_param}暂无用户数据</td></tr>";
						exit ();
					} else {
						
						$result2 = mysql_query ( "select * from ".C('DB_PREFIX')."fill where uname='{$extra_return_param}'" );
						$row = mysql_fetch_assoc ( $result2 );
						
						$assets = $row ['num'];
						$uid = $row ['uid'];
						$username = $row ['uname'];
					}
					
					$results = mysql_query ( "select count(*) from ".C('DB_PREFIX')."fill where tradeno='{$order_no}'" );
					$nums = mysql_result ( $results, "0" );
					
					if (! $nums) {
						// $sql = "insert into k_money(uid,m_value,m_order,status,assets,balance) values($uid,$order_amount,'$order_no',2,$assets,$assets)";
						
						// if (mysql_query($sql)){echo "";}
						// else{echo "Error creating database: " . mysql_error();}
						
						$result3 = mysql_query ( "select m_id from ".C('DB_PREFIX')."fill where tradeno='{$order_no}'" );
						$row3 = mysql_fetch_assoc ( $result3 );
						
						$m_id = $row3 ['id'];
						$u_id = $row3 ['uid'];
						$p_money = $row3 ['num'];
						
						// $sql2 = "update k_money,k_user set k_money.status=1,k_money.update_time=now(),k_user.money=k_user.money+k_money.m_value,k_money.about='ips chong zhi ok',k_money.sxf=0,k_money.balance=k_user.money+k_money.m_value where k_money.uid=k_user.uid and k_money.m_id=$m_id and k_money.`status`=2";
						
						$sql2 = "UPDATE ".C('DB_PREFIX')."fill SET `status` =1 WHERE id=$m_id";
						
						if (mysql_query ( $sql2 )) {
							echo "";
						} else {
							echo "Error creating database: " . mysql_error ();
						}
						
						$sql3 = "UPDATE ".C('DB_PREFIX')."user SET rmb=rmb +$p_money WHERE member_id=$u_id";
						
						if (mysql_query ( $sql3 )) {
							echo "";
						} else {
							echo "Error creating database: " . mysql_error ();
						}
						
						echo "<Script language=javascript>alert('交易成功,请回首页重新登入.');window.open('http://" . $_SERVER ["HTTP_HOST"] . "/','Index')</script>";
						
						exit ();
					} else {
						
						echo "<Script language=javascript>alert('交易成功,请回首页重新登入');window.open('http://" . $_SERVER ["HTTP_HOST"] . "/','Index')</script>";
						
						exit ();
					}
				}
			} else {
				
				echo "订单签名错误";
			}
		} else {
			echo "非法交易";
		}
	}
}

24:F:\git\coin\bisheng commerce\App\Home\Controller\FillController.class.php
<?php
namespace Home\Controller;
use Home\Controller\HomeController;
use Think\Page;
use Think\Upload;

class FillController extends HomeController {
    //空操作
    public function _initialize(){
        parent::_initialize();
    }
    public function _empty(){
        header("HTTP/1.0 404 Not Found");
        $this->display('Public:404');
    }
    public function index(){
    	$where['uid']=$_SESSION['USER_KEY_ID'];//用户id
		$count      = M("Fill")->where($where)->count();// 查询满足要求的总记录数
		$Page       = new \Think\Page($count,10);// 实例化分页类 传入总记录数和每页显示的记录数(25)
		$show       = $Page->show();// 分页显示输出// 进行分页数据查询 注意limit方法的参数要使用Page类的属性
		$list = M("Fill")->where($where)->order('id desc')->limit($Page->firstRow.','.$Page->listRows)->select();
		$this->assign('list',$list);// 赋值数据集
		$this->assign('page',$show);// 赋值分页输出
        $this->display();
    }
    
}

25:F:\git\coin\bisheng commerce\App\Home\Controller\FinanceController.class.php
<?php
namespace Home\Controller;
use Home\Controller\HomeController;
use Think\Page;
use Think\Upload;

class FinanceController extends HomeController {
    //空操作
    public function _initialize(){
        parent::_initialize();
    }
    public function _empty(){
        header("HTTP/1.0 404 Not Found");
        $this->display('Public:404');
    }
    public function index(){
    	$where['member_id']=$_SESSION['USER_KEY_ID'];//用户id
    	$field=C("DB_PREFIX")."finance.*,".C("DB_PREFIX")."finance_type.name as typename";
		$count      = M("Finance")->where($where)
					->join(C("DB_PREFIX")."finance_type on ".C("DB_PREFIX")."finance.type=".C("DB_PREFIX")."finance_type.id")->count();// 查询满足要求的总记录数
		$Page       = new \Think\Page($count,10);// 实例化分页类 传入总记录数和每页显示的记录数(25)
		$show       = $Page->show();// 分页显示输出// 进行分页数据查询 注意limit方法的参数要使用Page类的属性
		$list = M("Finance")->field($field)->where($where)
		->join(C("DB_PREFIX")."finance_type on ".C("DB_PREFIX")."finance.type=".C("DB_PREFIX")."finance_type.id")
		->order('finance_id desc')->limit($Page->firstRow.','.$Page->listRows)->select();
		foreach($list as $k=>$v){
			if($v['currency_id']==0){
				$list[$k]['currency_name']="人民币";
			}else{
				$cu=M("Currency")->where("currency_id='{$v['currency_id']}'")->find();
				$list[$k]['currency_name']=$cu['currency_name'];
			}
		}
		$this->assign('list',$list);// 赋值数据集
		$this->assign('page',$show);// 赋值分页输出
	
        $this->display();
    }
    
}

26:F:\git\coin\bisheng commerce\App\Home\Controller\HelpController.class.php
<?php
namespace Home\Controller;
use Common\Controller\CommonController;
class HelpController extends CommonController {
	function _initialize(){
		parent::_initialize();
	}
	public function  _empty(){
		header("HTTP/1.0 404 Not Found");
		$this->display('Public:404');
	}
	
	public function index(){

		//左侧标题，右侧文章
		//点击标题显示对应文章
    	$article = M('Article');
    	$art_cat = M('Article_category');
		//$id为header传来的文章id，
    	$id = I('get.id');
    	//$article_id为帮助中心内传来的文章id
    	$article_id = I('get.article_id');
    	if($id){
    	  $where['position_id'] = $id;
		}
		if($article_id){
			$where['article_id'] = $article_id;
		}
		//数据库是否有数，没有返回404
//     	$count = $article->where($where)->count();
// 		if($count==0){
// 			$this->display('Public:404');
// 			return;
// 		}
    	//查找到单一的文章
		$art_one = $article->where($where)->find();  	
	
		//将数据库中html标签字符串化，显示
			$art_one['title']=html_entity_decode($art_one['title']);
			$art_one['content']=html_entity_decode($art_one['content']);

		//查找6：帮助中心的title，遍历为左侧的显示title		
		$art_list = $art_cat->where('parent_id = 6')->select();
    	foreach($art_list as $k=>$v){
    		$item= $article->where('position_id = '.$v['id'])->select();
    		$art_list[$k]['children']=$item;
    	}
		$this->assign('art_one',$art_one);		
    	$this->assign('art_list',$art_list);
    	$this->display();	
    }

}

27:F:\git\coin\bisheng commerce\App\Home\Controller\HomeController.class.php
<?php
namespace Home\Controller;
use Common\Controller\CommonController;
class HomeController extends CommonController {
 	protected $member;
 	protected $trade;
 	protected $auth;
	public function _initialize(){
 		parent::_initialize();
  		if(empty($_SESSION['USER_KEY_ID'])){
  			$this->redirect("Login/index");
  		} 
  		 // 添加用户真实姓名等
  		$this->auth = M('Member')->where('member_id ='.$_SESSION['USER_KEY_ID'])->find();
  		if (empty($this->auth)){
  		    $this->redirect("Login/index");
  		}
  		$this->assign('auth',$this->auth);
 		
  		$this->trade=M('Trade');
 		//修正会员各个币种信息  currency_user
 		$currency=M('Currency')->select();
 		foreach ($currency as $k=>$v){
 			$rs=$this->getCurrencyUser($_SESSION['USER_KEY_ID'], $v['currency_id']);
 			if(!$rs){
 				$this->addCurrencyUser($_SESSION['USER_KEY_ID'],$v['currency_id']);
 			}
 		}
 		$this->jiedong();
	}

	/**
	 * 添加currency_user表方法
	 * @param int $uid 会员id
	 * @param int $cid 币种id
	 */
	 public function addCurrencyUser($uid,$cid){
	 	$data['member_id']=$uid;
	 	$data['currency_id']=$cid;
	 	$data['num']=0;
	 	$data['forzen_num']=0;
	 	$data['status']=0;
	 	$rs=M('Currency_user')->add($data);
	 	if($rs){
	 		return true;
	 	}else{
	 		return false;
	 	}
	 }
	//获取会员有多少人工充值订单
	public function getPaycountByName($name){
		$list=M('Pay')->where("member_name='".$name."'")->count();
		if($list){
			return $list;
		}else{
			return false;
		}
	}
	
	//获取个人账户指定币种金额
	public function getUserMoneyByCurrencyId($user,$currencyId){
	    return M('Currency_user')->field('num,forzen_num,chongzhi_url')->where("Member_id={$this->member['member_id']} and currency_id=$currencyId")->find();
	}
	//空操作
	public function _empty(){
		header("HTTP/1.0 404 Not Found");
		$this->display('Public:404');
	}
	
	
	/**
	 * 解冻程序
	 * 现方法为根据众筹设置的解冻比例解冻
	 * Ps:注释掉部分为 默认配置项一个解冻比例
	 * @return boolean
	 */
	private function jiedong(){
		$time=time();
		$bili = null;
		
		$list=M('Issue_log')->where("deal>0 and add_time<{$time}-60*60*24  and status=0")->select();
		if(!$list){
			return false;
		}
		foreach ($list as $k=>$v){
			$list=$this->getIssueRemoveForzenBiLiByIssueId($v['iid']);
			$v['remove_forzen_bili'] = $list['remove_forzen_bili']/100;
			$v['remove_forzen_cycle'] = $list['remove_forzen_cycle'];
			if($v['add_time']>($time-$v['remove_forzen_cycle']*60*60*24)){
				continue;
			}
			M('Issue_log')->where("id={$v['id']}")->setDec('deal',$v['num']*$v['remove_forzen_bili']);
			M('Issue_log')->where("id={$v['id']}")->setField('add_time',time());
			M('Currency_user')->where("member_id={$v['uid']} and currency_id={$v['cid']}")->setInc('num',$v['num']*$v['remove_forzen_bili']);
			M('Currency_user')->where("member_id={$v['uid']} and currency_id={$v['cid']}")->setDec('forzen_num',$v['num']*$v['remove_forzen_bili']);
			if($v['deal']==0){
				M('Issue_log')->where("id={$v['id']}")->setField('status',1);
			}
			
// 			M('Issue_log')->where("id={$v['id']}")->setDec('deal',$v['num']*$bili);
// 			M('Issue_log')->where("id={$v['id']}")->setField('add_time',time());
// 			M('Currency_user')->where("member_id={$v['uid']} and currency_id={$v['cid']}")->setInc('num',$v['num']*$bili);
// 			M('Currency_user')->where("member_id={$v['uid']} and currency_id={$v['cid']}")->setDec('forzen_num',$v['num']*$bili);
// 			if($v['deal']==0){
// 				M('Issue_log')->where("id={$v['id']}")->setField('status',1);			
// 			}
		}
	}
	/**
	 * 根据认筹id查找解冻比例
	 * @param int $id Issue Id
	 * @return 解冻比例
	 */
	private function getIssueRemoveForzenBiLiByIssueId($id){
		$list =  M('Issue')->field('is_forzen,remove_forzen_bili,remove_forzen_cycle')->where("id = $id")->find();
		if($list['is_forzen']==0){
			return  $list;
		}else{
			return 0;
		}
	}
	
	
}

28:F:\git\coin\bisheng commerce\App\Home\Controller\index.html
 

29:F:\git\coin\bisheng commerce\App\Home\Controller\IndexController.class.php
<?php
namespace Home\Controller;
use Common\Controller\CommonController;
class IndexController extends CommonController {
 	public function _initialize(){
 		parent::_initialize();
 	}
	//空操作
	public function _empty(){
		header("HTTP/1.0 404 Not Found");
		$this->display('Public:404');
	}
	public function index(){
		//页面右方公告，提示，资信
		$art_model = D('Article');
		$info1 = $art_model->info(1);
		$info_red1 = $art_model->info_red(1);//标红
		$info2 = $art_model->info(2);		 //非标红
		$info_red2 = $art_model->info_red(2);//标红
		$this->assign('info1',$info1);		 //非标红
		$this->assign('info_red1',$info_red1);
		$this->assign('info2',$info2);
		$this->assign('info_red2',$info_red2);

		//幻灯
		$flash=M('Flash')->order('sort')->limit(6)->select();
		$this->assign('flash',$flash);
		//币种
		$currency=$this->currency();
		foreach ($currency as $k=>$v){
			$list=$this->getCurrencyMessageById($v['currency_id']);
			$currency[$k]=array_merge($list,$currency[$k]);
			$list['new_price']?$list['new_price']:0;
			$currency[$k]['currency_all_money'] = floatval($v['currency_all_num'])*$list['new_price'];
		}
        //*********选择进盟币,安全可信赖begin*******
        $all_money = M('Trade')->sum('money');
        $all_money = $this->config['transaction_false']+$all_money;
//        $all_money = 212315984125.123;
        $all_money = (string)round($all_money);
        for($i=0;$i<strlen($all_money);$i++){
            $arr[strlen($all_money)-1-$i] = $all_money[$i];
//            $arr[$i] = $all_money[$i];
        }
        $this->assign('arr',$arr);
        //*********选择进盟币,安全可信赖end*******
        $link = M('Link');
        $link_info =$link->select();
        //截断友情链接url头，统一写法
        foreach($link_info as $k => $v){
        	$url="";
        	$url = trim($v['url'],'https://');
        	$link_info[$k]['url'] = trim($url,'http://');
        }
        //*******众筹begin*******/////
        $issue_list=M('Issue')
            ->field(C("DB_PREFIX")."issue.*,".C("DB_PREFIX")."currency.currency_name as name")
            ->join("left join ".C("DB_PREFIX")."currency on ".C("DB_PREFIX")."currency.currency_id=".C("DB_PREFIX")."issue.currency_id")
            ->order(' id desc ')->select();
        $this->assign('issue_list',$issue_list);
        //*******众筹end*******/////
        $sum_money = num_format($all_money);
        $this->assign('link_info',$link_info);
        $this->assign('sum_money',$sum_money);
		$this->assign('currency',$currency);
		$this->assign('empty','暂无数据');
        $this->display();
     }

}

30:F:\git\coin\bisheng commerce\App\Home\Controller\LoginController.class.php
<?php
/**
 * Created by PhpStorm.
 * User: "姜鹏"
 * Date: 16-3-9
 * Time: 上午9:06
 */

namespace Home\Controller;
use Common\Controller\CommonController;
use Think\Verify;

class LoginController extends CommonController{
    /**
     * 展示界面
     */
    public function index(){
        if(session('USER_KEY_ID')){
            $this->redirect('Index/index');
            return;
        }
        $this->display();
    }
    /**
     * 处理登录请求
     * 全部用ajax提交
     */
    public function checkLog(){
        $email = I('post.email');
        $pwd = md5(I('post.pwd'));
        $M_member = D('Member');
        //再次判断
        if((checkEmail($email) || checkMobile($email))==false){
            $data['status']=2;
            $data['info']="请输入正确的手机或者邮箱";
            $this->ajaxReturn($data);
        }
        //判断传值是手机还是email
        $info = checkEmail($email)?$M_member->logCheckEmail($email):$M_member->logCheckMo($email);
        if($info['status']==2){
            $data['status']=2;
            $data['info']="非常抱歉您的账号已被禁用";
            $this->ajaxReturn($data);
        }
        //验证手机或邮箱
        if($info==false){
            $data['status']=2;
            $data['info']="邮箱或者手机不存在";
            $this->ajaxReturn($data);
        }
        //验证密码
        if($info['pwd']!=$pwd){
            //$this->error('密码输入错误');
            $data['status']=2;
            $data['info']="密码输入错误";
            $this->ajaxReturn($data);
        }
        //获取下方能用到的参数
        $new_ip = get_client_ip();
        $old_login_ip = $info['login_ip']?$info['login_ip']:$info['ip'];
        $card = I('post.year').I('post.month').I('post.day');
        $idcard = substr($info['idcard'],6,8);
        //验证身份信息如果身份证存在并且 当前IP 和上次登录Ip不一样
        if($old_login_ip != $new_ip && $info['idcard'] ){
            if($card != $idcard){
                $data['status']=2;
                $data['info']="生日与您当前填写不符";
                $this->ajaxReturn($data);
            }
        }
//        $this->pullMessage($info['member_id'],$info['login_time']?$info['login_time']:$info['reg_time'] );
        if($this->pullMessage($info['member_id'],$info['login_time']?$info['login_time']:$info['reg_time'])==false){
            $data['status']=2;
            $data['info']="服务器繁忙,请稍后重试12";
            $this->ajaxReturn($data);
        }
        //如果当前操作Ip和上次不同更新登录IP以及登录时间
        $data['login_ip'] = $new_ip;
        $data['login_time']= time();
        $where['member_id'] = $info['member_id'];
        $r = $M_member->where($where)->save($data);
        if($r===false){
            $data['status']=2;
            $data['info']="服务器繁忙,请稍后重试";
            $this->ajaxReturn($data);
        }
        
        session('USER_KEY_ID',$info['member_id']);
        session('USER_KEY',$info['email']);//用户名
        session('STATUS',$info['status']);//用户状态

        $data['status']=1;
        $data['info']="登录成功";
        $this->ajaxReturn($data);
    }
    public function qqLogin(){
    	$app_id = C('SZ_QQ_APP_ID');
    	$app_key = C('SZ_QQ_APP_KEY');
    	$callback = C('SZ_QQ_CALLBACK');
    	$qq = new \Common\Api\QQConnect;
    	/* callback返回openid和access_token */
    	$back = $qq->callback($app_id , $app_key, $callback);
    	//防止刷新
    	empty($back) && $this->error("请重新授权登录",U('Login/index'));
    	$user_info = $qq->get_user_info($app_id,$back['token'],$back['openid']);
    	$Member = M('Member');
    	$where['openid']=$back['openid'];
    	$MemberArray = $Member->where("openid='".$back['openid']."'")->field('member_id,username,status')->find();
    	if($MemberArray['member_id']!=""){
    		session('USER_KEY_ID',$MemberArray['member_id']);
    		session('USER_KEY',$MemberArray['username']);//用户名
    		session('STATUS',$MemberArray['status']);//用户状态
    		$this->error("登陆成功",U('Index/index'));
    			
    	}else{
    			
    		$add['openid'] = $back['openid'];
    		$add['threepwd'] = $back['openid'];
    		$add['pwdtrade'] = md5('111111');
    		$add['head']=$back['figureurl_2'];
    		$add['name']=$back['nickname'];
    		
    			
    			
    		if($Member->create($add)){
    			$userid = $Member->add();
    			if($userid){
    				session('USER_KEY_ID',$userid);
    				session('USER_KEY',$back['openid']);//用户名
    				session('STATUS',0);//用户状态
    				$this->error("登陆成功",U('Index/index'));
    			}else{
    				$this->error("登陆失败",U('Login/index'));
    			}
    		}
    	}
    }
    /**
     * 忘记密码
     */
    public function findpwd(){
        if(IS_AJAX){
            if(empty($_POST['email'])){
                $data['status']=2;
                $data['info']="请填写邮箱";
                $this->ajaxReturn($data);
            }
            if(!checkEmail($_POST['email'])){
                $data['status']=2;
                $data['info']="请输入正确的邮箱";
                $this->ajaxReturn($data);
            }
            if(empty($_POST['captcha'])){
                $data['status']=2;
                $data['info']="请填写验证码";
                $this->ajaxReturn($data);
            }
            $verify = new Verify();
            if(!$verify->check($_POST['captcha'])){
                $data['status']=2;
                $data['info']="验证码输入错误";
                $this->ajaxReturn($data);
            }
            $info = M('Member')->where(array('email'=>$_POST['email']))->find();
            if($info==false){
                $data['status']=2;
                $data['info']="用户不存在";
                $this->ajaxReturn($data);
            }
            $token = strtoupper(md5($_POST['email']).md5(time()));//大写md5当前邮箱+当前时间
            $url = "http://".$_SERVER['SERVER_NAME'].U('Login/resetPwd',array('key'=>$token));
            $content = "<div>";
            $content.= "您好，<br><br>请点击链接：<br>";
            $content.= "<a target='_blank' href='{$url}' >重置您的密码</a>";
            $content.= "<br><br>如果链接无法点击，请复制并打开以下网址：<br>";
            $content.= "<a target='_blank' href='{$url}' >{$url}</a>";
            $r = setPostEmail($this->config['EMAIL_HOST'],$this->config['EMAIL_USERNAME'],$this->config['EMAIL_PASSWORD'],$this->config['name'].'团队',$_POST['email'],$this->config['name'].'团队[密码找回]',$content);
	        if($r){
            	$data['status']=2;
            	$data['info']="服务器繁忙,请稍后重试";
            	$this->ajaxReturn($data);
            }
            $member_id = $info['member_id'];
            $data['member_id'] = $info['member_id'];
            $data['token'] = $token;
            $data['add_time'] = time();
            if(M('Findpwd')->add($data)){
                $data['status']=1;
                $data['info']="邮箱已发送";
                $this->ajaxReturn($data);
            }else{
                $data['status']=2;
                $data['info']="服务器繁忙,请稍后重试";
                $this->ajaxReturn($data);
            }
        }else{
            $this->display();
        }
    }
    /**
     * 根据发送邮箱地址显示修改密码界面
     */
    public function resetPwd(){
        $token = I('key');
        if (empty($token)) {
            $this->success('无效的链接1', U('Index/index'));
            return;
        }
        $findpwd_info = M('Findpwd')->where("token = '$token'")->find();
        if ($findpwd_info === false) {
            $this->success('无效的链接', U('Index/index'));
            return;
        }
        if (time() - $findpwd_info['add_time'] > 24 * 60 * 60) {
        	M('findpwd')->delete($findpwd_info['id']);
            $this->success('邮件已过期', U('Index/index'));
            return;
        }
        if(IS_POST){
            $verify = new Verify();
            if(!$verify->check($_POST['captcha'])){
                $data['status']=2;
                $data['info']="验证码输入错误";
                $this->ajaxReturn($data);
            }
            if(empty($_POST['pwd'])){
                $data['status']=2;
                $data['info']="请输入密码";
                $this->ajaxReturn($data);
            }
            if(!checkPwd($_POST['pwd'])){
                $data['status']=2;
                $data['info']="密码长度在6-20个字符之间";
                $this->ajaxReturn($data);
            }
            if($_POST['repwd'] != $_POST['pwd']){
                $data['status']=2;
                $data['info']="确认密码和密码不一致";
                $this->ajaxReturn($data);
            }
            $member_info = M('member')->where(array('member_id'=>$findpwd_info['member_id']))->find();
            if(!empty($member_info['idcard'])){
                if($_POST['idcard']!=$member_info['idcard']){
                    $data['status']=2;
                    $data['info']="身份证输入错误";
                    $this->ajaxReturn($data);
                }
            }
            $member_newPwd = I('pwd','','md5');
            $r = M('member')
                ->where(array('member_id'=>$member_info['member_id']))
                ->setField('pwd',$member_newPwd);
            if($r===false){
                $data['status']=2;
                $data['info']="服务器繁忙,请稍后重试";
                $this->ajaxReturn($data);
            }else{
                M('findpwd')->delete($findpwd_info['id']);
                $data['status']=1;
                $data['info']="修改成功";
                $this->ajaxReturn($data);
            }
        }else{
            $this->assign('key',$token);
            $this->display();
        }
    }
    /**
     * 显示验证码
     */
    public function showVerify(){
        $config =	array(
            'fontSize'  =>  10,              // 验证码字体大小(px)
            'useCurve'  =>  true,            // 是否画混淆曲线
            'useNoise'  =>  true,            // 是否添加杂点
            'imageH'    =>  35,               // 验证码图片高度
            'imageW'    =>  80,               // 验证码图片宽度
            'length'    =>  4,               // 验证码位数
            'fontttf'   =>  '4.ttf',              // 验证码字体，不设置随机获取
        );
        $Verify =     new Verify($config);
        $Verify->entry();
    }
    /**
     * ajax判断Ip
     * @param $email
     */
    public function checkIp($email){
        //判断传过来的是手机号还是email
        $data = array();
        if(!checkEmail($email) && !checkMobile($email)){
            $data['status'] = 2;
            $data['msg'] = '请输入正确的邮箱或手机号码';
            $this->ajaxReturn($data);
        }
        if(checkEmail($email)){
            $where['email']  = $email;
        }else{
            $where['phone']  = $email;
        } 
        //检查用户是否存在
        $info =  M('Member')->where($where)->find();
        if(!$info){
            $data['status'] = 2;
            $data['msg'] = '用户不存在';
            $this->ajaxReturn($data);
        }
        //检查是否做了身份认证
        if($info['idcard']){
            //如果login_ip不存在那么就是第一次登录取注册IP
            $old_login_ip = $info['login_ip']?$info['login_ip']:$info['ip'];
            $new_ip = get_client_ip();
            if($old_login_ip!=$new_ip){
                $data['status'] = 1;
                $data['msg'] = '系统监测到您的账号本次登录IP和上次不同，为了保障您的账户资产安全，请输入您在'.$this->config['name'].'预留的身份证上的出生日期；如还未实名认证，请联系客服认证。';
                $this->ajaxReturn($data);
            }
        }
        $data['status'] = 0;
        $data['msg'] = '';
        $this->ajaxReturn($data);
    }
    /**
     * 退出
     */
    public function loginOut(){
        if ($_SESSION['USER_KEY_ID']!=null){
            session(null);
        }
        $this->redirect('Index/index');
    }

    /**
     * 读取消息库中有自己消息的列表并且存储至个人消息库中
     * @param $id 用户ID
     * @param $login_time 用户最后一次登录时间
     * @return bool 返回 成功失败
     */
    public function pullMessage($id,$login_time){
        if(empty($id)){
            return false;
        }
        if(empty($login_time)){
            return false;
        }
        //消息库
        $M_message_all = M('message_all');
        //用户消息库
        $M_message = M('message');
        $messageAllWhere['add_time'] = array('EGT',$login_time);
        $messageAllWhere['_string'] = " u_id= -1 or  u_id = $id";
        $message_info = $M_message_all->where($messageAllWhere)->select();
        if($message_info){
            foreach ($message_info as $vo) {
                $data[] = array(
                    'member_id'=>$id,
                    'title'=>$vo['title'],
                    'type' => $vo['type'],
                    'content'=> $vo['content'],
                    'add_time'=> $vo['add_time'],
                    'status' => 0,//未读
                    'message_all_id'=> $vo['id'],
                );
            }
            if($M_message->addAll($data)===false){
                return false;
            }
        }
        return true;
    }
}

31:F:\git\coin\bisheng commerce\App\Home\Controller\MarketController.class.php
<?php
/**
 */

namespace Home\Controller;

use Common\Controller\CommonController;

class MarketController extends CommonController {
    /**
     * 查看行情
     */
  public function index(){
  	
  		if(!empty($_GET['coin'])){
  			$whereMark['currency_mark'] = I('get.coin');
  		}
  		
  		$whereMark['is_line']=1;
  		$liCurrency = M('Currency')->field('currency_id,currency_name,currency_logo,currency_mark')->where($whereMark)->order('sort')->find();
  		
  		//判断 有没有 可以交易的币种
  	 	if(empty($liCurrency)){
  	 		$this -> error('交易币种正在紧张筹备中！敬请期待',U('Index/index'));
  	 	}
  	 	
  	 	$wheretrade['currency_id'] = $liCurrency['currency_id'] ;
  	 	//获取成交最大值
  	 	$liCurrency['maxPrice'] = M('Trade') ->where($wheretrade)->max('price');
  	 	//获取成交最小值
  	 	$liCurrency['minPrice'] = M('Trade') ->where($wheretrade)->min('price');
  	 	// 获取交易量
  	 	$liCurrency['countNum'] = M('Trade') ->where($wheretrade)->sum('num');
  	 	//最新价格
  	 	$liCurrency['newPrice'] = $this -> getNewPriceByCurrencyid($liCurrency['currency_id']);
  	 	$buyOrder['type'] = "buy";
  	 	//获取买一价
  	 $liCurrency['buyPrice']=$this->getOneOrdersByPrice($liCurrency['currency_id'], 'buy');
  	 	//获取卖一价
  	 	 $liCurrency['sellPrice']=$this->getOneOrdersByPrice($liCurrency['currency_id'], 'sell');
  	 	//成交盘
  	 	$Deal = M('Trade')->where($wheretrade)->order('add_time desc')->limit(30)->select();
  	 	
  	 
  	 	//买卖盘   买
  		 $sell=$this->getOrdersByType($liCurrency['currency_id'], 'buy', 20, 'desc');
  		 // 页面显示 成交量背景 比例
  	 	 foreach ($sell as $k=>$v){
			$sell[$k]['bili']=100-intval(($v['trade_num']/$v['num'])*100)."%";
		 }
  	 
  	 	//买卖盘   卖
  		 $buy =$this->getOrdersByType($liCurrency['currency_id'], 'sell', 20, 'asc');
  		 $buy=  array_reverse($buy);
  		 // 页面显示 成交量背景 比例
  	 	 foreach ($buy as $k=>$v){
  	 		$buy[$k]['bili']=100-intval(($v['trade_num']/$v['num'])*100)."%";
  	 	 }
  	 	
  	 	//查询其他交易币  去掉当前 币种
  	 	$where['currency_id'] =  array('NEQ',$liCurrency['currency_id']);
  	 	$where['is_line']=1;
  	 	$listCurrency = M('Currency')->field('currency_id,currency_name,currency_logo,currency_mark')->where($where)->select();
  	 	foreach($listCurrency as $k =>$v){
  	 		$listCurrency[$k]['newPrice'] = $this -> getNewPriceByCurrencyid($v['currency_id']);
  	 	}
  	 	
  	 	$this ->assign('count',max(count($sell),count($buy)));
  	 	$this ->assign('deal',$Deal);
  	 	$this ->assign('sell',$sell);
  	 	$this ->assign('buy',$buy);
  	 	$this ->assign('listCurrency',$listCurrency);
  	 	$this ->assign('liCurrency',$liCurrency);
  		$this->display();
  }
  
  /**
   *  获取最新交易价格
   * @param unknown $type    币种id
   * @return unknown|number  
   */
  public function getNewPriceByCurrencyid($currency_id){
  		$where['currency_id'] =$currency_id;
  		$list = M('Orders')->where($where)->field('price')->order('add_time desc')->find();
  		
  		if(!empty($list)){
  			return $list['price'];
  		}else{
  			return  0;
  		}
  }
  
  public function getMarket(){
      $where['status']=array('in',array(0,1));
      $list=M('Orders')->field('price')->where($where)->group('price')->select();
      $price_arr=array();
      $buy_arr=array();
      $sell_arr=array();
      foreach ($list as $k=>$v){
            $sell=M('Orders')->field('sum(num) as num')->where($where)->where("type='sell' and price='{$v['price']}'")->select();
            $buy=M('Orders')->field('sum(num) as num')->where($where)->where("type='buy' and price='{$v['price']}'")->select();
            $list[$k]['sell']=!empty($sell[0]['num'])?$sell[0]['num']:0;
            $list[$k]['buy']=!empty($buy[0]['num'])?$buy[0]['num']:0;
      }
      foreach ($list as $k=>$v){
          $price_arr[]=floatval($v['price']);
          $sell_arr[]=floatval($v['sell']);
          $buy_arr[]=floatval($v['buy']);
      }
      $data['price']=$price_arr;
      $data['sell']=$sell_arr;
      $data['buy']=$buy_arr;
     $this->ajaxReturn($data);
  }
  
  
  //获取买卖单分补
  private function getOrdersMarket($type,$currency_id){
       $where['currency_id']=$currency_id;
       $where['type']=$type;
      $max_pirce=M('Orders')->where($where)->max('price');
      $min_price=M('Orders')->where($where)->min('price');
      $units=intval(($max_pirce-$min_price)/10);
      for ($i=0;$i<10;$i++){
            $arr_price[]=$min_price+$units*$i;  
      }
      $start=$min_price;
      $end=$min_price+$units;
      
  }
  
  
}  

32:F:\git\coin\bisheng commerce\App\Home\Controller\ModifyMemberController.class.php
<?php
/**
 * Created by PhpStorm.
 * User: Administrator
 * Date: 16-3-8
 * Time: 下午4:29
 */

namespace Home\Controller;

use Common\Controller\CommonController;

class ModifyMemberController extends CommonController {
    /**
     * 添加个人信息
     */
    public function modify(){
        //判断是否是已经完成reg基本注册
       $login=$this->checkLogin();
       if(!$login){
      	 	$this->redirect('User/index');
       		return;
       }
       if(session('STATUS')!=0){
            $this->redirect('User/index');
            return;
        }
        if(IS_POST){
            $M_member = D('Member');
            $id = session('USER_KEY_ID');
            $_POST['member_id']=$id;
            $_POST['status'] = 1;//0=有效但未填写个人信息1=有效并且填写完个人信息2=禁用
            if (!$data=$M_member->create()){ // 创建数据对象
                // 如果创建失败 表示验证没有通过 输出错误提示信息
                $data['status'] = 0;
                $data['info'] = $M_member->getError();
                $this->ajaxReturn($data);
//                $this->error($M_member->getError());
                return;
            }else {
                $where['member_id'] = $id;
                $r = $M_member->where($where)->save();
                if($r){
                    session('procedure',2);//SESSION 跟踪第二步
                    session('STATUS',1);
                    $data['status'] = 1;
                    $data['info'] = "提交成功";
                    $this->ajaxReturn($data);
//                    $this->redirect('Reg/regSuccess');
                }else{
                    $data['status'] = 0;
                    $data['info'] = '服务器繁忙,请稍后重试';
                    $this->ajaxReturn($data);
//                    $this->error('服务器繁忙,请稍后重试');
//                    return;
                }
            }
        }else{
            $this->display();
        }
    }
    /**
     * ajax验证昵称是否存在
     */
    public function ajaxCheckNick($nick){
        $nick = urldecode($nick);
        $data =array();
        $M_member = M('Member');
        $where['nick']  = $nick;
        $r = $M_member->where($where)->find();
        if($r){
            $data['msg'] = "昵称已被占用";
            $data['status'] = 0;
        }else{
            $data['msg'] = "";
            $data['status'] = 1;
        }
        $this->ajaxReturn($data);
    }
    /**
     * ajax手机验证
     */
    function ajaxCheckPhone($phone) {
        $phone = urldecode($phone);
        $data = array();
        if(!checkMobile($phone)){
            $data['msg'] = "手机号不正确！";
            $data['status'] = 0;
        }else{
            $M_member = M('Member');
            $where['phone']  = $phone;
            $r = $M_member->where($where)->find();
            if($r){
                $data['msg'] = "此手机已经绑定过！请更换手机号";
                $data['status'] = 0;
            }else{
                $data['msg'] = "";
                $data['status'] = 1;
            }
        }
        $this->ajaxReturn($data);
    }

    /**
     * ajax验证手机验证码
     */
    public function ajaxSandPhone(){
        $phone = urldecode(I('phone'));
        if(empty($phone)){
            $data['status']=0;
            $data['info'] = "手机号码不能为空";
            $this->ajaxReturn($data);
        }
        if(!preg_match("/^1[34578]{1}\d{9}$/",$phone)){  
            $data['status']=-1;
            $data['info'] = "手机号码不正确";
            $this->ajaxReturn($data);
        }  
        $user_phone=M("Member")->field('phone')->where("phone='$phone'")->find();
        if (!empty($user_phone)){
            $data['status']=-2;
            $data['info'] = "手机号码已经存在";
            $this->ajaxReturn($data);
        }
        $r = sandPhone($phone,$this->config['CODE_NAME'],$this->config['CODE_USER_NAME'],$this->config['CODE_USER_PASS']);
		if(!$r[1]){
			$data['status']=1;
        	$data['info']="发送成功";
        	$this->ajaxReturn($data);exit;
		}else{
			$data['status'] =-3;
        	$data['info']=chuanglan_status($r[1]);
        	$this->ajaxReturn($data);exit;
		}
 
        
//         if($r!="短信发送成功"){
//             $data['status']=0;
//             $data['info'] = $r;
//             $this->ajaxReturn($data);
//         }else{
//             $data['status']=1;
//             $data['info'] = $r;
//             $this->ajaxReturn($data);
//         }
    }
}

33:F:\git\coin\bisheng commerce\App\Home\Controller\OauthController.class.php
<?php
// 本类由系统自动生成，仅供测试用途
namespace Home\Controller;
use Think\Controller;
class OauthController extends Controller {

/*namespace User\Controller;
use Think\Controller;
class OauthController extends Controller {*/
/* 
* Type类型，初始化
* QQConnet  WeiboConnect 
*/
    public function index(){
    switch ($_GET['type']) {
    /* QQ互联登录 */
    case qq:
    	$app_id = C('SZ_QQ_APP_ID');
        $scope = C('SZ_QQ_SCOPE');
        $callback = C('SZ_QQ_CALLBACK');
        $sns = new \Common\Api\QQConnect;
        $sns->login($app_id, $callback, $scope);
    break;
    /* 新浪微博登录 */
    case sina:
    $app_id = C('SZ_SINA_APP_ID');
    $scope = C('SZ_SINA_SCOPE');
    $callback = C('SZ_SINA_CALLBACK');
    $sns = new \Common\Api\WeiboConnect;
    $sns->login($app_id, $callback, $scope);
    break;
    /* 默认无登录 */
    default:
    $this->error("无效的第三方方式",U('/user/login/index'));
    break;
    }
    }  
      /*    
       * 互联登录返回信息
       * 获取code 和 state状态，查询数据库 
       *  */
 public function callback() {
    switch ($_GET['type']) {
    /* 接受QQ互联登录返回值 */
    case qq:
    empty($_GET['code']) && $this->error("无效的第三方方式",U('/user/login/index'));
    $app_id = C('SZ_QQ_APP_ID');
    $app_key = C('SZ_QQ_APP_KEY');
    $callback = C('SZ_QQ_CALLBACK');
    $qq = new \Common\Api\QQConnect;
    /* callback返回openid和access_token */
    $back = $qq->callback($app_id , $app_key, $callback);
                        //防止刷新
    empty($back) && $this->error("请重新授权登录",U('/user/login/index'));
    //此处省略数据库查询，查询返回的$back['openid']
  break;
     
    /* 接受新浪微博登录返回值     */
    case sina:
       empty($_GET['code']) && $this->error("无效的第三方方式",U('/user/login/index'));
            $app_id = C('SZ_SINA_APP_ID');
    $app_key = C('SZ_SINA_APP_KEY');
    $scope = C('SZ_SINA_SCOPE');
    $callback = C('SZ_SINA_CALLBACK');
    $weibo = new \Common\Api\WeiboConnect;
    /* callback返回openid和access_toke */
    $back = $weibo->callback($app_id , $app_key, $callback);
    empty($back) && $this->error("请重新授权登录",U('/user/login/index'));
            //此处省略数据库查询，查询返回的$back['openid']
                break;
               /* 默认错误跳转到登录页面  */
    default:
    $this->error("无效的第三方方式",U('/user/login/index'));
    break;
    }
    }
}	 

34:F:\git\coin\bisheng commerce\App\Home\Controller\OrdersController.class.php
<?php
namespace Home\Controller;
use Common\Controller\CommonController;
class OrdersController extends CommonController{
    public function _initialize(){
        parent::_initialize();
    }
    //交易页面显示
    public function index(){
        if(empty($_GET['currency'])){
            $this->display('Public:b_stop');
            return;
        }        
        $currency_id=I('get.currency');
        $currency=M('Currency')->where("currency_mark='$currency_id' and is_line=1")->find();
        if(empty($currency)){
            $this->display('Public:b_stop');
            return;
        }
        $currency['currency_digit_num']=$currency['currency_digit_num']?$currency['currency_digit_num']:4;//设置限制位数
        //显示委托记录
        $buy_record=$this->getOrdersByType($currency['currency_id'],'buy', 10, 'desc');
        $sell_record=$this->getOrdersByType($currency['currency_id'],'sell', 10, 'asc');
        $this->assign('buy_record',$buy_record);
        $this->assign('sell_record',$sell_record);
        //格式化手续费
        $currency['currency_sell_fee']=floatval($currency['currency_sell_fee']);
        $currency['currency_buy_fee']=floatval($currency['currency_buy_fee']);
        //币种信息
        $currency_message=$this->getCurrencyMessageById($currency['currency_id']);
        $currency_trade=$this->getCurrencynameById($currency['trade_currency_id']);
        $this->assign('currency_message',$currency_message);
        $this->assign('currency_trade',$currency_trade);
        //个人账户资产
        if (!empty($_SESSION['USER_KEY_ID'])){
            $user_currency_money['currency']['num']=$this->getUserMoney($currency['currency_id'], 'num');
            $user_currency_money['currency']['forzen_num']=$this->getUserMoney($currency['currency_id'], 'forzen_num');
            $user_currency_money['currency_trade']['num']=$this->getUserMoney($currency['trade_currency_id'], 'num');
            $user_currency_money['currency_trade']['forzen_num']=$this->getUserMoney($currency['trade_currency_id'], 'forzen_num');
            if($currency['trade_currency_id']==0){
                $user_currency_money['currency_trade']['num']=$this->member['rmb'];
                $user_currency_money['currency_trade']['forzen_num']=$this->member['forzen_rmb'];
            }
            $this->assign('user_currency_money',$user_currency_money);
            //个人挂单记录
            $this->assign('user_orders',$this->getOrdersByUser(5,$currency['currency_id']));
            //最大可买
            if (!empty($sell_record)){
            		  $buy_num=sprintf('%.4f',$user_currency_money['currency_trade']['num']/$sell_record[0]['price']);
            }else {
                $buy_num=0;
            }
            $this->assign('buy_num',$buy_num);
            //最大可卖
            $sell_num=sprintf('%.4f',$user_currency_money['currency']['num']);
            $this->assign('sell_num',$sell_num);
        }
        $this->assign('session',$_SESSION['USER_KEY_ID']);
        $this->assign('currency',$currency);
        //成交记录
        $trade=$this->getOrdersByStatus(2, 20, $currency['currency_id']);
        $this->assign('trade',$trade);
        $this->display();
    }
    //交易大厅
    public function currency_trade(){
        $count = M('Currency')->where('is_line=1')->count();//根据分类查找数据数量
        $page = new \Think\Page($count,10);//实例化分页类，传入总记录数和每页显示数
        $show = $page->show();//分页显示输出性
        $currency = M('Currency')->where('is_line=1')->order('sort')->limit($page->firstRow.','.$page->listRows)->select();//时间降序排列，越接近当前时间越高
        foreach ($currency as $k=>$v){
            $list=$this->getCurrencyMessageById($v['currency_id']);
            $currency[$k]=array_merge($list,$currency[$k]);
            $list['new_price']?$list['new_price']:0;
            $currency[$k]['currency_all_money'] = floatval($v['currency_all_num'])*$list['new_price'];
        }
        $this->assign('page',$show);
        $this->assign('currency',$currency);
        $this->display();
    }
    
    //获取挂单记录
    public function getOrders(){
        switch (I('post.type')){
          case 'buy':  $this->ajaxReturn($this->getOrdersByType(I('post.currency_id'),'buy', 10, 'desc'));
          break;
          case 'sell':$this->ajaxReturn($this->getOrdersByType(I('post.currency_id'),'sell', 10, 'asc'));
          break;
        }
    }
    //获取k线
    public function getOrdersKline(){
        if(empty($_GET['currency'])){
            return;
        }
        $currency_id=I('get.currency');
        //K线
        $char=!empty($_GET['time'])?I('get.time'):'kline_1h';
        switch ($char){
            case 'kline_5m':$time=5;break;
            case 'kline_15m':$time=15;break;
            case 'kline_30m':$time=30;break;
            case 'kline_1h':$time=60;break;
            case 'kline_8h':$time=480;break;
            case 'kline_1d':$time=24*60;break;
            default:$time=60;
        }
        $data[$char]=$this->getKline($time,$currency_id);
        $this->ajaxReturn($data);
    }
    //获取K线
    private function getKline($base_time,$currency_id){
            $time=time()-$base_time*60*60;
            for ($i=0;$i<60;$i++){
             $start= $time+$base_time*60*$i;
             $end=$start+$base_time*60;
            //时间
            $item[$i][]=$start*1000+8*3600*1000;
            $where['currency_id']=$currency_id;
            $where['type']='buy';
            $where['add_time']=array('between',array($start,$end));
     
            //交易量
          $num=M('Trade')->where($where)->sum('num');
          $item[$i][]=!empty($num)?floatval($num):0;
            //开盘
            $where_price['currency_id']=$currency_id;
            $where_price['type']='buy';
            $where_price['add_time']=array('elt',$end);
          
            $order_k=M('Trade')->field('price')->where($where_price)->order('add_time desc')->find();
            $item[$i][]=!empty($order_k['price'])?floatval($order_k['price']):0;
            //最高
           $max=M('Trade')->where($where)->max('price');
           $max=!empty($max)?floatval($max):$order_k['price'];
           $max=!empty($max)?$max:0;
           $item[$i][]=$max;
            //最低
            $min=M('Trade')->where($where)->min('price');
            $min=!empty($min)?floatval($min):$order_k['price'];
            $item[$i][]=!empty($min)?$min:0;
            //收盘
            $order_s=M('Trade')->field('price')->where($where)->order('add_time asc')->find();
            $order_s=!empty($order_s['price'])?floatval($order_s['price']):$order_k['price'];
            $item[$i][]=!empty($order_s)?$order_s:0;
        }
       // $item=json_encode($item,true);
        return $item;
    }
}

35:F:\git\coin\bisheng commerce\App\Home\Controller\PayController.class.php
<?php
namespace Home\Controller;
use Home\Controller\HomeController;
use Think\Page;
use Think\Upload;

class PayController extends HomeController {
	
    //空操作
    public function _initialize(){
        parent::_initialize();
    }

    public function _empty(){
        header("HTTP/1.0 404 Not Found");
        $this->display('Public:404');
    }
    public function index(){
        $this->display();
    }
    //人工充值AJAX处理方式
    public function rechargeByMan(){
    	$config=$this->config;
    	$member=$this->member;
    	$data['member_name']=I('post.member_name');
    	$data['money']=intval(I('post.money'));
    	$data['account']=I('post.account');
    	$data['count']=I('post.count');
    	$data['type']=I('post.type');	
    	if(empty($data['member_name'])||empty($data['money'])||empty($data['account'])||empty($data['type'])){
    		$arr['info']='请填写全部信息';
    		$arr['status']=0;
    		$this->ajaxReturn($arr);
    	}
    	if($member['status']!=1){
    		$arr['info']='请完成实名验证再进行充值';
    		$arr['status']=0;
    		$this->ajaxReturn($arr);
    	}
    	if(strlen($data['account'])<11||strlen($data['account'])>20){
    		$arr['info']='请输入正确的银行卡号或支付宝账号';
    		$arr['status']=0;
    		$this->ajaxReturn($arr);
    	}
    	if($data['money']<$config['pay_min_money']){
    		$arr['info']="充值金额不能小于{$config['pay_min_money']}元";
    		$arr['status']=0;
    		$this->ajaxReturn($arr);
    	}
    	if($data['money']>$config['pay_max_money']){
    		$arr['info']="充值金额不能大于{$config['pay_max_money']}元";
    		$arr['status']=0;
    		$this->ajaxReturn($arr);
    	}
    	$data['member_id'] = session('USER_KEY_ID');
    	$data['add_time']=time();
    	$data['status']=0;
    	$list=M('Pay')->add($data);
    	if($list){
    		$arr['info']="充值订单提交成功";
    		$arr['status']=1;
    		$arr['num']=$data['count'];
    		$this->ajaxReturn($arr);
    	}else{
    		$arr['info']="充值订单提交失败";
    		$arr['status']=0;
    		$this->ajaxReturn($arr);
    	}
    }
    
    //币充值页面
    public function bpay(){

    	$this->User_status();//判断是否需要进行信息补全
    	$id=I('currency_id');//货币id
    	if(empty($id)){
    		$this->error("请选择币种",U("User/index"));
    	}
    	$currency=$this->getCurrencyByCurrencyId($id);
    	
    	if(empty($currency)){
    		$this->error("无效币种请联系管理员",U("User/index"));
    	}
		$list=$this->getUserMoneyByCurrencyId($_SESSION['USER_KEY_ID'], $id);
		//设置充值地址
    	if(empty($list['chongzhi_url'])){
    		$address=$this->qianbao_new_address($currency);
    		$this->setCurrentyMemberByMemberId($_SESSION['USER_KEY_ID'], $id, 'chongzhi_url', $address);
    		$list['chongzhi_url']=$address;
    	}
    
    	//充值页面
    	$where['user_id']=$_SESSION['USER_KEY_ID'];
    	$where['status']=array('in',array(2,3));
    	$where['currency_id']=$id;//货币id
    	import('ORG.Util.Page');// 导入分页类
    	$count      = M("Tibi")->where($where)->count();// 查询满足要求的总记录数
    	$Page       = new Page($count,10);// 实例化分页类 传入总记录数和每页显示的记录数
    	$show       = $Page->show();// 分页显示输出
    	// 进行分页数据查询 注意limit方法的参数要使用Page类的属性
    	$chongzhi = M("Tibi")->where($where)->order("id desc")->limit($Page->firstRow.','.$Page->listRows)->select();
    	$this->assign('chongzhi',$chongzhi);// 赋值数据集
    	$this->assign('page',$show);// 赋值分页输出
    	$this->assign("list",$list);
    	$this->assign("currency",$currency);//货币信息
    	$this->display();
    }
    
    
    //提币的页面
    public function tcoin(){

    	$this->User_status();//判断是否需要进行信息补全
    	$cuid=I('currency_id');
    	$list=M("Qianbao_address")->where("user_id='{$_SESSION['USER_KEY_ID']}' and currency_id = '$cuid'")->find();
    	$this->assign("list",$list);
    	$currency=$this->getCurrencyByCurrencyId($cuid);
    	if(empty($currency)){
    		$this->error("错误操作，请联系管理员",U('User/index'));
    	}
    	
    	$where['user_id']=$_SESSION['USER_KEY_ID'];
    	$where['status']=array('in',array(0,1));
    	import('ORG.Util.Page');// 导入分页类
    	$count      = M("Tibi")->where($where)->count();// 查询满足要求的总记录数
    	$Page       = new Page($count,10);// 实例化分页类 传入总记录数和每页显示的记录数
    	$show       = $Page->show();// 分页显示输出
    	// 进行分页数据查询 注意limit方法的参数要使用Page类的属性
    	$tibi_list = M("Tibi")->where($where)->order("id desc")->limit($Page->firstRow.','.$Page->listRows)->select();
    	$this->assign('page',$show);// 赋值分页输出
    	$this->assign("tibi_list",$tibi_list);
    	$this->tibi_save($currency);
    	 
    	$cuser=M("Currency_user")->where("currency_id='$cuid' and member_id='{$_SESSION['USER_KEY_ID']}'")->find();
    	$this->assign("cuser",$cuser);//个人货币数量
    	
    	$this->assign("cuid",$currency);//货币名称
    	$this->display();
    }
    /**
     * 修改提币记录
     */
    private function tibi_save($currency){
    	$where['user_id']=$_SESSION['USER_KEY_ID'];
    	$where['status']=0;
    	$list=M("Tibi")->where($where)->select();
    	if(!empty($list)){
    		foreach ($list as $k=>$v){
    			$x="";
    			$data="";
    			$x=$this->chakan_tibi_jilu($v['ti_id'],$currency);
    			if($x['confirmations']>2){
    				$data['check_time']=$x['time'];
    				$data['status']=1;
    				M("Tibi")->where("id='{$v['id']}'")->save($data);
    			}
    		}
    	}
    }
    /**
     *
     * 查看提币记录
     *
     * @param unknown $tid 提币ti_id
     * @return unknown
     */
    private function chakan_tibi_jilu($tid,$currency){
    	require_once 'App/Common/Common/easybitcoin.php';
    	$bitcoin = new \Bitcoin($currency['rpc_user'],$currency['rpc_pwd'],$currency['rpc_url'],$currency['port_number']);
//     	$result = $bitcoin->getinfo();
    	$list= $bitcoin->gettransaction($tid);
    	return $list;
    }
    
    /**
     * 提币方法
     */
    
    public function ti_bi(){
    	 $cuid=I("currency_id");//货币id
    	 $currency=M("Currency")->where("currency_id='$cuid'")->find();//这个是货币
    	 if($_POST['code']!=$_SESSION['code']){
    	 	$arr['status']=11;
    	 	$arr['info']="验证码不正确";
    	 	$this->ajaxReturn($arr);exit;
    	 }
    	 if(empty($currency)){
    	 	$arr['status']=10;
    	 	$arr['info']="无效货币，无法提币";
    	 	$this->ajaxReturn($arr);exit;
    	 }
    
    	if(empty($_POST['num'])){
    		$arr['status']=2;
    		$arr['info']="请填写提币数量";
    		$this->ajaxReturn($arr);exit;
    	}
    	if($_POST['num']<=0.0001){
    		$arr['status']=3;
    		$arr['info']="请填写大于0.0001的数量";
    		$this->ajaxReturn($arr);exit;
    	}
    	if($_POST['num']>$currency['currency_all_tibi']){
    		$arr['status']=4;
    		$arr['info']="已超出最大限制";
    		$this->ajaxReturn($arr);exit;
    	}
    	$num=floatval($_POST['num']);
    	if(empty($_POST['paypwd'])){
    		$arr['status']=5;
    		$arr['info']="请填写支付密码";
    		$this->ajaxReturn($arr);exit;
    	}
    	$user=M("Member")->where("member_id='{$_SESSION['USER_KEY_ID']}'")->find();
    	if($user['pwdtrade']!=md5($_POST['paypwd'])){
    		$arr['status']=6;
    		$arr['info']="支付密码错误";
    		$this->ajaxReturn($arr);exit;
    	}
    	//判断是否已经添加提币地址
    	$list=M("Qianbao_address")->where("user_id='{$_SESSION['USER_KEY_ID']}' and currency_id='$cuid'")->find();
    	 
    	if(empty($list)){
    		$arr['status']=7;
    		$arr['info']="请添加提币地址";
    		$this->ajaxReturn($arr);exit;
    	}
    	//判断看这个钱包地址是否是真实地址
    	if(!$this->check_qianbao_address($list['qianbao_url'],$currency)){
    		$arr['status']=8;
    		$arr['info']="提币地址不是一个有效地址";
    		$this->ajaxReturn($arr);exit;
    	}
    	//判断账户余额够不够
    	$money=M("Currency_user")->where("member_id='{$_SESSION['USER_KEY_ID']}' and currency_id='$cuid'")->find();
    	if($money['num']<$num){
    		$arr['status']=10;
    		$arr['info']="账户余额不足，无法提币";
    		$this->ajaxReturn($arr);exit;
    	}
    	if(!empty($this->config['tcoin_fee'])){
    		$actual=$num*(1-$this->config['tcoin_fee']/100);//计算出扣除手续费后的价格
    	}else{
    		$actual=$num;
    	}
    	$actual=(float)$actual;//实际到账
    
    	$data['fee']=$this->config['tcoin_fee'];//手续费
    	$data['currency_id']=$cuid;
    	$data['user_id']=$_SESSION['USER_KEY_ID'];
    	$data['url']=$list['qianbao_url'];
    	$data['name']=$list['name'];
    	$data['num']=$num;
    	$data['actual']=$actual;//实际到账价格
    	$data['status']=0;
    	$data['add_time']=time();
    	
    	$tibi=$this->qianbao_tibi($list['qianbao_url'],$actual,$currency);//提币程序
    	 
    	if($tibi){//成功写入数据库
    		$data['ti_id']=$tibi;
    		$re=M("Tibi")->add($data);
    		//减钱操作
    		M("Currency_user")->where("member_id='{$_SESSION['USER_KEY_ID']}' and currency_id='$cuid'")->setDec("num",$num);
    		$arr['status']=1;
    		$arr['info']="提币成功，请耐心等待";
    		$this->ajaxReturn($arr);exit;
    
    	}else{//失败提示
    		$arr['status']=9;
    		$arr['info']="提币失败";
    		$this->ajaxReturn($arr);exit;
    	}
    	 
    	 
    	 
    }
    
    /**
     * 添加钱包提现地址
     */
    public function add_qianbao_address(){
    	$cuid=I("currency_id");//货币id
    	$currency=M("Currency")->where("currency_id = '$cuid'")->find();
    	if(empty($currency)){
    		$arr['status']=2;
    		$arr['info']="无效币种，无法添加提币地址";
    		$this->ajaxReturn($arr);exit;
    	}
    	if(empty($_POST['name'])){
    		$arr['status']=3;
    		$arr['info']="新地址姓名不能为空";
    		$this->ajaxReturn($arr);exit;
    	}
    	if(empty($_POST['address'])){
    		$arr['status']=4;
    		$arr['info']="新地址不能为空";
    		$this->ajaxReturn($arr);exit;
    	}
    	//检测钱包地址是否有效
    	$jiance=$this->check_qianbao_address($_POST['address'],$currency);
    	if(!$jiance){
    		$arr['status']=5;
    		$arr['info']="钱包地址错误，不是一个真实有效的钱包地址";
    		$this->ajaxReturn($arr);exit;
    	}
    	//检测地址是否已经存在
    	$where['qianbao_url']=$_POST['address'];
    	$re=M("Qianbao_address")->where($where)->find();
    	if(!empty($re)){
    		$arr['status']=6;
    		$arr['info']="此地址已经绑定，请核实真实地址";
    		$this->ajaxReturn($arr);exit;
    	}
    	//检查此人是否已经有地址
    	$uq=M("Qianbao_address")->where("user_id='{$_SESSION['USER_KEY_ID']}'")->find();
    	 
    	$data['currency_id']=$cuid;//货币id
    	$data['name']=$_POST['name'];
    	$data['qianbao_url']=$_POST['address'];
    	$data['add_time']=time();
    	$data['user_id']=$_SESSION['USER_KEY_ID'];
    	$data['status']=1;
    	if(empty($uq)){
    		$qa=M("Qianbao_address")->add($data);
    	}else{
    		$qa=M("Qianbao_address")->where("id='{$uq['id']}'")->save($data);
    	}
    
    	if($qa){
    		$arr['status']=1;
    		$arr['info']="添加成功";
    		$this->ajaxReturn($arr);exit;
    	}else{
    		$arr['status']=7;
    		$arr['info']="添加失败";
    		$this->ajaxReturn($arr);exit;
    	}
    }
    
    /**
     * 删除钱包地址
     */
    public function del_address(){
    	$id=I('id');
    	$cuid=I("cuid");
    	if(empty($id)){
    		$this->error("无效数据");
    	}
    	if(empty($cuid)){
    		$this->error("无效货币");
    	}
    	$where['id']=$id;//提币地址的id
    	$where['currency_id']=$cuid;//提币的币种id
    	$where['user_id']=$_SESSION['USER_KEY_ID'];
    	$qa=M("Qianbao_address")->where($where)->find();
    	if(empty($qa)){
    		$this->error("非法操作");
    	}
    	 
    	$re=M("Qianbao_address")->where($where)->delete();
    	if($re){
    		$this->success("删除成功",U('Pay/tcoin',array('currency_id'=>$cuid)));
    	}else{
    		$this->error("删除失败");
    	}
    }
    /**
     * 充值方法
     * @return boolean
     */
    
    public function chongzhi_function(){
    	//     	$where['status']=array("in",array(3));//1与3分别为 提币成功 与充值成功;
    	//     	$where['user_id']=$_SESSION['USER_KEY_ID'];
    	//     	$count = M("Tibi")->where($where)->count();
    	$id=I("currency_id");//货币id；
    	if(empty($id)){
    		return false;
    	}
    	$currency=M("Currency")->where("currency_id='$id'")->find();//这个是货币
    	if(empty($currency)){
    		return false;
    	}
    	
    	//如果货币不存在 直接返回
    	$currency=M("Currency")->where("currency_id='$id'")->find();
    	if(empty($currency)){
    		return false;
    	}
    	$list=$this->trade_qianbao($_SESSION['USER_KEY'],$currency);
    	foreach ($list as $k=>$v){
    		$data["currency_id"]=$currency['currency_id'];//货币id写入
    		if($v['category']=='receive'){
    			$data[]=array();
    			$data['user_id']=$_SESSION['USER_KEY_ID'];
    			$data['url']=$v['address'];//地址
    			$data['name']=$v['account'];//标签
    			$data['add_time']=$v['time'];//时间
    			$data['num']=$v['amount'];//数量
    			$tibi_txid=M("Tibi")->where("ti_id='{$v['txid']}'")->find();
    			if(!empty($tibi_txid)){
    				//如果已经存在  而且是已经完成状态 不处理直接跳出循环
    				if($tibi_txid['status']==3){
    					continue;
    				}
    				if($v['confirmations']>2){
    					$data['status']=3;//3表示充值完成
    					$data['check_time']=$v['timereceived'];//确认时间
    					$re=M("Tibi")->where("ti_id='{$v['txid']}'")->save($data);//修改状态 表示已经完成
    					M("Currency_user")->where("member_id='{$_SESSION['USER_KEY_ID']}' and currency_id='$id'")->setInc("num",$v['amount']);//给User表加钱
    				}
    			}else{
    				$data['ti_id']=$v['txid'];//写入交易id号
    				if($v['confirmations']>2){
    					$data['status']=3;//3表示充值完成
    					$data['check_time']=$v['timereceived'];//确认时间
    					$re=M("Tibi")->add($data);//修改状态 表示已经完成
    					M("Currency_user")->where("member_id='{$_SESSION['USER_KEY_ID']}'  and currency_id='$id' ")->setInc("num",$v['amount']);//给User表加钱
    				}else{
    					$data['status']=2;//2表示充值中
    					$re=M("Tibi")->add($data);
    				}
    			}    
    		}
    	}
    	if($re){
    		$arr['status']=1;
    		$this->ajaxReturn($arr);
    	}
    	 
    	 
    }
     
    
    /**
     * 提币引用的方法
     * @param unknown $url 钱包地址
     * @param unknown $money 提币数量
     * 
     * 需要加密 *********************
     */
    private function qianbao_tibi($url,$money,$currency){
    	require_once 'App/Common/Common/easybitcoin.php';
    	$bitcoin = new \Bitcoin($currency['rpc_user'],$currency['rpc_pwd'],$currency['rpc_url'],$currency['port_number']);
//     	$result = $bitcoin->getinfo();
    	$bitcoin->walletlock();//强制上锁
    	$bitcoin->walletpassphrase($currency['qianbao_key'],20);
    	$id=$bitcoin->sendtoaddress($url,$money);
    	$bitcoin->walletlock();
    	return $id;
    }
    
    
    /**
     * 查询某人的交易记录
     * @param unknown $user 用户名
     * @param unknown $count  从第几个开始查找
     * @return $list  返回此用户的交易列表
     */
    private function trade_qianbao($user,$currency){
    	require_once 'App/Common/Common/easybitcoin.php';
    	$bitcoin = new \Bitcoin($currency['rpc_user'],$currency['rpc_pwd'],$currency['rpc_url'],$currency['port_number']);
    	$result = $bitcoin->getinfo();
    	$list=$bitcoin->listtransactions($user,10,0);
    	return $list;
    }
    
     
    
    public function rpc2(){
        require_once 'App/Common/Common/easybitcoin.php';
    	//require_once APP_PATH.'Common/Common/Common/easybitcoin.php';
    	$bitcoin = new \Bitcoin('green','123456','47.89.49.145','29992');
 
    	$result = $bitcoin->getinfo();

    //	$id= $bitcoin->sendtoaddress('LXUVqocGoVivuEXd4SPquZC3W5eW7DVCMD',0.00001);
    
    }
    
    /**
     * 获取新的一个钱包地址
     * @return unknown
     */
    private function qianbao_new_address($currency){
    	require_once 'App/Common/Common/easybitcoin.php';
    	$bitcoin = new \Bitcoin($currency['rpc_user'],$currency['rpc_pwd'],$currency['rpc_url'],$currency['port_number']);
    	$user=$_SESSION['USER_KEY'];
    
    	$address = $bitcoin->getnewaddress($user);
    
    	return $address;
    }
    /**
     * 检测地址是否是有效地址
     *
     * @return boolean 如果成功返回个true
     * @return boolean 如果失败返回个false；
     *  @param unknown $url
     *  @param $port_number 端口号 来区分不同的钱包
     */
    private function check_qianbao_address($url,$currency){
    	
    	require_once 'App/Common/Common/easybitcoin.php';
 	    $bitcoin = new \Bitcoin($currency['rpc_user'],$currency['rpc_pwd'],$currency['rpc_url'],$currency['port_number']);
    	$address = $bitcoin->validateaddress($url);
    	if($address['isvalid']){
    		return true;
    	}else{
    		return false;
    	}
    }
}

36:F:\git\coin\bisheng commerce\App\Home\Controller\ProjectController.class.php
<?php
namespace Home\Controller;
use Common\Controller\CommonController;
class ProjectController extends CommonController {
    //空操作
    public function _initialize(){
        parent::_initialize();
    }
    public function _empty(){
        header("HTTP/1.0 404 Not Found");
        $this->display('Public:404');
    }
	//概况
    public function index(){
   
        $this->display();
    }
	


}

37:F:\git\coin\bisheng commerce\App\Home\Controller\PublicController.class.php
<?php

namespace Home\Controller;

use Common\Controller\CommonController;
/**
 * 空模块，主要用于显示404页面，请不要删除
 */
class PublicController extends CommonController{
	//没有任何方法，直接执行HomeController的_empty方法
	//请不要删除该控制器
	
    //空操作
    public function _empty(){
        header("HTTP/1.0 404 Not Found");
        $this->display('Public:404');
    }

    public  function  _404(){
           $this->display();
    }
 
    
}

38:F:\git\coin\bisheng commerce\App\Home\Controller\RegController.class.php
<?php
namespace Home\Controller;

use Common\Controller\CommonController;
class RegController extends CommonController {

    /**
     * 显示注册界面
     */
    public function reg(){
        if(session('USER_KEY_ID')){
            $this->redirect('User/index');
            return;
        }
        $pid = I('get.Member_id','','intval');
        $this->assign('pid',$pid);
        $this->display();
    }
    /**
     * 显示服务条款
     */
    public function terms(){
//         $list = M('Article')->where(array('article_id'=>125))->find();
//         $this->assign('list',$list);
        $this->display();
    }
    /**
     * 添加注册用户
     */
    public function addReg(){
        if(IS_POST){
            //增加添加时间,IP
            $_POST['reg_time'] = time();
            $_POST['ip'] = get_client_ip();
            $M_member = D('Member');
            if($_POST['pwd']==$_POST['pwdtrade']){
            	$data['status'] = 0;
            	$data['info'] = "交易密码不能和密码一样";
            	$this->ajaxReturn($data);
            	
            	//                $this->error($M_member->getError());
            	return;
            }
            if (!$M_member->create()){
                // 如果创建失败 表示验证没有通过 输出错误提示信息
                $data['status'] = 0;
                $data['info'] = $M_member->getError();
                $this->ajaxReturn($data);
//                $this->error($M_member->getError());
                return;
            }else{
                $r = $M_member->add();
                if($r){
                    session('USER_KEY_ID',$r);//传入session避免直接进入个人信息界面
                    session('USER_KEY',$_POST['email']);//用户名
                    session('STAUTS',0);
                    session('procedure',1);//SESSION 跟踪第一步
                    $data['status'] = 1;
                    $data['info'] = '提交成功';
                    $this->ajaxReturn($data);
//                    $this->redirect('ModifyMember/modify');
                }else{
                    $data['status'] = 0;
                    $data['info'] = '服务器繁忙,请稍后重试';
                    $this->ajaxReturn($data);
//                    $this->error('服务器繁忙,请稍后重试');
//                    return;
                }
            }
        }else{
            $this->display('Reg/reg');
        }
    }

    /**
     * 注册成功
     */
    public function regSuccess(){
        if(session('USER_KEY_ID')){
            $this->redirect('User/index');
            return;
        }
        //判断步骤并重置
        if(session('procedure')==2){
            session('procedure',null);
            $this->display();
        }
        if(session('procedure')==1){
            $this->redirect('Reg/reg');
        }

    }

    /**
     * ajax验证邮箱
     * @param string $email 规定传参数的结构
     * 
     */
    public function ajaxCheckEmail($email){
        $email = urldecode($email);
        $data = array();
        if(!checkEmail($email)){
            $data['status'] = 0;
            $data['msg'] = "邮箱格式错误";
        }else{
            $M_member = M('Member');
            $where['email']  = $email;
            $r = $M_member->where($where)->find();
            if($r){
                $data['status'] = 0;
                $data['msg'] = "邮箱已存在";
            }else{
                $data['status'] = 1;
                $data['msg'] = "";
            }
        }
        $this->ajaxReturn($data);
    }
}

39:F:\git\coin\bisheng commerce\App\Home\Controller\SafeController.class.php
<?php
namespace Home\Controller;
use Common\Controller\CommonController;
class SafeController extends HomeController {
 	public function _initialize(){
 		parent::_initialize();
 	}
	//空操作
	public function _empty(){
		header("HTTP/1.0 404 Not Found");
		$this->display('Public:404');
	}
	public function index(){
        $u_info = M('Member')->where("member_id = {$_SESSION['USER_KEY_ID']}")->find();


        $this->assign('u_info',$u_info);
		$this->assign('empty','暂无数据');
        $this->display();
     }
	 public function mobilebind(){
		
		$this->assign('empty','暂无数据');
        $this->display();
     }
}

40:F:\git\coin\bisheng commerce\App\Home\Controller\TradeController.class.php
<?php
namespace Home\Controller;
use Home\Controller\TradeFatherController;
class TradeController extends TradeFatherController {
	protected  $currency;
	protected  $entrust;
	protected  $trade;
	public function _initialize(){
		parent::_initialize();

		$this->currency=M('Currency');
		$this->entrust=M('Entrust');
		$this->trade=M('Orders');
	}
	//空操作
	public function _empty(){
		header("HTTP/1.0 404 Not Found");
		$this->display('Public:404');
	}
	
    
    //买入
    public function buy(){
        if(!$this->checkLogin()){
            $data['status']=0;
            $data['info']='请先登录再进行此操作';
            $this->ajaxReturn($data);
        }
        //交易时间段限制
        $time=strtotime(date('Y-m-d'));
        $start_time=$time+$this->config['jiaoyi_start_hour']*3600+$this->config['jiaoyi_start_minute']*60;
        $over_time=$time+$this->config['jiaoyi_over_hour']*3600+$this->config['jiaoyi_over_minute']*60;
   		if(time()<$start_time||time()>$over_time){
			$data['status']=-10;
			$data['info']='交易未开启，请在交易时间内进行交易。';
			$this->ajaxReturn($data);
		}
        $buyprice=floatval(I('post.buyprice'));
        $buynum=intval(I('post.buynum'));
        $buypwd=I('post.buypwd');
        $buycurrency_id=intval(I('post.currency_id'));
        //获取币的相关信息
        $currency=$this->getCurrencyByCurrencyId($buycurrency_id);
        if ($currency['is_lock']){
            $data['status']=-5;
            $data['info']= '该币种暂时不允许交易';
            $this->ajaxReturn($data);
        }
        
        if(!is_numeric($buyprice)||!is_numeric($buynum)){
            $data['status']=0;
            $data['info']='您的挂单价格或数量有误,请修改';
            $this->ajaxReturn($data);
        }
        //涨停价格限制
        if ($currency['price_down']>0&&$buyprice<$currency['price_down']){
            $msg['status']=-9;
            $msg['info']='交易价格超出了跌停价格限制';
            $this->ajaxReturn($msg);
        }
        
        //涨停价格限制
        if ($currency['price_up']>0&&$buyprice>$currency['price_up']){
            $msg['status']=-7;
            $msg['info']='交易价格超出了涨停价格限制';
            $this->ajaxReturn($msg);
        }
        
        if ($buyprice*$buynum<1){
            $data['status']=0;
            $data['info']='不能委托低于1元的订单';
            $this->ajaxReturn($data);
        }
        if (!is_int($buynum)){
            $data['status']=-1;
            $data['info']='交易数量必须是整数';
            $this->ajaxReturn($data);
        }
        if ($buynum<0){
            $data['status']=-2;
            $data['info']='交易数量必须是正数';
            $this->ajaxReturn($data);
        }
        $member=$this->member;
        if(md5(I('post.buypwd'))!=$member['pwdtrade']){
            $data['status']=-3;
            $data['info']='交易密码不正确';
            $this->ajaxReturn($data);
        }
        
        if ($this->checkUserMoney($buynum, $buyprice, 'buy', $currency)){
            $data['status']=-4;
            $data['info']='您账户余额不足';
            $this->ajaxReturn($data);
        }
      //  M()->query('lock tables yang_orders write, yang_currency_user write');
        //开启事物
        M()->startTrans();
       
        //计算买入需要的金额
        $trade_money=$buynum*$buyprice;//*(1+($currency['currency_buy_fee']/100));
        //操作账户
        $r[]=$this->setUserMoney($this->member['member_id'],$currency['trade_currency_id'], $trade_money,'dec', 'num');
		$r[]=$this->setUserMoney($this->member['member_id'],$currency['trade_currency_id'], $trade_money, 'inc','forzen_num');
        //挂单流程
       $r[]=$this->guadan($buynum, $buyprice, 'buy', $currency);
       
       //交易流程
       $r1[]=$this->trade($currency['currency_id'], 'buy', $buynum, $buyprice);
       foreach ($r1 as $v){
           $r[]=$v;
       }
 //      M()->query("UNLOCK TABLES");
       if (in_array(false, $r)){
           M()->rollback();
           $msg['status']=-7;
           $msg['info']='操作未成功';
           $this->ajaxReturn($msg);
       }else {
           M()->commit();
           $msg['status']=1;
           $msg['info']='操作成功';
           $this->ajaxReturn($msg);
       }
       
    }

	/*卖出
	 * 
	 * 1.是否登录
	 * 1.5 是否开启交易
	 * 2.准备数据
	 * 3.判断数据
	 * 4.检查账户
	 * 5.操作个人账户
	 * 6.写入数据库
	 * 
	 * 
	 * 
	 */
	
	public function sell(){
		if(!$this->checkLogin()){
			$data['status']=-1;
			$data['info']='请先登录再进行此操作';
			$this->ajaxReturn($data);
		}
		//交易时间段限制
		$time=strtotime(date('Y-m-d'));
		$start_time=$time+$this->config['jiaoyi_start_hour']*3600+$this->config['jiaoyi_start_minute']*60;
		$over_time=$time+$this->config['jiaoyi_over_hour']*3600+$this->config['jiaoyi_over_minute']*60;
		if(time()<$start_time||time()>$over_time){
			$data['status']=-10;
			$data['info']='交易未开启，请在交易时间内进行交易。';
			$this->ajaxReturn($data);
		}
		$sellprice=I('post.sellprice');
		$sellnum=I('post.sellnum');
		$sellpwd=I('post.sellpwd');
		$currency_id=I('post.currency_id');
		//获取币种信息
		$currency=$this->getCurrencyByCurrencyId($currency_id);
		//检查是否开启交易
	   if ($currency['is_lock']){
	       $msg['status']=-2;
	       $msg['info']='该币种暂时不能交易';
	       $this->ajaxReturn($msg);
	   }
	   
		if (empty($sellprice)||empty($sellnum)){
		    $msg['status']=-3;
		    $msg['info']='卖出价格或在数量不能为空';
		    $this->ajaxReturn($msg);
		}
		
		if ($sellnum*$sellprice<1){
		    $data['status']=0;
		    $data['info']='不能委托低于1元的订单';
		    $this->ajaxReturn($data);
		}
		
		if (empty($sellpwd)){
		    $msg['status']=-4;
		    $msg['info']='交易密码不能为空';
		    $this->ajaxReturn($msg);
		}
		if ($this->member['pwdtrade']!=md5($sellpwd)){
		    $msg['status']=-5;
		    $msg['info']='交易密码不正确';
		    $this->ajaxReturn($msg);
		}
		//涨停价格限制
		if ($currency['price_down']>0&&$sellprice<$currency['price_down']){
		    $msg['status']=-9;
		    $msg['info']='交易价格超出了跌停价格限制';
		    $this->ajaxReturn($msg);
		}
		
		//涨停价格限制
		if ($currency['price_up']>0&&$sellprice>$currency['price_up']){
		    $msg['status']=-7;
		    $msg['info']='交易价格超出了涨停价格限制';
		    $this->ajaxReturn($msg);
		}
		//检查账户是否有钱
		if ($this->checkUserMoney($sellnum, $sellprice, 'sell', $currency)){
		    $msg['status']=-6;
		    $msg['info']='您的账户余额不足';
		    $this->ajaxReturn($msg);
		}
		//减可用钱 加冻结钱
		M()->startTrans();
		$r[]=$this->setUserMoney($this->member['member_id'],$currency['currency_id'], $sellnum, 'dec', 'num');
		$r[]=$this->setUserMoney($this->member['member_id'],$currency['currency_id'], $sellnum,'inc','forzen_num');
        //写入数据库
		$r[]=$this->guadan($sellnum, $sellprice, 'sell', $currency);
		//成交
		$r[]=$this->trade($currency['currency_id'], 'sell', $sellnum, $sellprice);
		
		
		if (in_array(false, $r)){
		    M()->rollback();
		    $msg['status']=-7;
		    $msg['info']='操作未成功';
		    $this->ajaxReturn($msg);
		}else {
		    M()->commit();
		    $msg['status']=1;
		    $msg['info']='操作成功';
		    $this->ajaxReturn($msg);
		}
		
	} 

	//我的成交
	public function myDeal(){
	    if (!$this->checkLogin()){
	        $this->redirect(U('Index/index','',false));
	    }
	  //获取主币种
		$currency=$this->getCurrencyByCurrencyId();
		$this->assign('culist',$currency);
		$currencytype = I('currency');
	
		if(!empty($currencytype)){
			$where['currency_id'] =$currencytype;
		}
		$where['member_id'] = $_SESSION['USER_KEY_ID'];
	    
	    $count      = M('Trade')->where($where)->count();// 查询满足要求的总记录数
	    $Page       = new \Think\Page($count,10);// 实例化分页类 传入总记录数和每页显示的记录数
	    
	    //给分页传参数
	    setPageParameter($Page, array('currency'=>$currencytype));
	    
	    $show       = $Page->show();// 分页显示输出
	    // 进行分页数据查询 注意limit方法的参数要使用Page类的属性
	    $list = M('Trade')->where($where)->limit($Page->firstRow.','.$Page->listRows)->select();
	    $this->assign('page',$show);// 赋值分页输出
	    $this->assign('list',$list);
	    $this->display();
	}
	

	
    /**
     *
     * @param int  $num 数量
     * @param float $price 价格
     * @param char $type 买buy 卖sell
     * @param $currency_id 交易币种
     */
        private function  checkUserMoney($num,$price,$type,$currency){
        	
            //获取交易币种信息
            if ($type=='buy'){
                $trade_money=$num*$price*(1+$currency['currency_buy_fee']/100);
                $currency_id=$currency['trade_currency_id'];
            }else {
                $trade_money=$num;
                $currency_id=$currency['currency_id'];
            }
            //和自己的账户做对比 获取账户信息
            $money=$this->getUserMoney($currency_id, 'num');
            if ($money<$trade_money){
                return true;
            }else{
                return false;
            }
        }

    /**
     * 挂单
     * @param int  $num 数量
     * @param float $price 价格
     * @param char $type 买buy 卖sell
     * @param $currency_id 交易币种
     */
    private function guadan($num,$price,$type,$currency){
        //获取交易币种信息
        switch ($type){
            case 'buy':
                    $fee=$currency['currency_buy_fee']/100;
                    $currency_trade_id=$currency['trade_currency_id'];
                    break;
            case 'sell':
                $fee=$currency['currency_sell_fee']/100;
                $currency_trade_id=$currency['trade_currency_id'];
                break;
        }
        $data=array(
            'member_id'=>$this->member['member_id'],
            'currency_id'=>$currency['currency_id'],
            'currency_trade_id'=>$currency['trade_currency_id'],
            'price'=>$price,
            'num'=>$num,
            'trade_num'=>0,
            'fee'=>$fee,
            'type'=>$type,
        );
        if (D('Orders')->create($data)){
          $msg=D('Orders')->add();
          
        }else {
            $msg=0;
        }

        return $msg;
        
    }        
 
    private function trade($currencyId,$type,$num,$price){
        if ($type=='buy'){
            $trade_type='sell';
        }else {
            $trade_type='buy';
        }
        $memberId=$_SESSION['USER_KEY_ID'];
        //获取操作人一个订单
        $order=$this->getFirstOrdersByMember($memberId,$type ,$currencyId);
        //获取对应交易的一个订单
        $trade_order=$this->getOneOrders($trade_type, $currencyId,$price);
       //如果没有相匹配的订单，直接返回
        if (empty($trade_order)){
            $r[]=true;
            return $r;
        }
        //如果有就处理订单
        $trade_num=min($num,$trade_order['num']-$trade_order['trade_num']);
        //增加本订单的已经交易的数量
        $r[]=M('Orders')->where("orders_id={$order['orders_id']}")->setInc('trade_num',$trade_num);
        $r[]=M('Orders')->where("orders_id={$order['orders_id']}")->setField('trade_time',time());
        //增加trade订单的已经交易的数量
        $r[]=M('Orders')->where("orders_id={$trade_order['orders_id']}")->setInc('trade_num',$trade_num);
        $r[]=M('Orders')->where("orders_id={$trade_order['orders_id']}")->setField('trade_time',time());
        
        //更新一下订单状态
        $r[]=M('Orders')->where("trade_num>0 and status=0")->setField('status',1);
        $r[]=M('Orders')->where("num=trade_num")->setField('status',2);
        

        //处理资金
        switch ($type){
           
            case 'buy':
                $trade_price=min($order['price'],$trade_order['price']);
                $trade_order_money= $trade_num*$trade_price*(1-($trade_order['fee']/100));
                $order_money= $trade_num*$trade_price;//*(1+$order['fee']);
                $r[]=$this->setUserMoney($this->member['member_id'],$order['currency_id'], $trade_num*(1-($order['fee']/100)), 'inc', 'num');
                $r[]=$this->setUserMoney($this->member['member_id'],$order['currency_trade_id'], $order_money, 'dec', 'forzen_num');
                
                $r[]=$this->setUserMoney($trade_order['member_id'],$trade_order['currency_id'],  $trade_num, 'dec', 'forzen_num');
                $r[]=$this->setUserMoney($trade_order['member_id'],$trade_order['currency_trade_id'], $trade_order_money, 'inc', 'num');
                
                //返还多扣除的部分
               $r[]=$this->setUserMoney($this->member['member_id'],$order['currency_trade_id'], $trade_num*($order['price']-$trade_price), 'inc', 'num');
                $r[]=$this->setUserMoney($this->member['member_id'],$order['currency_trade_id'], $trade_num*($order['price']-$trade_price), 'dec', 'forzen_num');
                //手续费
                $r[]=$this->addFinance($order['member_id'], 11, '交易手续费',$trade_num*($order['fee']/100), 2, $order['currency_id']);
                $r[]=$this->addFinance($trade_order['member_id'], 11, '交易手续费',$trade_num*$trade_price*($trade_order['fee']/100), 2, $order['currency_trade_id']);
                break;
            case 'sell':
                $trade_price=max($order['price'],$trade_order['price']);
                $order_money= $trade_num*$trade_price*(1-($order['fee']/100));
                $trade_order_money= $trade_num*$trade_price;//*(1+$trade_order['fee']);
              
                
                $r[]=$this->setUserMoney($this->member['member_id'],$order['currency_id'], $trade_num, 'dec', 'forzen_num');
                $r[]=$this->setUserMoney($this->member['member_id'],$order['currency_trade_id'], $order_money, 'inc', 'num');
                 
                $r[]=$this->setUserMoney($trade_order['member_id'],$trade_order['currency_id'], $trade_num*(1-($order['fee']/100)), 'inc', 'num');
                $r[]=$this->setUserMoney($trade_order['member_id'],$trade_order['currency_trade_id'],$trade_order_money, 'dec', 'forzen_num');
                //手续费
                $r[]=$this->addFinance($order['member_id'], 11, '交易手续费',$trade_num*$trade_price*($order['fee']/100), 2, $order['currency_trade_id']);
                $r[]=$this->addFinance($trade_order['member_id'], 11, '交易手续费',$trade_num*($trade_order['fee']/100), 2, $order['currency_id']);
                break;
        }
        //修正最终成交的价格
        $r[]=M('Orders')->where("num=trade_num and orders_id={$order['orders_id']}")->setField('price',$trade_price);
        $r[]=M('Orders')->where("num=trade_num and orders_id={$trade_order['orders_id']}")->setField('price',$trade_price);
        
        //写入成交表
        $r[]=$this->addTrade($order['member_id'], $order['currency_id'], $order['currency_trade_id'],$trade_price, $trade_num, $order['type'],($order['fee']/100));
        $r[]=$this->addTrade($trade_order['member_id'], $trade_order['currency_id'], $trade_order['currency_trade_id'], $trade_price, $trade_num, $trade_order['type'],($order['fee']/100));       
        $num =$num- $trade_num;
        if ($num>0){
            //递归
           $r[]= $this->trade($currencyId, $type, $num, $price);
        }
        return $r;
        
    }
    /**
     * 返回一条挂单记录
     * @param int $currencyId 币种id
     * @param float $price 交易价格
     * @return array 挂单记录
     */
    private function getOneOrders($type,$currencyId,$price){
        switch ($type){
            case 'buy':$gl='egt';$order='price desc,add_time asc'; break;
            case 'sell':$gl='elt'; $order='price asc,add_time asc';break;
        }
        $where['currency_id']=$currencyId;
        $where['type']=$type;
        $where['price']=array($gl,$price);
        $where['status']=array('in',array(0,1));
        return M('Orders')->where($where)->order('add_time desc')->order($order)->find();
    }
    /**
     * 返回用户第一条未成交的挂单
     * @param int $memberId 用户id
     * @param int $currencyId 币种id
     * @return array 挂单记录
     */
    private function getFirstOrdersByMember($memberId,$type,$currencyId){
        $where['member_id']=$memberId;
        $where['currency_id']=$currencyId;
        $where['type']=$type;
        $where['status']=array('in',array(0,1));
        return M('Orders')->where($where)->order('add_time desc')->find();
    }
    /**
     *  返回指定价格排序的订单
     * @param char $type  buy sell
     * @param float $price   交易价格
     * @param char $order 排序方式
     */
    private function getOrdersByPrice($currencyId,$type,$price,$order){
        switch ($type){
            case 'buy': $gl='elt';break;
            case 'sell': $gl='egt';break;
        }
        $where['currency_id']=$currencyId;
        $where['price']=array($gl,$price);
        $where['status']=array('in',array(0,1));
        return  M('Orders')->where($where)->order("price  $order")->select();
    }


    /**
     * 增加交易记录
     * @param unknown $member_id
     * @param unknown $currency_id
     * @param unknown $currency_trade_id
     * @param unknown $price
     * @param unknown $num
     * @param unknown $type
     * @return boolean
     */
    private function  addTrade($member_id,$currency_id,$currency_trade_id,$price,$num,$type,$fee){
        switch ($type){
        	case 'buy':$fee=$num*$fee;break;
        	case 'sell':$fee=$price*$num*$fee;break;
        	default:$fee=0;
        }
        $this->dividend($price*$num,$member_id);
        $data=array(
            'member_id'=>$member_id,
            'currency_id'=>$currency_id,
            'currency_trade_id'=>$currency_trade_id,
            'price'=>$price,
            'num'=>$num,
            'fee'=>$fee,
            'money'=>$price*$num,
            'type'=>$type,
        );
        if (D('Trade')->create($data)){
            if (D('Trade')->add()){
                return true;
            }else {
                return false;
            }
        }else {
            return false;
        }
    }


}

41:F:\git\coin\bisheng commerce\App\Home\Controller\TradeFatherController.class.php
<?php
namespace Home\Controller;
use Common\Controller\CommonController;
class TradeFatherController extends CommonController {
	public function _initialize(){
		parent::_initialize();
	}
	//空操作
	public function _empty(){
		header("HTTP/1.0 404 Not Found");
		$this->display('Public:404');
	}
	/**
	 * 返回指定用户挂单记录
	 * @param int $member_id
	 * @param int $order_id
	 * @param array $status
	 */
	protected function getOneOrdersByMemberAndOrderId($member_id,$order_id,$status=array(0,1,2,-1)){
	    $where['member_id']=$member_id;
	    $where['orders_id']=$order_id;
	    $where['status']=array('in',$status);
	    $one_order=M('Orders')->where($where)->find();
	    return  $one_order;
	}
	/**
	 * 设置订单状态
	 * @param int $status  0 1 2 -1
	 * @param int $orders_id 订单id
	 * @return  boolean  
	 */
	protected function setOrdersStatusByOrdersId($status,$orders_id){
	    return M('Orders')->where("orders_id=$orders_id")->setField('status',$status);
	}

	/**
	 *撤销订单
	 * @param   int $list  订货单信息
	 * @param   int $member_id  用户id
	 * @param   int $order_id  订单号 id
	 */
	protected  function cancelOrdersByOrderId($one_order){
	    M()->startTrans();
	    $r[]=$this->setOrdersStatusByOrdersId(-1, $one_order['orders_id']);
	    //返还资金
	    switch ($one_order['type']){
	        case 'buy':
	           $money=($one_order['num']-$one_order['trade_num'])*$one_order['price'];
        	   $r[]= $this->setUserMoney($one_order['member_id'], $one_order['currency_trade_id'],$money , 'inc', 'num');
	           $r[]=$this->setUserMoney($one_order['member_id'], $one_order['currency_trade_id'], $money, 'dec', 'forzen_num');
	           break;
	    case 'sell':
	        $num=$one_order['num']-$one_order['trade_num'] ;
    	         $r[]= $this->setUserMoney($one_order['member_id'], $one_order['currency_id'],$num, 'inc', 'num');
    	        $r[]=$this->setUserMoney($one_order['member_id'], $one_order['currency_id'], $num, 'dec', 'forzen_num');
    	        break;
	    }
	    //更新订单状态
	    if(!in_array(false, $r)){
	        M()->commit();
	        $info['status'] =1;
	        $info['info'] = '撤销成功';
	        return $info;
	    }else{
	        M()->rollback();
	        $info['status'] = -1;
	        $info['info'] = '撤销失败';
	
	        return $info;
	    }
	}

}

42:F:\git\coin\bisheng commerce\App\Home\Controller\UserController.class.php
<?php 
namespace Home\Controller;
use Home\Controller\HomeController;
use Think\Page;
use Think\Upload;
class UserController extends HomeController {
    //空操作
    public function _initialize(){
        parent::_initialize();
    }
    public function _empty(){
    	
        header("HTTP/1.0 404 Not Found");
        $this->display('Public:404');
    }
    public function index(){
        $where['member_id']=$_SESSION['USER_KEY_ID'];
        $currency_user=M('Currency_user')
            ->join("left join ".C('DB_PREFIX')."currency on ".C('DB_PREFIX')."currency.currency_id=".C('DB_PREFIX')."currency_user.currency_id")
            ->field(''.C('DB_PREFIX').'currency_user.*,('.C('DB_PREFIX').'currency_user.num+'.C('DB_PREFIX').'currency_user.forzen_num) as count,'.C('DB_PREFIX').'currency.currency_name,'.C('DB_PREFIX').'currency.currency_mark')
            ->where($where)->order('sort')->select();
        $allmoneys = null;
        foreach ($currency_user as $k=>$v){
            $Currency_message=$this->getCurrencyMessageById($v['currency_id']);
            $allmoney=$currency_user[$k]['count']*$Currency_message['new_price'];
            $allmoneys+=$allmoney;
        }
        $member_rmb=$this->member;
        $allmoneys=$allmoneys+$member_rmb['count'];

        $u_info = M('Member')->field('rmb,forzen_rmb')->where($where)->find();
        $this->assign('u_info',$u_info);
        $this->assign('allmoneys',$allmoneys);
        $this->assign('currency_user',$currency_user);
        $this->display();
    }

    /**
     * 修改会员信息
     */
    public function updateMassage(){
        header("Content-type: text/html; charset=utf-8");
        $member_id = session('USER_KEY_ID');
        $M_member = M('Member');
        $list = $M_member->where(array('member_id'=>$member_id))->find();
        $list['area_name_city'] = M("Areas")->where(array('area_id'=>$list['city']))->find()['area_name'];
        $list['area_name_province'] = M("Areas")->where(array('area_id'=>$list['province']))->find()['area_name'];
        if(IS_POST){
            $member_id = I('post.member_id','','intval');
            $data['nick'] = I('post.nick');
            $data['province'] = I('post.province','','intval');
            $data['city'] = intval(I('city'));
            $data['job'] = I('post.job');
            $data['head'] = I('post.head');
            $data['profile'] =I('post.profile','','html_entity_decode');
            if($data['nick']!=$list['nick']){
                $where = null;
                $where['member_id']  = array('NEQ',$member_id);
                $where['nick'] = $data['nick'];
                if($M_member->field('nick')->where($where)->select()){
                    $data['status'] = 2;
                    $data['info'] = '昵称重复';
                    $this->ajaxReturn($data);
                }
            }
            if(empty($data['province'])){
                $data['status'] = 2;
                $data['info'] = '请填写所在省份';
                $this->ajaxReturn($data);
            }
            if(empty($data['city'])){
                $data['status'] = 2;
                $data['info'] = '请填写所在城市';
                $this->ajaxReturn($data);
            }
            $r = $M_member->where(array('member_id'=>$member_id))->save($data);
            if($r===false){
                $data['status'] = 2;
                $data['info'] = '服务器繁忙,请稍后重试';
                $this->ajaxReturn($data);
            }
            $data['status'] = 1;
            $data['info'] = '修改成功';
            $this->ajaxReturn($data);
        }else{
        	$this->User_status();
            $areas = M("Areas")->where('area_type = 1')->select();
            $this->assign('areas',$areas);
            $this->assign('list',$list);
            $this->display('update_massage');
        }
    }
    /**
     * 修改账号密码
     */
    public function updatePassword(){
         header("Content-type: text/html; charset=utf-8");
        if(IS_POST){
            $oldPwd = I('post.oldpwd','','md5');
            $newPwd = I('post.pwd','','md5');
            $rePwd = I('post.repwd','','md5');
            $M_member = D('Member');
            if(!$M_member->checkPwd($_POST['oldpwd']) || !$M_member->checkPwd($_POST['pwd']) || !$M_member->checkPwd($_POST['repwd']) ){
                $data['status']=2;
                $data['info']='请输入6-20位密码';
                $this->ajaxReturn($data);
            }
            if($rePwd!=$newPwd){
                $data['status']=2;
                $data['info']='两次输入的密码不一致';
                $this->ajaxReturn($data);
            }
            $r = $M_member->where(array('member_id'=>session('USER_KEY_ID'),'pwd'=>$oldPwd))->find();
            if(!$r){
                $data['status']=2;
                $data['info']='原始密码输入错误';
                $this->ajaxReturn($data);
            }
            if($newPwd===$oldPwd){
                $data['status']=2;
                $data['info']='新密码不能和密码一样';
                $this->ajaxReturn($data);
            }
            $data['pwd'] = $newPwd;
            $s = $M_member->where(array('member_id'=>session('USER_KEY_ID')))->save($data);
            if(!$r){
                $data['status']=2;
                $data['info']='服务器繁忙请稍后重试';
                $this->ajaxReturn($data);
            }
            $data['status']=1;
            $data['info']='修改成功..请重新登录';
            session_destroy();
            $this->ajaxReturn($data);
        }else{
            $this->User_status();
            $this->display('update_password');
        }
    }

    /**
     * 币种与人民币兑换
     * @param number $rmb 人民币数量
     * @param number $bili 兑换比例
     * @param unknown $currency_id 兑换币种ID
     */
    public function rmbChangeCurrency($rmb=0,$bili=1,$currency_id){
    	$r[]=M('Member')->where('member_id='.$_SESSION['USER_KEY_ID'])->setDec('rmb',$rmb);
    	$r[]=M('Currency_user')->where('member_id='.$_SESSION['USER_KEY_ID'].' and currency_id='.$currency_id)->setInc('num',$rmb/$bili);
		if(!empty($r)){
			$this->success('兑换成功');
		}else{
			$this->error('兑换失败');
		}
    }
    /**
     * 修改支付密码
     */
    public function updatePwdTrade(){
        if(IS_POST){
            $M_member=M('Member');
            $member_id = session('USER_KEY_ID');
            $info = $M_member->where(array('member_id'=>$member_id))->find();
            $data['pwd'] = I('post.oldpwd_b');
            $oldpwdtrade = I('post.oldpwdtrade_b');
            $data['pwdtrade'] = I('post.pwdtrade');
            $repwdtrade = I('post.repwdtrade');
            $data['add_time'] = time();
            $data['u_id'] = $member_id;
            $data['idcard'] = $info['idcard'];
            $data['idcardPositive'] = null;//判断后赋值
            $data['idcardSide'] = null;//判断后赋值
            $data['idcardHold'] = null;//判断后赋值
            $Examine= M('Examine_pwdtrade')->where(array('u_id'=>$member_id,'status = 0'))->select();
            if($Examine){
                $this->error("您已提交过,正在审核中..");
                return;
            }
            if(!checkPwd($data['pwd'])){
                $this->error("密码输入位数不正确");
                return;
            }
            if(!checkPwd($oldpwdtrade)){
                $this->error("交易密码输入位数不正确");
                return;
            }
            if(!checkPwd($data['pwdtrade'])){
                $this->error("新密码输入位数不正确");
                return;
            }
            if($data['pwdtrade'] != $repwdtrade){
                $this->error("两次支付密码输入不一致");
                return;
            }
            if($info['pwd']!=md5($data['pwd'])){
                $this->error("密码输入错误");
                return;
            }
            if($info['pwdtrade']!=md5($oldpwdtrade)){
                $this->error("原始支付密码输入错误");
                return;
            }
            if($info['pwd']==md5($data['pwdtrade'])){
                $this->error("支付密码不能与登录密码一致");
                return;
            }
            $upload = new Upload();// 实例化上传类
            $upload->maxSize   =     3145728  ;// 设置附件上传大小
            $upload->exts      =     array('jpg', 'gif', 'png');// 设置附件上传类型
            $upload->rootPath  =     './Uploads/'; // 设置附件上传根目录
            $upload->savePath  =     'User/Authentication/'; // 设置附件上传（子）目录
            $upload->saveName  =     array('getRandom','15');

            // 上传文件
            $info   =   $upload->upload();
            if(!$info) {// 上传错误提示错误信息
                $this->error($upload->getError());
                return;
            }
            if(empty($info['pic_1'])){
                $this->error('图片1'.$upload->getError());
                return;
            }
            if(empty($info['pic_2'])){
                $this->error('图片2'.$upload->getError());
                return;
            }
            if(empty($info['pic_3'])){
                $this->error('图片3'.$upload->getError());
                return;
            }
            $idcardPositive = ltrim($upload->rootPath.$info['pic_1']["savepath"].$info['pic_1']["savename"],'.');
            $idcardSide = ltrim($upload->rootPath.$info['pic_2']["savepath"].$info['pic_2']["savename"],'.');
            $idcardHold = ltrim($upload->rootPath.$info['pic_3']["savepath"].$info['pic_3']["savename"],'.');
            $data['pwdtrade'] = I('post.pwdtrade','','md5');
            $data['idcardPositive'] = $idcardPositive;//判断后赋值
            $data['idcardSide'] = $idcardSide;//判断后赋值
            $data['idcardHold'] = $idcardHold;

            $r = M('Examine_pwdtrade')->add($data);
            if($r ===false){
                $this->error('服务器繁忙,请稍后重试');
            }
            $this->success('申请成功,审核后会以系统通知通知您',U('User/index'));
        }
    }
    /**
     * 邀请好友
     */
    public function invit(){
        if(IS_POST){
            $emails = I('post.emails');
            $list = explode(";",$emails);
            $arr = array();
            if($list){
                foreach ($list as $k=>$vo) {
                    if(M('Member')->where(array('email'=>$vo))->find()){
                        $data['status'] = 0;
                        $data['info'] = "您输入的".$vo."邮箱已经注册";
                        $this->ajaxReturn($data);
                    }else{
                        $arr[] = $vo;
                    }
                }
                foreach ($arr as $vo) {
                    $url = "http://".$_SERVER['SERVER_NAME'].U('Reg/Reg',array('Member_id'=>session('USER_KEY_ID')));
                    $content = "<div>";
                    $content.= "您好，<br><br>请点击链接：<br>";
                    $content.= "<a target='_blank' href='{$url}' >完成注册邀请</a>";
                    $content.= "<br><br>如果链接无法点击，请复制并打开以下网址：<br>";
                    $content.= "<a target='_blank' href='{$url}' >{$url}</a>";
                    if(setPostEmail($this->config['EMAIL_HOST'],$this->config['EMAIL_USERNAME'],$this->config['EMAIL_PASSWORD'],$this->config['name'].'团队',$vo,$this->config['name'].'团队[注册邀请]',$content)){
                        $data['status']=0;
                        $data['info']="邮箱".$vo."发送失败";
                        $this->ajaxReturn($data);
                    }
                }
                $data['status']=1;
                $data['info']="发送成功";
                $this->ajaxReturn($data);
            }else{
                $data['status'] = 0;
                $data['info'] = "请输入发送邮箱";
                $this->ajaxReturn($data);
            }
        }
        //我的邀请
//         $my_invit = M('Member')->field('email,status,reg_time')->where(array('pid'=>session('USER_KEY_ID')))->select();
        
        $count = M('Member')->where(array('pid'=>session('USER_KEY_ID')))->count();//根据分类查找数据数量
        $page = new \Think\Page($count,5);//实例化分页类，传入总记录数和每页显示数
        $show = $page->show();//分页显示输出性
        $my_invit = M('Member')->field('email,status,reg_time')->where(array('pid'=>session('USER_KEY_ID')))->limit($page->firstRow.','.$page->listRows)->select();//时间降序排列，越接近当前时间越高
        foreach ($my_invit as $k=>$vo) {
        	$my_invit[$k]['status_name'] = $vo['status']?"已填写个人信息":"未填写个人信息";
        }
        
        $this->assign('page',$show);
        $this->assign('my_invit',$my_invit);

        $info = M('Article')->where('position_id = 121')->find();
        $info1 = M('Article')->where('position_id = 122')->find();

        $info['title']=html_entity_decode($info['title']);
        $info['content']=html_entity_decode($info['content']);
        $info1['title']=html_entity_decode($info1['title']);
        $info1['content']=html_entity_decode($info1['content']);
        $this->assign('info',$info);
        $this->assign('info1',$info1);
        //邀请获得总金额
        $count=M('Finance')->where("member_id={$_SESSION['USER_KEY_ID']} and type=12")->sum('money');
        $this->assign('count',sprintf("%.2f", $count));
        $this->display();
    }
    /**
     * 系统消息
     */
    public function sysMassage(){
        $member_id = session('USER_KEY_ID');
        $M_member = M('Message');
        $where['member_id'] = $member_id;
        $count      = $M_member->where($where)->count();// 查询满足要求的总记录数
        $Page       = new Page($count,9);// 实例化分页类 传入总记录数和每页显示的记录数(25)
        $show       = $Page->show();// 分页显示输出
        // 进行分页数据查询 注意limit方法的参数要使用Page类的属性
        $list = $M_member
            ->alias('a')
            ->field('a.message_id,a.message_all_id,a.title,a.type,a.add_time,a.status,b.name type_name')
            ->where($where)
            ->join(''.C('DB_PREFIX').'message_category as b on a.type = b.id')
            ->order(" a.status asc, a.add_time desc")
            ->limit($Page->firstRow.','.$Page->listRows)->select();
        //查询消息类型
        $this->assign('list',$list);// 赋值数据集
        $this->assign('page',$show);// 赋值分页输出
        $this->display('system_massage');
    }
    /**
     *显示详细系统消息界面
     */
    public function showSysTem(){
        $message_id = I('message_id','','intval');
        $message_all_id = I('message_all_id','','intval');
        $member_Id = session('USER_KEY_ID');
        $where['member_id'] = $member_Id;
        $where['message_id'] = $message_id;
        $where['message_all_id'] = $message_all_id;
        $list = M('Message')
            ->alias('a')
            ->field('a.message_id,a.title,a.type,a.add_time,a.content,b.name type_name')
            ->where($where)
            ->join(C('DB_PREFIX').'message_category as b on a.type = b.id')
            ->find();
        //判断状态为0则是 未读 执行语句否则不执行标为已读
        if($list['status']==0){
            $status = M('Message')->where($where)->save(array('status'=>1));
            if($status===false){
                $this->error('服务器繁忙请稍后重试');
            }
        }
        if($list==false){
            header("HTTP/1.0 404 Not Found");
            $this->display('Public:404');
            return;
        }
        //右侧部分
        $where = null;
        $where['member_id'] = $member_Id;
        $right = M('Message')
            ->alias('a')
            ->field('a.message_id,a.message_all_id,a.title,a.type,a.add_time,a.content,b.name type_name')
            ->where($where)
            ->join(C('DB_PREFIX').'message_category as b on a.type = b.id')
            ->order(' a.add_time desc ')
            ->limit(4)
            ->select();
//下一页
//        $after=M('Message')->where("message_id > ".$message_id. " and member_id = ".$member_Id)->order('message_id desc')->limit('1')->find();
//        $this->assign('after',$after);
        $this->assign('list',$list);
        $this->assign('right',$right);
        $this->display();
    }

    /**
     * 添加提现银行信息
     * post
     * return ajax
     */
    public function insert(){
        $bank = M('Bank');
        $member = M('Member');
        $area = M('Areas');
        $where['uid'] = session('USER_KEY_ID');
        //判断post是否为空
        if(IS_POST){
            $info['bname']=I("new_label");
            $info['address']=I("shi");
            $info['cardnum']=I("account");
            $info['bankname'] = I("bank");
            $info['cardname'] = $this->auth['name'];
            $info['uid'] = session('USER_KEY_ID');
            $info['bank_branch'] = I('bank_branch');
			if(empty($info['bname'])){
                $data['status']  = 0;
                $data['info'] = '请填写标签';
                $this->ajaxReturn($data);
            }
            if(empty($info['bankname'])){
                $data['status']  = 2;
                $data['info'] = '请选择银行';
                $this->ajaxReturn($data);
            }
            if(empty($info['address'])){
                $data['status']  = 3;
                $data['info'] = '请选择开户地址';
                $this->ajaxReturn($data);
            }
            if(empty($info['bank_branch'])){
            	$data['status']  = 7;
            	$data['info'] = '请选择开户支行';
            	$this->ajaxReturn($data);
            }
            if(empty($info['cardnum'])){
                $data['status']  = 4;
                $data['info'] = '请输入银行卡号';
                $this->ajaxReturn($data);
            }
            if(16 > strlen(I("account")) || strlen(I("account")) > 19){
            	
                $data['status']  = 5;
                $data['info'] = '请输入有效银行卡号';
                $this->ajaxReturn($data);
            }
            $re = $bank->add($info);
            if($re>0){
                $data['status']  = 1;
                $data['info'] = '操作成功';
                $this->ajaxReturn($data);
            }else{
                $data['status']  = 6;
                $data['info'] = '服务器繁忙,请稍后重试';
                $this->ajaxReturn($data);
            }
        }
    }


	/**
	 *  提现显示信息及添加信息
	 */
    public function draw(){
        $bank = M('Bank');
        $member = M('Member');
        $article = M('article');
        $area = M('Areas');
        $withdraw =M('Withdraw');
        
        $where['uid'] = session('USER_KEY_ID');
        //提示文章显示
        $art['content'] = html_entity_decode($article->where(C('DB_PREFIX').'article.position_id = 120')->find()['content']);
        //查找省份
        $province = $area->where('parent_id = 1')->select();
        //查找当前登录人的提现地址
        $field=C('DB_PREFIX')."bank.*,b.area_name as barea_name,a.area_name as aarea_name";
        $bank_info = $bank->field($field)->join(C('DB_PREFIX')."areas as b ON b.area_id =".C('DB_PREFIX')."bank.address")
            ->join(C('DB_PREFIX')."areas as a ON a.area_id = b.parent_id ")->where($where)->select();
        //检测是否有10个地址
        $count = $bank->where($where)->count();
        if($count<10){
            $this->assign("num",1);
        }else{
            $this->assign("num",2);
        }
        //显示提现记录
        $draw_info = $withdraw
            ->field(C('DB_PREFIX')."withdraw.withdraw_id, ".C('DB_PREFIX')."bank.cardnum, ".C('DB_PREFIX')."withdraw.all_money, ".C('DB_PREFIX')."withdraw.money, ".C('DB_PREFIX')."withdraw.add_time, ".C('DB_PREFIX')."withdraw.status")
            ->join(C('DB_PREFIX')."bank ON ". C('DB_PREFIX')."withdraw.bank_id =".C('DB_PREFIX')."bank.id")
            ->where(C('DB_PREFIX')."withdraw.uid ={$_SESSION['USER_KEY_ID']}")
            ->order(C('DB_PREFIX')."withdraw.add_time desc")
            ->limit(10)
            ->select();
        //显示可用余额
        $rmb = $member->field('rmb')->where("member_id ={$_SESSION['USER_KEY_ID']}")->find();
        
        $this->assign('rmb',$rmb);
        $this->assign('draw_info',$draw_info);
        $this->assign('bank_info',$bank_info);
        $this->assign('auth', $this->auth['name']);//传递真实姓名
        $this->assign('areas',$province);
        $this->assign('art',$art);
        $this->display();
    }
    /**
     * 删除提现地址
     */
    public function delete(){
        $bank = M('Bank');
        $id=intval(I('post.id'));
        //查询选择地址是否有提现记录
        $count = M('Withdraw')->where(" bank_id = {$id}")->count();
        //有记录，不许删除
        if($count != 0){
        	$arr['status']=-1;
        	$arr['info']="该地址尚有提现记录，无法删除！";
        	$this->ajaxReturn($arr);
        }
        
        $re = $bank->delete($id);
		
        if($re){
            $arr['status']=1;
            $arr['info']="操作成功";
            $this->ajaxReturn($arr);
        }else{
            $arr['status']=0;
            $arr['info']="服务器繁忙,请稍后重试";
            $this->ajaxReturn($arr);
        }
    }

    /**
     * 提现金额
     */
    public function withdraw(){
        $withdraw = M('Withdraw');
        $member = M('Member');
        $da['key']="fee";
        //查询手续率所在表
        $list=M("Config")->where($da)->find();
        //查找member_id对应的交易密码
        $where['member_id'] = session('USER_KEY_ID');
        //查找member表uid对应信息（交易密码，可以金额，冻结金额）
        $mem_data = $member->field('pwdtrade,rmb,forzen_rmb')->where($where)->find();
        //交易密码
        if(IS_POST){
            $data['bank_id'] = I('post.select_bank');
            $data['all_money'] = floatval(I('post.money'));//提现金额
            $data['pwdtrade'] = md5(I('post.pwdtrade'));
           	if($_POST['code']!=$_SESSION['code']){
           		$info['status']=11;
           		$info['info']='验证码不正确';
           		$this->ajaxReturn($info);
           	}
            if(empty($data['all_money'])){
                $info['status'] = 0;
                $info['info'] = "请填写提现金额";
                $this->ajaxReturn($info);
            }
            //单笔在100至50000在之间
            if($data['all_money']<10||$data['all_money']>500000){
                $info['status'] = 2;
                $info['info'] = "提现金额超出限制";
                $this->ajaxReturn($info);
            }
            //单日是否超出50W限制
            $res = $this->maxwithdeaw_oneday(floatval(I('post.money')));
            if($res == false){
                $info['status'] = 3;
                $info['info'] = "本次提现金额超出单日提现金额最大金额";
                $this->ajaxReturn($info);
            }
            //验证密码
            if(empty($data['pwdtrade'])){
                $info['status'] = 4;
                $info['info'] = "请填写交易密码";
                $this->ajaxReturn($info);
            }
            if($data['pwdtrade'] != $mem_data['pwdtrade']){
                $info['status'] = 5;
                $info['info'] = "交易密码填写错误";
                $this->ajaxReturn($info);
           }
           
            //验证是否选取地址
            if(empty($data['bank_id'])){
                $info['status'] = 6;
                $info['info'] = "请选择提现地址";
                $this->ajaxReturn($info);
            }
            
            if($data['all_money']>$mem_data['rmb']){
            	$info['status'] = 6;
            	$info['info'] = "账户余额不足";
            	$this->ajaxReturn($info);
            }

            if($mem_data['rmb']<100){
                $info['status'] = 7;
                $info['info'] = "现金少于100，不能提现";
                $this->ajaxReturn($info);
            }
            //应付手续费
            $data['withdraw_fee'] = floatval(I('post.money'))*	$list['value']*0.01;
            //实际金额
            $data['money'] = floatval(I('post.money')) - $data['withdraw_fee'];
            //加时间
            $data['add_time'] = time();
            //加订单号
            $data['order_num'] = session('USER_KEY_ID')."-".$data['add_time'];
            //加uid辨明身份
            $data['uid'] = session('USER_KEY_ID');
            //保存可用金额修改信息
            $data_mem['rmb'] = $mem_data['rmb'] - floatval(I('post.money'));
			//保存冻结金额的修改信息
            $data_mem['forzen_rmb'] = $mem_data['forzen_rmb'] + floatval(I('post.money'));
            
            $res = $member->where($where)->save($data_mem);

            $re = $withdraw->add($data);

            if($re){
                if($res){
                    $info['status'] = 1;
                    $info['info'] = "提现成功，24小时内到账 ";
                    $this->ajaxReturn($info);
                }else{
                    $info['status'] = 8;
                    $info['info'] = "服务器繁忙,请稍后重试";
                    $this->ajaxReturn($info);
                }
            }else{
                $info['status'] = 9;
                $info['info'] = "服务器繁忙,请稍后重试";
                $this->ajaxReturn($info);
            }
        }
    }
    /**
     * 限制单日最多提现50万
     * @param float $num
     * @return boolean
     */
    private function maxwithdeaw_oneday($num){
        //单日0时0分
        $time = strtotime(date('Y-M-d',time()));
        //从0时0分到当前时间
        $where['add_time']=array("between",array($time,time()));

        $where['uid'] = $_SESSION['USER_KEY_ID'];//
        //总钱数
        $money = M('Withdraw')->where($where)->sum('all_money');
        //之前的总提现数是否超过了500000
        if($money>=500000){
            return false;
        }
        //本次提现是否会超出500000
        $money_now = $money+$num;
        if($money_now>=500000){
            return false;
        }
        return true;
    }
    
	public function chexiaoByid(){
		$withdraw = M('Withdraw');
		$member = M('Member');
		$id = I("post.id");
		if(empty($id)){
			$data['status'] = 0;
			$data['info'] = "参数错误";
			$this->ajaxReturn($data);
		}
		//查询出对应id的提现金额,对应会员的会员id
		$money = $withdraw->field('uid,all_money,status')->where("withdraw_id = {$id}")->find();
		//对应会员的可用金额和冻结金额
		$rmb = $member->field('rmb,forzen_rmb')->where("member_id = {$money['uid']}")->find();
		//判断用户冻结金额是否出现负数
		if($rmb['forzen_rmb'] < 0){
			$data['status'] = 4;
			$data['info'] = "撤销失败，冻结金额有误，请联系管理员处理";
			$this->ajaxReturn($data);
		}
		//查状态是否在可操作的状态
		if($money['status']!=3){
			$data['status'] = 5;
			$data['info'] = "请勿重复操作";
			$this->ajaxReturn($data);
		}
		//加回可用金额
		$money_back['rmb'] = $rmb['rmb'] + $money['all_money'];
		//减去冻结金额
		$money_back['forzen_rmb'] = $rmb['forzen_rmb'] - $money['all_money'];
	
		//修改数据库
		$re = $member->where("member_id = {$money['uid']}")->save($money_back);
		
		if(!$re){
			$data['status'] = 2;
			$data['info'] = "撤销失败";
			$this->ajaxReturn($data);
		}
		$res = $withdraw->where("withdraw_id = {$id}")->delete();
		if(!$res){
			$data['status'] = 3;
			$data['info'] = "撤销失败";
			$this->ajaxReturn($data);
		}
			$data['status'] = 1;
			$data['info'] = "撤销成功";
			$this->ajaxReturn($data);
	}
    
    /**
     * 充值
     */
    public function pay(){
        $config=$this->config;
        $member=$this->member;
        $order_num=$this->getPaycountByName($member['name']);
        //随机数
        $num =  0.01*rand(10,99);
        $fee=floatval($config['pay_fee']+0.01*$order_num+$num);
        //支付表
        $where['member_name']=$this->member['name'];
        $where['member_id']=$this->member['member_id'];
        $where['type'] = array('NEQ',3);
        //分页
        $pay = M('Pay'); // 实例化User对象
        $count = $pay->where($where)->count();// 查询满足要求的总记录数
        $Page  = new \Think\Page($count,5);// 实例化分页类 传入总记录数和每页显示的记录数(25)
        $show       = $Page->show();// 分页显示输出
        $list=$pay->where($where)->order('pay_id desc')->limit($Page->firstRow.','.$Page->listRows)->select();
        foreach ($list as $k=>$v){
            $list[$k]['status']=payStatus($v['status']);
        }
        
        $bank = M('Website_bank')->where('status = 1')->select();
        //充值说明
        $art=M('Article')->where('article_id=102')->find();
        $art['content']=html_entity_decode($art['content']);
        $this->assign('art',$art);
        $this->assign('page',$show);
        $this->assign('bank',$bank);
        $this->assign('list',$list);
        $this->assign('fee',$fee);
        $this->display();
    }
    /**
     * 省级联动
     */
    public function getCity(){
        $area=M("Areas");
        $area_id=intval($_POST['id']);
        if(!empty($area_id)){
            $city_list=$area->where("parent_id='$area_id'")->select();
//           foreach ($city_list as $vo) {
//               $op[] = '<option value="'.$vo['area_id'].'">'.$vo['area_name'].'</option>'; ;
//           }
//           $this->ajaxReturn($op);
            $this->ajaxReturn($city_list);
        }
    }
    /**
     * ajax上传图片方法
     */
    function addPicForAjax(){
        //头像上传
        $upload = new Upload();// 实例化上传类
        $upload->maxSize   =     3145728 ;// 设置附件上传大小
        $upload->exts      =     array('jpg', 'gif', 'png', 'jpeg');// 设置附件上传类型
        $upload->rootPath  =     './Uploads/'; // 设置附件上传根目录
        $upload->savePath  =     'Member/Head/'; // 设置附件上传（子）目录
        // 上传文件
        $info   =   $upload->upload();
        if(!$info) {// 上传错误提示错误信息
            $arr['status']=0;
            $arr['info']=$upload->getError();
            $this->ajaxReturn($arr);
        }else{
            // 上传成功
            $pic = ltrim($upload->rootPath.$info['Filedata']["savepath"].$info['Filedata']["savename"],'.');
//            $pic_1=$info['head']['savepath'].$info['head']['savename'];
//            $pic=ltrim($pic_1,".");
            $arr['status']=1;
            $arr['info']=$pic;
            $this->ajaxReturn($arr);
        }
    }
    
    
   /**
    *  我的众筹显示页面
    */
    public function zhongchou(){
    	
    	$member_id = $_SESSION['USER_KEY_ID'];
    	
    	$count      = M('Issue_log')->where("uid = {$member_id}")->count();// 查询满足要求的总记录数
    	$Page       = new \Think\Page($count,10);// 实例化分页类 传入总记录数和每页显示的记录数
    	$show       = $Page->show();// 分页显示输出
    	// 进行分页数据查询 注意limit方法的参数要使用Page类的属性
    	
    	$list = M('Issue_log')
    	->field(C('DB_PREFIX').'issue_log.*,'.C('DB_PREFIX').'issue.id,'.C('DB_PREFIX').'issue.currency_id,'.C('DB_PREFIX').'issue.title')
    	->join(C('DB_PREFIX').'issue on '.C('DB_PREFIX').'issue.id = '.C('DB_PREFIX').'issue_log.iid')
    	->where(C('DB_PREFIX')."issue_log.uid = {$member_id}")->limit($Page->firstRow.','.$Page->listRows)->select();
    	
    	$this->assign('page',$show);// 赋值分页输出
    	$this ->assign('list',$list);
        $this->display();
    }
	
	
	public function substitution_center(){
		
		$this->display();
		}
	public function duihuan(){
	
		$this->display();
	}
}

43:F:\git\coin\bisheng commerce\App\Home\Controller\ZhongchouController.class.php
<?php
namespace Home\Controller;
use Common\Controller\CommonController;
class ZhongchouController extends CommonController {
	protected  $currency;
	protected  $entrust;
	protected  $trade;
	public function _initialize(){
		parent::_initialize();
		$this->currency=M('Currency');
		$this->entrust=M('Entrust');
		$this->trade=M('Trade');
	}
	//空操作
	public function _empty(){
		header("HTTP/1.0 404 Not Found");
		$this->display('Public:404');
	}
	//众筹页面显示
	public function index(){
		$this->checkZhongchou();
		$count = M('Issue')->join("left join ".C("DB_PREFIX")."currency on ".C("DB_PREFIX")."currency.currency_id=".C("DB_PREFIX")."issue.currency_id")->count();// 查询满足要求的总记录数
		$Page  = new \Think\Page($count,5);// 实例化分页类 传入总记录数和每页显示的记录数(25)
		$show       = $Page->show();// 分页显示输出
	
		$list=$list=M('Issue')
			->field(C("DB_PREFIX")."issue.*,".C("DB_PREFIX")."currency.currency_name as name,".C("DB_PREFIX")."currency.currency_logo as logo")
			->join("left join ".C("DB_PREFIX")."currency on ".C("DB_PREFIX")."currency.currency_id=".C("DB_PREFIX")."issue.currency_id")
			->limit($Page->firstRow.','.$Page->listRows)
			->order('end_time desc')->select();
		//算进度
		foreach ($list as $key=>$vo) {
			$bili=(($vo['num']-$vo['deal'])/$vo['num'])*100;
			if ($bili<0.001){
				$bili=0.001;
			}
			if ($bili>100){
				$bili=100;
			}
			$list[$key]['bl'] = $bili;
		}
		$this->assign('page',$show);
		$this->assign('list',$list);
		$this->display();
	}
	//众筹详细页面显示
	public function details(){
		if(empty($_GET['id'])){
			$this->redirect('Public:404');
		}
		$this->checkZhongchou();
		$list=M('Issue')
			->field(C("DB_PREFIX")."issue.*,".C("DB_PREFIX")."currency.currency_name as name")
			->join("left join ".C("DB_PREFIX")."currency on ".C("DB_PREFIX")."currency.currency_id=".C("DB_PREFIX")."issue.currency_id")
			->order('ctime desc')
			->where('id='.$_GET['id'])
			->find();
		$list['buy_name'] = $list['buy_currency_id']==0?"人民币":M('Currency')->field('currency_name')->where("currency_id='{$list['buy_currency_id']}'")->find()['currency_name'];
		$list['buy_mark'] = $list['buy_currency_id']==0?"RMB":M('Currency')->field('currency_mark')->where("currency_id='{$list['buy_currency_id']}'")->find()['currency_mark'];
		$list['zhongchou_success_bili']=$list['zhongchou_success_bili']*100;
		$uid=$_SESSION['USER_KEY_ID'];
		if (!empty($uid)){
			$list['buy_count']  =$this->getIssuecountById($uid,$_GET['id']);
		}
		if(!$list){
			$this->redirect('Public:404');
		}
		$list['info']=html_entity_decode($list['info']);
		//查询个人记录
		$where['uid']=$_SESSION['USER_KEY_ID'];
		$where['iid']=$list['id'];
		$log=M('Issue_log')->field('*,num*price as count')->where($where)->select();
		$num_buy=M('Issue_log')->where($where)->sum('num');
		//查询账户余额
		if (!empty($uid)){
			if($list['buy_currency_id']!=0){
				$buy_num = M('Currency_user')->field('num')->where("member_id=$uid and currency_id={$list['buy_currency_id']}")->find();
				$buy_num = $buy_num['num'];
			}else{
				$buy_num = M('Member')->field('rmb')->where("member_id=$uid")->find();
				$buy_num = $buy_num['rmb'];
			}
		}
		$this->assign('id',$list['id']);
		$this->assign('num_buy',$num_buy);
		$this->assign('log',$log);
		$this->assign('list',$list);
		$this->assign('buy_num',$buy_num);
		$this->display();
	}
	//处理众筹
	public function run(){
		$num=intval(I('post.num'));
		$id=I('post.id');
		$uid=$_SESSION['USER_KEY_ID'];
		$buy_currency_id = I('post.buy_currency_id');
//    	$member=$this->member;
		if($buy_currency_id!=0){
			$buy_num = M('Currency_user')->field('num')->where("member_id=$uid and currency_id=$buy_currency_id")->find();
			$buy_num = $buy_num['num'];
		}else{
			$buy_num = M('Member')->field('rmb')->where("member_id=$uid")->find();
			$buy_num = $buy_num['rmb'];
		}
		$config=$this->config;
		$issue=M('Issue')->where("id=$id")->find();

		$where['uid']=$_SESSION['USER_KEY_ID'];
		$where['iid']=$id;
		$num_buy=M('Issue_log')->where($where)->sum('num');

		//获取会员一次众筹有几次记录
		$count=$this->getIssuecountById($uid,$id);
		if($issue['limit_count']<=$count){
			$data['status']=0;
			$data['info']='认筹次数不能超过限购次数';
			$this->ajaxReturn($data);
		}
		if($issue['limit']<$num){
			$data['status']=0;
			$data['info']='认筹数量不能超过限购数量';
			$this->ajaxReturn($data);

		}
		if($issue['min_limit']>$num){
			$data['status']=0;
			$data['info']='认筹数量不能小于最小认筹数量';
			$this->ajaxReturn($data);
		}
		if($issue['deal']<$num){
			$data['status']=0;
			$data['info']='认筹数量不能超过剩余数量';
			$this->ajaxReturn($data);
		}
		if($issue['limit']<$num_buy+$num){
			$data['status']=0;
			$data['info']='您已超过总认筹限购';
			$this->ajaxReturn($data);
		}
		if($buy_num<$num*$issue['price']){
			$data['status']=0;
			$data['info']='您的账户余额不足';
			$this->ajaxReturn($data);
		}
		//修改会员表人民币字段
//    	$rs=M('Member')->where("member_id=$uid")->setDec('rmb',$num*$issue['price']*$config['bili']);
		if($buy_currency_id!=0){
			$rs = M('Currency_user')->where("member_id=$uid and currency_id={$issue['buy_currency_id']}")->setDec('num',$num*$issue['price']);
		}else{
			$rs = M('Member')->where("member_id=$uid")->setDec('rmb',$num*$issue['price']);
		}
		//添加财务日志表
		if($rs){
			//添加认购记录
			$arr['iid']=$id;
			$arr['uid']=$uid;
			$arr['cid']=$issue['currency_id'];
			$arr['num']=$num;
			$arr['deal']=$num;
			$arr['price']=$issue['price'];
			$arr['add_time']=time();
			$arr['buy_currency_id']=$buy_currency_id;
			$arr['status']=0;
			M('Issue_log')->add($arr);
			//修改会员币种数量
			if($issue['is_forzen']==0){
				M('Currency_user')->where("member_id=$uid and currency_id={$issue['currency_id']}")->setInc('forzen_num',$num);
			}else{
				M('Currency_user')->where("member_id=$uid and currency_id={$issue['currency_id']}")->setInc('num',$num);
			}
				$this->addFinance($uid, 8, '众筹扣款'.$num*$issue['price'], $num*$issue['price'], 2, $buy_currency_id);
				$this->addFinance($uid, 9, '众筹获取'.$num, $num, 1, $issue['currency_id']);
			//添加信息表
			$this->addMessage_all($uid, -2, '认购成功', '您参与的众筹项目'.$issue['title'].'已成功,扣除交易币'.$num*$issue['price'].',获取众筹币'.$num);
			//添加众筹推荐人员奖励
			
			if($issue['zc_awards_status']==1){
				$this->setAwards($issue,$uid,$num);
			}
			$data['status']=0;
			$data['info']='认筹成功';
			$this->ajaxReturn($data);
		}else{
			//添加信息表
			$this->addMessage_all($uid, -2, '众筹失败', '您参与的众筹项目'.$issue['title'].'未成功');
			$data['status']=0;
			$data['info']='认筹失败';
			$this->ajaxReturn($data);
		}
	}

	public function setAwards($arr,$uid,$num){
		//查找此用户下推荐人 一代 二代
		$u_info = M('Member')->field('member_id,pid')->where("member_id = '{$uid}'")->find();
		if(empty($u_info['pid'])){
			return true;
		}
		$one_info = M('Member')->field('status,member_id,pid')->where("member_id = '{$u_info['pid']}'")->find();
		$one_where['member_id'] = $one_info['member_id'];
		$one_where['currency_id'] = $arr['zc_awards_currency_id'];
		$num = $arr['zc_awards_one_ratio']/100*$num;
		
		if ($one_info['status']==1&&$u_info['is_lock']==0){//只有用户正常情况才会有推荐奖励
    		  $r = M('Currency_user')->where($one_where)->setInc('num',$num);
    		  $this->addFinance($one_info['member_id'], 12, '众筹推荐奖励'.$num, $num, 1, $arr['zc_awards_currency_id']);
		}
		
		if(empty($one_info['pid'])){
			return true;
		}
		
		$two_info = M('Member')->field('status,member_id,pid')->where("member_id = '{$one_info['pid']}'")->find();
		$two_where['member_id'] = $two_info['member_id'];
		$two_where['currency_id'] = $arr['zc_awards_currency_id'];
		$num = $arr['zc_awards_two_ratio']/100*$num;
		if ($two_info['status']==1&&$two_info['is_lock']==0){//只有用户正常情况才会有推荐奖励
    		$r = M('Currency_user')->where($two_where)->setInc('num',$num);
    		$this->addFinance($two_info['member_id'], 12, '众筹推荐奖励'.$num, $num, 1, $arr['zc_awards_currency_id']);
		}
		if($r){
			return true;
		}
	}
}

44:F:\git\coin\bisheng commerce\App\Home\index.html
 

45:F:\git\coin\bisheng commerce\App\Home\Model\ArticleModel.class.php
<?php


namespace Home\Model;
use Think\Model;
class ArticleModel extends Model{
	//查询非标红文章（6个）
	public function info($id){
		$article = M('Article');
		$where[C("DB_PREFIX")."article_category.id"] = intval($id);
		$info = $article->join(C("DB_PREFIX")."article_category ON ".C("DB_PREFIX")."article.position_id = ".C("DB_PREFIX")."article_category.id")
						->where($where)
						->where(C("DB_PREFIX")."article.sign = 0")
						->order('add_time desc')
						->limit(0,6)
						->select();///排序，规定固定10个，红4灰6，///排序，规定固定10个，红4灰6，
		if($info){
			return $info;
		}else{
			return false;
		}
	}
	//查询标红文章（4个）
	public function info_red($id){
		$article = M('Article');
		$where[C("DB_PREFIX")."article_category.id"] = intval($id);
		$info = $article->join(C("DB_PREFIX")."article_category ON ".C("DB_PREFIX")."article.position_id = ".C("DB_PREFIX")."article_category.id")
		->where($where)
		->where(C("DB_PREFIX")."article.sign = 1")
		->order('add_time desc')
		->limit(0,4)
		->select();///排序，规定固定10个，红4灰6，///排序，规定固定10个，红4灰6，
		if($info){
			return $info;
		}else{
			return false;
		}
	}
	
	public function info_one($id){
		$article = M('Article');
		$where[C("DB_PREFIX")."article_category.id"] = intval($id);
		$info = $article->join(C("DB_PREFIX")."article_category ON ".C("DB_PREFIX")."article.position_id = ".C("DB_PREFIX")."article_category.id")
		->where($where)
		->order('add_time desc')
		->find();
		if($info){
			return $info;
		}else{
			return false;
		}
	}
}

?>

46:F:\git\coin\bisheng commerce\App\Home\Model\index.html
 

47:F:\git\coin\bisheng commerce\App\Home\Model\MemberModel.class.php
<?php
/**
 * Created by PhpStorm.
 * User: Administrator
 * Date: 16-3-8
 * Time: 下午2:23
 */

namespace Home\Model;
use Think\Model;

class MemberModel extends Model{

    protected $_validate = array(
//        array(验证字段1,验证规则,错误提示,[验证条件,附加规则,验证时间]),
//        array('agree','1','条款必须同意',1,'equal',1),//同意条款
        array('email','email','email格式不正确',1,'',1), //验证邮箱
        array('pwd','require','登录密码不能为空',1,'',1),
        array('pwd','checkPwd','密码格式不正确',1,'function',1), //函数认证密码(同样要求)
        array('repwd','pwd','确认密码不正确',1,'confirm',1), //二次密码是否一样
    	array('email','','帐号名称已经存在！',0,'unique',1), // 在新增的时候验证name字段是否唯一

        array('pwdtrade','require','交易密码不能为空',1,'',1),
        array('pwdtrade','checkPwd','交易密码不正确',1,'function',1), // 函数认证支付密码(同样要求)
        array('repwdtrade','pwdtrade','确认交易密码不正确',1,'confirm',1), // 二次密码是否一样

        //modify验证

        array('nick','require','昵称不能为空',1,'',2),
        array('name','require','真实姓名不能为空',1,'',2),
        array('idcard','require','身份证号码必须填写',1,'',2),
        array('phone','require','手机号码必须填写',1,'',2),
        array('code','require','验证码必须填写',1,'',2),
        array('code','checkPhoneCode','手机验证码不正确',1,'function',2),
    );

    protected $_auto = array(
//       array(完成字段1,完成规则,[完成条件,附加规则]),
        array('pwd','md5',1,'function'), //加密登录密码
        array('pwdtrade','md5',1,'function'), // 加密支付密码
    );

    /**
     * 验证密码长度在6-20个字符之间
     * @param $pwd
     * @return bool
     */
    public function checkPwd($pwd){
        $pattern="/^[1-9|a-z|A-Z]{6,20}$/";
        if(preg_match($pattern, $pwd)){
            return true;
        }else{
            return false;
        }
    }

    public function logCheckEmail($email){
        $where['email'] = $email;
        $info = $this->where($where)->find();
        if($info){
            return $info;
        }else{
            return false;
        }
    }

    public function logCheckMo($mo){
        $where['phone'] = $mo;
        $info = $this->where($where)->find();
        if($info){
            return $info;
        }else{
            return false;
        }
    }

    function checkPhoneCode($code){
        if (session('code')!=$code){
            return  false;
        }else {
            return true;
        }
    }

}

48:F:\git\coin\bisheng commerce\App\Home\Model\OrdersModel.class.php
<?php
namespace Home\Model;
use Think\Model;
class OrdersModel extends Model{
    protected $_auto = array (          
        array('status','0'),  
        array('add_time','time',1,'function'),
        array('trade_time','time',2,'function'),
    );
}

?>

49:F:\git\coin\bisheng commerce\App\Home\Model\TradeModel.class.php
<?php


namespace Home\Model;
use Think\Model;
class TradeModel extends Model{
    protected $_auto = array (          
        array('status','0'),  
        array('add_time','time',1,'function'),
        array('trade_no','setTrade_no',1,'callback'),
    );
    
    //给一个订单号
    public function setTrade_no(){
        return 'T'.time();
    }
    
}

?>

50:F:\git\coin\bisheng commerce\App\Home\View\Art\details.html
<include file="App/Home/View/Public/header.html"/>

<div id="main">
  <div class="newsarea" style="padding-top:0;">
    <div class="newsarea_box">
      <div class="product left clearfix">
        <div style="border-bottom:1px solid #e2e2e2; padding-top:20px; position:relative;">
         
         
          <h2 style="line-height:24px; border:none;">{$art_one.title}</h2>
          <p style=" position:absolute; right:40px; bottom:0px; color:#999;">{$art_one.add_time|date='Y-m-d H:i:s',###}</p>
        </div>
        <div class="paragraph paragraph_news">
         <p>{$art_one.content}</p>
        </div>
      </div>
     <!--上面为显示的文章-->
      <div class="right">
        <div class="latest">
          <div class="investmentarea">
            <div class="focusnum1" style="border-bottom:1px solid #eee;">
            
              <h2 class="left">最新动态</h2>
              
              <p class="right"><a href="{:U('Art/index',array('id'=>$art_one['position_id']))}">查看更多</a></p>
              <div class="clear"></div>
            </div>
            
            <volist name="art_list" id="vos">
            <ul>
              <a href="{:U('Art/details',array('id'=>$vos['article_id']))}">
              <li>
                <p class="left" style="width:200px; line-height:18px;">{$vos.title}</p>
                <p class=" right recruit" style="width:65px; margin-left:0;">{$vos.add_time|date='Y-m-d',###}</p>
                <div class="clear"></div>
              </li>
              </a> 
            </ul>
            </volist>
          
          </div>
        </div>
      </div>
      <div class="clear"></div>
    </div>
  </div>
</div>
<div class="clear"></div>
<!--footer start--> 
<include file="App/Home/View/Public/footer.html"/>

51:F:\git\coin\bisheng commerce\App\Home\View\Art\index.html
<include file="App/Home/View/Public/header.html"/>
<div id="main">
  <div class="main_box">
    <div class="dynamic">
      <h3>最新动态</h3>
      <ul>
        <volist name="list" id="vo">
          <li> <a href="{:U('Art/details',array('id'=>$vo['article_id']))}"><span>{$vo.add_time|date='Y-m-d H:i:s',###}</span> {$vo.title} </a> </li>
        </volist>
      </ul>
      <div class="page">
      		<ul>
            	{$page}
            </ul>
      </div>
    </div>
  </div>
</div>
<!--footer start--> 
<include file="App/Home/View/Public/footer.html"/>

52:F:\git\coin\bisheng commerce\App\Home\View\Dow\index.html
<include file="App/Home/View/Public/header.html"/>
<style>
.filtrate{
border: 1px solid #e55600;
color:#e55600;
border-radius: 3px;
width: 60px;
height: 28px;
margin: 5px;
cursor: pointer;
}
.filtrate:hover{
border: 1px solid #e55600;
border-radius: 3px;
width: 60px;
height: 28px;
margin: 5px;
cursor: pointer;
color:#FFF;
background-color:#e55600;	
}
</style>
    <!--top end-->
<div id="main">
	<div class="main_box">

            <script src="../Entrust/js/coinindex.js"></script>
<div class="ybc_list">
	<div class="ybcoin clearfix">
<!--	<main>-->
    
    
	<div class="autobox">
 <div class="now"> <a href="{:U('Index/index')}" class="orange">首页</a> &gt;<a href="{:U('Dow/index')}" class="orange"> 下载中心 </a> &gt; 虚拟币钱包下载 </div>
    
    <div class="assets_center clear po_re zin70">
        <!--左侧菜单-->
        <div style="top: -1px;" class="coin_menu">
            <div class="coin_menu_box">
                <dl>
                    <dt class="here"><a href="{:U('Dow/index')}">虚拟币钱包下载</a></dt>
          <dt><a href="{:U('Dow/two')}">浏览器下载</a></dt>
          <dt><a href="{:U('Dow/newcoin')}">新币上线申请</a></dt>
                </dl>
            </div>
        </div>
    
    <!--右侧内容-->
    <div class="assets_content w753 right bg_w">
      <h1>虚拟币钱包下载</h1>
      <div class="friend_a_box">
        <table style=" background-color:#ffffff; margin-bottom: 20px; border: solid 1px #ededed;" align="left" border="0" width="600">
          <tbody>
		  <volist name="list" id="vo">
            <tr>
              <td height="24" width="60"><img src="{$vo.currency_logo}" style=" width:35px; padding:5px 0px 0px 20px;" alt=""></td>
              <td width="120"> {$vo.currency_name}（{$vo.currency_mark}）</td>
              <td width="60">　<a href="{$vo.qianbao_url}" class="orange" target="_blank">钱包下载</a></td>
              <td width="60">　<a href="https://{$vo.guanwang_url}" class="orange" target="_blank">官方网站</a></td>
            </tr>
			</volist>
         
            
          </tbody>
        </table>
        <br>
        <br>
      </div>
    </div>
  </div>
</div>	
        
        
        
        
        
        
        
 <!--	<main>-->       
	</div>
<div >{$page}</div>               
</div>
<script>
function cointrust()
{
	var coinname = $('#coninname').val();
	var status  = $('#status').val();
	location.href='/user_exchange/cointrustold/coinname/'+coinname+'/status/'+status;
}
</script>
		</div>
		<div class="clear"></div>
	</div>
</div>  
<script>
$(".menu4").addClass("uc-current");
</script>  
<include file="App/Home/View/Public/footer.html"/>

53:F:\git\coin\bisheng commerce\App\Home\View\Dow\newcoin.html
<include file="App/Home/View/Public/header.html"/>
<style>
.filtrate{
border: 1px solid #e55600;
color:#e55600;
border-radius: 3px;
width: 60px;
height: 28px;
margin: 5px;
cursor: pointer;
}
.filtrate:hover{
border: 1px solid #e55600;
border-radius: 3px;
width: 60px;
height: 28px;
margin: 5px;
cursor: pointer;
color:#FFF;
background-color:#e55600;	
}
</style>
    <!--top end-->
<div id="main">
	<div class="main_box">

            <script src="../Entrust/js/coinindex.js"></script>
<div class="ybc_list">
	<div class="ybcoin clearfix">
<!--	<main>-->
    
    
	<div class="autobox">
    <div class="now"> <a href="{:U('Index/index')}" class="orange">首页</a> &gt;<a href="{:U('Dow/index')}" class="orange"> 下载中心 </a> &gt; 新币上线申请 </div>
    
    <div class="assets_center clear po_re zin70">
        <!--左侧菜单-->
        <div style="top: -1px;" class="coin_menu">
            <div class="coin_menu_box">
                <dl>
                    <dt><a href="{:U('Dow/index')}">虚拟币钱包下载</a></dt>
          <dt><a href="{:U('Dow/two')}">浏览器下载</a></dt>
          <dt  class="here"><a href="{:U('Dow/newcoin')}">新币上线申请</a></dt>
                </dl>
            </div>
        </div>
        <style>
            .xj{border-top: 1px dotted #919191;padding-top: 19px;width: 690px;margin-left: 25px;}
            .xj ol li{list-style: decimal;margin-left:30px;line-height: 32px;}
            .xj ol{margin:10px 0;}
            .xj a{color:#e55600;}
        </style>
        <!--右侧内容-->
        <div class="assets_content w753 right bg_w">
            <h1>新币上线申请</h1>

            <div class="xj">
                <span style="text-indent: 2em;">{$config.new_coin_up}
                <a href="{$config.biaoge_url}" style="padding:13px 20px;clear:both;margin:20px 0 0 30px;  display: inline-block;background-color: #e55600;color:#fff;border-radius: 300px;;" target="_blank">下载新币上线申请表</a>
            </div>
        </div>
    </div>
</div>	
        
        
        
        
        
        
        
 <!--	<main>-->       
	</div>
<div >{$page}</div>               
</div>
<script>
function cointrust()
{
	var coinname = $('#coninname').val();
	var status  = $('#status').val();
	location.href='/user_exchange/cointrustold/coinname/'+coinname+'/status/'+status;
}
</script>
		</div>
		<div class="clear"></div>
	</div>
</div>  
<script>
$(".menu4").addClass("uc-current");
</script>  
<include file="App/Home/View/Public/footer.html"/>

54:F:\git\coin\bisheng commerce\App\Home\View\Dow\two.html
<include file="App/Home/View/Public/header.html"/>
<style>
.filtrate{
border: 1px solid #e55600;
color:#e55600;
border-radius: 3px;
width: 60px;
height: 28px;
margin: 5px;
cursor: pointer;
}
.filtrate:hover{
border: 1px solid #e55600;
border-radius: 3px;
width: 60px;
height: 28px;
margin: 5px;
cursor: pointer;
color:#FFF;
background-color:#e55600;	
}
</style>
    <!--top end-->
<div id="main">
	<div class="main_box">

            <script src="../Entrust/js/coinindex.js"></script>
<div class="ybc_list">
	<div class="ybcoin clearfix">
<!--	<main>-->
    
    
	<div class="autobox">
  <div class="now"> <a href="{:U('Index/index')}" class="orange">首页</a> &gt;<a href="{:U('Dow/index')}" class="orange"> 下载中心 </a> &gt; 浏览器下载 </div>
    
    <div class="assets_center clear po_re zin70">
        <!--左侧菜单-->
        <div style="top: -1px;" class="coin_menu">
            <div class="coin_menu_box">
                <dl>
                    <dt><a href="{:U('Dow/index')}">虚拟币钱包下载</a></dt>
          <dt  class="here"><a href="{:U('Dow/two')}">浏览器下载</a></dt>
          <dt><a href="{:U('Dow/newcoin')}">新币上线申请</a></dt>
                </dl>
            </div>
        </div>
    
    <!--右侧内容-->
    <div class="assets_content w753 right bg_w">
      <h1>浏览器下载</h1>
      <div class="friend_a_box">
        <table style=" background-color:#ffffff; margin-bottom: 20px; border: solid 1px #ededed;" align="left" border="0" width="600">
          <tbody>
            <tr height="60">
              <td width="60"><img src="/Public/Home/images/d-ie9.jpg" alt=""></td>
              <td width="200"> 　Internet Explorer 9.0</td>
              <td width="80"><a href="http://www.microsoft.com/zh-cn/download/internet-explorer.aspx" target="_blank">&nbsp; &nbsp;官网下载</a></td>
            </tr>
            <tr height="60">
              <td><img src="/Public/Home/images/d-chrome.jpg" alt=""></td>
              <td>　Chrome 谷歌浏览器</td>
              <td><a href="https://www.google.com/intl/zh-CN/chrome/browser/" target="_blank">&nbsp; &nbsp;官网下载</a></td>
            </tr>
            <tr height="60">
              <td><img src="/Public/Home/images/d-firefox.jpg" alt=""></td>
              <td>　FireFox 火狐浏览器</td>
              <td><a href="http://www.firefox.com.cn/" target="_blank">&nbsp; &nbsp;官网下载</a></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>	
        
        
        
        
        
        
        
 <!--	<main>-->       
	</div>
<div >{$page}</div>               
</div>
<script>
function cointrust()
{
	var coinname = $('#coninname').val();
	var status  = $('#status').val();
	location.href='/user_exchange/cointrustold/coinname/'+coinname+'/status/'+status;
}
</script>
		</div>
		<div class="clear"></div>
	</div>
</div>  
<script>
$(".menu4").addClass("uc-current");
</script>  
<include file="App/Home/View/Public/footer.html"/>

55:F:\git\coin\bisheng commerce\App\Home\View\Draw\index.html
<include file="App/Home/View/Public/header.html"/>
    <!--top end-->
<script src="./元宝网｜第一数字资产交易平台_files/index.js"></script>
<div id="main">
	<div class="main_box">
		<include file="App/Home/View/Public/left.html"/>
		<div class="raise right clearfix">
            <script type="text/javascript" src="./元宝网｜第一数字资产交易平台_files/ajax.js"></script>
<script type="text/javascript" src="./元宝网｜第一数字资产交易平台_files/Fnc.js"></script>
<div class="ybc_list">
	<div class="ybcoin">
		<h2 class="left">莱特币提币</h2>
		<div class="clear"></div>
	</div>
</div>
<json id="json" ></json>
        <div class="support_ybc pass_ybc" id="verifyon">
        <div id="tagContent" class="passContent">
        <div class="tagContent selectTag" id="tagContent0">
                    <div class="choose_one clearfix">
		<h2 class="left">选择一个提币地址<span style="float:right;margin-right:50px;"><strong id="coinout_showtips"></strong></span></h2>
		<p class="right" style="font-size:12px; margin-top:8px;">如果您新添加的地址为【未认证】，请联系官方客服QQ（4008367667）审核。</p>
	    </div>
	    <table cellpadding="0" cellspacing="0" border="0" class="my_add">
		<thead>
			<tr align="center">
				<th style="width:143px">选择</th>
				<th style="width:221px">地址标签</th>
				<th style="width:300px;">提币地址</th>
				<th style="width:100px">状态</th>
				<th style="width:144px">操作</th>
			</tr>
		</thead>
        <form action="https://www.yuanbaohui.com/user_exchange/outcoinconfirm2" method="post" id="coinout_con"></form>
		<tbody>
            <input type="hidden" id="coins_what" name="coin_what" value="ltc">
            			<tr align="center" style="display:none;" id="coinout_newaddr">
				<td>新地址</td>
				<td><input type="text" class="sum" id="new_label" placeholder="例如：张三的地址"></td>
				<td><input type="text" class="sum" id="wallet_address" style="width:300px;" placeholder="例如：yja67fGc8UBXLWtjwvHFkjrmYhTFGH9PTs"></td>
				<td>&nbsp;</td>
				<td><input type="button" class="verify" onclick="coinOut.submitNewAddr()" id="yes_add2" value="确认"></td>
			</tr>
			<tr align="right" style="display:none;" id="phone_alert2">
				<td colspan="5"><span style="color:#f00;">系统已拨打您的手机告知验证码，请输入验证码</span> <input type="text" class="verify_text" id="phone_code_wallet"><input type="button" class="verify" value="确认" onclick="coinOut.finaddAddress()"></td>
			</tr>
			<tr align="center" id="addAddress_tr">
				<td colspan="5"><a href="javascript:coinOut.addNewAddr();" id="addNewAddress">点击添加一个新的提币地址</a></td>
			</tr>
		</tbody>
	    </table>
	    <h2 class="choose_one">输入要提币的数额<span>(可用余额：<strong>0 LTC</strong>)</span><span style="float:right;margin-right:20px;"><strong id="coinout2_showtips"></strong></span></h2>
	    <table cellpadding="0" cellspacing="0" border="0" class="my_add">
		<tbody>
			<tr>
            <input type="hidden" id="coin_over" value="0">
				<td style="position:relative;"><input style="display:none"><!-- for disable autocomplete on chrome --><input type="text" class="sum" id="coin_rmb" name="num" onkeyup="coinOut.daozhang()" autocomplete="off"></td>
				<td>实际到帐 <input type="text" class="sum" id="true_coin" disabled=""> <span style="color:#f60;">(手续费0%)<input type="hidden" value="0" id="fee_coin"></span></td>
				<td>交易密码 <input type="password" style="display:none"><!-- for disable autocomplete on chrome --><input type="password" class="sum" name="pwdtrade" id="pwdtrade" autocomplete="off"></td>
				<td><input type="submit" class="confirm" value="确认提币"></td>
			</tr>
		</tbody>
        
	    </table>
        	    <h2 class="choose_one">转出莱特币说明</h2>
        <div class="turns">
            <p>1. 提币手续费为0%，请仔细确认后再操作。</p>
            <p>2. 每笔转出最大限额2000个币。</p>
            	                <input type="hidden" id="max_coin" value="2000">
            <input type="hidden" id="min_coin" value="5.0000">
        </div>
        </div>
        <div class="tagContent" id="tagContent1">
                    <p style=" text-align:center; font-size:18px; color:#666; margin-top:120px;">还未设置Google验证?</p>
            <p class="clickon"><a href="https://www.yuanbaohui.com/user_safe/twofactor">点击设置</a></p>
        	    <h2 class="choose_one">转出莱特币说明</h2>
        <div class="turns">
            <p>1.提币手续费为0%，请仔细确认后再操作。</p>
            <p>2.每笔转出最大限额2000个币。</p>
        </div>
        </div>
        </div>
    </div>
	<div class="ybc_list">
    <div class="ybcoin">
        <h2 class="left">转出记录</h2>
        <div class="clear"></div>
    </div>
	<table cellspacing="0" cellpadding="0" border="0" class="raise_list" align="center" style="border:1px solid #e1e1df;">
		<thead>
		<tr>
			<th>记录ID</th>
			<th>转入钱包地址</th>
			<th>转出数量</th>
			<th>实际到账</th>
			<th>操作时间</th>
			<th>状态</th>
		</tr>
		</thead>
		<tbody>
		<tr id="btc_box" class="btc_new" style="display:none">
			<td id="btc_id"></td>
			<td id="btc_wallet"></td>
			<td id="btc_number"></td>
			<td id="btc_fee"></td>
			<td id="btc_created"></td>
			<td class="tableEnd" id="btc_status">等待转出</td>
		</tr>
				</tbody>
	</table>
	</div>
	</div>
<style>.btc_new,.btc_new td {background: #DDFFDD !important;}#cb_msg_box{background:#B50000;color:#FFF;display:none;text-align:center;padding:0px;}</style>
<script type="text/javascript" src="./元宝网｜第一数字资产交易平台_files/tab2.js"></script>
<script src="__PUBLIC__/Home/js/coinout.js"></script>
		</div>
		<div class="clear"></div>
	</div>
    
<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>

56:F:\git\coin\bisheng commerce\App\Home\View\Entrust\history.html
<include file="App/Home/View/Public/header.html"/>
<style>

.filtrate{
border: 1px solid #e55600;
color:#e55600;
border-radius: 3px;
width: 60px;
height: 28px;
margin: 5px;
cursor: pointer;
}
.filtrate:hover{
border: 1px solid #e55600;
border-radius: 3px;
width: 60px;
height: 28px;
margin: 5px;
cursor: pointer;
color:#FFF;
background-color:#e55600;
}

</style>
    <!--top end-->
<div id="main">
	<div class="main_box">
		<include file="App/Home/View/Public/left.html"/>
		<div class="raise right clearfix">
            <script src="js/coinindex.js"></script>
<div class="ybc_list">
	<div class="ybcoin clearfix">
		<h2 class="left">委托历史</h2> 
		<div class="right">
			<form action="{:U('Entrust/history')}" method="post">
                <select id="coninname" name="currency">
                    <volist name="culist" id="vo">		    
                    <option value="{$vo['currency_id']|default=""}">{$vo['currency_id']|getCurrencynameByCurrency=###}对{$vo['trade_currency_id']|getCurrencynameByCurrency=###}</option>
                    </volist>    
                </select>
                <select id="status" style="margin-left:0; width:80px;" name="status">
                    
                     <option value="2">已成交</option>
                     <option value="-1">已撤销</option>
                     <option value="2,-1" selected="selected">全部</option>
                </select>
                <input value="提交" class="filtrate" type="submit">
			</form>
        </div>
	</div>
		<table class="raise_list" style="border:1px solid #e1e1df;" align="center" border="0" cellpadding="0" cellspacing="0">
	 		<thead>
				<tr>
					<th>委托时间</th>
					<th>币种</th>
					<th>类型</th>
					<th>委托数量</th>
					<th>委托价格</th>
					<th>成交数量</th>
					<th>尚未成交</th>
					<th>状态</th>
			
				</tr>
				</thead>
				<tbody>
				<foreach name="list" item="vo">
					<tr >
						<td c >{$vo.add_time|date='Y-m-d H:i:s',###}</th>
						<td  >{$vo.currency_id|getCurrencynameByCurrency=###}</td>
						<eq name="vo['type']" value="sell"> <td class="red"><else/><td style="color:#039904;"></eq>{$vo.type|fomatOrdersType=###}</td>
						<td>{$vo.num|floatval=###}</td>
						<td>{$vo.price|floatval=###}</td>
						<td>{$vo.trade_num|floatval=###}</td>
						<td>{$vo['num']- $vo['trade_num']|floatval=###}</td>
						<td>{$vo.status|formatOrdersStatus=###}</td>
					</tr>
				</foreach>
				</tbody>
              </table>
              <div class="page" style=" min-width:200px !important; float:right;">
                    {$page}
              </div>
                            
</div>
<script>
function cointrust()
{
	var coinname = $('#coninname').val();
	var status  = $('#status').val();
	location.href='/user_exchange/cointrustold/coinname/'+coinname+'/status/'+status;
}
</script>
		</div>
		<div class="clear"></div>
	</div>
</div>  
<script>
$(".menu4").addClass("uc-current");
</script>  
<include file="App/Home/View/Public/footer.html"/>

57:F:\git\coin\bisheng commerce\App\Home\View\Entrust\manage.html
<include file="App/Home/View/Public/header.html"/>
<style>
.filtrate{
border: 1px solid #e55600;
color:#e55600;
border-radius: 3px;
width: 60px;
height: 28px;
margin: 5px;
cursor: pointer;
}
.filtrate:hover{
border: 1px solid #e55600;
border-radius: 3px;
width: 60px;
height: 28px;
margin: 5px;
cursor: pointer;
color:#FFF;
background-color:#e55600;	
}
</style>
    <!--top end-->
<div id="main">
	<div class="main_box">
		<include file="App/Home/View/Public/left.html"/>
		<div class="raise right clearfix">
            <script src="js/coinindex.js"></script>
<div class="ybc_list">
	<div class="ybcoin clearfix">
		<h2 class="left">委托管理</h2>
		<div class="right">
			<form action="{:U('Entrust/manage')}" method="post">
                <select id="coninname" name="currency">
                    <volist name="culist" id="vo">		    
                    <option value="{$vo['currency_id']|default=""}">{$vo['currency_id']|getCurrencynameByCurrency=###}对{$vo['trade_currency_id']|getCurrencynameByCurrency=###}</option>
                    </volist>    
                </select>
                <select id="status" style="margin-left:0; width:80px;" name="status">
                     <option value="0">未成交</option>
                     <option value="1">部分成交</option>
                   	 <!--<option value="2">已成交</option>
                     <option value="3">已撤销</option>  -->  
                     <option value="0,1" selected="selected">全部</option>
                </select>
                <input value="提交" class="filtrate" type="submit">
			</form>
        </div>
	</div>
		<table class="raise_list" style="border:1px solid #e1e1df;" align="center" border="0" cellpadding="0" cellspacing="0">
	 		<thead>
				<tr>
					<th>委托时间</th>
					<th>币种</th>
					<th>类型</th>
					<th>委托数量</th>
					<th>委托价格</th>
					<th>成交数量</th>
					<th>尚未成交</th>
					<th>状态</th>
					<th>操作</th>
				</tr>
				</thead>
				<tbody>
				<foreach name="list" item="vo">
					<tr>
						<td>{$vo.add_time|date='Y-m-d H:i:s',###}</td>
						<td>{$vo.currency_id|getCurrencynameByCurrency=###}</td>
							<eq name="vo['type']" value="sell"> <td class="red"><else/><td style="color:#039904;"></eq>{$vo.type|fomatOrdersType=###}</td>
						<td>{$vo.num|floatval=###}</td>
						<td>{$vo.price|floatval=###}</td>
						<td>{$vo.trade_num|floatval=###}</td>
						<td>{$vo['num']- $vo['trade_num']|floatval=###}</td>
						<td>{$vo.status|formatOrdersStatus=###}</td>
						<td><a href="javascript:void(0)"  onclick="cexiao({$vo.orders_id})">撤销</a></td>
					</tr>
				</foreach>
			<tbody>
              </table>
          </div>
          <div class="page" style=" min-width:200px !important; float:right;">
                    {$page}
              </div>
		</div>
		<div class="clear"></div>
	</div>
</div>
<script>
$(".menu2").addClass("uc-current");
</script>
<script>
	function cexiao(_this){
		layer.confirm('确定撤销委托？', {
	  btn: ['确定','取消'], //按钮
	  title: '撤销委托'
	}, function(){
	  $.post('{:U('Entrust/cancel')}',{status:-1,order_id:_this},function(data){
				   if(data['status'] == 1){
					   layer.msg(data['info']);
					   setTimeout(window.location.reload(),1000);
				   }else{
					   layer.msg(data['info']);
				   }
			})
	}, function(){
	  layer.msg('已取消');
	});

	}
</script>
<include file="App/Home/View/Public/footer.html"/>

58:F:\git\coin\bisheng commerce\App\Home\View\Fill\index.html
<include file="App/Home/View/Public/header.html"/>
    <!--top end-->
	<style>
	table tr td{border-bottom:1px solid #e1e1df;}	
	</style>
	<style>
.raise_list tr:hover{
	background-color:#FFE9D2;
	}
	
</style>
<div id="main">
	<div class="main_box">
		<include file="App/Home/View/Public/left.html"/>
		<div class="raise right clearfix">
            <div class="ybc_list">
	<div class="ybcoin clearfix">
		<h2 class="left">第三方支付日志</h2>
		
	</div>
		<table class="raise_list" style="border:1px solid #e1e1df;" id="Transaction" align="center" border="0" cellpadding="0" cellspacing="0">
			<thead>
			<tr>
				<th>订单号</th>
				<th>金额(rmb)</th>
				<th>状态</th>
				<th>充值时间</th>
			
			</tr>
			</thead>
			<tbody>
			<volist name="list" id="vo">
			<tr>
				<td>{$vo.tradeno}</td>
				<td>{$vo.num}</td>
				<td><eq name="vo.status" value="1"><span style="color:#393">成功</span><else/><span style="color:#e55600">失败</span></eq></td>
				<td>{$vo.ctime|date="Y-m-d H:i:s",###}</td>
			
			</tr>
			</volist>
			</tbody>
									
		</table>
		<div class="page" style=" min-width:200px !important; float:right;">
                    {$page}
              </div>
	</div>
		</div>
		<div class="clear"></div>
	</div>
</div> 
<script>
$(".menu138").addClass("uc-current");
</script>   
<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>
<!--footer end-->


59:F:\git\coin\bisheng commerce\App\Home\View\FillByBank\bank.html
<html>
<head></head>
<body>
<form name="form1" id="form1" method="post" action="{$form_url}" target="_self">
<input type="hidden" name="pGateWayReq" value="{$strsubmitxml}" />
</form>
<script language="javascript">document.form1.submit();</script>
</body>
</html>

60:F:\git\coin\bisheng commerce\App\Home\View\FillByBank\index.html
<include file="App/Home/View/Public/header.html"/>
<style type="text/css">
.user {
	width: 97%;
	margin: 0px auto;
}
.user-nav {
}
.user-nav a {
	display: inline-block;
	float: left;
	padding: 7px 20px;
	margin-left: 10px;
	color: #0B72A4;
}
.user-nav a.cur {
	background: #fff;
	border: 1px solid #ddd;
	border-bottom: 0px;
}
.user-info {
	padding: 20px 0px;
	font-size: 14px;
	border: 1px solid #ddd;
}
.user-info dl {
	display: block;
	width: 99%;
	margin: 0px auto;
	zoom: 1;
	overflow: hidden;
}
.user-info dl dt, .user-info dl dd {
	float: left;
	padding: 15px 10px;
}
.user-info dl dt {
	clear: both;
	width: 10%;
}
.user-info dl dd {
	width: 70%;
}
.user-info dl dd input[type='radio'] {
	margin-left: 20px;
}
.user-info input[type='text'], .user-info input[type='password'] {
	width: 100px;
	height: 30px;
	line-height: 30px;
	border: 1px solid #ccc;
	padding-top: 0px;
	padding-right: 10px;
	padding-bottom: 0px;
	padding-left: 10px;
}
.user-info table {
	width: 100%;
	border: 1px solid #ccc;
	border-bottom: 0px;
}
.user-info th, .user-info td {
	padding: 10px 10px;
	border-bottom: 1px solid #ccc;
	text-align: right;
}
.user-info h3 {
	text-indent: 15px;
	padding: 15px 0px;
}
.sub {
	display: inline-block;
	font-weight: 700;
	font-size: 14px;
	color: white;
	text-align: center;
	width: 170px;
	height: 32px;
	line-height: 32px;
	background: #FF8C19;
	margin-top: 10px;
}
.sub:hover {
	color: #fff;
	text-decoration: none;
}
.banktable td {
	padding: 0px;
}
.onlineRecharge .onlineRechargeContent .numberBlock{ width:350px}
.mainBox2 h3 {
  font-size: 20px;
  font-weight: bold;
  color:#E32222;
  padding-left:0px;
}
.content {
  padding: 10px;
}
.input {
  border: 1px solid #DDD;
  padding: 2px;
  font: 12px/150% Arial,"Lucida Grande",Verdana,Helvetica,sans-serif;
  color: #333;
}
.content #button_10:hover{ background-color:#286090 !important;}
.selecttabboxNew li{float:none;line-height: 19px;}
</style>
<script src="js/index.js"></script>

<div id="main">
	
	<div class="main_box">
	
  <div class="rightArea">
    <div class="onlineRecharge">
	
      <div class="selecttabNew1">
	  
        <ul class="selecttabboxNew">
		<include file="App/Home/View/Public/left.html"/>
                 <!--<li class=""> <a class="otherBoxTitle" href="/Home/Fill/index">线下手动汇款<img src="/Public/Home/nofee.png"></a> </li>-->
            
                <!--  <li class=""> <a class="otherBoxTitle" href="/Home/Fill/zhifu_add">支付宝手动汇款<img src="/Public/Home/nofee.png"></a> </li>
                 <li class="cur"> <a class="otherBoxTitle" href="/Home/Fill/bank">银行汇款<img src="/Public/Home/nofee.png"></a> </li>
           -->
        </ul>
      </div>
      
      <div class="rightArea3">
				<div class="riskArea">
					<span class="icon"></span> <span class="hinttext"> <span class="define">{$art.title}</span><span> {$art.content}
 </span> </span>
				</div>
			</div>
            
            <div class="mainBox2">
          
         
			
		  <div class="content">
          <style>
		  #tips2bank { margin-left:40px;}
          		#tips2bank li{ line-height:45px;}
          </style>
          <!--<ul id="tips2bank">
							<li><span class="c1">充值方式： </span><span class="c2" id="fownerName1">支付宝</span><span class="c3"></span></li> 
							<li><span class="c1">收款帐号：</span><span class="c2" id="fownerName2">{$sys.alipay}  </span></li> 
							<li><span class="c1">收款人名：</span><span class="c2" id="fownerName3">{$sys.alipay_name}</span></li> 
					<li><span class="c1">附言内容：</span><span class="c2" id="fownerName">{$auth.id}</span></li> 
						
            <div>
		  </div>
		  <input name="optEmail" value="{$sys.alipay}" type="hidden">
		  <input name="title" value="{$num}" type="hidden">
          <li><span class="c1">充值金额：</span>
            <input style="margin-left:55px;" name="money" onkeyup="javascript:buyTurnoverValue();" class="input" id="payAmount" value="100" size="20" type="text">
            元</span></li>
          			<input id="button_10" type="submit" value="确认充值" style="width:130px; height:45px; border-radius:5px; margin-top:8px; background:#337ab7; color:#fff; font-size:16px; border:0px;"> 
</ul>-->
<!--新加-->
<form id="form1" name="form1" action="{:U('FillByBank/bank')}" method="post" onsubmit="return VerifyData();" target="_blank">
          <table width="60%" style="border-collapse:collapse;border:1px solid #000000; margin-left:200px; position:absolute;" border="0" cellpadding="1" cellspacing="1" >
            <tr>
              <td height="30" align="right" class="tdwp"><span class="STYLE12">*</span> 充值金额:</td>
              <td align="left">&nbsp;&nbsp;&nbsp;
                <input name="p3_Amt" type="text" id="p3_Amt" style="border:1px solid #CCCCCC;height:18px;line-height:20px; width:118px;" onkeyup="clearNoNum(this);" size="15"/>
                <span style="color:#FF0000">&nbsp;&nbsp;&nbsp;*&nbsp;充值金额不能低于{$config.pay_min_money}元</span></td>
            </tr>
            <!--<tr>
              <td height="30" align="right" class="tdwp"><span class="STYLE12">*</span> 兑换美元:</td>
              <td align="left">&nbsp;&nbsp;&nbsp;
                <input  type="text" id="p3_my" style="border:1px solid #CCCCCC;height:18px;line-height:20px; width:118px;"  size="15" disabled="disabled"/></td>
            </tr>-->
            <tr>
              <td align="right" height="60"><span class="STYLE12">*</span> 选择银行:</td>
              <td align="left"><div style="padding-left:20px;">
                  <table width="100%" border="0" cellpadding="0" cellspacing="0" style="left:0; line-height:40px;">
                    <tr class="b_rig">
                      <td>
                      <input type="radio" name="pd_FrpId" value="1101" checked />
                        &nbsp;<img src="/Public/Home/images/bank/nongye.gif"/></td>
                      <td><input name="pd_FrpId" type="radio" value="1100" />
                        &nbsp;<img src="/Public/Home/images/bank/gongshang.gif" /></td>
                      <td><input name="pd_FrpId" type="radio" value="1106">
                        &nbsp;<img src="/Public/Home/images/bank/jianshe.gif" /></td>
                    </tr>
                    <tr>
                      <td><input name="pd_FrpId" type="radio" value="1108"/>
                        &nbsp;<img src="/Public/Home/images/bank/jiaotong.gif" /></td>
                      <td><input name="pd_FrpId" type="radio" value="1107">
                        &nbsp;<img src="/Public/Home/images/bank/zhongguo.gif" /></td>
                      <td><input name="pd_FrpId" type="radio" value="1102">
                        &nbsp;<img src="/Public/Home/images/bank/zhaohang.gif" /></td>
                    </tr>
                    <tr class="b_rig">
                      <td><input name="pd_FrpId" type="radio" value="1110">
                        &nbsp;<img src="/Public/Home/images/bank/minsheng.gif" /></td>
                      <td><input name="pd_FrpId" type="radio" value="1112">
                        &nbsp;<img src="/Public/Home/images/bank/guangda.gif" /></td>
                      <td><input name="pd_FrpId" type="radio" value="1103" >
                        &nbsp;<img src="/Public/Home/images/bank/xingye.gif" /></td>
                    </tr>
                    <tr class="b_rig">
                      <td><input name="pd_FrpId" type="radio" value="1104">
                        &nbsp;<img src="/Public/Home/images/bank/zhongxin.gif" /></td>
                      <td><input name="pd_FrpId" type="radio" value="1121"/>
                        &nbsp;<img src="/Public/Home/images/bank/pingan.gif" /></td>
                      <td><input name="pd_FrpId" type="radio" value="1111">
                        &nbsp;<img src="/Public/Home/images/bank/huaxia.gif" /></td>
                    </tr>
                    <tr class="b_rig">
                      <td><input name="pd_FrpId" type="radio" value="1109">
                        &nbsp;<img src="/Public/Home/images/bank/shangpufa.gif" /></td>
                      <td><input name="pd_FrpId" type="radio" value="1114">
                        &nbsp;<img src="/Public/Home/images/bank/gdb.gif" /></td>
                      <td><input name="pd_FrpId" type="radio" value="1119">
                        &nbsp;<img src="/Public/Home/images/bank/youzheng.gif" /></td>
                    </tr>
                  </table>
                </div></td>
            </tr>
            <tr>
              <td height="40" colspan="2" align="right"><div align="center"><span style="color:#FF0000">注意：付款后请等待系统自动跳转到提示交易成功的页面。</span></div></td>
            </tr>
            <tr>
              <td height="35" align="right">&nbsp;</td>
              <td height="40" align="left" valign="middle">&nbsp;&nbsp;
                <input type="submit" value="马上冲值" name="SubTran" class=" btn btn-default anniu_01" id="SubTran" />
                </td>
            </tr>
						<table width="96%" border="0" cellpadding="0" cellspacing="5" style="position:absolute; margin-left:200px ; margin-top:380px;">
          <tr >
            <td align="left" style="padding-top:10px;"><strong class="STYLE1">在线冲值说明：</strong></td>
          </tr>
          <tr>
            <td align="left"><span class="font-hblack"><span >
              <div style=" line-height:22px; font-size:12px;"> (1).请按表格填写准确的在线冲值信息,确认提交后会进入选择的银行进行在线付款! </div>
              <div style=" line-height:22px;font-size:12px;"> (2).交易成功后请点击返回支付网站可以查看您的订单信息! </div>
              <div style=" line-height:22px;font-size:12px;"> (3).如有任何疑问,您可以联系 在线客服,{$config['name']}为您提供365天×24小时不间断的友善和专业客户咨询服务! </div>
              <div style=" line-height:22px;font-size:12px;"> (4).注意：充值成功后，请不要急着关闭支付成功的跳转页面，否则有可能不会到帐。 </div>
              <div style=" line-height:22px;font-size:12px;"> (5).如需网银汇款/ATM转账或支付宝存款，请联系在线客服索取存款账号！ </div>
              </span> </span></td>
          </tr>
        </table>

          </table>
          <input type="hidden" name="pa_MP" id="pa_MP" value="<?=$rows['username']?>" />
          <input size="50" type="hidden" name="pr_NeedResponse" id="pr_NeedResponse" value="1" />
        </form>
        <!--<table width="96%" border="0" cellpadding="0" cellspacing="5">
          <tr >
            <td align="left" style="padding-top:10px;"><strong class="STYLE1">在线冲值说明：</strong></td>
          </tr>
          <tr>
            <td align="left"><span class="font-hblack"><span >
              <div style=" line-height:22px; font-size:12px;"> (1).请按表格填写准确的在线冲值信息,确认提交后会进入选择的银行进行在线付款! </div>
              <div style=" line-height:22px;font-size:12px;"> (2).交易成功后请点击返回支付网站可以查看您的订单信息! </div>
              <div style=" line-height:22px;font-size:12px;"> (3).如有任何疑问,您可以联系 在线客服,皇冠现金网为您提供365天×24小时不间断的友善和专业客户咨询服务! </div>
              <div style=" line-height:22px;font-size:12px;"> (4).注意：充值成功后，请不要急着关闭支付成功的跳转页面，否则有可能不会到帐。 </div>
              <div style=" line-height:22px;font-size:12px;"> (5).如需网银汇款/ATM转账或支付宝存款，请联系在线客服索取存款账号！ </div>
              </span> </span></td>
          </tr>
        </table>-->


<!--新加-->
        </div>
        <!--    <img src="/Public/Home/2h.jpg" />-->
</div>
  <!--<div style="margin-top: 3px;" class="entrustTen lasttenorder">
		<div class="Tentitle">

			<span class="lightblue4">充值记录</span>
		</div>
		<div class="coinBoxBody">
			<table width="100%">
				<tbody>
					<tr>	
							<th width="190">订单号</th>
							<th width="190">时间</th>
							<th width="180">充值方式</th>
							<th width="180">金额</th>
							<th width="180">状态</th>
						
						</tr>
					<volist name="list" id="vo" empty="$empty">
					<tr>
					  <td>{$vo.tradeno} </td>
                    <td>{$vo.ctime|date="Y-m-d H:i:s",###}</td>
                     <td>支付宝手动充值</td>
                     <td>{$vo['num']}</td>
                    <td>{$vo.status_fill}</td>
					
					</tr>
					</volist>
				</tbody>
			</table>
		</div>

		<div class="page">
			<ul>
			<li><a href="{$path}/Fill/zhifu_add/page/1">首页</a></li>
			<li><a href="{$path}/Fill/zhifu_add/page/{$page-1}">上一页</a></li>
			<li><a href="{$path}/Fill/zhifu_add/page/{$page+1}">下一页</a></li>
			<li><a href="{$path}/Fill/zhifu_add/page/{$page_num}">尾页</a></li>
			</ul>
		</div>
	</div>-->
</div>
</div>
<div class="clear"></div>
		</div>
		<div class="clear"></div>
	</div>


<script>
		/*var $ = function(Id){
            return document.getElementById(Id);
        }*/
    
       
        //数字验证 过滤非法字符
        function clearNoNum(obj){
	        //先把非数字的都替换掉，除了数字和.
	        obj.value = obj.value.replace(/[^\d.]/g,"");
	        //必须保证第一个为数字而不是.
	        obj.value = obj.value.replace(/^\./g,"");
	        //保证只有出现一个.而没有多个.
	        obj.value = obj.value.replace(/\.{2,}/g,".");
	        //保证.只出现一次，而不能出现两次以上
	        obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
	        if(obj.value != ''){
	        var re=/^\d+\.{0,1}\d{0,2}$/;
                  if(!re.test(obj.value))   
                  {   
			          obj.value = obj.value.substring(0,obj.value.length-1);
			          return false;
                  }else{
					  $("#p3_my").val($("#p3_Amt").val()/6.5);
				  }
	        }
        }
<!--
//去掉空格
function check_null(string) { 
var i=string.length;
var j = 0; 
var k = 0; 
var flag = true;
while (k<i){ 
if (string.charAt(k)!= " ") 
j = j+1; 
k = k+1; 
} 
if (j==0){ 
flag = false;
} 
return flag; 
}
function VerifyData() {
alert();
var min_num={$config.pay_min_money};
if (document.form1.p3_Amt.value == "") {
			alert("请输入存款金额！")
			document.form1.p3_Amt.focus();
			return false;
}
if (document.form1.p3_Amt.value !="") {
		  if(document.form1.p3_Amt.value <min_num )
		  {
			alert("充值不能小于".min_num."元！")
			document.form1.p3_Amt.focus();
			return false;
		  }
}
}
function url(s){
location.href="<?=substr($_SERVER['HTTP_REFERER'],0,strlen($_SERVER['HTTP_REFERER'])-12) ?>/"+s;
}

</script>
<include file="App/Home/View/Public/footer.html"/>

61:F:\git\coin\bisheng commerce\App\Home\View\Finance\index.html
<include file="App/Home/View/Public/header.html"/>
    <!--top end-->
	<style>
	table tr td{border-bottom:1px solid #e1e1df;}	
	</style>
	<style>
.raise_list tr:hover{
	background-color:#FFE9D2;
	}
	
</style>
<div id="main">
	<div class="main_box">
		<include file="App/Home/View/Public/left.html"/>
		<div class="raise right clearfix">
            <div class="ybc_list">
	<div class="ybcoin clearfix">
		<h2 class="left">财务日志</h2>
		
	</div>
		<table class="raise_list" style="border:1px solid #e1e1df;" id="Transaction" align="center" border="0" cellpadding="0" cellspacing="0">
			<thead>
			<tr>
				<th>类型</th>
				<th>说明</th>
				<th>变动资金</th>
				<th>支出/收入</th>
		
				<th>币种</th>
				<th>成交时间</th>
			
			</tr>
			</thead>
			<tbody>
			<volist name="list" id="vo">
			<tr>
				<td>{$vo.typename}</td>
				<td>{$vo.content}</td>
				<td>{$vo.money}</td>
				<td><eq name="vo.money_type" value="1"><span style="color:#393">收入</span><else/><span style="color:#e55600">支出</span></eq></td>
	
				<td>{$vo.currency_name}</td>
				<td>{$vo.add_time|date="Y-m-d",###}</td>
			
			</tr>
			</volist>
			</tbody>
									
		</table>
		<div class="page" style=" min-width:200px !important; float:right;">
                    {$page}
              </div>
	</div>
		</div>
		<div class="clear"></div>
	</div>
</div> 
<script>
$(".menu13").addClass("uc-current");
</script>   
<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>
<!--footer end-->


62:F:\git\coin\bisheng commerce\App\Home\View\Help\index.html
<include file="App/Home/View/Public/header.html"/>
    <!--top end-->
    <link rel="shortcut icon" href="http://www.jubi.com/favicon.ico" type="image/x-icon">

	<script src="_PUBLIC__/Home/js/script.js"></script>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">                                         
</head>
<body>
<div class="autobox">
    <div class="now">

        <a href="{:U('Index/index')}" class="orange">首页</a> &gt;<a href="{:U('Help/index',array('id'=>60))}" class="orange"> 帮助中心 </a>
		<notempty name="art_one.title">&gt;<a class="orange">{$art_one.title}</a></notempty>

    </div>
    <div class="assets_center clear po_re zin70">
        <!--左侧菜单-->
        <div class="coin_menu">

            	<volist name="art_list" id="vo">
                <dl>
                    <dt >{$vo.name}</dt>
                    <div class="dl_menu" style="display:block">
                    	<volist name="vo['children']" id="vos">
                            <dd class=""><em></em><a href="{:U('Help/index',array('article_id'=>$vos['article_id']))}">{$vos.title}</a></dd>  
                    	</volist>
                    </div>
                </dl>
                </volist>

        </div>

        <!--右侧内容-->
        <div class="assets_content zhinan w753 right bg_w mh1500">

          <h1>{$art_one.title}</h1>
            
            <div class="about_text">
             {$art_one.content}
            </div>
      </div>
    </div>
</div>

<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>
<!--footer end-->

63:F:\git\coin\bisheng commerce\App\Home\View\Index\index.html
<include file="App/Home/View/Public/header.html"/>

<!--top end-->
<!--header end-->
<style>
.pull-left{ float:left;}
.pull-right{ float:right;}
.link a{ color:#000;}
.link{ margin:0px auto; width:100%;}

</style>
<script type="text/javascript" src="__PUBLIC__/Home/js/focus.js"></script>
<script type="text/javascript" src="__PUBLIC__/Home/js/Fnc.js"></script>
<script type="text/javascript" src="__PUBLIC__/Home/js/zc.js"></script>
<script type="text/javascript" src="__PUBLIC__/Home/js/1.js"></script>
<script type="text/javascript" src="__PUBLIC__/Home/js/bootstrap.js"></script>
<script type="text/javascript" src="__PUBLIC__/Home/js/jquery.flexslider-min.js"></script>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/hb_index.css">
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/zc.css">
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/flexslider.css">
<link rel="shortcut icon" href="1.ico" />
<!--banner start-->
<div style="height:360px; width:100%; position:relative; overflow:hidden; min-width:1200px;">

<div>
	<div class="flexslider">
		<ul class="slides">
			<volist name='flash' id='vo'>
            	<li><a href="http://{$vo.jump_url|default='#'}" target="_blank"><img src="{$vo.pic}" alt="{$vo.title}" style="height:320px;"></a></li>
            </volist>
		</ul>
	</div>
	<div class="ybcoin_volume">
		<div style="color:#fff;">
			<p style=" font-size:16px; margin-bottom:5px; text-align: center;">风险提示</p>
			<p style=" font-size:12px; line-height:22px;">{$config.risk_warning}</p>
		</div>
					<div class="news_coin"><empty name="member"><a href="{:U('Login/index')}">立即登录</a><else/><a href="{:U('User/index')}">我的账户</a></empty></div>
			<p class="coin_reg"><empty name="member"><a href="{:U('Reg/reg')}" class="left">免费注册</a><!-- <a href="{:U('Oauth/index',array('type'=>'qq'))}" class="right">QQ登录  </a> --><else/></empty><a href="{:U('Dow/newcoin')}" class="right">我要上新币</a></p>
			</div>
</div>
</div>
<!--banner end-->
<div class="ybcoin_section clearfix" style="border:0;">
    <!--币币交易开始-->
    <div id="tags_coin" class="coinarea left" style="position:relative;">
        <!--<ul id="tags" class="for_coin">
            <li class="selectTag"><a onmouseover="selectTag('tagContent0',this)">对CNY交易区</a></li>
            <li><a onmouseover="selectTag('tagContent3',this)">对TRMB交易区</a></li>
            </ul>
        -->
        <div class="bgcolor" style="display:none;"></div>
        <div style="margin-top:30px;" id="tagContent">
            <!-- 对CNY交易区 结束-->
            <div class="tagContent selectTag" id="tagContent0">
                 <p style="color:#f00; font-size:14px; margin-bottom:10px;">{$config.friendship_tips}</p>
                <table class="coin_list coinarea" border="0" cellpadding="0" cellspacing="0">
                    <thead>
                    <tr>
                        <th>&nbsp;</th>
                        <th style="text-align:left;">币  名</th>
                        <th class="header">最新价格(CNY)</th>
                        <th class="header">24H成交量</th>
                        <th class="header">24H成交额(CNY)</th>
                        <th class="header">总市值(CNY)</th>
                        <th class="header">24H涨跌</th>
                        <th class="header">7D涨跌</th>
                    </tr>
                    </thead>
                    <tbody>
                    <volist name='currency' id='vo' empty='$empty'>
                        <tr class="coin_num">
                            <td><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}"><img src="{$vo.currency_logo}" style="width:20px; height:20px;"></a></td>
                            <td class="coin_name"><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}">{$vo.currency_name|default='虚拟币'}{$vo.currency_mark|default=''}</a></td>
                            <td><eq name='vo.new_price_status' value='0' ><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}" class="buy"><else/><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}" class="sell"></eq>
                                {$vo.new_price|default='暂无'}<eq name='vo.new_price_status' value='0'>↓<else/>↑</eq></a></td>
                            <td><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}">{$vo.24H_done_num|default='0'}</a></td>
                            <td><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}">{$vo.24H_done_money|default='0'}</a></td>
                            <td><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}">{$vo.currency_all_money|default='0'}</a></td>
                            <td><gt name='vo.24H_change' value='0'><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}" class="sell"><else/><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}" class="buy"></gt>{$vo.24H_change|default='0'}%</a></td>
                            <td><gt name='vo.7D_change' value='0'><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}" class="sell">+<else/><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}" class="buy"></gt>{$vo.7D_change|default='0'}%</a></td>
                        </tr>
                    </volist>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <!--币币交易结束-->
    <div class="right coin_news">
        <div class="news_title clearfix">
            <h2 class="left">官方公告</h2>
            <a href="{:U('Art/index',array('id'=>'1'))}" class="right">更多</a>
        </div>
        <ul>
            <volist name="info_red1" id="vo_red1">
                <li>
                    <a href="{:U('Art/details',array('id'=>$vo_red1['article_id']))}">
                        <span class="coin_news_title left" style="color:red;font-weight:bold;">{$vo_red1.title}</span>
                        <span class="right">{$vo_red1.add_time|date='m-d',###}</span>
                    </a>
                </li>
            </volist>
            <volist name="info1" id="vo1">
                <li>
                    <a href="{:U('Art/details',array('id'=>$vo1['article_id']))}">
                        <span class="coin_news_title left">{$vo1.title}</span>
                        <span class="right">{$vo1.add_time|date='m-d',###}</span>
                    </a>
                </li>
            </volist>
        </ul>
        <div class="news_title clearfix" style="margin-top:20px;">
            <h2 class="left">市场动态</h2>
            <a href="{:U('Art/index',array('id'=>'2'))}" class="right">更多</a>
        </div>
        <ul>
        <volist name="info_red2" id="vo_red2">
        
            <li>
                <a href="{:U('Art/details',array('id'=>$vo_red2['article_id']))}">
                    <span class="coin_news_title left" style="color:red;font-weight:bold;">{$vo_red2.title}</span>
                    <span class="right">{$vo_red2.add_time|date='m-d',###}</span>
                </a>
            </li>
        </volist>
        </ul>
        <ul>
            <volist name="info2" id="vo2">
                <li><a href="{:U('Art/details',array('id'=>$vo2['article_id']))}"><span class="coin_news_title left">{$vo2.title}</span><span class="right">{$vo2.add_time|date='m-d',###}</span></a></li>
            </volist>
        </ul>
        <!--<div style="margin-top:20px;"><a href="https://www.gemwallet.com/" target="_blank"><img src="images/coin_gemwallet.jpg" alt="竞付宝"></a></div>-->
    </div>
</div>
<div class="index_box_2 slogan" style="width:1200px; margin:0px auto; margin-top:30px;">

    <div class="slogan_title">选择{$config.name|default='虚拟网'},安全可信赖</div>
        <div class="slogan_tis">累计交易额:<span id="yi"><span>{$sum_money|default='0'}</span></div>
        <div id="cumulative">
          <div class="number_box">
             <volist name="arr" id="vo" key="key">
                 <div <if condition=" $key%3 eq 0 && $key%12 eq 0  ">class="unit add_f"
                        <elseif condition=" $key%3 eq 0 "/>class="unit add_w"
                        <else/>class="unit"
                    </if> >
                     <div class="top"><span>{$vo}</span></div>
                     <div style="" class="top"><span>{$vo}</span></div>
                     <div class="btm"><span>{$vo}</span></div>
                     <div style="transform: rotateX(0deg);" class="btm"><span>{$vo}</span></div>
                 </div>
             </volist>



        <!--<div class="unit add_f">-->
        <!--<div class="top"><span>3</span></div>-->
        <!--<div style="" class="top"><span>3</span></div>-->
        <!--<div class="btm"><span>3</span></div>-->
        <!--<div style="transform: rotateX(0deg);" class="btm"><span>3</span></div>-->
        <!--</div>-->
        <!--<div class="unit ">-->
        <!--<div class="top"><span>6</span></div>-->
        <!--<div style="" class="top"><span>6</span></div>-->
        <!--<div class="btm"><span>6</span></div>-->
        <!--<div style="transform: rotateX(0deg);" class="btm"><span>6</span></div>-->
        <!--</div>-->
        <!--<div class="unit ">-->
        <!--<div class="top"><span>8</span></div>-->
        <!--<div style="" class="top"><span>8</span></div>-->
        <!--<div class="btm"><span>8</span></div>-->
        <!--<div style="transform: rotateX(0deg);" class="btm"><span>8</span></div>-->
        <!--</div>-->
        <!--<div class="unit add_w">-->
        <!--<div class="top"><span>7</span></div>-->
        <!--<div style="" class="top"><span>7</span></div>-->
        <!--<div class="btm"><span>7</span></div>-->
        <!--<div style="transform: rotateX(0deg);" class="btm"><span>7</span></div>-->
        <!--</div>-->
        <!--<div class="unit ">-->
        <!--<div class="top"><span>4</span></div>-->
        <!--<div style="" class="top"><span>4</span></div>-->
        <!--<div class="btm"><span>4</span></div>-->
        <!--<div style="transform: rotateX(0deg);" class="btm"><span>4</span></div>-->
        <!--</div>-->
        <!--<div class="unit ">-->
        <!--<div class="top"><span>7</span></div>-->
        <!--<div style="" class="top"><span>7</span></div>-->
        <!--<div class="btm"><span>7</span></div>-->
        <!--<div style="transform: rotateX(0deg);" class="btm"><span>7</span></div>-->
        <!--</div>-->
        <!--<div class="unit add_w">-->
        <!--<div class="top"><span>9</span></div>-->
        <!--<div style="" class="top"><span>9</span></div>-->
        <!--<div class="btm"><span>9</span></div>-->
        <!--<div style="transform: rotateX(0deg);" class="btm"><span>9</span></div>-->
        <!--</div>-->
        <!--<div class="unit ">-->
        <!--<div class="top"><span>9</span></div>-->
        <!--<div style="" class="top"><span>9</span></div>-->
        <!--<div class="btm"><span>9</span></div>-->
        <!--<div style="transform: rotateX(0deg);" class="btm"><span>9</span></div>-->
        <!--</div>-->
        <!--<div class="unit ">-->
        <!--<div class="top"><span>5</span></div>-->
        <!--<div style="" class="top"><span>5</span></div>-->
        <!--<div class="btm"><span>5</span></div>-->
        <!--<div style="transform: rotateX(0deg);" class="btm"><span>5</span></div>-->
        <!--</div>-->

        <!--<div class="unit add_w">-->
        <!--<div class="top"><span>3</span></div>-->
        <!--<div style="" class="top"><span>3</span></div>-->
        <!--<div class="btm"><span>3</span></div>-->
        <!--<div style="transform: rotateX(0deg);" class="btm"><span>3</span></div>-->
        <!--</div>-->
        <!--<div class="unit ">-->
        <!--<div class="top"><span>5</span></div>-->
        <!--<div style="" class="top"><span>5</span></div>-->
        <!--<div class="btm"><span>5</span></div>-->
        <!--<div style="transform: rotateX(0deg);" class="btm"><span>5</span></div>-->
        <!--</div>-->
        <!--<div class="unit ">-->
        <!--<div class="top"><span>8</span></div>-->
        <!--<div style="" class="top"><span>8</span></div>-->
        <!--<div class="btm"><span>8</span></div>-->
        <!--<div style="transform: rotateX(0deg);" class="btm"><span>8</span></div>-->
        <!--</div>-->



    </div>
</div>
</div>
<script type="text/javascript" src="__PUBLIC__/Home/js/coinindex.js"></script>
<script type="text/javascript" src="__PUBLIC__/Home/js/tab.js"></script>
<script type="text/javascript" src="__PUBLIC__/Home/js/slide.js"></script>
<script type="text/javascript" src="__PUBLIC__/Home/js/hb_lang.js"></script>
<script type="text/javascript" src="__PUBLIC__/Home/js/hb_sea.js"></script>
<script type="text/javascript" src="__PUBLIC__/Home/js/hb_hm.js"></script>
<script src="%EF%BF%A52717.80%20_%20%E3%80%90%E7%81%AB%E5%B8%81%E3%80%91%E8%99%9A%E6%8B%9F%E8%B4%A7%E5%B8%81%E4%BA%A4%E6%98%93_%E6%AF%94%E7%89%B9%E5%B8%81%E4%BA%A4%E6%98%93%E5%B9%B3%E5%8F%B0_%E8%99%9A%E6%8B%9F%E5%B8%81%E8%8E%B1%E7%89%B9%E5%B8%81_%E6%AF%94%E7%89%B9%E5%B8%81%E5%AE%98%E7%BD%91_files/page_glb_var.js"></script>
<script>
    seajs.use("dist/page_index");
    /**/
    function change_vcode(e) {
        e.src = "/account/captcha?" + Math.random();
    }
    /**/

</script>

<script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?18784dd00dc1c9774528d08ae7943072";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>
<!-- 成功案例 -->
<!--<div class="success-project">
    <div class="page-view">
         <div class="row">
           <p class="sp-title">众筹</p>
        </div>
        <div class="row" style="overflow: hidden;position: relative;">
            <span class="sp-prev"><img src="__PUBLIC__/Home/images/suc_left_arrow.png"></span>
            <span class="sp-next"><img src="__PUBLIC__/Home/images/suc_right_arrow.png"></span>

            <div class="sp-view">
            <volist name="issue_list" id="vo">
                <div style="width: 400px;" class="sp-wrap">
                    <div class="sp-box">
                        <a href="{:U('Zhongchou/details',array('id'=>$vo['id']))}" target="_blank">
                            <div class="sp-info">
                                <div class="pull-right pull-right1">
                                    <h4 style="font-weight: normal;font-size: 16px">{$vo['title']|mb_substr=###,0,8,'utf-8'}</h4>

                                    <p style="font-size: 12px;">{$vo['name']}</p>
                                </div>
                                <img src="{$vo['url1']}" style="width: 82px;height: 82px;">
                                <!--                                    <img src="--><!--" style="width: 82px;height: 82px;">-->
                   <!-- </div> 
                        </a>

                        <div class="sp-step">
                            <div class="pull-left sp-time">
                                <p><span>{$vo['end_time']|date="Y-m-d",###}</span></p>
                                <p><span>{$vo['add_time']|date="Y-m-d",###}</span></p>
                                <p><span>{$vo['ctime']|date="Y-m-d",###}</span></p>
                            </div>
                            <div class="pull-right">
                                <p>众筹完成</p>
                                <p>众筹开始</p>
                                <p>初创项目</p>
                            </div>
                        </div>
                    </div>
                </div>
            </volist>
                <!--<div style="width: 400px;" class="sp-wrap">-->
                    <!--<div class="sp-box">-->
                        <!--<a href="https://www.yuanbaohui.com/project_index/?id=209" target="_blank">-->
                            <!--<div class="sp-info">-->
                                <!--<div class="pull-right pull-right1">-->
                                    <!--<h4 style="font-weight: normal;font-size: 16px">第二次元宝币与太一股认...</h4>-->

                                    <!--<p style="font-size: 12px;">元宝币兑换太一股</p>-->
                                <!--</div>-->
                                <!--<img src="__PUBLIC__/Home/images/c3aa0c2605711db444b4fbf2fd235b4a.png" style="width: 82px;height: 82px;">-->
                                <!--&lt;!&ndash;                                    <img src="&ndash;&gt;&lt;!&ndash;" style="width: 82px;height: 82px;">&ndash;&gt;-->
                            <!--</div>-->
                        <!--</a>-->

                        <!--<div class="sp-step">-->
                            <!--<div class="pull-left sp-time">-->
                                <!--<p><span>2015-08-12</span></p>-->
                                <!--<p><span>2015-08-10</span></p>-->
                                <!--<p><span>2015-07-30</span></p>-->
                            <!--</div>-->
                            <!--<div class="pull-right">-->
                                <!--<p>众筹完成</p>-->
                                <!--<p>众筹开始</p>-->
                                <!--<p>初创项目</p>-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                <!--</div>-->
                <!---->
                <!--<div style="width: 400px;" class="sp-wrap">-->
                    <!--<div class="sp-box">-->
                        <!--<a href="https://www.yuanbaohui.com/project_index/?id=201" target="_blank">-->
                            <!--<div class="sp-info">-->
                                <!--<div class="pull-right pull-right1">-->
                                    <!--<h4 style="font-weight: normal;font-size: 16px">首次元宝币与太一股（A...</h4>-->

                                    <!--<p style="font-size: 12px;">测试兑换</p>-->
                                <!--</div>-->
                                <!--<img src="__PUBLIC__/Home/images/d5b42c5e728e4f80623198daa636fb73.png" style="width: 82px;height: 82px;">-->
                                <!--&lt;!&ndash;                                    <img src="&ndash;&gt;&lt;!&ndash;" style="width: 82px;height: 82px;">&ndash;&gt;-->
                            <!--</div>-->
                        <!--</a>-->

                        <!--<div class="sp-step">-->
                            <!--<div class="pull-left sp-time">-->
                                <!--<p><span>2015-06-23</span></p>-->
                                <!--<p><span>2015-06-18</span></p>-->
                                <!--<p><span>2015-06-17</span></p>-->
                            <!--</div>-->
                            <!--<div class="pull-right">-->
                                <!--<p>众筹完成</p>-->
                                <!--<p>众筹开始</p>-->
                                <!--<p>初创项目</p>-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                <!--</div>-->
                <!--<div style="width: 400px;" class="sp-wrap">-->
                    <!--<div class="sp-box">-->
                        <!--<a href="https://www.yuanbaohui.com/project_index/?id=191" target="_blank">-->
                            <!--<div class="sp-info">-->
                                <!--<div class="pull-right">-->
                                    <!--<h4 style="font-weight: normal;font-size: 16px">OKDICE数学概率二...</h4>-->

                                    <!--<p style="font-size: 12px;">OKDICE是纯数学随机数的骰子游戏</p>-->
                                <!--</div>-->
                                <!--<img src="__PUBLIC__/Home/images/b0548d0ea80e93784d36e03a004ba09e.png" style="width: 82px;height: 82px;">-->
                                <!--&lt;!&ndash;                                    <img src="&ndash;&gt;&lt;!&ndash;" style="width: 82px;height: 82px;">&ndash;&gt;-->
                            <!--</div>-->
                        <!--</a>-->

                        <!--<div class="sp-step">-->
                            <!--<div class="pull-left sp-time">-->
                                <!--<p><span>2015-05-18</span></p>-->
                                <!--<p><span>2015-04-30</span></p>-->
                                <!--<p><span>2015-04-27</span></p>-->
                            <!--</div>-->
                            <!--<div class="pull-right">-->
                                <!--<p>众筹完成</p>-->
                                <!--<p>众筹开始</p>-->
                                <!--<p>初创项目</p>-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                <!--</div>-->
                <!--<div style="width: 400px;" class="sp-wrap">-->
                    <!--<div class="sp-box">-->
                        <!--<a href="https://www.yuanbaohui.com/project_index/?id=9" target="_blank">-->
                            <!--<div class="sp-info">-->
                                <!--<div class="pull-right">-->
                                    <!--<h4 style="font-weight: normal;font-size: 16px">元宝汇</h4>-->

                                    <!--<p style="font-size: 12px;">元宝网，第一数字货币众筹交易平台</p>-->
                                <!--</div>-->
                                <!--<img src="__PUBLIC__/Home/images/917bbfbcc932a39eca211ec8e89d09d7.png" style="width: 82px;height: 82px;">-->
                                <!--&lt;!&ndash;                                    <img src="&ndash;&gt;&lt;!&ndash;" style="width: 82px;height: 82px;">&ndash;&gt;-->
                            <!--</div>-->
                        <!--</a>-->

                        <!--<div class="sp-step">-->
                            <!--<div class="pull-left sp-time">-->
                                <!--<p><span>2014-06-01</span></p>-->
                                <!--<p><span>2014-05-01</span></p>-->
                                <!--<p><span>2014-04-13</span></p>-->
                            <!--</div>-->
                            <!--<div class="pull-right">-->
                                <!--<p>众筹完成</p>-->
                                <!--<p>众筹开始</p>-->
                                <!--<p>初创项目</p>-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                <!--</div>-->
                <!--<div style="width: 400px;" class="sp-wrap">-->
                    <!--<div class="sp-box">-->
                        <!--<a href="https://www.yuanbaohui.com/project_index/?id=48" target="_blank">-->
                            <!--<div class="sp-info">-->
                                <!--<div class="pull-right">-->
                                    <!--<h4 style="font-weight: normal;font-size: 16px">币涨投资基金</h4>-->

                                    <!--<p style="font-size: 12px;">实时监测元宝汇、btctrade、比特时代等涉及元宝币交易的正规平台交易行情</p>-->
                                <!--</div>-->
                                <!--<img src="__PUBLIC__/Home/images/06df42e485da1f44cee4c8886ac2ed95.png" style="width: 82px;height: 82px;">-->
                                <!--&lt;!&ndash;                                    <img src="&ndash;&gt;&lt;!&ndash;" style="width: 82px;height: 82px;">&ndash;&gt;-->
                            <!--</div>-->
                        <!--</a>-->

                        <!--<div class="sp-step">-->
                            <!--<div class="pull-left sp-time">-->
                                <!--<p><span>2014-08-21</span></p>-->
                                <!--<p><span>2014-07-21</span></p>-->
                                <!--<p><span>2014-04-24</span></p>-->
                            <!--</div>-->
                            <!--<div class="pull-right">-->
                                <!--<p>众筹完成</p>-->
                                <!--<p>众筹开始</p>-->
                                <!--<p>初创项目</p>-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                <!--</div>-->
                <!--<div style="width: 400px;" class="sp-wrap">-->
                    <!--<div class="sp-box">-->
                        <!--<a href="https://www.yuanbaohui.com/project_index/?id=187" target="_blank">-->
                            <!--<div class="sp-info">-->
                                <!--<div class="pull-right">-->
                                    <!--<h4 style="font-weight: normal;font-size: 16px">免费VPN币分发投资</h4>-->

                                    <!--<p style="font-size: 12px;">免费机会仅此一次</p>-->
                                <!--</div>-->
                                <!--<img src="__PUBLIC__/Home/images/d09a0420c556744cc948a0cbc7cf21bd.png" style="width: 82px;height: 82px;">-->
                                <!--&lt;!&ndash;                                    <img src="&ndash;&gt;&lt;!&ndash;" style="width: 82px;height: 82px;">&ndash;&gt;-->
                            <!--</div>-->
                        <!--</a>-->

                        <!--<div class="sp-step">-->
                            <!--<div class="pull-left sp-time">-->
                                <!--<p><span>2015-04-17</span></p>-->
                                <!--<p><span>2015-04-13</span></p>-->
                                <!--<p><span>2015-04-12</span></p>-->
                            <!--</div>-->
                            <!--<div class="pull-right">-->
                                <!--<p>众筹完成</p>-->
                                <!--<p>众筹开始</p>-->
                                <!--<p>初创项目</p>-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                <!--</div>-->
           <!-- </div>
        </div>
    </div>
</div> -->
<!-- 客服信息 -->
<div class="autobox">
    <ul class="web_service clear pl30">
        <li class="w265"><a id="BizQQWPA" href="http://wpa.qq.com/msgrd?v=3&uin={$config['qq1']}&site=qq&menu=yes"><div class="web_service_pic service_1"></div><div class="web_service_pic_num"><p>{$config.qq1|default="暂无"}</p><div class="qqsecvice">在线QQ客服</div></div></a></li>
        <li class="w245"><div class="web_service_pic service_2"></div><div class="web_service_pic_num"><p>{$config.tel|default="暂无"}</p><div>工作日:9-19时 节假日:9-18时</div></div></li>
        <li class="w265"><a href="http://weibo.com/{$config['weibo']}" target="_blank"><div class="web_service_pic service_3"></div><div class="web_service_pic_num"><p>{$config['weibo']|default="暂无"}</p><div>新浪官方微博</div></div></a></li>
        <li><div class="web_service_pic service_4"></div><div class="web_service_pic_num"><p>2群：{$config['qqqun2']|default="暂无"}</p><div class="h_underl">交流QQ群<!--  <a href="javascript:;" class="orange">查看更多</a>   --></div></div></li>
    </ul>
</div>



<div class="safety_tips">
    <div style="border-top:#d8d8d8 dotted 1px;width: 1000px; margin: 0 auto; margin-bottom: 20px;"></div>
    <h3>专业的安全保障</h3>
    <div class="autobox">
        <ul class="safety_tips_ul clear">
            <li>
                <img src="/Public/Home/images/safe_1.jpg" alt="" height="70" width="70">
                <h4>系统可靠</h4>
                <p>银行级用户数据加密、动态身份验证，多级风险识别控制，保障交易安全</p>
            </li>
            <li>
                <img src="/Public/Home/images/safe_2.jpg" alt="" height="70" width="70">
                <h4>资金安全</h4>
                <p>钱包多层加密，离线存储于银行保险柜，资金第三方托管，确保安全</p>
            </li>
            <li>
                <img src="/Public/Home/images/safe_3.jpg" alt="" height="70" width="70">
                <h4>快捷方便</h4>
                <p>充值即时、提现迅速，每秒万单的高性能交易引擎，保证一切快捷方便</p>
            </li>
            <li>
                <img src="/Public/Home/images/safe_4.jpg" alt="" height="70" width="70">
                <h4>服务专业</h4>
                <p>专业的客服团队，400电话和24小时在线QQ，VIP一对一专业服务</p>
            </li>
        </ul>
    </div>
</div>
<!--友情链接-->
<div class="link">
    <div class="linkbox">
        <h4>友情链接</h4>
        <ul>
            <volist name = "link_info" id = "vo">
                <li><a target="_blank" href="http://{$vo['url']}" style=" font-size:16px;">{$vo.name}</a> </li>
            </volist>

        </ul>
    </div>
</div>

<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>
<!--footer end-->
<script>
$(function() { 
    $(".flexslider").flexslider({
		directionNav: true,
		pauseOnAction: false
});
});

</script>

64:F:\git\coin\bisheng commerce\App\Home\View\index.html
 

65:F:\git\coin\bisheng commerce\App\Home\View\Login\findPwd.html
<include file="App/Home/View/Public/header.html"/>
<style>
    .top{ border-bottom:0; padding:10px 0;}
    #main{ padding:0;}
    .login_tongyi{ width:1000px; margin:0 auto; border:1px solid #ddd;}
    .ybc_footer{ text-align:center; color:#999; margin:30px 0;}
	 .loginBox .login label.error{
         float:inherit;
         padding-left: 10px;
     }
    .error{
        color: #999;
    }
</style>
<div id="main">
    <div class="mainbody login_tongyi">

        <div class="bigcontainer">
            <div class="left630">
                <h2 class="user">忘记密码</h2>

                <div class="loginBox">
                    <form method="post" id="findPwdForm" action="{:U('Login/findpwd')}" jump-url="{:U('Index/index')}">
                        <!-- 电子邮箱 -->
                        <ul class="login">
                            <li><label for="email">电子邮箱：</label><input type="text" class="loginValue" value="" name="email">
                            </li>
                            <li><label>验证码：</label><input class="loginValue" name="captcha" id="captcha">
                                <img id="captchaimg" src="{:U('Login/showVerify')}">
                                <a href="#" onclick="$('#captchaimg').attr('src', '{:U(\'Login/showVerify\')}?t='+Math.random())">看不清？</a></li>
                            <li style="margin-bottom:15px;"><label>&nbsp;</label><input type="submit" value="找回密码" class="tijiao" style="border:0;"></li>
                            <li><label>&nbsp;</label>已有账号&nbsp;<a href="{:U('Login/index')}">登录</a><span>没有{$config.name|default='本网站'}账号？&nbsp;<a href="{:U('Reg/reg')}" class="zhuce">注册一个</a></span></li>
                        </ul>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $("#findPwdForm").validate({
        rules: {
            email:{
                required:true,
                email:true
            },
            captcha:{
                required:true
            }
        },
        messages: {
            email:{
                required:"邮箱不能为空",
                email:"邮箱格式不正确"
            },
            captcha:{
                required:"验证码不能为空"
            }
        },
        submitHandler:function(form){
            ajax_submit_form(form)
            return false;
        },
        invalidHandler: function() {  //不通过回调
            return false;
        }
    });
</script>

<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>

66:F:\git\coin\bisheng commerce\App\Home\View\Login\index.html
<include file="App/Home/View/Public/header.html"/>
<!--top end-->
<style>
    .top{ border-bottom:0; padding:10px 0;}
    #main{ padding:0;}
    .login_tongyi{ width:1000px; margin:0 auto; border:1px solid #ddd;}
    .ybc_footer{ text-align:center; color:#999; margin:30px 0;}
</style>
<div id="main">
    <div class="login_tongyi">
        <h2 class="user">{$config.name|default="虚拟币"}用户登录</h2>
        <!--<form id="form" method="post" action="{:U('Login/checkLog')}" >  -->
        <form class="form-horizontal m-t"  id="signupForm" jump-url="{:U('Safe/index')}" method="post"  action="{:U('Login/checkLog')}">
            <ul class="login">
                <li><label for="email" class="youxiang">邮箱/手机号：</label>
                    <!--<input style="display:none">--><!-- for disable autocomplete on chrome -->
                    <input name="email" id="email" class="" i="" type="text"><!-- autocomplete="off"/>-->
                    <span class="note" id="emailmsg" style="color:red"></span>
                </li>
                <li><label for="pwd" class="youxiang">密码：</label>
                    <input style="display:none" type="password"><!-- for disable autocomplete on chrome -->
                    <input name="pwd" id="pwd" class="" i="" type="password" onkeyup="KeyDown();"><!-- autocomplete="off"/>-->
                    <span class="note" id="pwdmsg" style="color:red"></span>
                </li>
                <li id="birthcheck" style="margin-bottom:10px;display:none">
                    <label for="captcha" class="youxiang">出生日期：</label>
                    <select name="year" style="width:70px">
                        <option value="1920">1920</option>
                        <option value="1921">1921</option>
                        <option value="1922">1922</option>
                        <option value="1923">1923</option>
                        <option value="1924">1924</option>
                        <option value="1925">1925</option>
                        <option value="1926">1926</option>
                        <option value="1927">1927</option>
                        <option value="1928">1928</option>
                        <option value="1929">1929</option>
                        <option value="1930">1930</option>
                        <option value="1931">1931</option>
                        <option value="1932">1932</option>
                        <option value="1933">1933</option>
                        <option value="1934">1934</option>
                        <option value="1935">1935</option>
                        <option value="1936">1936</option>
                        <option value="1937">1937</option>
                        <option value="1938">1938</option>
                        <option value="1939">1939</option>
                        <option value="1940">1940</option>
                        <option value="1941">1941</option>
                        <option value="1942">1942</option>
                        <option value="1943">1943</option>
                        <option value="1944">1944</option>
                        <option value="1945">1945</option>
                        <option value="1946">1946</option>
                        <option value="1947">1947</option>
                        <option value="1948">1948</option>
                        <option value="1949">1949</option>
                        <option value="1950">1950</option>
                        <option value="1951">1951</option>
                        <option value="1952">1952</option>
                        <option value="1953">1953</option>
                        <option value="1954">1954</option>
                        <option value="1955">1955</option>
                        <option value="1956">1956</option>
                        <option value="1957">1957</option>
                        <option value="1958">1958</option>
                        <option value="1959">1959</option>
                        <option value="1960">1960</option>
                        <option value="1961">1961</option>
                        <option value="1962">1962</option>
                        <option value="1963">1963</option>
                        <option value="1964">1964</option>
                        <option value="1965">1965</option>
                        <option value="1966">1966</option>
                        <option value="1967">1967</option>
                        <option value="1968">1968</option>
                        <option value="1969">1969</option>
                        <option value="1970">1970</option>
                        <option value="1971">1971</option>
                        <option value="1972">1972</option>
                        <option value="1973">1973</option>
                        <option value="1974">1974</option>
                        <option value="1975">1975</option>
                        <option value="1976">1976</option>
                        <option value="1977">1977</option>
                        <option value="1978">1978</option>
                        <option value="1979">1979</option>
                        <option value="1980" selected="selected">1980</option>
                        <option value="1981">1981</option>
                        <option value="1982">1982</option>
                        <option value="1983">1983</option>
                        <option value="1984">1984</option>
                        <option value="1985">1985</option>
                        <option value="1986">1986</option>
                        <option value="1987">1987</option>
                        <option value="1988">1988</option>
                        <option value="1989">1989</option>
                        <option value="1990">1990</option>
                        <option value="1991">1991</option>
                        <option value="1992">1992</option>
                        <option value="1993">1993</option>
                        <option value="1994">1994</option>
                        <option value="1995">1995</option>
                        <option value="1996">1996</option>
                        <option value="1997">1997</option>
                        <option value="1998">1998</option>
                        <option value="1999">1999</option>
                        <option value="2000">2000</option>
                        <option value="2001">2001</option>
                        <option value="2002">2002</option>
                        <option value="2003">2003</option>
                        <option value="2004">2004</option>
                        <option value="2005">2005</option>
                        <option value="2006">2006</option>
                        <option value="2007">2007</option>
                        <option value="2008">2008</option>
                        <option value="2009">2009</option>
                        <option value="2010">2010</option>
                        <option value="2011">2011</option>
                        <option value="2012">2012</option>
                        <option value="2013">2013</option>
                        <option value="2014">2014</option>
                        <option value="2015">2015</option>
                    </select>
                    <select name="month" style="width:70px;">
                        <option selected="selected" value="01">1</option>
                        <option value="02">2</option>
                        <option value="03">3</option>
                        <option value="04">4</option>
                        <option value="05">5</option>
                        <option value="06">6</option>
                        <option value="07">7</option>
                        <option value="08">8</option>
                        <option value="09">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                    </select> 月

                    <select name="day" style="width:70px;">
                        <option selected="selected" value="01">1
                        </option><option value="02">2
                    </option><option value="03">3
                    </option><option value="04">4
                    </option><option value="05">5
                    </option><option value="06">6
                    </option><option value="07">7
                    </option><option value="08">8
                    </option><option value="09">9
                    </option><option value="10">10
                    </option><option value="11">11
                    </option><option value="12">12
                    </option><option value="13">13
                    </option><option value="14">14
                    </option><option value="15">15
                    </option><option value="16">16
                    </option><option value="17">17
                    </option><option value="18">18
                    </option><option value="19">19
                    </option><option value="20">20
                    </option><option value="21">21
                    </option><option value="22">22
                    </option><option value="23">23
                    </option><option value="24">24
                    </option><option value="25">25
                    </option><option value="26">26
                    </option><option value="27">27
                    </option><option value="28">28
                    </option><option value="29">29
                    </option><option value="30">30
                    </option><option value="31">31
                    </option></select> 日
                </li>
                <li style=" width:332px; line-height:22px; padding-left:350px;">
		<span class="note" id="birthmsg" style="color:red; margin:0;">
		
		</span>
                </li>
                <li style="margin-bottom:15px;"><label class="youxiang">&nbsp;</label><input class="denglu" value="登录" style="border:0;" type="button" onclick="checkform()"   ></li>
                <li class="forget" style="margin-bottom:0px;">
                    <label class="youxiang">&nbsp;</label>
                    <a href="{:U('Login/findPwd')}">忘记密码？</a>
                    <span style="margin-left:118px;">没有{$config.name|default="虚拟币"}账号？<a href="{:U('Reg/reg')}" class="zhuce">注册一个</a></span>
                </li>
                <li class="forget" style=" height:30px; line-height:30px;">
                    <label class="youxiang">&nbsp;</label>
                </li>
            </ul>
        </form>
    </div>
</div>
<script>
    vali = {email: 0, pwd: 0};
    $('#email').bind('blur', function(){
        $.post("{:U('Login/checkIp')}",{email:$(this).val()},
                function(d){
                    if(d.status==1){
                        $("#birthcheck").show();
                        $('#birthmsg').html(d.msg);
                    }
                    if(d.status==2){
                        validateMsg('email',d.msg, vali.email = 0);
                    }else{
                        return validateMsg('email', '', vali.email = 1);
                    }
                }, 'json');

    });
    $('#pwd').bind('blur', function(){
        var pLen = $(this).val().length;
        if(pLen < 6 || pLen > 20) return validateMsg('pwd', '密码长度在6-20个字符之间', 0);
        return validateMsg('pwd', '', vali.pwd = 1);
    });
    function checkform(){
        if(vali.email==0){
            $('#email').focus();
            return false;
        }
        if(vali.pwd==0){
            $('#pwd').focus();
            return false;
        }
//        return true;
       $.post("{:U('Login/checkLog')}", $('#signupForm').serialize(),function(data){
		   if(data.status==1){
		   	layer.msg(data['info']);	
		   	window.location.href="{:U('Safe/index')}"
		   }else{
			   layer.msg(data['info']);
			   }
		   
		})
    }
</script>

<script>
function KeyDown()
{
  if (event.keyCode == 13)
  {		
        var pLen = $('#pwd').val().length;
        if(pLen < 6 || pLen > 20) return validateMsg('pwd', '密码长度在6-20个字符之间', 0);
         validateMsg('pwd', '', vali.pwd = 1);
		checkform();
  }
}
</script>
<script src="__PUBLIC__/Home/js/form.js"></script>
<!--<script src="__PUBLIC__/Home/js/form.js?v=1"></script>-->



<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>

67:F:\git\coin\bisheng commerce\App\Home\View\Login\resetpwd.html
<include file="App/Home/View/Public/header.html"/>
<style>
    .loginBox .login label.error{
        float:inherit;
        padding-left: 10px;
    }
    .error{
        color: #999;
    }
</style>
<div class="mainbody">

    <div class="bigcontainer">
        <div class="left630">
            <h2 class="user">重置密码</h2>

            <div class="loginBox">
                <form method="post" id="resetPwdForm"  action="{:U('Login/resetPwd')}" jump-url="{:U('Index/index')}">
                    <ul class="login">
                        <li><label for="email">新密码：</label><input type="password" class="loginValue" id="pwd" name="pwd" value=""></li>
                        <li><label for="email">确认新密码：</label><input type="password" class="loginValue" id="repwd" name="repwd" value=""></li>
                        <li><label for="idcard">身份证号码：</label><input type="text" name="idcard" placeholder="如果账户未实名认证此项可不填"></li>
                        <li><label>验证码：</label><input class="loginValue" name="captcha" id="captcha">
                            <img id="captchaimg" src="{:U('Login/showVerify')}">
                            <a href="#" onclick="$('#captchaimg').attr('src', '{:U(\'Login/showVerify\')}?t='+Math.random())">看不清？</a></li>
                        <li style="margin-bottom:15px;"><label>&nbsp;</label><input type="submit" value="找回密码" class="tijiao" style="border:0;"></li>
                        <li><label>&nbsp;</label>已有账号&nbsp;<a href="{:U('Login/index')}">登录</a><span>没有{$config.name|default='本网站'}账号？&nbsp;<a href="{:U('Reg/reg')}" class="zhuce">注册一个</a></span></li>
                    </ul>
                    <input type="hidden" name="key" value="{$key}"/>
                </form>
            </div>

        </div>
    </div>
</div>
<script>
    $("#resetPwdForm").validate({
        rules: {
            pwd:{
                required:true,
                rangelength:[6,20]
            },
            repwd:{
                required:true,
                rangelength:[6,20],
                equalTo:"#pwd"
            },
            captcha:{
                required:true
            }

        },
        messages: {
            pwd:{
                required:"密码不能为空",
                rangelength:"密码长度在6-20个字符之间"
            },
            repwd:{
                required:"确认密码不能为空",
                rangelength:"密码长度在6-20个字符之间",
                equalTo:"必须和密码一致"
            },
            captcha:{
                required:"验证码不能为空"
            }
        },
        submitHandler:function(form){
            ajax_submit_form(form)
            return false;
        },
        invalidHandler: function() {  //不通过回调
            return false;
        }
    });
</script>

<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>

68:F:\git\coin\bisheng commerce\App\Home\View\Market\index.html
<include file="App/Home/View/Public/header.html"/>

<style>
.greenfont{ color:#039904;}
.coin_footer{ clear:both; padding-top:20px;}
</style>

    <script type="text/javascript"> 
		$(function(){
			$(".pcicon1").on("mouseover",function(){
				$(this).addClass("lbnora").next(".pcicon1box").css({"width":"148px"});
			}).on("mouseout",function(){
				$(this).removeClass("lbnora").next(".pcicon1box").css("width","0px");
			});
			$(".iscion4").on("click",function(){
				$("html, body").animate({
					scrollTop: 0
				})
			});

			var objWin;
			$("#opensq").on("click",function(){
				var top = window.screen.height/2 - 250;
				var left = window.screen.width/2 - 390;
				var target = "http://p.qiao.baidu.com//im/index?siteid=8050707&ucid=18622305"; 
				var cans = 'width=780,height=550,left='+left+',top='+top+',toolbar=no, status=no, menubar=no, resizable=yes, scrollbars=yes' ;

				if((navigator.userAgent.indexOf('MSIE') >= 0)&&(navigator.userAgent.indexOf('Opera') < 0)){
						//objWin = window.open ('','baidubridge',cans) ; 
						if (objWin === undefined || objWin === null || objWin.closed) { 
							objWin = window.open (target,'baidubridge',cans) ; 
						}else { 
							objWin.focus();
						}
				}else{
					var win = window.open('','baidubridge',cans );
					if (win.location.href == "about:blank") {
					    //窗口不存在
					    win = window.open(target,'baidubridge',cans);
					} else {
					    win.focus();
					}
				}
				return false;

			})
		})
		
	</script>
<!--top end-->
<div class="bg_w" style="width: 100%; height: 86px;">
<div class="autobox">
         <div class="all_coin_price">
            <div class="all_coin_show"><a href=""><img src="{$liCurrency.currency_logo}" style="float:left; width:50px;  margin-right:5px;" /><span>{$liCurrency['currency_name']}({$liCurrency['currency_mark']})</span><em></em></a></div>
            <div class="all_coin_list"><div class="all_coin_box"><ul id="all_coin">
			<foreach name="listCurrency" item="vo">
			<li><a href="{:U('Market/index',array('coin'=>$vo['currency_mark']))}"><img src="{$vo.currency_logo}" style="float:left; width:50px; margin-right:5px;" /><div class="all_coin_name"><p>{$vo.currency_name}({$vo['currency_mark']})</p><span>￥{$vo.newPrice}</span></div></a></li>
			</foreach>
			</ul></div></div>
        </div>
        <dl class="all_coin_info">
            <dt id="market-price">{$liCurrency['newPrice']|default =0}</dt>
            <dd><p class="orange" id="market-vrc">{$liCurrency['maxPrice']|default =0}</p>最高价</dd>
            <dd><p class="greenfont" id="market-min" style="color:#039904">{$liCurrency['minPrice']|default =0}</p>最低价</dd>
            <dd><p id="market-buy">{$liCurrency['sellPrice']|default =0}</p>买一价</dd>
            <dd><p id="market-sell">{$liCurrency['buyPrice']|default =0}</p>卖一价</dd>
            <dd class="w150"><p id="market-sum">{$liCurrency['countNum']|default =0}</p>成交量</dd>
        </dl>
    </div>
</div>
</div>
<div class="list-tab-box">
    <ul class="list-tab">
        <!--<li style="margin:0;"><i class="arrow-tab"></i><a href="javascript:void(0);">交易维理币</a></li>-->
        <li class="on"><a href="javascript:void(0);"><i class="arrow-tab"></i>{$liCurrency['currency_name']}行情</a></li>
        <!--<li><a href="javascript:void(0);"><i class="arrow-tab"></i>了解维理币</a></li>
        <li><a href="javascript:void(0);"><i class="arrow-tab"></i>评价维理币</a></li>-->
    </ul>
</div>
<!--头部结束-->
<div id="chart-control" data="vrc" class="tradeinfo" style="">
    <div class="autobox mt20 clear" id="Kline-change" style="margin-top:20px; "></div>
        <!--<div data-highcharts-chart="0" style="background-color: #fff;border:1px solid #ebebeb;padding:30px 20px 20px 10px;margin-bottom:20px;" id="graphbox"><div style="position: relative; overflow: hidden; width: 968px; height: 400px; text-align: left; line-height: normal; z-index: 0; left: 0.5px; top: 0px;" id="highcharts-0" class="highcharts-container"></div></div>-->
        <div class="autobox">
        <div class="left w690" style="position:relative; float:left; ">

            <!--行情图-->
            <script>
                document.write('<s'+'cript src="/js/depth.js?t='+Math.random()+'"></scr'+'ipt>');
            </script><script src="__PUBLIC__/Home/js/depth.js"></script>
            <!--行情图结束-->
            <div class="clear">
                <h3>买卖盘</h3>
                <div style="border:1px solid #ebebeb;overflow: hidden;">
                    <table class="infotable first" style="float:left;width: 6%;" cellpadding="0" cellspacing="0">
                        <thead>
                        <tr>
                            <th>&nbsp;&nbsp;&nbsp;&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody id="infolist">
						
						<for start="0" end="$count">
							<tr><td>{$i+1}</td></tr>
						</for>
						
						
					
						</tbody>
                    </table>
                    <table class="infotable market" cellpadding="0" cellspacing="0">
                        <thead>
                        <tr>
                            <th width="30%">折合(￥)</th>
                            <th width="30%">买入量</th>
                            <th width="30%">买入价(￥)</th>
                        </tr>
                        </thead>
                        <tbody id="infobuylist"> 
						<!-- {$vo.bili} 是百分比 需要的那个值 写的时候直接写入就可以了 带符号% 循环中需要的-->
						<foreach name="sell" item="vo" >
						<tr><td><span>{$vo['price'] * $vo['num']}<i style="font-style:normal;color:#999;"></i></span></td><td><span style="color:#e55600;">{$vo.num}</span></td> <td> <span>{$vo.price}</span><span data-count="504.461" class="deepbar buy" style="margin-top:-10px; width: {$vo.bili};"></span></td>  </tr>
						</foreach >
						</tbody>

                    </table>
                    <table class="infotable market last" cellpadding="0" cellspacing="0">
                        <thead>
                        <tr>
                            <th width="33.3333%">卖出价(￥)</th>
                            <th width="33.3333%">卖出量</th>
                            <th width="33.3333%">折合(￥)</th>
                        </tr>
                        </thead>
                        <tbody id="infoselllist">
						<!-- {$vo.bili} 是百分比 需要的那个值 写的时候直接写入就可以了 带符号%  下面foreach 循环中需要的-->
						<foreach name="buy" item="vo">
                        <tr><td><span>{$vo.price}</span></td><td><span style="color:#690;">{$vo.num}</span></td> <td><span>{$vo['price'] * $vo['num']}<i style="font-style:normal;color:#999;"></i></span><span data-count="1000" class="deepbar sell" style="margin-top:-10px; width: {$vo.bili};"></span></td> </tr>
						</foreach >
                    
                        </tbody>

                    </table>
                </div>

            </div>
        </div>

        <div class="right w290" style="float:right;">
            <h3>最新成交</h3>
            <table class="infotable turnover" cellpadding="0" cellspacing="0">
                <thead>
                <tr>
                    <th width="33.33333%">时间</th> 
                    <th width="33.33333%">价格</th>
                    <th width="33.33333%">数量</th>
                </tr>
                </thead>
                <tbody id="turnover">
				<foreach name="deal" item="vo">
				<tr><td>{$vo.add_time|date="H:i:s",###}</td><eq name="vo['type']" value="sell"> <td class="red"><else/><td class="greenfont"></eq>{$vo.price}</td><td>{$vo.num}</td></tr>
				</foreach>
				</tbody>

            </table>
        </div>
        </div>



    <!--联系方式-->
    
</div>
<script>

$(function () {
	$.get('/Home/Market/getMarket',function(data){
		 $('#Kline-change').highcharts({
        chart: {
            type: 'areaspline'
        },
        title: {
            text: ''
        },
        legend: {
            layout: 'vertical',
            align: 'left',
            verticalAlign: 'top',
            x: 150,
            y: 100,
            floating: true,
            borderWidth: 1,
            backgroundColor: '#FFFFFF'
        },
        xAxis: {
            categories: data['price'],
        
        },
        yAxis: {
            title: {
                text: '{$liCurrency['currency_mark']}'
            }
        },
        tooltip: {
            shared: true,
            valueSuffix: ' CNY'
        },
        credits: {
            enabled: false
        },
        plotOptions: {
            areaspline: {
                fillOpacity: 0.5
            }
        },
        series: [{
            name: '买单',
            data: data['buy']
        }, {
            name: '卖单',
            data: data['sell']
        }]
    });
		
	})
   
});
</script>
    
<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>
<!--footer end-->
<script>
$(".myhome").hover(function(){
	$(".mywallet_list").show();	
},function(){
	$(".mywallet_list").hover(function(){
		$(".mywallet_list").show();	
	},function(){
		$(".mywallet_list").hide();	
	});
	$(".mywallet_list").hide();
});
</script>
<script>
$(".all_coin_show").hover(function(){
	$(".all_coin_list").show();	
},function(){
	$(".all_coin_list").hover(function(){
		$(".all_coin_list").show();	
	},function(){
		$(".all_coin_list").hide();	
	});
	$(".all_coin_list").hide();
});
</script>

69:F:\git\coin\bisheng commerce\App\Home\View\ModifyMember\modify.html
<include file="App/Home/View/Public/header.html"/>
<!--top end-->
<div class="ybc_section">
    <ul class="ybc_user_nav clearfix Font18">
        <li class="current"><span>1</span>邮箱注册</li>
        <li class="current" id="currentpwd"><span>2</span>设置交易密码</li>
        <li class="current"><span>3</span>实名认证</li>
        <li><span>4</span>注册成功</li>
    </ul>
    <div class="ybc_warn Font18">为了确保您的资金安全，请实名认证</div>
    <form id="form" method="post"  jump-url="{:U('Reg/regSuccess')}"  action="{:U('ModifyMember/modify')}">
        <div class="ybc_userarea ybc_userarea2" style="margin-bottom:50px;">
            <div class="ybc_user clearfix">
                <div class="ybc_label left"><label for="nick">昵称</label></div>
                <div class="ybc_text left"><input name="nick" id="nick" value="" type="text"></div>
                <div class="ybc_hint left"><strong class="msg_i">i</strong><span id="nickmsg"><font style="color:red">请输入您的昵称</font></span></div>
            </div>
            <div class="ybc_user clearfix">
                <div class="ybc_label left"><label for="name">真实姓名</label></div>
                <div class="ybc_text left"><input name="name" id="name" value="" onkeyup="value=value.replace(/[^\D]/g,'');" autocomplete="off" maxlength="8" type="text"></div>
                <div class="ybc_hint left"><strong class="msg_i">i</strong><span id="namemsg">真实姓名设置后不能修改，并且与提现账户名相同</span></div>
            </div>
            <div class="ybc_user clearfix">
                <div class="ybc_label left"><label for="cardtype">证件类型</label></div>
                <div class="ybc_text left">
                    <select id="cardtype" name="cardtype">
                        <option value="1" selected="selected">身份证</option>
                        <option value="2">护照</option>
                        <option value="3">军官证</option>
                        <option value="4">其它</option>
                    </select>
                </div>
            </div>
            <div class="ybc_user clearfix">
                <div class="ybc_label left"><label for="idcard">证件号码</label></div>
                <div class="ybc_text left"><input name="idcard" id="idcard" value="" type="text"></div>
                <div class="ybc_hint left"><strong class="msg_i">i</strong><span id="idcardmsg">证件号码注册后不能修改</span></div>
            </div>
            <div class="ybc_user clearfix">
                <div class="ybc_label left"><label for="mo">手机号码</label></div>
                <div class="ybc_text left" style=" line-height:30px; width:209px;">
                    <input name="phone" id="mo" value="" type="text">
                </div>
                <div class="ybc_hint left">
                    <strong class="msg_i">i</strong>
                    <span id="momsg">请输入您的手机号码</span>
                </div>
            </div>
            <div class="ybc_user clearfix">
                <div class="ybc_label left"><label for="code">验证码</label></div>
                <div class="ybc_text left"><input name="code" id="code" value="" type="text"></div>
                <div class="ybc_hint left"><input type="button" class="button" value="点击发送" id="msgt" data-key='on' onclick="sandPhone()"></div>
            </div>
            <!--<input id="avatar" name="avatar" value="/images/ulogodefault.jpg" type="hidden">-->
            <div class="ybc_user clearfix">
                <div class="ybc_label left"><label>&nbsp;</label></div>
                <div class="ybc_text left"><input value="提交" class="ybc_next" type="button" onclick="valiForms()"></div>
            </div>
        </div>
        <div style="font-size:14px; padding-left:180px; line-height:24px; color:#666; margin-bottom:30px;">
            <p>1.真实姓名经实名认证后将不能够更改，请如实填写。</p>
            <p>2.{$config.name|default='本网站'}只接受实名充值，提现时银行等姓名信息必须与您的认证姓名一致。</p>
            <p>3.{$config.name|default='本网站'}有合理的理由怀疑用户提供虚假身份信息时，有权拒绝注册或者冻结、注销已经注册的账户及资产。</p>
        </div>
    </form>
</div>
<script type="text/javascript" src="__PUBLIC__/Home/js/city.js"></script>
<script type="text/javascript">
    $("document").ready(function(){
        initProvinceCity($("#p1"),$("#c1"));
    });
</script>
<script type="text/javascript" src="__PUBLIC__/Home/js/ajaxfileupload.js"></script>
<script charset="utf-8" src="__PUBLIC__/Home/js/kindeditor-min.js"></script>
<script charset="utf-8" src="__PUBLIC__/Home/js/zh_CN.js"></script>
<script src="__PUBLIC__/Home/js/form.js"></script>
<script>
    vali = {name: 0, nick: 0, idcard: 0,phone:0};
    $('#name').bind('blur', function(){
        if($(this).val().length < 2) return validateMsg('name', '请输入您的真实姓名', 0);
        return validateMsg('name', '', vali.name = 1);
    });
    $('#nick').bind('blur', function(){
        if($(this).val().length < 2) {
            vali.nick = 0;
            return validateMsg('nick', '请输入您的昵称', 0);
        }
        $.get("{:U('ModifyMember/ajaxCheckNick')}",{nick:encodeURIComponent($(this).val())}, function(d){
            validateMsg('nick', d['msg'], d['status']);
            if(d.status==1){
                vali.nick = d['status'];
            }
        }, 'json');

    });

    $('#mo').bind('blur', function(){
        if($(this).val().length != 11) {
            vali.phone = 0;
            return validateMsg('mo', '请输入手机号码', 0);
        }
        $.get("{:U('ModifyMember/ajaxCheckPhone')}" ,{phone:encodeURIComponent($(this).val())}, function(d){
            validateMsg('mo', d['msg'], d['status']);
            vali.phone = d['status'];
        }, 'json');
    });
    $('#idcard').bind('blur', function(){
        if($('#cardtype').val() == 1){
            if($(this).val().length < 15) return validateMsg('idcard', '请输入正确的身份证', 0);
        }else{
            if($(this).val().length < 7) return validateMsg('idcard', '请输入正确的护照号', 0);
        }
        return validateMsg('idcard', '', vali.idcard = 1);
    });
    function sandPhone(){
        var i=120;
        var tid2;
        tid2=setInterval(function(){
            if($("#msgt").attr("data-key")=='off'){
                $("#msgt").attr("disabled",true);
               // $("#msgt").removeClass("class");
               // $("#msgt").addClass("button again");
                i--;
                $("#msgt").val(i+"秒后可重新发送");
                if(i<=0){
				//	$("#msgt").removeClass("class");
				//	$("#msgt").addClass("button");
                    $("#msgt").removeAttr("disabled").val("重新发送验证码");
					$("#msgt").attr("data-key","on");
                }
            }
        },1000);
		var phone = $("mo").val();
        if(phone && /^1[3|4|5|8]\d{9}$/.test(phone)){
            layer.msg("请填写正确的手机号码");
        }else{
            $.post("{:U('ModifyMember/ajaxSandPhone')}",{phone:encodeURIComponent($("#mo").val())},
                    function(d){
                       layer.msg(d.info);				   
                        if(d.status==1){	
                            i=120;
                            $("#msgt").attr("data-key","off");
                        }
                    });
        }
    }
    function valiForms(){
        if(vali.nick==0){
            $('#nick').focus();
            return false;
        }
        if(vali.name==0){
            $('#name').focus();
            return false;
        }
        if(vali.idcard==0){
            $('#idcard').focus();
            return false;
        }
        if(vali.phone==0){
            $('#mo').focus();
            return false;
        }
        else{
            $('#form').submit();
        }
    }
    $("#form").validate({
        rules: {
        },
        messages: {
        },
        submitHandler:function(form){
            ajax_submit_form(form)
            return false;
        },
        invalidHandler: function() {  //不通过回调
            return false;
        }
    });
    //kind editor
    var editor;
    KindEditor.ready(function(K) {
        editor = K.create('textarea[name="description"]', {
            resizeType : 1,
            allowPreviewEmoticons : false,
            allowImageUpload : false,
            items : [
                'source', 'fontname', 'fontsize', 'forecolor','|',  'bold', 'link', '|', 'justifyleft', 'justifycenter', 'justifyright' ],
            colorTable : [
                ['#FF0000', '#E56600', '#FF9900', '#64451D', '#DFC5A4', '#FFE500'],
                ['#009900', '#006600', '#99BB00', '#B8D100', '#60D978', '#00D5FF'],
                ['#337FE5', '#003399', '#4C33E5', '#9933E5', '#CC33E5', '#EE33EE'],
                ['#FFFFFF', '#CCCCCC', '#999999', '#666666', '#333333', '#000000']
            ]
        });
    });
</script>


<!--  暂时不用 手机验证 -->
<!---<script type="text/javascript" src="__PUBLIC__/Home/js/phonecode.js"></script>-->
<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>
<!--footer end-->
<script type="text/javascript" src="__PUBLIC__/Home/js/downList.js"></script>
<script type="text/javascript" src="__PUBLIC__/Home/js/sdmenu.js"></script>
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?0ab4db557b96d841137861e0740d1e0a";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


</body></html>

70:F:\git\coin\bisheng commerce\App\Home\View\Orders\currency_trade.html
<include file="App/Home/View/Public/header.html"/>
<style>
.coin_num td input{
border: 1px solid #e55600;
color:#e55600;
border-radius: 3px;
width: 80px;
height: 30px;
margin: 5px;
cursor: pointer;
}
.coin_num td input:hover{
border: 1px solid #e55600;
border-radius: 3px;
width: 80px;
height: 30px;
margin: 5px;
cursor: pointer;
color:#FFF;
background-color:#e55600;	
}
</style>
    <!--top end-->
    <link rel="shortcut icon" href="http://www.jubi.com/favicon.ico" type="image/x-icon">
	<script src="_PUBLIC__/Home/js/script.js"></script>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/jb_font-awesome.css">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">                                         
</head>
<body>
<div id="main">
	<div class="main_box">
      <!--币币交易开始-->
      <div id="tags_coin" class="coinarea left" style="position:relative;">
		<!--<ul id="tags" class="for_coin">
			<li class="selectTag"><a onmouseover="selectTag('tagContent0',this)">对CNY交易区</a></li>
			<li><a onmouseover="selectTag('tagContent3',this)">对TRMB交易区</a></li>
            </ul>
		-->
		<div class="bgcolor" style="display:none;"></div>
		<div style="margin-top:30px;" id="tagContent">
		<!-- 对CNY交易区 结束-->
		<div class="tagContent selectTag" id="tagContent0">
		<p style="color:#f00; font-size:14px; margin-bottom:10px;">{$config.friendship_tips}</p>
		<table class="coin_list coinarea" border="0" cellpadding="0" cellspacing="0">
			<thead>
                <tr>
					<th>&nbsp;</th>
					<th style="text-align:left;">币名</th>
					<th class="header">最新价格(CNY)</th>
					<th class="header">24H成交量</th>
					<th class="header">24H成交额(CNY)</th>
					<th class="header">总市值(CNY)</th>
					<th class="header">24H涨跌</th>
					<th class="header">7D涨跌</th>
                    <th class="header" style="padding-right: 60px;">去交易</th>
				</tr>
			</thead>
			<tbody>
                <volist name='currency' id='vo' empty='$empty'>
                    <tr class="coin_num">
                        <td><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}"><img src="{$vo.currency_logo}" style="width:20px; height:20px;"></a></td>
                        <td class="coin_name"><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}">{$vo.currency_name|default='虚拟币'}{$vo.currency_mark|default=''}</a></td>
                        <td><eq name='vo.new_price_status' value='0' ><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}" class="buy"><else/><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}" class="sell"></eq>
                        {$vo.new_price|default='暂无'}<eq name='vo.new_price_status' value='0'>↓<else/>↑</eq></a></td>
                        <td><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}">{$vo.24H_done_num|default='0'}</a></td>
                        <td><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}">{$vo.24H_done_money|default='0'}</a></td>
                        <td><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}">{$vo.currency_all_money|default='0'}</a></td>
                        <td><gt name='vo.24H_change' value='0'><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}" class="sell"><else/><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}" class="buy"></gt>{$vo.24H_change|default='0'}%</a></td>
                        <td><gt name='vo.7D_change' value='0'><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}" class="sell">+<else/><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}" class="buy"></gt>{$vo.7D_change|default='0'}%</a></td>
                        <td style="padding-right: 10px;"><a href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}"><input value="去交易"  type="button"></a></td>
                    </tr>
                </volist>
			</tbody>
		</table>
		</div>
            <div style="width: 1200px; clear: both; margin: 0px auto;">
                <div class="page" style="min-width: 250px !important;margin-left: 500px;">
                    {$page}
                </div>
            </div>
	</div>
    </div>
	  <!--币币交易结束-->
<div class="clear"></div>
		</div>
		<div class="clear"></div>
	</div>
<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>
<!--footer end-->

	
    

71:F:\git\coin\bisheng commerce\App\Home\View\Orders\index.html
<include file="App/Home/View/Public/header.html"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/kline.css">
<script src="__PUBLIC__/Home/js/jquery-1.js"></script>
<script src="__PUBLIC__/Home/js/highstock.js"></script>
<script>
/*chart_5m = {symbol:"{$currency.currency_mark}_{$currency_trade.currency_mark}",symbol_view:"DDD/CNY",ask:1.2,time_line:{$kline_5m}};
chart_15m = {symbol:"{$currency.currency_mark}_{$currency_trade.currency_mark}",symbol_view:"DDD/CNY",ask:1.2,time_line:{$kline_15m}};
chart_1d = {symbol:"{$currency.currency_mark}_{$currency_trade.currency_mark}",symbol_view:"DDD/CNY",ask:1.2,time_line:{$kline_1d}};
chart_1h = {symbol:"{$currency.currency_mark}_{$currency_trade.currency_mark}",symbol_view:"DDD/CNY",ask:1.2,time_line:{$kline_1h}};
chart_30m = {symbol:"{$currency.currency_mark}_{$currency_trade.currency_mark}",symbol_view:"DDD/CNY",ask:1.2,time_line:{$kline_30m}};
chart_8h = {symbol:"{$currency.currency_mark}_{$currency_trade.currency_mark}",symbol_view:"DDD/CNY",ask:1.2,time_line:{$kline_8h}};*/
$(function() {
	$.get("/Home/Orders/getOrdersKline",{"currency":$("#currency_id").val(),"time":"kline_1h"},function(orders){
        kline($("#currency_mark").html()+"2"+$("#currency_trade_mark").html(),orders.kline_1h);

	});
	
	$("#chart-control > button").click(function(){
		$(this).addClass("btn-success").siblings().removeClass("btn-success");
			 var time = $(this).attr('data-time');
			 $.get("/Home/Orders/getOrdersKline",{"currency":$("#currency_id").val(),"time":time},function(orders){
			 kline($("#currency_mark").html()+"2"+$("#currency_trade_mark").html(),orders[time]);
		});
	});
});
</script>
<script src="__PUBLIC__/Home/js/kline.js"></script>

<style>
	.my_coin ul li{ font-size:12px; width:145px; height:24px; overflow:hidden;}
</style>
<div id="main" style="background:#fbfaf8; padding-top:0;">
  <div class="total_top" style="margin-bottom: 20px;">
    <div class="price">
      <img style=" float:left; width:50px; height:50px; padding-right:10px;" src="{$currency.currency_logo}" />
      <div class="left coin_coin">{$currency.currency_name|default="虚拟币"} 对{$currency_trade.currency_name|default="人民币"} <br>
        <span id="currency_mark">{$currency.currency_mark|default="XNB"}</span> /<span id="currency_trade_mark"> {$currency_trade.currency_mark|default="CNY"}</span></div>
      <ul class="right now_price">
        <li>最新价<br>
          <span class="money" id="new_price">{$currency_message.new_price|default="0.000"}</span></li>
        <li>买一价 / 卖一价<br>
          <span id="24h_sell">{$currency_message.buy_one_price|default="0.000"}</span><span> / </span><span id="24h_buy">{$currency_message.sell_one_price|default="0.000"}</span></li>
        <li>最高价 / 最低价<br>
          <span id="24h_max">{$currency_message.max_price|default="0.000"}</span><span> / <span><span id="24h_min">{$currency_message.min_price|default="0.000"}</span></span></span></li>
        <li>24H成交量<br>
          <span id="24h_count">{$currency_message.24H_done_num|default="0.000"}</span></li>
      </ul>
      <div class="clear"></div>
    </div>
  </div>
  <div class="main_box"> 
    <!--普通-->
    <div class="k_img k-box" id="k-cus-box">
      <div id="graphbox" style="width:96%;height:455px;margin:0px auto;">
        <div id="container" style="height: 410px; min-width: 460px"></div>
        <div id="chart-control" data="ybc" class="btn-group centered" style="width: 98%;height: 30px;line-height: 30px; marign:0 auto;text-align:center">
          <button data-time="kline_5m" class="btn">5分钟线</button>
          <button data-time="kline_15m" class="btn">15分钟线</button>
          <button data-time="kline_30m" class="btn">30分钟线</button>
          <button data-time="kline_1h" class="btn btn-success">1小时线</button>
          <button data-time="kline_8h" class="btn">8小时线</button>
          <button data-time="kline_1d" class="btn ">日线</button>
        </div>
      </div>
    </div>
     <!--交易币种id-->
                <input value="{$currency.currency_id}" name="currency_id" type="hidden" id="currency_id">
                 <!--交易币种id-->
    <div class="trading left clearfix">
      <div class="my_coin"> 
        <!--登录后-->
        <notempty name="session">
          <ul>
            <li style="width: 200px; overflow: hidden; height: 24px;">我的{$currency.currency_name|default="虚拟币"} 资产：</li>
            <li>可用：<span class="sell" id="from_over">{$user_currency_money['currency']['num']|default=0.00}</span></li>
            <li>冻结：<span class="buy" id="from_lock">{$user_currency_money['currency']['forzen_num']|default=0.00}</span></li>
            <li>总量：<span style="color:#333;" id="from_total">{$user_currency_money['currency']['num']+$user_currency_money['currency']['forzen_num']}</span></li>
            <div class="clear"></div>
          </ul>
          <ul>
            <li style="width: 200px; overflow: hidden; height: 24px;">我的{$currency_trade.currency_name|default="人民币"}资产：</li>
            <li>可用：<span class="sell" id="to_over">{$user_currency_money['currency_trade']['num']|default=0.00}</span></li>
            <li>冻结：<span class="buy" id="to_lock">{$user_currency_money['currency_trade']['forzen_num']|default=0.00}</span></li>
            <li>总量：<span style="color:#333;" id="to_total">{$user_currency_money['currency_trade']['num']+$user_currency_money['currency_trade']['forzen_num']}</span></li>
            <div class="clear"></div>
          </ul>
          <else/>
          <p>我的资产：<a href="{:U('Login/index')}">登录</a> | <a href="{:U('Reg/reg')}">注册</a></p>
        </notempty>
      </div>
      <div class="curve pay">
        <div class="buysell sellform">
          <div class="buyformarea left">
            <h2 class="buy">买入{$currency.currency_name|default="虚拟币"} </h2>
            <ul class="buyform">
              <li>
                <label>最佳买价：</label>
                <h3 id="coinbuy_nice" class="buy left">{$sell_record[count($sell_record)-1]['price']|default="0.000"}</h3>
              </li>
              <li>
                <label for="price" class="buys">买入价格：</label>
                <input value="{$currency_message.buy_one_price|default='0.000'}" style="color:#999" name="buyprice" id="coinpricein" onkeyup="vNum(this,{$currency.currency_digit_num});zuidakemai();" onclick="if(value==defaultValue){value='';}" onblur="if(value==''){value='0.000';}" type="text">
              </li>
              <li>
                <label for="num" class="buys">最大可买：</label>
                <b id="coinbuy_max"  title="点击将数值写入数量输入框"></b><span class="maxcoin">0</span> </li>
              <li>
                <label for="buynum" class="buys">买入数量：</label>
                <input style="display:none;">
                <!-- for disable autocomplete on chrome -->
                <input name="buynum" id="numberin" onkeyup="vNum(this,{$currency.currency_digit_num});" autocomplete="off" type="text" value="">
              </li>
              <li>
                <label for="buyword" class="buys">交易密码：</label>
                <input style="display:none;">
                <!-- for disable autocomplete on chrome -->
                <input class="buyinput" value="" id="pwdtradein" autocomplete="off" type="password" name="buypwd">
              </li>
              <li style="margin-bottom:0;">
                <label for="num" class="buys">手续费：</label>
                <b id="feebuy">0.00</b><span>（{$currency.currency_buy_fee|default="0.00%"}% {$currency.currency_mark|default="--"}）</span></li>
              <li>
                <label for="num" class="buys">交易额：</label>
                <b id="coinin_sumprice">0.00</b> {$currency_trade.currency_mark|default="CNY"}</li>
            </ul>
            <p class="sellform">
              <input id="trustbtnin" onclick="buy()" class="submit" value="买入" type="button">
            </p>
            <p class="sellform" style="margin:15px 0;"><span id="trustmsgin" class="tishi">数字货币交易具有极高的风险，投资需谨慎！</span></p>
          </div>
          <div class="buyformarea right">
            <h2 class="sell">卖出{$currency.currency_name|default="虚拟币"} </h2>
            <ul class="buyform sellform">
              <li>
                <label>最佳卖价：</label>
                <h3 id="coinsale_nice" class="sell left">{$buy_record[0]['price']|default="0.000"}</h3>
              </li>
              <li>
                <label for="price" class="buys">卖出价格：</label>
                <input value="{$currency_message.buy_one_price|default='0.000'}" style="color:#999" class="buyinput" id="coinpriceout" onkeyup="vNum2(this,{$currency.currency_digit_num});" onclick="if(value==defaultValue){value='';}" onblur="if(value==''){value='0.000';}" type="text">
               
              </li>
              <li>
                <label for="num" class="buys">最大可卖：</label>
                <b id="coinsale_max" onclick="$('#numberout').val(this.innerHTML)" title="点击将数值写入数量输入框">{$sell_num|default=0}</b><span></span> </li>
              <li>
                <label for="buynum" class="buys">卖出数量：</label>
                <input style="display:none;">
                <!-- for disable autocomplete on chrome -->
                <input class="buyinput" id="numberout" onkeyup="vNum2(this,{$currency.currency_digit_num});" autocomplete="off" type="text">
              </li>
              <li>
                <label for="buyword" class="buys">交易密码：</label>
                <input style="display:none;">
                <!-- for disable autocomplete on chrome -->
                <input class="buyinput" id="pwdtradeout" autocomplete="off" type="password">
              </li>
              <li style="margin-bottom:0;">
                <label for="num" class="buys">手续费：</label>
                <b id="fee">0.00</b><span>（{$currency.currency_sell_fee|default="0.00"}% {$currency_trade.currency_mark|default="--"}）</span></li>
              <li>
                <label for="num" class="buys">交易额：</label>
                <b id="coinout_sumprice">0.00</b>{$currency_trade.currency_mark|default="CNY"}</li>
            </ul>
            <p class="sellform2">
              <input class="submit" id="trustbtnout" value="卖出" onclick="sell();" type="button">
            </p>
            <p class="sellform" style="margin:15px 0;"><span id="trustmsgout" class="tishi">数字货币交易具有极高的风险，投资需谨慎！</span></p>
          </div>
          <div class="clear"></div>
        </div>
        <h2>最新成交<a href="{:U('Trade/myDeal')}" class="right my_coin_trade">我的成交</a></h2>
        <div class="buysell" style="border:1px solid #d2d2d2;">
          <ul class="record_title">
            <li>成交时间</li>
            <li>类型</li>
            <li>成交价格</li>
            <li>成交量</li>
            <li>总计</li>
          </ul>
          <div class="record">
            <table class="latest_list record_list" align="center" border="0" cellpadding="0" cellspacing="0">
              <tbody id="coinorderlist">
                <volist name='trade' id='vo'>
                <tr>
                  <td class="list_con1">{$vo.trade_time|date=' H:i:s',###}</td>
                  <td class="list_con1 {$vo.type}"><eq name='vo.type' value='sell'>卖出<else/>买入</eq></td>
                  <td class="list_con1 {$vo.type}">{$vo.price|default='暂无'}</td>
                  <td class="list_con1">{$vo.num|default='暂无'}</td>
                  <td class="list_con1">{$vo['num']*$vo['price']}</td>
                </tr>
                </volist>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="latest right clearfix">
      <p class="more_coin"><a href="{$currency.detail_url|default=''} " target="_blank">查看货币详情</a></p>

       <notempty name="session">

      <h2 style="margin-top:20px;">我的委托<a href="{:U('Entrust/manage')}" class="right my_coin_trade">全部委托</a></h2>
      <div style="border:1px solid #d2d2d2; color:#333;">
        <ul class="my_title">
          <li style=" width:40px;">类型</li>
          <li style=" width:65px; text-align:left; padding-left:10px;">委托价格</li>
          <li style=" width:100px; text-align:left; padding-left:10px;">委托数量</li>
          <li style=" width:52px; text-align:left; padding-left:10px;"></li>
          <li style=" width:52px; text-align:left; padding-left:10px;">操作</li>
        </ul>
        <div class="my_record">
          <table class="latest_list weituo" style=" width:291px;" align="center" border="0" cellpadding="0" cellspacing="0">
            <tbody id="mycointrustlist">
            <foreach name='user_orders' item='v'>
             <tr class="list_con2">
              <td class="{$v['type']} left_sell" style="width:55px;">{$v['type']|fomatOrdersType=###}</td>
              <td style="width:50px;">{$v.price|default=0.00}</td>
              <td>{$v['num']-$v['trade_num']}</td>
              <td style="width:60px;"><span style="width:<php>echo setOrdersTradeNum($v['num'],$v['trade_num']);</php>%" class="{$v['type']}Span"></span></td>
              <td style="width:40px;"><a href="javascript:void(0)"  onclick="cexiao({$v.orders_id})">撤销</a></td>
            </tr>
            </foreach>
            </tbody>
          </table>
        </div>
      </div>
      <else/>
      <div style="border:1px solid #e2e2e2; margin:15px 0; padding:15px; color:#333; background:#fff; line-height:20px; font-size:14px; text-align:left;">
                <p style="width:278px; word-break:break-all;">交易规则：<br>
               {$config.VAP_rule}
                </p>
        </div>
      </notempty>
      <div style="margin-top:0px;">
        <h2>委托信息</h2>
      </div>
      <table cellspacing="0" cellpadding="0" border="0" class="latest_list weituo" align="center" style="border:1px solid #d2d2d2;">
        <tbody id="coinsalelist">
          <volist name='sell_record' key='k' id='vo'>
            <tr class="list_con2">
              <td class="sell left_sell" style="width:55px;">卖(<php>echo count($sell_record)-$k+1</php>)</td>
              <td style="width:70px;" onclick="getsell(this)">{$vo.price|default=0.00}</td>
              <td onclick="sellnum(this)">{$vo['num']-$vo['trade_num']}</td>
              <td style="width:80px;"><span style="width:{$vo.bili}%" class="sellSpan"></span></td>
            </tr>
          </volist>
        </tbody>
      </table>
      <table cellspacing="0" cellpadding="0" border="0" class="latest_list weituo" align="center" style="border:1px solid #d2d2d2;">
        <thead>
          <tr style="height:26px;">
            <th style="height:26px; text-align:center; width:55px;" class="left_sell">卖 / 买</th>
            <th style="height:26px; width:70px;">价格</th>
            <th style="height:26px;">委托量</th>
            <th style="height:26px;">&nbsp;</th>
          </tr>
        </thead>
        <tbody id="coinbuylist">
          <volist name='buy_record' key='k' id='vo'>
            <tr class="list_con2">
              <td class="buy left_sell" style="width:55px;" onclick="getbuy(this);">买({$k})</td>
              <td style="width:70px;" onclick="buynum(this);">{$vo.price|default=0.00}</td>
              <td>{$vo['num']-$vo['trade_num']}</td>
              <td style="width:80px;"><span style="width:{$vo.bili}%" class="buySpan"></span></td>
            </tr>
          </volist>
        </tbody>
      </table>
    </div>
  </div>
  <div class="clear"></div>
</div>
<format id="price_float" data="3"></format>
<!--footer start--> 
<include file="App/Home/View/Public/footer.html"/> 
<!--footer end--> 
<input type="hidden" value="{$currency.currency_name|default='虚拟币'}"  id = "cname"/>
<script>
function sell(){
	var cname=$("#cname").val();
	if($("#coinpriceout").val()==""){
		$("#trustmsgout").text("卖出价格不能为空").fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500);
		return false;
	}
	if($("#numberout").val()==""){
		$("#trustmsgout").text("卖出数量不能为空").fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500);
		return false;
	}
	if($("#pwdtradeout").val()==""){
		$("#trustmsgout").text("交易密码不能为空").fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500);
		return false;
	}
	if(($("#coinpriceout").val())*($("#numberout").val())<1){
		$("#trustmsgout").text("交易额不能低于1元").fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500);
		return false;
	}
	layer.confirm('确定卖出?', {
		  btn: ['确定','取消'] //按钮
		}, function(index){
			layer.close(index);
			$("body").append("<div id='loading' style='z-index:19891014; background-color:#000; opacity:0.3; filter:alpha(opacity=30);top: 0;left: 0;width: 100%;height: 100%;position: fixed;_position: absolute;text-align:center;'><img src='/public/home/images/loading.gif' style='margin-top:25%;' /></div>");
			$.ajax({
				type:"post",
				url:"{:U('Trade/sell')}",
				data:{sellprice:$("#coinpriceout").val(),sellnum:$("#numberout").val(),sellpwd:$("#pwdtradeout").val(),currency_id:$("#currency_id").val()},
				async:true,
				success: function(d){
					$("#loading").remove();
					if(d.status!=1){
					$("#trustmsgout").text(d.info).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500);	
					//加一个提示
					layer.msg(d.info);
					}else{
					layer.msg(d.info);
					//刷新页面
					setTimeout(window.location.reload(),2000);
					}
				}
			});
}, function(){
  layer.msg('已取消');
});

}
function buy(){
	if($("#coinpricein").val()==""){
		$("#trustmsgin").text("买入价格不能为空").fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500);
		return false;
	}
	if($("#numberin").val()==""){
		$("#trustmsgin").text("买入数量不能为空").fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500);
		return false;
	}
	if($("#pwdtradein").val()==""){
		$("#trustmsgin").text("交易密码不能为空").fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500);
		return false;
	}
	if(($("#coinpricein").val())*($("#numberin").val())<1){
		$("#trustmsgin").text("交易额不能低于1元").fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500);
		return false;
	}
	layer.confirm('确定买入?', {
	  btn: ['确定','取消'] //按钮
	}, function(index){
		layer.close(index);
		$("body").append("<div id='loading' style='z-index:19891014; background-color:#000; opacity:0.3; filter:alpha(opacity=30);top: 0;left: 0;width: 100%;height: 100%;position: fixed;_position: absolute;text-align:center;'><img src='/public/home/images/loading.gif' style='margin-top:25%;' /></div>");
		$.ajax({
			type:"post",
			url:"{:U('Trade/buy')}",
			data:{buyprice:$("#coinpricein").val(),buynum:$("#numberin").val(),buypwd:$("#pwdtradein").val(),currency_id:$("#currency_id").val()},
			async:true,
			success: function(d){
				$("#loading").remove();
				if(d.status!=1){
				$("#trustmsgin").text(d.info).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500);	
				//加一个提示
				layer.msg(d.info);
				}else{
				layer.msg(d.info);
				//刷新页面
				setTimeout(window.location.reload(),2000);
				}
			}
		});
	}, function(){
  layer.msg('已取消');
});
}
function badFloat(num, size){
    if(isNaN(num)) return true;
    num += '';
    if(-1 == num.indexOf('.')) return false;
    var f_arr = num.split('.');
    if(f_arr[1].length > size){
        return true;
    }
    return false;
}
//格式化小数
//@f float 传入小数: 123; 1.1234; 1.000001;
//@size int 保留位数
//@add bool 进位: 0舍 1进
function formatfloat(f, size, add){
    f = parseFloat(f);
    if(size == 2) conf = [100,0.01];
    if(size == 3) conf = [1000,0.001];
    if(size == 4) conf = [10000,0.0001];
    if(size == 5) conf = [100000,0.00001];
    if(size == 6) conf = [1000000,0.000001];
    if(size == 7) conf = [10000000,0.0000001];
	if(size == 8) conf = [100000000,0.00000001];
    var ff = Math.floor(f * conf[0]) / conf[0];
    if(add && f > ff) ff += conf[1];
    return isNaN(ff)? 0: ff;
}
function vNum(o, len){
	if($("#coinpricein").val()!="" || $("#coinpricein").val()!="此出价为1个币的价格" && $("#numberin").val()!=""){
		if(badFloat(o.value, len))
		o.value=formatfloat(o.value,len,0);
		var fee2 = {$currency.currency_buy_fee} /100;
		var ci = $("#coinpricein").val()*$("#numberin").val();
		var ct2 = ci ;//+ ci * fee2;
		
		$("#feebuy").text(Math.round(ci*fee2*10000)/10000);
		$("#coinin_sumprice").text(Math.round(ct2*10000)/10000);
	}
}

function vNum2(o, len){
	if($("#coinpriceout").val()!="" || $("#coinpriceout").val()!="此出价为1个币的价格" && $("#numberout").val()!=""){
	if(badFloat(o.value, len))
		o.value=formatfloat(o.value, len, 0);
	var nt = $("#coinpriceout").val()*$("#numberout").val();
	var fee = {$currency.currency_sell_fee} /100;
	var ct = nt;// - nt * fee;
	
	$("#fee").text(Math.round(nt*fee*10000)/10000);
	$("#coinout_sumprice").text(Math.round(ct*10000)/10000);
	}
	
}
//5秒自动刷新挂单记录
setInterval(function(){
	$.post('/Home/Orders/getOrders',{"type":'sell',"currency_id":$("#currency_id").val()},function(data){
		$("#coinsalelist").empty();
		var length=parseInt(data.length)
		for(var i=0;i<data.length;i++){
			$("#coinsalelist").append(
				"<tr class='list_con2'><td class='sell left_sell' style='width:55px;'>卖("+(length-i)+")</td><td style='width:70px;cursor:pointer;' onclick='getsell(this)'>"+data[i]['price']+"</td><td onclick='sellnum(this);'>"+parseFloat(data[i]['num']-data[i]['trade_num'])+"</td><td style='width:80px;'><span style='width:"+data[i]['bili']+"%' class='sellSpan'></span></td></tr>"
			);
		}
	});
		$.post('/Home/Orders/getOrders',{"type":'buy',"currency_id":$("#currency_id").val()},function(data){
		$("#coinbuylist").empty();
		var length=parseInt(data.length)
		for(var i=0;i<data.length;i++){
			$("#coinbuylist").append(
				"<tr class='list_con2'><td class='buy left_sell' style='width:55px;'>买("+(parseInt(i)+1)+")</td><td style='width:70px;cursor:pointer;' onclick='sellnum(this);'>"+data[i]['price']+"</td><td onclick='buynum(this);'>"+parseFloat(data[i]['num']-data[i]['trade_num'])+"</td><td style='width:80px;'><span style='width:"+data[i]['bili']+"%' class='buySpan'></span></td></tr>"
			);
		}
	})		
},5000);


</script>
<script>
function zuidakemai(){
	if($("#coinpricein").val()!="" && $("#coinpricein").val()!=0){
		var m = {$user_currency_money.currency_trade.num|default=0};
		var fee={$currency.currency_buy_fee}/100;
		m=m*(1-fee);
		var n = parseFloat($("#coinpricein").val());
		
		$(".maxcoin").text(Math.round(m/n*10000)/10000);
	}else{
		$(".maxcoin").text(0);
	}
}
</script>
<script>
	function cexiao(_this){
		layer.confirm('确定撤销委托？', {
	  btn: ['确定','取消'], //按钮
	  title: '撤销委托'
	}, function(){
	  $.post('{:U('Entrust/cancel')}',{status:-1,order_id:_this},function(data){
				   if(data['status'] == 1){
					   layer.msg(data['info']);
					   setTimeout(window.location.reload(),1000);
				   }else{
					   layer.msg(data['info']);
				   }
			})
	}, function(){
	  layer.msg('已取消');
	});

	}
	
	function getsell(_this){
		$("#coinpricein").val($(_this).text());
		zuidakemai();
	}
	function sellnum(_this){
		$("#numberin").val($(_this).text());
	}
	function getbuy(_this){
		$("#coinpriceout").val($(_this).text());
	}
	function buynum(_this){
		$("#numberout").val($(_this).text());
	}

</script>

72:F:\git\coin\bisheng commerce\App\Home\View\Pay\bpay.html
<include file="App/Home/View/Public/header.html"/>
    <!--top end-->
<script src="./元宝网｜第一数字资产交易平台_files/index.js"></script>
<div id="main">
	<div class="main_box">
		<include file="App/Home/View/Public/left.html"/>
		<div class="raise right clearfix">
            <div class="ybc_list">
	<div class="ybcoin">
                <h2 class="left">转入{$currency.currency_name}</h2>
		<div class="clear"></div>
        	</div>
	<div class="clearfix" style="border:1px solid #e6e6e6; margin:10px 0 10px 0; padding:10px 10px 10px 0;">
		    <div class="userinbtc left" style="margin-top:30px;"> 
			<p class="inBTtext">这是您的{$currency.currency_name}钱包地址，请将您的{$currency.currency_name}转入此地址：</p>
			<div class="outwallet">{$list['chongzhi_url']}</div>
            		    </div>
		    <!-- 调用二维码接口调用 -->
		    <!-- 外部接口 -->
	</div>
   

    <div class="ybc_list">
        <div class="ybcoin">
            <h2 class="left">转入说明</h2>
            <div class="clear"></div>
        </div>
                <p>1. 转入是自动的，{$currency.currency_name}转账需要整个网络进行确认，达到<b>2个确认</b>后您的{$currency.currency_name}会自动充值到您的账户中</p>
        <p>2. 此地址是您的唯一且独自使用的转入地址，您可以同时进行多次充值</p> 
            </div>
</div>
<div class="ybc_list">
	<div class="ybcoin">
		<h2 class="left">转入记录</h2>
		<div class="clear"></div>
	</div>	
		<table cellspacing="0" cellpadding="0" border="0" class="raise_list" align="center" style="border:1px solid #e1e1df;">
			<thead>
			<tr>
				<th>记录ID</th>
				<th>转入钱包地址</th>
				<th>数量</th>
				<th>确认数</th>
				<th>发送时间</th>
				<th>状态</th>
			</tr>
			</thead>
			<tbody>
			<volist name="chongzhi" id='vo'>
            <tr id="btcin_box" class="btcin_new">
                <td id="btcin_id">{$vo.id}</td>
                <td id="btcin_wallet">{$vo.url}</td>
                <td id="btcin_number">{$vo.num}</td>
                <td id="btcin_created">{$vo.num}</td>
				 <td id="btcin_created">{$vo.add_time|date="Y-m-d H:i:s",###}</td>
                <td class="tableEnd" id="btcin_status"><eq name="vo.status" value='2'>等待中<else/>充值成功</eq></td>
            </tr>
			</volist>
						</tbody>
		</table>
				{$page}
				<input type="hidden" id="currency_id" value="{$currency.currency_id}">
	</div>
	<script>
    setInterval("myInterval()",1000);//1000为1秒钟
       function myInterval()
       {
	   	var id=$("#currency_id").val();
			
           $.post('{:U('Pay/chongzhi_function')}',{currency_id:id},function(data){
			   if(data.status==1){
				   location.reload();     
				   }
			})
        }

</script>
	<style>.btcin_new,.btcin_new td {background: #DDFFDD !important;}</style>
</div>
  

		</div>
		<div class="clear"></div>
	</div>
    
<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>

73:F:\git\coin\bisheng commerce\App\Home\View\Pay\tcoin.html
<include file="App/Home/View/Public/header.html"/>
    <!--top end-->
<script src="./元宝网｜第一数字资产交易平台_files/index.js"></script>
<div id="main">
	<div class="main_box">
		<include file="App/Home/View/Public/left.html"/>
		<div class="raise right clearfix">
            <script type="text/javascript" src="./元宝网｜第一数字资产交易平台_files/ajax.js"></script>
<script type="text/javascript" src="./元宝网｜第一数字资产交易平台_files/Fnc.js"></script>
<div class="ybc_list">
	<div class="ybcoin">
		<h2 class="left">{$cuid.currency_name}提币</h2>
		<div class="clear"></div>
	</div>
</div>
<json id="json" ></json>
        <div class="support_ybc pass_ybc" id="verifyon">
        <div id="tagContent" class="passContent">
        <div class="tagContent selectTag" id="tagContent0">
                    <div class="choose_one clearfix">
		<h2 class="left">选择一个提币地址<span style="float:right;margin-right:50px;"><strong id="coinout_showtips"></strong></span></h2>
		<p class="right" style="font-size:12px; margin-top:8px;">如果您新添加的地址为【未认证】，请联系官方客服QQ（{$config.qq1}）审核。</p>
	    </div>
	    <table cellpadding="0" cellspacing="0" border="0" class="my_add">
		<thead>
			<tr align="center">
				<th style="width:143px">选择</th>
				<th style="width:221px">地址标签</th>
				<th style="width:300px;">提币地址</th>
				<th style="width:100px">状态</th>
				<th style="width:144px">操作</th>
			</tr>
		</thead>
     
		<tbody>
            <form class="form-horizontal m-t" id="address" jump-url="{:U('Pay/tcoin',array('currency_id'=>$cuid['currency_id']))}" method="post" action="{:U('Pay/add_qianbao_address')}">
            			<tr style="display:none;" id="coinout_newaddr" align="center">
				<td>新地址</td>
				<td><input class="sum" id="new_label"  type="text" name="name" placeholder="例如：张三的地址"></td>
				<td><input class="sum" id="wallet_address" style="width:300px;"  type="text" name="address" placeholder="例如：yja67fGc8UBXLWtjwvHFkjrmYhTFGH9PTs" ></td>				
				<input type="hidden" name="currency_id" value="{$cuid['currency_id']}" />
				<td>&nbsp;</td>
				<td><input class="verify"  id="yes_add2" value="确认" type="submit"></td>
			</tr>
			</form>
			<!--<tr style="display:none;" id="phone_alert2" align="right">
				<td colspan="5"><span style="color:#f00;">系统已拨打您的手机告知验证码，请输入验证码</span> <input class="verify_text" id="phone_code_wallet" type="text"><input class="verify" value="确认" onclick="coinOut.finaddAddress()" type="button"></td>
			</tr>-->
			
			<empty name="list">
			<tr align="center" id="addAddress_tr">
				<td colspan="5"><a href="javascript:coinOut.addNewAddr();" id="addNewAddress">点击添加一个新的提币地址</a></td>
                
			</tr>
			<else/>
			<tr align="center">
				<td>地址</td>
				<td><input class="sum" id="new_label"  type="text" name="name" value="{$list.name|default=''}" disabled="disabled"></td>
				<td><input class="sum" id="wallet_address" style="width:300px;"  type="text" name="address" disabled="dosabled"  value="{$list.qianbao_url|default=''}"></td>
				<td>可用</td>
				
				<td><a href="{:U('Pay/del_address',array('id'=>$list['id'],'cuid'=>$cuid['currency_id']))}">删除</a></td>
			</tr>
			</empty>
		</tbody>
	    </table>
		  <script>	
           $("#address").validate({			   
                rules: {
                    name: {
                        required: true,
                    },
                    address: {
                        required: true,
                    }
                },
                messages: {
                  name: {
                        required: "姓名不能为空",
                    },
                    cardnum: {
                        required: '地址不能为空',
                    }
                },
				submitHandler:function(form){
					ajax_submit_form(form)
					return false;
				},
				invalidHandler: function() {  //不通过回调 
					  return false; 
				  },
		   
            });
			</script> 
			
	    <h2 class="choose_one">输入要提币的数额<span>(可用余额：<strong>{$cuser.num} {$cuid.currency_mark}</strong>)</span><span style="float:right;margin-right:20px;"><strong id="coinout2_showtips"></strong></span></h2>
	    <table cellpadding="0" cellspacing="0" border="0" class="my_add">
		<form class="form-horizontal m-t" id="tibi" jump-url="{:U('Pay/tcoin',array('currency_id'=>$cuid['currency_id']))}" method="post" action="{:U('Pay/ti_bi')}">
		<tbody>      
        
			<tr>
	    	  <input type="hidden" name="currency_id" value="{$cuid.currency_id}">
				<td style="position:relative; padding-left:90px;">提币数量<input type="text" class="sum" id="coin_rmb" name="num" ></td>
				<td>实际到帐 <input type="text" class="sum" id="true_coin" disabled=""> <span style="color:#f60;">(手续费{$config.tcoin_fee|mb_substr=0,4,"utf-8"}%)</span></td>
			</tr>
            <tr>
               <td style=" padding-left:90px;">交易密码 <input type="password" class="sum" name="paypwd" ></td>
               <td>验证码
                    <input style="display:none" type="password">
                    <!-- for disable autocomplete on chrome -->
                    <input class="sum" name="code" id="code" autocomplete="off" type="password">
                    <input class="confirm"  value="点击发送" type="button" id="msgt" data-key='off' onclick="sandPhone()"></td>
            </tr>
            <tr>
              <td colspan="4"><input style=" float:right; margin-right:103px;" type="submit" class="confirm" value="确认提币"></td>
            </tr>
		</tbody>
        	</form>
	    </table>
        	    <h2 class="choose_one">转出{$cuid.currency_name}说明</h2>
        <div class="turns">
            <p>1. 提币手续费为{$config.tcoin_fee|mb_substr=0,4,"utf-8"}%，请仔细确认后再操作。</p>
            <p>2. 每笔转出最大限额{$cuid.currency_all_tibi|default="0"}个币。</p>
            	                <input type="hidden" id="sell_fee" value="{$config.tcoin_fee}">
            <input type="hidden" id="min_coin" value="5.0000">
        </div>
        </div>
        <div class="tagContent" id="tagContent1">
       
        	    <h2 class="choose_one">转出{$cuid.currency_name}说明</h2>
        <div class="turns">
            <p>1.提币手续费为{$cuid.currency_sell_fee|mb_substr=0,4,"utf-8"}%，请仔细确认后再操作。</p>
            <p>2.每笔转出最大限额2000个币。</p>
        </div>
        </div>
        </div>
    </div>
	<div class="ybc_list">
    <div class="ybcoin">
        <h2 class="left">转出记录</h2>
        <div class="clear"></div>
    </div>
	<table cellspacing="0" cellpadding="0" border="0" class="raise_list" align="center" style="border:1px solid #e1e1df;">
		<thead>
		<tr>
			<th>记录ID</th>
			<th>转入钱包地址</th>
			<th>转出数量</th>
			<th>实际到账</th>
			<th>操作时间</th>
			<th>状态</th>
		</tr>
		</thead>
		<tbody>
		<volist name="tibi_list" id='vo'>
		<tr id="btc_box" class="btc_new">
			<td id="btc_id">{$vo.id}</td>
			<td id="btc_wallet">{$vo.url}</td>
			<td id="btc_number">{$vo.num}</td>
			<td id="btc_fee">{$vo.actual}</td>
			<td id="btc_created">{$vo.add_time|date="Y-m-d H:i:s",###}</td>
			<td class="tableEnd" id="btc_status"><eq name="vo.status" value = '0'>等待转出<else/>已经到账</eq></td>
		</tr>
				
		</volist>
				</tbody>
	</table>
	</div>
	</div>
	    <script>	
           $("#tibi").validate({			   
                rules: {
                    num: {
                        required: true,
                    },
                    paypwd: {
                        required: true,
                    },
					code:{
						required: true,
					}
                },
                messages: {
                  num: {
                        required: "金额不能为空",
                    },
                    paypwd: {
                        required: "请填写支付密码",
                    },
					code: {
                        required: "请填写验证码",
                    }
                },
				submitHandler:function(form){
					ajax_submit_form(form)
					return false;
				},
				invalidHandler: function() {  //不通过回调 
					  return false; 
				  },
		   
            });
			</script> 
<style>.btc_new,.btc_new td {background: #DDFFDD !important;}#cb_msg_box{background:#B50000;color:#FFF;display:none;text-align:center;padding:0px;}</style>

<script src="__PUBLIC__/Home/js/coinout.js"></script>
<script>
$('#coin_rmb').bind('input propertychange', function() {
	var num=$("#coin_rmb").val();
	if(isNaN(num)){
	 alert("请输入数字类型");
	}else{
	
	var fee=$("#sell_fee").val()/100;
	var shiji=num*(1-fee);
	$("#true_coin").val(shiji.toFixed(2));
	}
}); 
 function sandPhone(){
        var phone="{$member.phone}";
		
		var i=120;
        var tid2;
        tid2=setInterval(function(){
            if($("#msgt").attr("data-key")=='off'){
                $("#msgt").attr("disabled",true);
                $("#msgt").removeClass("class");
                $("#msgt").addClass("button again");
                i--;
                $("#msgt").val(i+"秒后可重新发送");
                if(i<=0){
                    $("#msgt").removeAttr("disabled").val("重新发送验证码");
                    $("#msgt").attr("data-key","on");
                }
            }
        },1000);
        
            $.post("{:U('Common/ajaxSandPhone')}",{'phone':phone},
                    function(d){
                       layer.msg(d.info);
                        if(d.status==1){
                            i=120;
                            $("#msgt").attr("data-key","off");
            	 }
            });
    }
</script>
		</div>
		<div class="clear"></div>
	</div>
    
<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>

74:F:\git\coin\bisheng commerce\App\Home\View\Project\index.html
<include file="App/Home/View/Public/header.html"/>
<script type="text/javascript" src="__PUBLIC__/Home/js/jquery-1.7.2.min.js"></script>
<script src="__PUBLIC__/Home/js/share.js"></script>
<link rel="stylesheet" href="__PUBLIC__/Home/css/share_style0_32.css">
<link rel="stylesheet" href="__PUBLIC__/Home/css/share_popup.css">
<link rel="stylesheet" href="__PUBLIC__/Home/css/select_share.css">
 <div class="xiangmu">
<!--<p class="left prcjecticon" style="margin-top:5px;"><img src="--><!--" style="width:72px;height:72px;" /></p>-->
<p class="left prcjecticon" style="margin-top:5px;"><img src="__PUBLIC__/Home/images/c9889b3d27c8298671b82930c438f428.png" style="width:72px;height:72px;"></p>
    <div class="left prc_name" style="margin-top:0;">
        <div class="newurl">
		<h1 class="left projecth1">美基金</h1>
<!--		<p class="left"><a href="--><!--">--><!--</a></p>-->
		<div class="clear"></div>
	</div>
        <h2 id="yijuh2">轻松分享美股收益</h2>
        <p>北京&nbsp;-&nbsp;数字货币</p>
    </div>
    <div class="right">
    <div class="clearfix">
	    <p class="left focus">
				<a href="http://yuanbaohui.com/project_index/?id=171#">已关注</a>
			    </p>
	    <p class="right report_btn"><a href="http://yuanbaohui.com/feedback/submit?id=171">举报</a></p>
    </div>
    <div class="pro_share" style="display:none;">
       <div class="bdsharebuttonbox bdshare-button-style0-32" data-bd-bind="1459145253710">
		  <a href="http://yuanbaohui.com/project_index/?id=171#" class="bds_more" data-cmd="more"></a>
		  <a href="http://yuanbaohui.com/project_index/?id=171#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
		  <a href="http://yuanbaohui.com/project_index/?id=171#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
		  <a href="http://yuanbaohui.com/project_index/?id=171#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a>
	 </div>
	 <script>
window._bd_share_config={"common":{
                   "bdSnsKey":{},               
		   "bdText":"我在元宝网关注了一个好项目#美基金#，轻松分享美股收益。#元宝网#第一数字货币众筹交易平台。注册登录元宝网(http://yuanbaohui.com)，分享项目即送1000元宝银币YBY + 1000番茄币TMT!@元宝团队官微",
                   "bdUrl":"/project_index/?id=171",
		   "onAfterClick":function(cmd){
		        if(cmd == 'tsina'){
				$.get('/project_index/share/?pid='+171+'&cmd='+cmd+'&t=' + Math.random(), function(d) { 
				}, 'json');
			}
		   },
		   "bdMini":"2",
		   "bdMiniList":false,
		   "bdPic":"",
		   "bdStyle":"0",
		   "bdSize":"32"
		   },
                   "share":{},
                   "selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","tqq","weixin","linkedin","fbook","twi"]}};
 with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
 </script>

    </div>
    <!--<p class="giving"><a href="http://yuanbaohui.com/news/detail/?id=142" style="text-align:center;">分享到新浪微博即送<br/>0.1YBY+1000TMT</a></p>-->
    </div>
    <div class="clear"></div>
</div>
<div class="projectnav">
	<ul>
		<li><a class="current" href="javascript:void()" onclick="on_tab(this,1)" >项目概述</a></li>
		<li><a href="javascript:void()" onclick="on_tab(this,2)" >动态</a></li>
		<li><a href="javascript:void()" onclick="on_tab(this,3)" >关注（<span id="follow">508</span>）</a></li>
        </ul>
</div>
<div id="main" style=" background:#f5f5f5;">
    
    <div class="main_box">
		<div class="product left clearfix show" id="content1">
			<h2 style="padding-left:30px;">项目产品介绍</h2>
		<div class="slider_box" id="slider_name">
		  <ul class="silder_con" style="left: 0px; width: 600px;">		
                        <!--            <li class="silder_panel clearfix"><a href="#" class="f_l"><img src="--><!--" /></a></li>-->
            <li class="silder_panel clearfix"><a href="http://yuanbaohui.com/project_index/?id=171#" class="f_l"><img src="__PUBLIC__/Home/images/c9889b3d27c8298671b82930c438f428.png"></a></li>
            		  </ul>
		  <ul class="silder_nav clearfix">            
                        <!--            <li><a href="#"><img src="--><!--"/></a></li>-->
            <li class="current" style="opacity: 1;"><a href="http://yuanbaohui.com/project_index/?id=171#"><img src="__PUBLIC__/Home/images/c9889b3d27c8298671b82930c438f428.png"></a></li>
            		  </ul>
		<a class="prev" style="opacity: 0.2;">Prev</a><a class="next" style="opacity: 0.2;">Next</a></div>
<div style="background:#ffffca;padding:20px 30px;margin-top: 10px">
			<p style="font-size: 16px;text-align: center;color: red;margin-bottom: 10px">免责声明</p>
			<p style="font-size: 14px;text-indent: 28px;color: #666;">{$config.disclaimer}</p>
		</div>
		<div class="paragraph" style="padding:30px;">
		    <p>
		    </p><p class="&quot;MsoNormal&quot;" style="font-family:Simsun;font-size:medium;background-color:#FFFFFF;text-align:justify;">
	<span style="font-family:宋体;">美基金币白皮书</span><span style="font-family:Calibri;"></span> 
</p>
	    </div>
                        
			<div class="comments">
				<h3>发表评论</h3>
                <form method="post" action="http://yuanbaohui.com/project_index/comment/?id=171">
					<textarea name="desc" id="jianjie" rows="5" cols="80" style="width:590px;"></textarea>
					<input type="submit" class="tijiao" style="border:0;" value="提交">
				</form>
			</div>
            			<div class="contactarea" style="margin-bottom:0;">
				<div style="border-bottom:1px solid #e1e1df;">
					<p class="left newcomments" style="color:#666; padding-left:30px;">最新评论</p>
                    <p class="right followers" style="padding-right:30px;"><a href="http://yuanbaohui.com/project_index/comment/?id=171">查看更多</a></p>
					<div class="clear"></div>
				</div>
                				<div class="investment" style=" padding-left:30px;">
					<div class="investment_con">
<!--					<p class="com_pic"><a href="--><!--" title="--><!--"><img src="--><!--" style="width:48px;height:48px;" /></a></p>-->
					<p class="com_pic"><a href="http://yuanbaohui.com/user_home/?uid=128380" title="接近满仓"><img style="width:48px;height:48px;"></a></p>
				        <p style=" font-weight:bold; font-family:" 微软雅黑";="" margin-top:5px;"=""><a href="http://yuanbaohui.com/user_home/?uid=128380">接近满仓</a>&nbsp;&nbsp;评论了&nbsp;&nbsp;<a href="./美基金项目官方首页-元宝网｜第一数字资产交易平台_files/美基金项目官方首页-元宝网｜第一数字资产交易平台.html">美基金</a><span style="color:#999; margin-left:10px;">2016-01-14 09:15:01</span></p>
				        <p>你天天喊狗狗币正在上涨，那天也没涨。别耽误大家时间了</p>
					</div>
                    
				</div>
                			</div>
            		</div>
                    
        <div class="product left clearfix hide" id="content2">
			    <div class="pro_comments">
				<div class="com_con">
<!--				    <p class="com_pic"><a href="--><!--" title="--><!--"><img src="--><!--" style="width:48px;height:48px;" /></a></p>-->
				    <p class="com_pic"><a href="http://yuanbaohui.com/user_home/?uid=137913" title="文青"><img style="width:48px;height:48px;"></a></p>
                    <p style=" font-weight:bold; font-family:" 微软雅黑";"=""><a href="http://yuanbaohui.com/user_home/?uid=137913">文青</a>&nbsp;&nbsp;评论了&nbsp;&nbsp;<a href="http://yuanbaohui.com/project_index/?id=171">美基金</a>&nbsp;项目<span style="color:#999; margin-left:10px;">2016-01-16 23:08:32</span></p>
				    <p>现在所有出来的币种都不要买，我看和坑人的公证币没两样，买了就跌，现有这些币种就够咱们玩的了</p>
				</div>
				<div class="clear"></div>
			</div>
            			<div class="pro_comments">
				<div class="com_con">
<!--				    <p class="com_pic"><a href="--><!--" title="--><!--"><img src="--><!--" style="width:48px;height:48px;" /></a></p>-->
				    <p class="com_pic"><a href="http://yuanbaohui.com/user_home/?uid=137913" title="文青"><img style="width:48px;height:48px;"></a></p>
                    <p style=" font-weight:bold; font-family:" 微软雅黑";"=""><a href="http://yuanbaohui.com/user_home/?uid=137913">文青</a>&nbsp;&nbsp;评论了&nbsp;&nbsp;<a href="http://yuanbaohui.com/project_index/?id=171">美基金</a>&nbsp;项目<span style="color:#999; margin-left:10px;">2016-01-16 23:07:11</span></p>
				    <p>现在所有出来的币种都不要买，我看和坑人的公证币没两样，买了就跌，注意了</p>
				</div>
				<div class="clear"></div>
			</div>
                        <div class="page"> <a href="http://yuanbaohui.com/project_index/comment/?id=171&amp;p=0">&lt;</a> <a href="#" class="current">1</a> <a href="http://yuanbaohui.com/project_index/comment/?id=171&amp;p=2">2</a>  <a href="http://yuanbaohui.com/project_index/comment/?id=171&amp;p=3">3</a>  <a href="http://yuanbaohui.com/project_index/comment/?id=171&amp;p=4">4</a>  <a href="http://yuanbaohui.com/project_index/comment/?id=171&amp;p=5">5</a>  <a href="http://yuanbaohui.com/project_index/comment/?id=171&amp;p=6">6</a>  <a href="http://yuanbaohui.com/project_index/comment/?id=171&amp;p=7">7</a>  <a href="http://yuanbaohui.com/project_index/comment/?id=171&amp;p=8">8</a>  <a href="http://yuanbaohui.com/project_index/comment/?id=171&amp;p=9">9</a>  <a href="http://yuanbaohui.com/project_index/comment/?id=171&amp;p=2">&gt;</a> </div>					</div>
                        
        <div class="product left clearfix hide" id="content3">
            		<div class="pro_comments">
			<div class="com_con left">
<!--				<p class="com_pic"><a href="--><!--" title="--><!--"><img src="--><!--" style="width:48px; height:48px;" /></a></p>-->
				<p class="com_pic"><a href="http://yuanbaohui.com/user_home/?uid=210726" title="lvv"><img style="width:48px; height:48px;"></a></p>
				<div class="left">
				<h3 class="followers"><a href="http://yuanbaohui.com/user_home/?uid=210726">lvv</a></h3>
				<p style="color:#666;"></p>
                <p style="color:#666;">0</p>
				</div>
			</div>
			<div class="focusarea right">
			    <p class="focuses"><a href="http://yuanbaohui.com/user_home/follow?uid=210726">关注</a></p>
			    <p style="color:#666;">0个粉</p>
			</div>
			<div class="clear"></div>
		</div>
            		<div class="pro_comments">
			<div class="com_con left">
<!--				<p class="com_pic"><a href="--><!--" title="--><!--"><img src="--><!--" style="width:48px; height:48px;" /></a></p>-->
				<p class="com_pic"><a href="http://yuanbaohui.com/user_home/?uid=219263" title="玉辉二哥"><img style="width:48px; height:48px;"></a></p>
				<div class="left">
				<h3 class="followers"><a href="http://yuanbaohui.com/user_home/?uid=219263">玉辉二哥</a></h3>
				<p style="color:#666;"></p>
                <p style="color:#666;">0</p>
				</div>
			</div>
			<div class="focusarea right">
			    <p class="focuses"><a href="http://yuanbaohui.com/user_home/follow?uid=219263">关注</a></p>
			    <p style="color:#666;">0个粉</p>
			</div>
			<div class="clear"></div>
		</div>
            		<div class="pro_comments">
			<div class="com_con left">
<!--				<p class="com_pic"><a href="--><!--" title="--><!--"><img src="--><!--" style="width:48px; height:48px;" /></a></p>-->
				<p class="com_pic"><a href="http://yuanbaohui.com/user_home/?uid=112821" title="zhang794584111"><img style="width:48px; height:48px;"></a></p>
				<div class="left">
				<h3 class="followers"><a href="http://yuanbaohui.com/user_home/?uid=112821">zhang794584111</a></h3>
				<p style="color:#666;"></p>
                <p style="color:#666;">0</p>
				</div>
			</div>
			<div class="focusarea right">
			    <p class="focuses"><a href="http://yuanbaohui.com/user_home/follow?uid=112821">关注</a></p>
			    <p style="color:#666;">1个粉</p>
			</div>
			<div class="clear"></div>
		</div>
            		<div class="pro_comments">
			<div class="com_con left">
<!--				<p class="com_pic"><a href="--><!--" title="--><!--"><img src="--><!--" style="width:48px; height:48px;" /></a></p>-->
				<p class="com_pic"><a href="http://yuanbaohui.com/user_home/?uid=127078" title="注册你的心"><img style="width:48px; height:48px;"></a></p>
				<div class="left">
				<h3 class="followers"><a href="http://yuanbaohui.com/user_home/?uid=127078">注册你的心</a></h3>
				<p style="color:#666;"></p>
                <p style="color:#666;">0</p>
				</div>
			</div>
			<div class="focusarea right">
			    <p class="focuses"><a href="http://yuanbaohui.com/user_home/follow?uid=127078">关注</a></p>
			    <p style="color:#666;">0个粉</p>
			</div>
			<div class="clear"></div>
		</div>
                        <div class="page"> <a href="http://yuanbaohui.com/project_index/follow/?id=171&amp;p=0">&lt;</a> <a href="#" class="current">1</a> <a href="http://yuanbaohui.com/project_index/follow/?id=171&amp;p=2">2</a>  <a href="http://yuanbaohui.com/project_index/follow/?id=171&amp;p=3">3</a></div>		</div>
        	<div class="latest right">
				<div class="support_ybc support_ovte">
			<ul id="tags">
				<li class="selectTag"><a onclick="selectTag(&#39;tagContent0&#39;,this)" href="javascript:void(0)">投票</a> </li>
				
				<div class="clear"></div>
			</ul>
			<div id="tagContent">
				<div class="tagContent selectTag" id="tagContent0">
					<p class="ovte"><a href="javascript:tp(171,1);" class="ovteone">投一票</a></p>
					<p class="ovte">目前累计：<span id="span1">388</span>票</p>
					<p class="ovte_remind">1. 注册用户且有交易记录的可以参与投票<br>2. 每个用户每小时可投一票<br>3. 首页“热门项目”按近7日内投票数排序</p>
				</div>
				
			</div>
		</div>
		                        				<div class="focusnum" style=" position:relative;">
					<div class="focusnum1">
						<h2>目前关注人数<br>508</h2>
						<p class="state statePurple" style=" position:absolute; right:20px; top:20px;">币币交易中</p>
					</div>
					<p>此项目为币币交易中，添加“关注”，及时关注最新动态。</p>
					<p class="focus1">
												<a href="http://yuanbaohui.com/project_index/?id=171#">已关注</a>
											</p>
				</div>
            		 <!--添加了团队成员-->
                        <div class="focusnum">
				<div class="focusnum1">
                    <h2 class="left">团队成员</h2>
                                         
                   <div class="clear"></div>
            </div>
                <div class="teamarea">
		   			 <div class="left rolearea">
                         <p class="roles"><a href="http://yuanbaohui.com/user_home/?uid=89515" title="yzhou">
<!--		<img src="--><!--" style="width:72px;height:72px; background:url(/images/avatardefault.jpg) 0 0 no-repeat;"/></a></p>-->
			 <img src="__PUBLIC__/Home/images/ulogodefault.jpg" style="width:72px;height:72px; background:url(/Public/home/images/avatardefault.jpg) 0 0 no-repeat;"></a></p>
			 <p class="rolename"><a href="http://yuanbaohui.com/user_home/?uid=89515">yzhou</a></p>
			 <p class="role"><a href="http://yuanbaohui.com/user_home/?uid=89515" title="">发起人</a></p>
			</div>
		                      					<div class="clear"></div>
					</div></div>
                   <div class="investmentarea">
		<div class="focusnum1" style="border-bottom:1px solid #e2e2e2;">
			<h2 class="left">新闻公告</h2>
						<p class="right" style="height:40px; line-height:40px;"><a href="http://yuanbaohui.com/news?corp=171&flag=1">查看更多</a></p>
						<div class="clear"></div>
		</div>
		<ul>
									<li><span class="recruit" style="color:#ccc;">2016-03-20</span><a href="http://yuanbaohui.com/news/detail/?id=846" target="_blank">【美基金】更换美基金管理人公告</a></li>
						<li><span class="recruit" style="color:#ccc;">2015-10-29</span><a href="http://yuanbaohui.com/news/detail/?id=690" target="_blank">【美基金】美基金15年10月29日净值</a></li>
						<li><span class="recruit" style="color:#ccc;">2015-09-15</span><a href="http://yuanbaohui.com/news/detail/?id=614" target="_blank">【美基金】美基金币价格异常和解散官方QQ群的说明</a></li>
						<li><span class="recruit" style="color:#ccc;">2015-09-07</span><a href="http://yuanbaohui.com/news/detail/?id=601" target="_blank">【公告】美基金15年9月7日净值计算</a></li>
						<li><span class="recruit" style="color:#ccc;">2015-08-18</span><a href="http://yuanbaohui.com/news/detail/?id=557" target="_blank">美基金币网站可以正常访问了</a></li>
						<li><span class="recruit" style="color:#ccc;">2015-08-13</span><a href="http://yuanbaohui.com/news/detail/?id=544" target="_blank">美基金币网站维护通知</a></li>
						<li><span class="recruit" style="color:#ccc;">2015-05-18</span><a href="http://yuanbaohui.com/news/detail/?id=401" target="_blank">美基金5月18日净值计算</a></li>
						<li><span class="recruit" style="color:#ccc;">2015-09-07</span><a href="http://yuanbaohui.com/news/detail/?id=345" target="_blank">【公告】美基金3月31日净值计算，发售完毕</a></li>
						<li><span class="recruit" style="color:#ccc;">2015-03-04</span><a href="http://yuanbaohui.com/news/detail/?id=322" target="_blank">美基金3月3日净值计算</a></li>
						<li><span class="recruit" style="color:#ccc;">2015-02-10</span><a href="http://yuanbaohui.com/news/detail/?id=310" target="_blank">美基金2月10日净值计算</a></li>
					</ul>				
	</div>
	<div class="investmentarea">
		<div class="focusnum1" style="border-bottom:1px solid #e2e2e2;">
			<h2 class="left">招募人员</h2>
						<div class="clear"></div>
		</div>
		<ul>
						<li style="color:#999;">暂无消息</li>
					</ul>				
	</div>
	<div class="investmentarea">
		<div class="focusnum1" style="border-bottom:1px solid #e2e2e2;">
			<h2>免责声明</h2>
		</div>
		<p style="line-height:22px; color:#666; padding:10px 20px; border-bottom:1px solid #eee;">{$config.disclaimer}</p>			
	</div>
</div>
<div class="clear"></div>
		
    <script type="text/javascript" src="__PUBLIC__/Home/js/tab.js"></script>
	<script type="text/javascript">
		function tp(id,s){
			$.post("/info/addvote",{id:id,s:s},function(data){
				var msg = eval('(' + data + ')');
				if(msg.err == 3){
					$('#afoll').html('已关注');
					$('#follow').html(parseInt($('#follow').html())+1);
					/* $('#afoll1').html('已关注');
					$('#follow1').html(parseInt($('#follow1').html())+1); */
					$('#span1').html(parseInt($('#span1').html())+1);
					$('#span2').html(parseInt($('#span2').html())+1);
                    $('#votesuccess').show();
                    $('#votesuccess').html(msg.msg).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500);
                    $('#votesuccess').delay(1000).hide(0);
					//alert(msg.msg);
				}else if(msg.err == 2){
					$('#span1').html(parseInt($('#span1').html())+1);
					$('#span2').html(parseInt($('#span2').html())+1);
                    $('#votesuccess').show();
                    $('#votesuccess').html(msg.msg).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500);
                    $('#votesuccess').delay(1000).hide(0);
					//alert(msg.msg);
				}else if(msg.err == 0){
					location.href='/user/login/?url=%2Fproject_index%2F%3Fid%3D171';
					return;
				}else{
					alert(msg.msg);
				}
			}) 
		}
	</script>
    </div>
</div> 
<style>
.show{display:block};
.hide{display:none};

</style>
<script>

function on_tab(_this,num){
	$(".projectnav").children("ul").children("li").find("a").removeClass("current");
	$(_this).addClass('current');
	
	
	if(num=='1'){
		$("#content1").removeClass("hide");	$("#content1").addClass("show");
		$("#content2").removeClass("show");	$("#content2").addClass("hide");
		$("#content3").removeClass("show");	$("#content3").addClass("hide");
		
		
	}
	if(num=='2'){
		$("#content1").removeClass("show");	$("#content1").addClass("hide");
		$("#content2").removeClass("hide");	$("#content2").addClass("show");
		$("#content3").removeClass("show");	$("#content3").addClass("hide");	

	}
	if(num=='3'){
		$("#content1").removeClass("show");	$("#content1").addClass("hide");
		$("#content2").removeClass("show");	$("#content2").addClass("hide");
		$("#content3").removeClass("hide");	$("#content3").addClass("show");
		
	}
	
	}
	
</script> 
<script type="text/javascript" src="__PUBLIC__/Home/js/jquery.slides.js"></script>
<!--footer start--> 
<include file="App/Home/View/Public/footer.html"/>

75:F:\git\coin\bisheng commerce\App\Home\View\Public\404.html
<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>对不起，未能找到您想要的页面</title>
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" rev="stylesheet" type="text/css" media="all" href="__PUBLIC__/Home/css/basev2.css">
<style>
body { background:url(http://img.kuai.xunlei.com/img/v2/log_bg.jpg) repeat; }
</style>
</head>
<body>
<div class="bg_404"><p>404 对不起，未能找到您想要的页面</p><a class="back_home_btn" href="{:U('Index/index')}" title="返回首页">返回首页</a></div>
<img src="%E8%BF%85%E9%9B%B7%E5%BF%AB%E4%BC%A0-%E5%AF%B9%E4%B8%8D%E8%B5%B7%EF%BC%8C%E6%9C%AA%E8%83%BD%E6%89%BE%E5%88%B0%E6%82%A8%E6%83%B3%E8%A6%81%E7%9A%84%E9%A1%B5%E9%9D%A2_files/r.txt" style="display:none;">

</body></html>

76:F:\git\coin\bisheng commerce\App\Home\View\Public\b_stop.html
<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="utf-8"> 
<style>
body { background:url(http://img.kuai.xunlei.com/img/v2/log_bg.jpg) repeat; }
.bg_404{ background:url(__PUBLIC__/Home/images/b_stop.jpg) no-repeat center center; width:545px; height:373px; margin:50px auto; position:relative;}
.bg_404 p{ position:relative; top:65px; left:280px; line-height:30px; font-size:18px; font-family:"方正艺黑简体"; color:#2b1f1f;}
.bg_404 a{ color:#fff; position:relative; top:72px; left:330px;}
</style>
</head>
<body>
<div class="bg_404"><p>很抱歉!<br>该币种暂未开启交易，<br>或已停止交易!</p><a class="back_home_btn" href="{:U('Orders/currency_trade')}" title="返回首页">返回首页</a></div>

</body></html>

77:F:\git\coin\bisheng commerce\App\Home\View\Public\footer.html
<style>
.rightwidth{ width:340px;}
</style>
<!--footer start-->

<div class="coin_footer" style="position:relative;">
	<div class="coin_hint">

		<h2>{$info_one4.title|default="风险提示"}</h2>
		<p>{$config.risk_warning}</p>
	</div>
	<div class="coin_footerbar">
		<div class="coin_footer_nav clearfix">
			<div class="coin_nav coin_copy left">
				<p><a href="{:U('Index/index')}"><img style=" height:55px;" src="{$config.logo}"></a></p>
			</div>
			<div class="coin_nav left">
				<h2>{$config.name|default="虚拟币"}团队</h2>
				<ul>
					<li><a href="{:U('Index/index')}">{$config.name|default="虚拟币"}</a></li>
				<volist name="team" id="vo">
					<li><a href="{:U('Art/details',array('team_id'=>$vo['article_id']))}" target="_blank" class="left">{$vo.title}</a></li>
                </volist>
				</ul>
			</div>
			<div class="coin_nav left">
				<h2>帮助中心</h2>
				<ul>
                <volist name="help" id="vo">
					<li><a href="{:U('Help/index',array('id'=>$vo['id']))}" target="_blank" class="left">{$vo.name}</a></li>
                </volist>
				</ul>
			</div>
			<div class="coin_nav coin_nav02 left">
				<h2 class="clearfix"><span class="left">联系我们</span><a href="http://weibo.com/{$config.weibo}" target="_blank" class="coin_sina left"></a><!--<a href="#" id="coin_weixin" class="coin_wei left"></a>--></h2>
				<ul>
					<li>客服电话：{$config.tel|default="暂无"}</li>
					<li>客服QQ：{$config.qq1|default="暂无"}</li>
					<li><a href="mailto:{$config['email']}">客服邮箱：{$config.email|default="暂无"}</a></li>
					<li><a href="mailto:{$config['business_email']}">业务合作：{$config.business_email|default="暂无"}</a></li>
				</ul>
			</div>
			<div class="coin_nav coin_nav02 left rightwidth" style="position:relative;">
              <div style="float:left; padding-top:25px; padding-left:10px;"><img style=" width:100px;" src="{$config['weixin']}"/></div>
              <div style=" float:left; padding-left:10px;">
				<p class="coin_phone400">{$config.tel|default="暂无"}</p>
				<p class="coin_phoneqq"><a href="http://wpa.qq.com/msgrd?v=3&uin={$config['qq1']}&site=qq&menu=yes" target="_blank">在线客服</a></p>
				<p>工作日:9-19时 节假日:9-18时</p>
               </div>
				<div class="group" style="left:12px;margin-top: 40px">
					<ul class="qq_all" style="    margin-left: 10px;">
						<li><a style="flont:left; " href="javascript:void(0)">{$config.name|default="虚拟币"}官方群<img style="margin-top:5px;" src="__PUBLIC__/Home/images/xiala.png"></a>
							<ul style="margin-left: 105px;">
								<li>{$config.name|default="虚拟币"}官方1群 {$config.qqqun1|default="暂无"}</li>
								<li>{$config.name|default="虚拟币"}官方2群 {$config.qqqun2|default="暂无"}</li>
								<li>{$config.name|default="虚拟币"}官方3群 {$config.qqqun3|default="暂无"}</li>
							</ul>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
<div class="footer_aq">
	<p>{$config.copyright|default="暂无"}</p>
	<p>{$config.record|default="暂无"}</p>
	<ul class="footerSafety clearfix">
        <li class="safety02"><a href="http://net.china.com.cn/" target="_blank"></a></li>
        <li class="safety03"><a href="http://webscan.360.cn/index/checkwebsite/?url={$config['localhost']}" target="_blank"></a></li>
        <li class="safety04"><a href="http://www.cyberpolice.cn/wfjb/" target="_blank"></a></li>
    </ul>
</div>
<div id="weixin" style="position:absolute; bottom:88px; left:50%; margin-left:170px; display:block;"><!--<img src="{$config.logo}">--></div>
<script>
	$('#coin_weixin').mouseover(function(){
		$('#weixin').show();
	}).mouseout(function(){
		$('#weixin').hide();
	});
</script>
<!--footer end-->
<script type="text/javascript" src="__PUBLIC__/Home/js/gotop.js"></script>
<script type="text/javascript" src="__PUBLIC__/Home/js/link.js"></script>
<script type="text/javascript" src="__PUBLIC__/Home/js/slides.js"></script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?0ab4db557b96d841137861e0740d1e0a";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>



</div></body></html>

78:F:\git\coin\bisheng commerce\App\Home\View\Public\header.html
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" >
<meta name="renderer" content="webkit">
<meta name="keywords" content=""/>
<meta name="description" content=""/>
<meta property="wb:webmaster" content="8af72a3a7309f0ee">
    <title><notempty name='article'>{$article.title}-</notempty>{$config.title|default="虚拟币交易网站"}</title>
	<link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/base.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/layout.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/subpage.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/user.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/coin.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/zcpc.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/iconfont/demo.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/iconfont/iconfont.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/jb_style.css">
    <script src="__PUBLIC__/Home/js/hm.js">
    </script><script type="text/javascript" src="__PUBLIC__/Home/js/jquery-1.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Home/js/downList.js"></script>


    <script type="text/javascript" src="__PUBLIC__/js/jquery-1.8.2.js"></script>
    <script type="text/javascript" src="__PUBLIC__/js/jquery-2.1.1.min.js"></script>
    <script src="__PUBLIC__/js/bootstrap.min.js?v=3.4.0"></script>
    <script type="text/javascript" src="__PUBLIC__/js/layer/layer.js"></script>
    <script src="__PUBLIC__/js/jquery.validate.min.js"></script>
    <script src="__PUBLIC__/js/messages_zh.min.js"></script>
    <script src="__PUBLIC__/js/base.js"></script>

</head>
<body>
<!--<div class="clearfix phone_top" id="phone_top_div" style="display:none;">
	<div class="left">
		<p class="left phone_logo"><img src="/images/phone_logo01.png"/></p>
		<p class="left phone_title">第一数字货币众筹交易平台</p>
	</div>
	<a href="javascript:hidephone();" class="phone_x">X</a>
</div>-->
<!--top start-->
<div style="background:#f9f9f9; height:30px;">
    <div style="width:1000px; margin:0 auto;">
        <ul class="qqkf left" style="line-height:30px; color:#999;">
            <li class="phone"><a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin={$config['qq1']}&site=qq&menu=yes" class="qq_qq"></a>{$config.qq1|default="暂无"}</li>
            <li class="phone400">{$config.tel|default="暂无"}</li>
            <li class="phone_email"><a href="mailto:{$config['email']}">{$config.email|default="暂无"}</a></li>
            <li>&nbsp;&nbsp;工作日:9-19时 节假日:9-18时</li>
        </ul>
            <if  condition="!empty($_SESSION['USER_KEY_ID'])">
                <div class="person right">
                    <a class="left myhome" href="{:U('ModifyMember/modify')}" style=" height:30px; line-height:30px; margin-right:5px;">
                        {$username} </a>
                        
                    <div style="display: none;" class="mywallet_list"><div class="clear"><ul class="balance_list"><h4>可用余额</h4><li><a href="javascript:void(0)"><em style="margin-top: 5px;" class="deal_list_pic_cny"></em><strong>人民币：</strong><span>{$member.rmb}</span></a></li></ul><ul class="freeze_list"><h4>委托冻结</h4><li><a href="javascript:void(0)"><em style="margin-top: 5px;" class="deal_list_pic_cny"></em><strong>人民币：</strong><span>{$member.forzen_rmb}</span></a></li></ul></div><div class="mywallet_btn_box"><a href="{:U('User/pay')}">充值</a><a href="{:U('User/draw')}">提现</a><a href="{:U('User/index')}">转入</a><a href="{:U('User/index')}">转出</a><a href="{:U('Entrust/manage')}">委托管理</a><a href="{:U('Trade/myDeal')}">成交查询</a></div></div>
                    <span class="left" style="height:30px; line-height:30px; color:#999; margin-right:5px;">(UID: {$Think.session.USER_KEY_ID} )</span>
                    <a class="left" href="{:U('Login/loginOut')}" style="height:30px; line-height:30px; margin:0 5px;">退出</a>
                    <div id="my" class="account left" href="javascript:void(0)" style="z-index:9997; margin-right:5px;">
                        <a class="user_me" href="{:U('User/index')}">我的账户</a>
                        <ul class="accountList" style="padding: 6px 0px; background: rgb(85, 85, 85) none repeat scroll 0% 0%; border-radius: 5px 0px 5px 5px; display: none;">
                            <!--<li class="accountico no"></li>-->
                            <li><a href="{:U('User/index')}">我的资产</a></li>
                            <li><a href="{:U('Entrust/manage')}">我的交易</a></li>
                            <li><a href="{:U('User/zhongchou')}">我的众筹</a></li>
                            <li style="border-top:1px solid #666;"><a href="{:U('User/pay')}">人民币充值</a></li>
                            <li><a href="{:U('User/draw')}">人民币提现</a></li>
                            <li style="border-bottom:1px solid #444;"><a href="{:U('User/index')}">充币提币</a></li>
                            <li><a href="{:U('User/updatePassword')}">修改密码</a></li>
                            <li><a href="{:U('User/sysMassage')}">系统消息<if condition="$newMessageCount"><span class="messagenum">{$newMessageCount}</span></if></a></li>
                        </ul>
                    </div>
                </div>
            </if>
        </if>
		<if condition="empty($_SESSION['USER_KEY_ID'])">
				<div class="loginArea right" style=" margin-right:5px;">
            	<a href="{:U('Login/index')}" style="color:#f60; font-size:14px;">登录</a>
            	<span class="sep">&nbsp;|&nbsp;</span>
            	<a href="{:U('Reg/reg')}" style="color:#f60; font-size:14px;">注册</a>
        		</div>
		</if>
    </div>
</div>
<div class="top">
    <div class="wapper clearfix">
        <h1 class="left"><a href="{:U('Index/index')}"><img style=" width:280px; height:70px;" src="{$config.logo}" alt="虚拟币" title="虚拟币"></a></h1>
        <ul class="nav right" style="z-index:9995;">
            <li><a href="{:U('Index/index')}">首页</a></li>
            <li><a href="{:U('Orders/currency_trade')}">交易大厅</a></li>
            <li><a href="{:U('Zhongchou/index')}">认购中心<!--hr--></a></li>
            <li><a href="{:U('Safe/index')}">用户中心</a></li>
            <li><a href="{:U('Help/index',array('id'=>60))}">帮助中心</a></li>
            <li><a href="{:U('Art/index',array('ramdon_id'=>'1'))}">最新动态</a></li>
            <li><a href="{:U('Market/index')}">行情中心</a></li>
            <li><a href="{:U('Dow/index')}">下载中心</a></li>
        </ul>
    </div>
</div>
<div class="pclxfsbox"> 
		<ul> 
			<li id="opensq">
				<i class="pcicon1 iscion6" ></i>
				<div class="pcicon1box">
					<div class="iscionbox" >
						<p>在线咨询</p>
						<p>{$config['worktime']|default="暂无"}</p>
					</div>
					<i></i>
				</div>
			</li>
			<li> 
				<i class="pcicon1 iscion1"></i>
				<div class="pcicon1box">
					<div class="iscionbox">
						<p><img src="{$config['weixin']}" alt="投筹网微信公众号" width="108"></p>
						<p>{$config.name|default="虚拟网"}微信群</p>
					</div>
					<i></i>
				</div>
			</li>
			<li>
				<i class="pcicon1 iscion2"></i>
				<div class="pcicon1box">
					<div class="iscionbox">
						<p>{$config['tel']|default="暂无"}</p>
						<p>{$config.name|default="虚拟网"}</p>
					</div>
					<i></i>
				</div>
			</li>
           <li>
				<i class="pcicon1 iscion3"><a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin={$config['qq1']}&site=qq&menu=yes"></a></i>
				<div class="pcicon1box">
					<div class="iscionbox">
						<p>{$config.qq1|default="暂无"}</p>
						<p>{$config.name|default="虚拟网"}QQ在线客服1</p>
					</div>
					<i></i>
				</div>
			</li>
            <li>
				<i class="pcicon1 iscion3" style="background:url(__PUBLIC__/Home/images/kefu2.png) no-repeat #9b9b9b;background-position:-144px 11px;"><a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin={$config['qq2']}&site=qq&menu=yes"></a></i>
				<div class="pcicon1box">
					<div class="iscionbox">
						<p>{$config.qq2|default="暂无"}</p>
						<p>{$config.name|default="虚拟网"}QQ在线客服2</p>
					</div>
					<i></i>
				</div>
			</li>
            <li>
				<i class="pcicon1 iscion3" style="background:url(__PUBLIC__/Home/images/kefu3.png) no-repeat #9b9b9b;background-position:-144px 11px;"><a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin={$config['qq3']}&site=qq&menu=yes"></a></i>
				<div class="pcicon1box">
					<div class="iscionbox">
						<p>{$config.qq3|default="暂无"}</p>
						<p>{$config.name|default="虚拟网"}QQ在线客服3</p>
					</div>
					<i></i>
				</div>
			</li>
			
			<li>
				<i class="pcicon1 iscion4"></i>
				<div class="pcicon1box">
					<div class="iscionbox">
						<p>返回顶部</p>
					</div>
					<i></i>
				</div>
			</li>
		</ul>
	</div>
    <script type="text/javascript"> 
		$(function(){
			$(".pcicon1").on("mouseover",function(){
				$(this).addClass("lbnora").next(".pcicon1box").css({"width":"148px"});
			}).on("mouseout",function(){
				$(this).removeClass("lbnora").next(".pcicon1box").css("width","0px");
			});
			$(".iscion4").on("click",function(){
				$("html, body").animate({
					scrollTop: 0
				})
			});

			var objWin;
			$("#opensq").on("click",function(){
				var top = window.screen.height/2 - 250;
				var left = window.screen.width/2 - 390;
				var target = "http://p.qiao.baidu.com//im/index?siteid=8050707&ucid=18622305"; 
				var cans = 'width=780,height=550,left='+left+',top='+top+',toolbar=no, status=no, menubar=no, resizable=yes, scrollbars=yes' ;

				if((navigator.userAgent.indexOf('MSIE') >= 0)&&(navigator.userAgent.indexOf('Opera') < 0)){
						//objWin = window.open ('','baidubridge',cans) ; 
						if (objWin === undefined || objWin === null || objWin.closed) { 
							objWin = window.open (target,'baidubridge',cans) ; 
						}else { 
							objWin.focus();
						}
				}else{
					var win = window.open('','baidubridge',cans );
					if (win.location.href == "about:blank") {
					    //窗口不存在
					    win = window.open(target,'baidubridge',cans);
					} else {
					    win.focus();
					}
				}
				return false;

			})
		})
		
	</script>
<!--top end-->

<script>
$(".myhome").hover(function(){
	$(".mywallet_list").show();	
},function(){
	$(".mywallet_list").hover(function(){
		$(".mywallet_list").show();	
	},function(){
		$(".mywallet_list").hide();	
	});
	$(".mywallet_list").hide();
});
</script>

79:F:\git\coin\bisheng commerce\App\Home\View\Public\left.html
<div id="my_menu" class="sdmenu left">
		<div>
			<p><i class="iconfont">&#xe61e;</i>&nbsp;我的资产</p>
						<a href="{:U('User/index')}" class="menu"><b class="ic-uc"></b><i class="iconfont">&#xe6f6;</i>&nbsp;&nbsp;账户资产</a>
                        <a href="{:U('Finance/index')}" class="menu13"><b class="ic-uc"></b><i class="iconfont">&#xe93e;</i>&nbsp;&nbsp;财务日志</a>
						<a href="{:U('FillByBank/index')}" class="menu15"><b class="ic-uc"></b><i class="iconfont">&#xe602;</i>&nbsp;&nbsp;在线网银支付</a>
                        <a href="{:U('Fill/index')}" class="menu138"><b class="ic-uc"></b><i class="iconfont">&#xe93e;</i>&nbsp;&nbsp;网银支付日志</a>
					</div>
		<div style="position:relative;">
			<p><i class="iconfont">&#xe643;</i>&nbsp;我的交易</p>
						<a href="{:U('Entrust/manage')}" class="menu2"><b class="ic-uc"></b><i class="iconfont">&#xe616;</i>&nbsp;&nbsp;委托管理</a>
						<a href="{:U('Trade/myDeal')}" class="menu3"><b class="ic-uc"></b><i class="iconfont">&#xe65b;</i>&nbsp;&nbsp;我的成交</a>
						<a href="{:U('Entrust/history')}" class="menu4"><b class="ic-uc"></b><i class="iconfont">&#xe62d;</i>&nbsp;&nbsp;委托历史</a>
						
						<a href="{:U('User/zhongchou')}" class="menu6"><b class="ic-uc"></b><i class="iconfont">&#xe60b;</i>&nbsp;&nbsp;我的众筹</a>
					</div>
                    <div>
			<p><i class="iconfont">&#xe60e;</i>&nbsp;安全中心</p>
            		
						<!--<a href="{:U('Safe/index')}" class="menu11"><b class="ic-uc"></b><i class="iconfont">&#xe649;</i>&nbsp;&nbsp;安全中心</a>-->
                        <a href="{:U('User/updatePassword')}" class="menu8"><b class="ic-uc"></b><i class="iconfont">&#xe638;</i>&nbsp;&nbsp;修改密码</a>
                        <a href="{:U('User/updateMassage')}" class="menu7"><b class="ic-uc"></b><i class="iconfont">&#xe649;</i>&nbsp;&nbsp;个人信息</a>
						<!--<a href="{:U('Safe/mobilebind')}" class="menu12"><b class="ic-uc"></b><i class="iconfont">&#xe609;</i>&nbsp;&nbsp;手机绑定</a>-->
					  </div>
				  <div>
			<p><i class="iconfont">&#xe611;</i>&nbsp;账户中心</p>
			            <a href="{:U('User/pay')}" class="menu12"><b class="ic-uc"></b><i class="iconfont">&#xe620;</i>&nbsp;&nbsp;人民币充值</a>
			            <a href="{:U('User/draw')}" class="menu14"><b class="ic-uc"></b><i class="iconfont">&#xe6f0;</i>&nbsp;&nbsp;人民币提现</a>
            		    <a href="{:U('Safe/index')}" class="menu11"><b class="ic-uc"></b><i class="iconfont">&#xe660;</i>&nbsp;&nbsp;用户中心</a>
						<a href="{:U('User/invit')}" class="menu9"><b class="ic-uc"></b><i class="iconfont">&#xe602;</i>&nbsp;&nbsp;邀请好友</a>
						<a href="{:U('User/sysMassage')}" class="menu10"><b class="ic-uc"></b><i class="iconfont">&#xe664;</i>&nbsp;&nbsp;系统消息<if condition="$newMessageCount"><span class="messagenum">{$newMessageCount}</span></if></a>



					  </div>
		</div>

80:F:\git\coin\bisheng commerce\App\Home\View\Public\time_stop.html
<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="utf-8"> 
<style>
body { background:url(http://img.kuai.xunlei.com/img/v2/log_bg.jpg) repeat; }
.bg_404{ background:url(__PUBLIC__/Home/images/b_stop.jpg) no-repeat center center; width:545px; height:373px; margin:50px auto; position:relative;}
.bg_404 p{ position:relative; top:65px; left:280px; line-height:30px; font-size:18px; font-family:"方正艺黑简体"; color:#2b1f1f;}
.bg_404 a{ color:#fff; position:relative; top:72px; left:330px;}
</style>
</head>
<body>
<div class="bg_404"><p>很抱歉!<br>该币种暂未到<br>交易开启时间段!</p><a class="back_home_btn" href="{:U('Orders/currency_trade')}" title="返回首页">返回首页</a></div>

</body></html>

81:F:\git\coin\bisheng commerce\App\Home\View\Reg\reg.html
<include file="App/Home/View/Public/header.html"/>
<!--top end-->

<style type="text/css">
.ybc_header {
    width: 1000px;
    height: 70px;
    margin: 10px auto;
}
.main{ width:100%; background-color:#fff; min-height:550px; _height:550px;font-size:12px; color:#666; font-family:"微软雅黑";}
.main_box{ width:1000px; margin:0 auto;
    min-height: 400px;
	padding:30px;
	padding-top:0;
	border: 1px solid #e1e1df;
	background-color: #fbfaf8;
	margin-left: 100px;}
.warning {
    line-height: 24px;
    margin-bottom: 10px;
    color: #333;
    font-size: 14px;
    word-break: break-all;
	margin-top:0px;

 
}
.warning h2{  height:60px; line-height:60px; border-bottom:1px solid #e1e1df; width:100%; text-align:center; margin-bottom:20px;color:#333; font-weight:normal;}
.warning h3{  height:40px;  line-height:40px;width:100%; margin-top:20px;color:#333;font-weight:normal;}

.ybc_label{ width:380px; height:30px; line-height:30px; text-align:right; padding-right:5px;}
.ybc_user2 {
    margin-bottom: 20px;
    margin-top: 50px;
	height:20px;

}
.ybc_user1 {
    margin-bottom: 20px;
    margin-top: 30px;

	height:40px;

}

.left {
    float: left;
}
.ybc_text .ybc_next {
    width: 204px;
    text-align: center;
    height: 40px;
    line-height: 40px;
    background: #f70;
    color: #fff;
    font-size: 16px;
    font-family: 'Microsoft Yahei';
    border: 0;
    padding: 0;
    cursor: pointer;
}
.clearfix {
    zoom: 1;
}
.ybc_hint1 {
    height: 30px;
    line-height: 30px;
    color: #999;
	margin-left:15px;
}
.tycolor {
color: #2471cb; 
    text-decoration: underline;
}
</style>
<div class="main" id="reg-prev">
	<div class="main_box">
		<div class="warning">
			<h2>风险警示</h2>
			{$config.reg_risk_warning}
		</div>
		<div class="ybc_user2 clearfix">
			<div class="ybc_text left"><input name="agree" id="tongyi" type="checkbox" onclick="xuanzhong()"></div>
			<div class="ybc_hint left"><label for="tongyi">我已经认真阅读以上风险提示，并已同意{$config.name} <a href="{:U('Reg/terms')}" id="agreement" class="tycolor">服务条款</a>，同意在自担风险，自担损失的情况下参与交易
</label></div>
			<div class="ybc_hint left"><span id="agree"></span></div>
		</div>
		<div class="ybc_user1 clearfix">
			<div class="ybc_label left"><label>&nbsp;</label></div>
			<div class="ybc_text left"><input value="继续注册" id="next-btn" class="ybc_next" style="background-color:#e1e1e1; " type="submit"></div>
			<div class="ybc_hint1 left"><span id="agree"> <a href="{:U('Index/index')}" class="tycolor">取消</a></span></div>
		</div>
	</div>
</div>

<div class="ybc_section" id="reg-now" style="display:none;">
    <ul class="ybc_user_nav clearfix Font18">
        <li class="current"><span>1</span>邮箱注册</li>
        <li id="currentpwd"><span>2</span>设置交易密码</li>
        <li><span>3</span>实名认证</li>
        <li><span>4</span>注册成功</li>
    </ul>
    <form class="ybc_userarea" id="ttttform" method="post" jump-url="{:U('Reg/regSuccess')}" action="{:U('Reg/addReg')}" onsubmit="return step2();">
        <div id="step1">
            <!--<div class="ybc_user clearfix">
                <div class="ybc_label left"><label for="pid">邀请码</label></div>
                <div class="ybc_text left"><input type='text' name='pid' value="0"></div>
            </div>-->
            <div class="ybc_user clearfix">
                <div class="ybc_label left"><label for="email">电子邮箱</label></div>
                <div class="ybc_text left"><input name="email" id="email" type="text"></div>
                <div class="ybc_hint left"><strong class="msg_i" id="email_msg">i</strong><span id="emailmsg">请输入您的电子邮箱，用于登录和找回密码</span></div><!--默认 i class="msg_i"  正确class="msg_error"  错误class="msg_ok"-->
            </div>
            <div class="ybc_user clearfix">
                <div class="ybc_label left"><label for="pwd">登录密码</label></div>
                <div class="ybc_text left"><input id="pwd" name="pwd" type="password"></div>
                <div class="ybc_hint left"><strong class="msg_i" id="pwd_msg">i</strong><span id="pwdmsg">密码长度6-20位</span></div>
            </div>
            <div class="ybc_user clearfix">
                <div class="ybc_label left"><label for="repwd">重复密码</label></div>
                <div class="ybc_text left"><input id="repwd" name="repwd" type="password"></div>
                <div class="ybc_hint left"><strong class="msg_i" id="repwd_msg">i</strong><span id="repwdmsg">重复输入密码，两次需要一致</span></div>
            </div>
            <div class="ybc_user clearfix">
                <div class="ybc_label left"><label for="pid">邀请码</label></div>
                <div class="ybc_text left"><input name="pid" <if condition="$pid">value="{$pid}" readonly="readonly"</if>  type="text"></div>
                <div class="left" style="color:#f00; line-height:30px;">选填项</div>
            </div>
            <div class="ybc_user clearfix">
                <div class="ybc_label left"><label>&nbsp;</label></div>
                <div class="ybc_text left"></div>
               
                <div class="ybc_hint left"><span id="agree"></span></div>
            </div>
            <div class="ybc_user clearfix">
                <div class="ybc_label left"><label>&nbsp;</label></div>
                <div class="ybc_text left"><input value="下一步" class="ybc_next" onclick="step1()" type="button"></div>
            </div>
        </div>
        <div id="step2" style="display:none">
            <div class="ybc_warn Font16" style="background:none; margin:-40px 0 60px 0;"><span class="msg_warn">！</span>为保障您的资金安全，请设置交易密码。				<br>对账户资产进行投资、交易、转出时，需用到交易密码，请务必牢记。</div>
            <div class="ybc_user clearfix">
                <div class="ybc_label left"><label for="pwdtrade">交易密码</label></div>
                <div class="ybc_text left"><input id="pwdtrade" name="pwdtrade" type="password"></div>
                <div class="ybc_hint left"><strong class="msg_i" id="pwdtrade_msg">i</strong><span id="pwdtrademsg">请输入交易密码，不能与登录密码相同</span></div>
            </div>
            <div class="ybc_user clearfix">
                <div class="ybc_label left"><label for="repwdtrade">重复交易密码</label></div>
                <div class="ybc_text left"><input id="repwdtrade" name="repwdtrade" type="password"></div>
                <div class="ybc_hint left"><strong class="msg_i" id="repwdtrade_msg">i</strong><span id="repwdtrademsg">重复输入交易密码，两次需要一致</span></div>
            </div>
            <div class="ybc_user clearfix">
                <div class="ybc_label left"><label>&nbsp;</label></div>
                <div class="ybc_text left"><input value="下一步" class="ybc_next" type="submit"></div>
            </div>
        </div>
    </form>
</div>
<script src="__PUBLIC__/Home/js/form.js"></script>
<script type="text/javascript">
    vali = {email: 0, pwd: 0, repwd: 0,tongyi:1};
    valistep2 = {pwdtrade: 0, repwdtrade: 0}
    $('#email').bind('blur', function(){
        var path_Email = "{:U('Reg/ajaxCheckEmail')}";
        $.get(path_Email,{email:encodeURIComponent($(this).val())}, function(d){
            if(d['status'] == 1){
                $('#email_msg').html("√");
                $('#email_msg').css('msg_ok');
            }else{
                $('#email_msg').html("×");
                $('#email_msg').css('msg_error');
            }
            validateMsg('email', d['msg'], d['status']);
            vali.email = d['status'];
        }, 'json');
    });

    $('#pwd').bind('blur', function(){
        var pLen = $(this).val().length;
        if(pLen < 6 || pLen > 20) {
            $('#pwd_msg').html("×");
            $('#pwd_msg').css('msg_error');
            return validateMsg('pwd', '密码长度在6-20个字符之间', 0);
        }
        $('#pwd_msg').html("√");
        $('#pwd_msg').css('msg_ok');
        return validateMsg('pwd', '', vali.pwd = 1);
    });
    $('#repwd').bind('blur', function(){
        var pLen = $(this).val().length;
        if(pLen < 6 || pLen > 20){
            $('#repwd_msg').html("×");
            $('#repwd_msg').css('msg_error');
            return validateMsg('repwd', '密码长度在6-20个字符之间', 0);
        }
        if($('#pwd').val() != $('#repwd').val()){
            $('#repwd_msg').html("×");
            $('#repwd_msg').css('msg_error');
            return validateMsg('repwd', '密码不一致，请重新输入。', 0);
        }
        $('#repwd_msg').html("√");
        $('#repwd_msg').css('msg_ok');
        return validateMsg('repwd', '', vali.repwd = 1);
    });
    $('#pwdtrade').bind('blur', function(){
        var pLen = $(this).val().length;
        var repLen = $('#repwdtrade').val().length;
        if(pLen < 6 || pLen > 20) {
            $('#pwdtrade_msg').html("×");
            $('#pwdtrade_msg').css('msg_error');
            return validateMsg('pwdtrade', '密码长度在6-20个字符之间', 0);
        }
        if($('#pwdtrade').val() == $('#pwd').val()){
            $('#pwdtrade_msg').html("×");
            $('#pwdtrade_msg').css('msg_error');
            return validateMsg('pwdtrade', '交易密码不能与登录密码一致哦', 0);
        }
        if(repLen>1){
            if($('#pwdtrade').val() != $('#repwdtrade').val()){
                $('#repwdtrade_msg').html("×");
                $('#repwdtrade_msg').css('msg_error');
                return validateMsg('repwdtrade', '再次输入的交易密码不一致', 0);
            }
        }
        $('#pwdtrade_msg').html("√");
        $('#pwdtrade_msg').css('msg_ok');
        return validateMsg('pwdtrade', '', valistep2.pwdtrade = 1);
    });
    $('#repwdtrade').bind('blur', function(){
        var pLen = $(this).val().length;
        if(pLen < 6 || pLen > 20){
            $('#repwdtrade_msg').html("×");
            $('#repwdtrade_msg').css('msg_error');
            return validateMsg('repwdtrade', '密码长度在6-20个字符之间', 0);
        }
        if($('#repwdtrade').val() != $('#pwdtrade').val()){
            $('#repwdtrade_msg').html("×");
            $('#repwdtrade_msg').css('msg_error');
            return validateMsg('repwdtrade', '密码不一致，请重新输入。', 0);
        }
        $('#repwdtrade_msg').html("√");
        $('#repwdtrade_msg').css('msg_ok');
        return validateMsg('repwdtrade', '', valistep2.repwdtrade = 1);
    });
    $("#tongyi").bind('click',function(){
        if($(this).val() == 1)
            $(this).val(0);
        else
            $(this).val(1);
        if($(this).val() == 0){
            return validateMsg('agreemsg', '需同意本网站服务条款方可进行下一步', vali.tongyi = 0);
        }else{
            return validateMsg('agreemsg', '', vali.tongyi = 1);
        }
    });

    function step1(){
        //检查第一步是否有问题
        for(var i in vali){
            if(!vali[i]) {
                event.preventDefault();
                return false;
            }
        }
        $('#step1').hide()
        $('#step2').show();
        $('#currentpwd').addClass('current');

    }
    function step2()
    {
        if(valistep2.pwdtrade==0 || valistep2.repwdtrade==0){
            return false;
        }else{
            return true;
        }
    }
</script>


<script>
    $("#ttttform").validate({
        submitHandler:function(form){
            ajax_submit_form(form)
            return false;
        },
        invalidHandler: function() {  //不通过回调
            return false;
        }
    });
</script>
<script>
   	$('#tongyi').click(function() {
		var isAgree = $(this).attr('checked');
		if(isAgree) {
			$(this).removeAttr('checked');
			$('#next-btn').css({'background':'#e1e1e1'});
		} else {
			$(this).attr("checked",'true');
			$('#next-btn').css({'background':'#f60'});
		}
		
	});
	$('#next-btn').click(function() {
		var isAgree = $('#tongyi').attr('checked');
		if(isAgree) {
			$('#reg-prev').hide();
			$('#reg-now').show();
		}
	});
</script>

<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>
<!--footer end-->

82:F:\git\coin\bisheng commerce\App\Home\View\Reg\regSuccess.html
<include file="App/Home/View/Public/header.html"/>
<!--top end-->
<div class="ybc_section">
	<ul class="ybc_user_nav clearfix Font18">
		<li class="current"><span>1</span>邮箱注册</li>
		<li class="current"><span>2</span>设置交易密码</li>
		<li class="current"><span>3</span>实名认证</li>
		<li class="current"><span>4</span>注册成功</li>
	</ul>
	<div class="ybc_rz">
		<p class="Font24">恭喜您，注册成功！</p>
		
	</div>
		<div class=" ybc_kind" style="width:285px; margin:50px auto; padding-left:0;">
			<a href="#" class="ybc_kind_three ybc_kind03" style="display:block;">
				<h2>存太一元<span class="Font16"> (TRMB)</span></h2>
				<p>每日领息（年化收益9.2%）<br>参与每天1万太一股配送</p>
			</a>
			<p>余额宝2倍收益，存取自由</p>
		</div>
	<a href="{:U('Index/index')}" style=" width:285px; text-align:center; height:60px; line-height:60px; margin:0 auto 50px auto; background:#f60; font-size:18px; color:#fff; display:block; border-radius:10px;">进入元宝网</a>
</div>
    <!--footer start-->
<div class="ybc_footer">Copyright  2013-2016 元宝网 All Rights Reserved. Powered by 北京亚投科技有限责任公司 </div>
    <!--footer end-->
    <script type="text/javascript" src="__PUBLIC__/Home/js/downList.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Home/js/sdmenu.js"></script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?0ab4db557b96d841137861e0740d1e0a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>	


</body></html>

83:F:\git\coin\bisheng commerce\App\Home\View\Reg\terms.html
<include file="App/Home/View/Public/header.html"/>
<script>
$(document).ready(function(){
    start=document.cookie.indexOf("motip=")
    if (start!=-1){ 
        start=start + 6
        end=start + 1
        motip = unescape(document.cookie.substring(start,end))
        if(motip == 1)
	    $('#phone_top_div').show();
    } 
});
function hidephone(){
	$('#phone_top_div').hide();
    var d=new Date()
    d.setTime(d.getTime() + 7200)
    document.cookie="motip=2;expires="+d.toUTCString()
}
</script>
<style>
.dynamic h3{
border-bottom:0px;
}
</style>
<div id="main">
    <div class="main_box">
		<div class="dynamic">
			<h2 style="height:70px; line-height:70px; border-bottom:1px solid #e1e1df; width:100%;">{$config['name']}-服务条款</h2>
			<div class="paragraph">
				 {$config['FWTK']}
			</div>
		</div>
    </div>
</div>  
<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>

84:F:\git\coin\bisheng commerce\App\Home\View\Safe\index.html
<include file="App/Home/View/Public/header.html"/>
<!--top end-->
<link rel="shortcut icon" href="http://www.jubi.com/favicon.ico" type="image/x-icon">
<script src="_PUBLIC__/Home/js/script.js"></script>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/jb_font-awesome.css">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>

<body>
<div id="main">
    <div class="main_box">
        <include file="App/Home/View/Public/left.html"/>
        <div class="assets_content w753 right bg_w" id="safebox" style=" border-left-style:none !important;"><h1>用户中心</h1>
            <div class="safe_center clear">
              <div style="float:left; margin-left:20px;">
                <div class="sc_level">
                    <div class="sc_level_4">
                      <img style=" width:102px; height:102px;" <if condition="$u_info['head']">src="{$u_info['head']}"<else/>src="__PUBLIC__/Home/images/ulogodefault.jpg"</if> >
                    </div>
                    <!--<div class="sc_level_info"></div>-->
                </div>
                <dl>
                    <dt>ID：<span>{$u_info['member_id']}</span></dt>
                    <dd>姓名：{$u_info['name']}</dd>
                    <dd>邮箱：{$u_info['email']}</dd>
                </dl>
              </div>
              <div style="float:left; margin-left:170px;">
                <dl style=" padding-top:0px !important;"><span style="font-size:16px;">人民币信息</span>
                    <dt>可用：￥{$u_info['rmb']|floatval=###}</span></dt>
                    <dd>冻结：￥{$u_info['forzen_rmb']|floatval=###}</dd>
                    <dd>总资产：￥{$u_info['rmb']+$u_info['forzen_rmb']|floatval=###}</dd>
                </dl>
              </div>
            </div>
            <ul class="sc_statu">
                <li>
                    <if condition="$u_info['status'] eq 0 ">
                        <em class="sc_statu_type_1_1"></em>
                        <dl>
                            <dt>实名认证</dt>
                            <dd class="nopass">未认证<a href="{:U('ModifyMember/modify')}">点击认证</a></dd>

                        </dl>
                        <else/>
                        <em class="sc_statu_type_1"></em>
                        <dl>
                            <dt>实名认证</dt>
                            <dd class="alpass">已认证<a href="{:U('User/updateMassage')}">查看</a></dd>
                        </dl>
                    </if>
                </li>
                <!--<li>
                    <if condition="$u_info['phone']">
                        <em class="sc_statu_type_3"></em>
                        <dl>
                            <dt>绑定手机</dt>
                            <dd class="alpass">已认证 <a href="{:U('User/updateMassage')}">查看</a></dd>
                        </dl>
                        <else/>
                        <em class="sc_statu_type_3_1"></em>
                        <dl>
                            <dt>绑定手机</dt>
                            <dd class="nopass">未认证 <a href="{:U('ModifyMember/modify')}">点击绑定</a></dd>
                        </dl>
                    </if>

                </li>-->
                <li>
                    <em class="sc_statu_type_2"></em>
                    <dl>
                        <dt>账户资产</dt>
                        <dd class="alpass">已认证<a href="{:U('User/index')}">点击进入</a></dd>
                    </dl>
                </li>
            </ul>
            <div class="sc_info_list" id="sc_info_list">
                <dl style="background-color: rgb(249, 249, 249);">
                    <dt>登录密码</dt>
                    <dd><p>登录{$config['name']}账户时需要输入的密码</p></dd>
                    <dd><div class="changepw"><a href="{:U('User/updatePassword')}">修改登录密码</a></div></dd>
                </dl>
                <dl style="background-color: rgb(255, 255, 255);">
                    <dt>交易密码</dt>
                    <dd><p>在{$config['name']}进行交易时需要输入的密码</p></dd>
                    <dd><div class="changepw"><a href="{:U('User/updatePassword')}">修改交易密码</a></div></dd>
                </dl>
                <dl style="background-color: rgb(249, 249, 249);">
                    <dt>实名认证</dt>
                    <dd><p>受国家要求及为了您的资金安全需进行实名认证</p></dd>
                    <dd>
                        <if condition="$u_info['status'] eq 0 ">
                            <div class="changepw">
                                未认证 <a href="{:U('ModifyMember/modify')}">认证</a>
                            </div>
                            <else/>
                            <div class="changepw">
                                已认证 <a href="{:U('User/updateMassage')}">查看</a>
                            </div>
                        </if>
                    </dd>
                </dl>
                <!--<dl style="background-color: rgb(255, 255, 255);">
                    <dt>手机绑定</dt>
                    <if condition="$u_info['phone']">
                        <dd>
                            <p>
                                您已成功绑定手机
                            </p>
                        </dd>
                        <dd>
                            <div class="changepw">
                                <a href="{:U('User/updateMassage')}">查看</a>
                            </div>
                        </dd>
                        <else/>
                        <dd>
                            <p>
                                未绑定手机，为了您的资金安全，建议您立即绑定
                            </p>
                        </dd>
                        <dd>
                            <div class="changepw">
                                <a href="{:U('ModifyMember/modify')}">绑定</a>
                            </div>
                        </dd>
                    </if>
                </dl>-->
            </div>
        </div>

        <div class="clear"></div>
    </div>
    <div class="clear"></div>
</div>
<script>
    $(".menu11").addClass("uc-current");

    function showTips(id,msg){
        var tips = layer.tips(msg, id, {
            tips: [1, '#fff8db'],
            area: ['400px', '35px']
        });
        $(id).on('mouseout', function(){
            layer.close(tips);
        });
    }
</script>
<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>
<!--footer end-->

85:F:\git\coin\bisheng commerce\App\Home\View\Safe\mobilebind.html
<include file="App/Home/View/Public/header.html"/>
    <!--top end-->
    <link rel="shortcut icon" href="http://www.jubi.com/favicon.ico" type="image/x-icon">
	<script src="_PUBLIC__/Home/js/script.js"></script>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/jb_font-awesome.css">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">                                         
</head>

<body>
<div id="main">
	<div class="main_box">
		<include file="App/Home/View/Public/left.html"/>
		<!--<div class="assets_content w753 right bg_w" style=" border-left-style:none !important;">
			<h1 id="h1-mobilebind">手机绑定</h1>
			<div class="changepw_warning" id="msg-box"><p><i></i><span>请绑定您的常用手机号，以确保您的帐户安全</span></p></div>
			<form id="form-mobilebind" class="pwtrade mart30">
				<dl>
					<dt>手机号码：</dt>
					<dd id="dd-mobilebind"><input name="mobile" type="text"></dd>
				</dl>
				<dl>
					<dt>获取验证码：</dt>
					<dd class="yuyin">
						<div class="clear">
							<a class="btn-mobile-sms1" onClick="AJAX.mobilecode('sms')">获取短信验证码</a>
                            <a class="btn-mobile-sms1 btn-mobile-sms1_1" id="btn-mobile-sms1_1">59秒后重新获取</a>
							<!--<a class="btn-mobile-tel1" onClick="AJAX.mobilecode('tel')">获取语音验证码</a>-->
                            <!--<a class="btn-mobile-tel1 btn-mobile-tel1_1" id="btn-mobile-tel1_1">59秒后重新获取</a>-->
						</div>
						<p>如果短信发送延迟，请使用语音验证码</p>
					</dd>
				</dl>
				<dl>
					<dt>验证码：</dt>
					<dd><input name="code" type="text"></dd>
				</dl>
				<dl>
					<dt></dt>
					<dd><input value="绑定手机" id="btn-mobilebind" onClick="AJAX.mobilebind()" type="button"></dd>
				</dl>
			</form>
		</div>-->
        <div class="assets_content w753 right bg_w" style=" border-left-style:none !important;">
          <div class="tishi" style="margin-left:80px; position:absolute;">
            <img src="__PUBLIC__/Home/images/warn.png">
            <div style="">
              <span style=" position:absolute; left:200px; top:125px; font-size:24px;">12345678909</span>
              <button type="button" style=" position:absolute; left:350px; top:230px; width:60px;">返回</button>
            </div>
          </div>
        </div>
<div class="clear"></div>
		</div>
		<div class="clear"></div>
	</div>

<script>
$(".menu12").addClass("uc-current");

function showTips(id,msg){
    var tips = layer.tips(msg, id, {
	tips: [1, '#fff8db'],
	area: ['400px', '35px'], 
    });
    $(id).on('mouseout', function(){
    layer.close(tips);
    });
}
</script> 
<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>
<!--footer end-->

86:F:\git\coin\bisheng commerce\App\Home\View\Trade\deal_history.html
<include file="App/Home/View/Public/header.html"/>
    <!--top end-->
<script src="js/index.js"></script>
<div id="main">
	<div class="main_box">
		
		<include file="App/Home/View/Public/left.html"/>
		<div class="raise right clearfix">
            <div class="ybc_list">
	<div class="ybcoin clearfix">
		<h2 class="left">成交历史</h2>
		<div class="right" style="margin-top:7px;">
			<select id="coninname" onchange="coinorder()">
				 <volist name="currency" id="vo">		    
                    <option value="{$vo['currency_mark']|default=""}">{$vo['currency_name']|default="虚拟币"}对人民币</option>
                    </volist>   
            </select>
		</div>
	</div>
		<table class="raise_list" style="border:1px solid #e1e1df;" id="Transaction" align="center" border="0" cellpadding="0" cellspacing="0">
			<thead>
			<tr>
				<th>订单号</th>
				<th>币种</th>
				<th>成交时间</th>
				<th>类型</th>
				<!--<th>买/卖</th>-->
				<th>成交价格</th>
				<th>成交数量</th>
				<th>成交额</th>
			</tr>
			</thead>
			<tbody>
			</tbody>
		</table>
	</div>
<script>
function coinorder()
{
	var coinname = $('#coninname').val();
	location.href='/user_exchange/coinorderold/coinname/'+coinname;
}
</script>
		</div>
		<div class="clear"></div>
	</div>
</div>  
<script>
$(".menu5").addClass("uc-current");
</script>  
<!--footer start-->

		<include file="App/Home/View/Public/footer.html"/>

87:F:\git\coin\bisheng commerce\App\Home\View\Trade\mydeal.html
<include file="App/Home/View/Public/header.html"/>
<style>
.filtrate{
border: 1px solid #e55600;
color:#e55600;
border-radius: 3px;
width: 60px;
height: 28px;
margin: 5px;
cursor: pointer;
}
.filtrate:hover{
border: 1px solid #e55600;
border-radius: 3px;
width: 60px;
height: 28px;
margin: 5px;
cursor: pointer;
color:#FFF;
background-color:#e55600;	
}
</style>
    <!--top end-->
<div id="main">
	<div class="main_box">
		<include file="App/Home/View/Public/left.html"/>
		<div class="raise right clearfix">
            <div class="ybc_list">
	<div class="ybcoin clearfix">
		<h2 class="left">我的成交</h2>
		<div class="right" style="margin-top:7px;">
			<form action="{:U('Trade/mydeal')}" method="post">
                <select id="coninname" name="currency">
                    <volist name="culist" id="vo">		    
                    <option value="{$vo['currency_id']|default=""}">{$vo['currency_id']|getCurrencynameByCurrency=###}对{$vo['trade_currency_id']|getCurrencynameByCurrency=###}</option>
                    </volist>    
                </select>
                <input value="提交" class="filtrate" type="submit">
			</form>
		</div>
	</div>
		<table class="raise_list" style="border:1px solid #e1e1df;" id="Transaction" align="center" border="0" cellpadding="0" cellspacing="0">
			<thead>
			<tr>
				<th>订单号</th>
				<th>币种</th>
				<th>成交时间</th>
				<th>类型</th>
				<th>成交价格</th>
				<th>成交数量</th>
				<th>成交额</th>
			</tr>
			</thead>
			<tbody>
			<foreach name="list" item="vo">
					<tr>
						<td>{$vo.trade_no}</td>
						<td>{$vo.currency_id|getCurrencynameByCurrency=###}</td>
						<td>{$vo.add_time|date='Y-m-d H:i:s',###}</td>
						<eq name="vo['type']" value="sell"> <td class="red"><else/><td style="color:#039904;"></eq>{$vo.type|fomatOrdersType=###}</td>
						<td>{$vo.price|floatval=###}</td>
						<td>{$vo.num|floatval=###}</td>
						<td>{$vo.money|floatval=###}</td>
						</tr>
				</foreach><!--  -->
			</tbody>
		</table>
	</div> 
        <div class="page" style=" min-width:200px !important; float:right;">
                    {$page}
              </div>
		</div>
		<div class="clear"></div>
	</div>
</div> 
<script>
$(".menu3").addClass("uc-current");
</script>   
<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>
<!--footer end-->

88:F:\git\coin\bisheng commerce\App\Home\View\User\draw.html
 <include file="App/Home/View/Public/header.html"/>
 <style>
 .pass_ybc{ min-height:400px !important;}
 .my_add{ margin-bottom:0px !important;}
 </style>
<div id="main">
  <div class="main_box"> <include file="App/Home/View/Public/left.html"/>
    <div class="raise right clearfix"> 
      <script type="text/javascript" src="js/ajax.js"></script> 
      <script type="text/javascript" src="js/Fnc.js"></script> 
      <script type="text/javascript" src="js/inputFormat.js"></script>
      <div class="ybc_list">
        <div class="ybcoin">
          <h2 class="left">CNY提现</h2>
          <!-- <p class="right" style=" margin-top:10px; color:#333;">您可以设置多个提款地址，这样您提款到不同的银行卡、钱包或其它平台时就会更方便。</p> -->
          <div class="clear"></div>
        </div>
      </div>
      <div class="support_ybc pass_ybc" id="verifyon"> 
        <!--<ul id="pass_change">
		<li class="selectTag"><a onClick="selectTag('tagContent0',this)" href="javascript:void(0)">提现到银行卡</a> </li>
		<li class="note"><a onClick="selectTag('tagContent1',this)" href="javascript:void(0)">提现到元宝理财</a></li>
		<div class="clear"></div>
        </ul>-->
        <div id="tagContent" class="passContent">
          <div class="tagContent selectTag" id="tagContent0">
            <h2 class="choose_one">选择一个提款地址 
              <!-- <a href="/news/detail/?id=736" style="float: right;margin-right:30px; color: red;" target="_blank">提现银行卡暂不支持邮政储蓄银行</a> --> 
            </h2>
            <table class="my_add" border="0" cellpadding="0" cellspacing="0">
              <thead>
                <tr align="center">
                  <th>选择</th>
                  <th>地址标签</th>
                  <th>提款地址</th>
                  <th>操作</th>
                </tr>
              </thead>
              <volist name="bank_info" id="vo">
              <thead>
              	  <th><input type="radio" value="{$vo.id}" id="bank_id" name="redios" onclick="bank_id()"></th>
                  <th>{$vo.bname}</th>
                  <th>{$vo.bankname}|{$vo.cardnum}|{$vo.cardname|default="无"}|{$vo.barea_name}|{$vo.aarea_name}</th>
                  <th><a class="link-del" href="javascript:void(0);" onclick="checkSuccess({$vo.id})">删除</a></th>
                 
              </thead>
              </volist>
              
              <script>
			  function checkSuccess(_this){
					layer.confirm(
					'确定删除', 
					{btn:['确定','取消']},
						function(){
							$.post("{:U('User/delete')}",{'id':_this},function(data){
									if(data.status>0){
										layer.msg(data.info);
										window.location.reload();
									}else{
										layer.msg(data.info);
										window.location.reload();
									}
							});	 
						}
					),
					function(){
						layer.msg('已取消');
					}
					
			}
			  
					function bank_id(){
						var list= $('input:radio[name="redios"]:checked').val();
						$("#select_bank").val(list);
					}
              </script>
             </table>
           <table id="addNewAddr" class="add_list" border="0" cellpadding="0" cellspacing="0" style="display:none"> 
              <tbody>
                <tr>
                 <form action="{:U('User/insert')}" method="post" id="bankform" jump-url="{:U('User/draw')}">
                  <td colspan="4" id="newAddress" style="">
                  <div id="rmb_out_ok">
                      <ul class="ybc_con" id="rollout" style="margin-top:10px;">
                        <li>
                          <label>新标签：</label>
                          <input name="new_label" id="new_label" placeholder="例：提现卡01" type="text">
                          <span class="note">个人备注信息</span></li>
                        <li>
                          <label>开户姓名：</label>
                          <input name="name" id="name" value="{$auth}" class="loginValue" disabled="disabled" type="text">				
                          
                          <span class="false" id="accountmsg">与实名认证信息一致不可修改</span> </li>
                        <li>
                          <label>银行名称：</label>
                          <select name="bank" id="bank" class="loginValue" style="width:264px; border:1px solid #e1e1df;">
                            <option selected="selected" value="">请选择银行</option>
                            <option value="支付宝">支付宝</option>
                            <option value="工商银行">工商银行</option>
                            <option value="建设银行">建设银行</option>
                            <option value="农业银行">农业银行</option>
                            <option value="中国邮政储蓄银行">中国邮政储蓄银行</option>
                            <option value="交通银行">交通银行</option>
                            <option value="中国银行">中国银行</option>
                            <option value="光大银行">光大银行</option>
                            <option value="中信银行">中信银行</option>
                            <option value="招商银行">招商银行</option>
                            <option value="民生银行">民生银行</option>
                            <option value="兴业银行">兴业银行</option>
                            <option value="平安银行">平安银行</option>
                            <option value="广发银行">广发银行</option>
                            <option value="北京银行">北京银行</option>
                            <option value="华夏银行">华夏银行</option>
                            <option value="上海浦东发展银行">上海浦东发展银行</option>
                            <option value="渤海银行">渤海银行</option>
                            <option value="浙商银行">浙商银行</option>
                            <option value="宁波银行">宁波银行</option>
                            <option value="恒丰银行">恒丰银行</option>
                            <option value="中国农业发展银行">中国农业发展银行</option>
                          </select>
                          <span class="rePWB" id="bankmsg"></span> 
                          </li>
                        <li>
                          <label>银行卡所在地：</label>
                          <select  id="p1" style="width:130px; border:1px solid #e1e1df;">
                            <option selected="selected" value="">省份</option>
                            <volist name="areas" id='row'> 
                            <option value="{$row['area_id']}" 
                              <eq name="row.area_id" value="$list.province">selected="selected"</eq>>
                              {$row['area_name']}
                              </option>
                            </volist>
                          </select>
                          <select id="c1" style="width:130px; border:1px solid #e1e1df;" onchange="city();">
                            <option selected="selected" value="">城市</option>
                          </select>
                      		<input type="hidden" name="shi" id="shi">
                        </li>
                        <li><label>开户支行：</label>
                          <input name="bank_branch" id="bank_branch" class="loginValue" style="font-size:14px;font-weight:bold;color:#f60;background:#fff7f2;" type="text">
                         <span class="false" style="color:#f00;">不能为空,如果没有请填"无"</span> </li>
                        <li>
                          <label id="kh">银行卡号：</label>
                          <input onkeyup="value=value.replace(/[^\d]/g,'')" name="account" id="account" class="loginValue" style="font-size:14px;font-weight:bold;color:#f60;background:#fff7f2;" type="text">
                          <span class="false" id="accountmsg" style="color:#f00;">银行卡号和开户姓名必须一致，否则无法到账。</span> </li>
                        <li id="yes_add">
                          <label>&nbsp;</label>
                          <input class="addition"  value="确认添加" type="submit">
                       
<script>
	function city(){
		$("#shi").val($("#c1").val());
	}
	$("#p1").change(function(){
	$.post("{:U('User/getCity')}",{'id':$("#p1").val()},function(data){
	  $("#c1").empty();
		var area=new Option("请选择","");
		$("#c1").append(area);
		if(data.length>0){
			for(var i=0;i<data.length;i++){
				var option = new Option(data[i]["area_name"], data[i]["area_id"]);	
				$("#c1").append(option);		
		}
		}else{
			$("#c1").append("<option value='0'>没有相应城市信息</option>");
		}
		});	 	  	  
	});

</script> 
<script>
function zfb(){
	if($('#bank').val()=="支付宝"){
		$('#kh').html('支付宝卡号：');
		$('#accountmsgs').html('支付宝卡号和姓名必须一致，否则无法到账。');
	}else{
		$('#kh').html('银行卡号：');
		$('#accountmsgs').html('银行卡号和开户姓名必须一致，否则无法到账。');
	}
}
</script>
                          
<script>
	  $("#bankform").validate({
        rules: {
			new_label:"required",
			
			bank:"required",
			
			province:"required",
			
			city:"required",
			bank_branch:"required",
			account:{required:true,
					 rangelength:[16,19]
					 }
        },
        messages: {
			
			new_label:"请填写标签",
			
			bank:"请选择银行",
			
			province:"请选择有效省份",
			
			city:"请选择有效城市/区",
			bank_branch:"请填写开户支行",
			account:{required:"请输入银行卡号",
					 rangelength:"请输入有效卡号"}
        },
	    submitHandler:function(form){
            ajax_submit_form(form)
            return false;
        },
        invalidHandler: function() {  //不通过回调
            return false;
        }
    });
</script>
                          
                          <span id="showMsg_address" style="color:red;">最多添加10条提款地址</span> </li>
                      </ul>
                      
                  </div>
                  </td>
                  </form>
                </tr>
                <tr style="display:none;" id="phone_alert" align="right">
                  <td colspan="4"><span style="color:#f00;">系统已拨打您的手机告知验证码，请输入验证码</span>
                    <input class="verify_text" id="phone_code_bank" type="text">
                    <input class="verify" id="add_bankcards" onclick="cnyOut.finaddAddress()" value="确认" type="button"></td>
                </tr>
                </tbody>
            </table>
           
           
            <center>
            <table>
                <tr id="addAddress_tr" align="center">
                  <td colspan="4" class="list" align="center">
                  <eq name="num" value="1"><a href="javascript:void(0);" id="addNewAddress" onclick="addNewAddr();">点击绑定银行卡</a>
                  <else/>
                  <td style="color:red;">最多添加10条提款地址</td>
                  </eq></td>
                </tr>
            </table>
            </center>
            <script>
				function addNewAddr(){
					document.getElementById("addNewAddr").style.display="";//显示
					document.getElementById("addAddress_tr").style.display="none";//隐藏
				}
			</script>
            <h2 class="choose_one">输入要提款的金额<span>(可用余额：<strong>￥{$rmb.rmb}</strong>)</span><span style="float:right;margin-right:20px;"><strong id="rmbout_showtips"></strong></span></h2>
           
           <form action="{:U('User/withdraw')}" method="post" id="drawform" jump-url="{:U('User/draw')}">
           <table class="my_add" border="0" cellpadding="0" cellspacing="0">
              <tbody>
                <tr>
                  <td style="position:relative; padding-left:90px;">提款金额
                  	<input name="select_bank" id="select_bank" type="hidden">
                    <input style="display:none">
                    <!-- for disable autocomplete on chrome -->
                    <input class="sum" name="money" id="money"  autocomplete="off" type="text" onkeyup="value=value.replace(/[^\d]/g,'');sjdz();">
                    </td>
                  <td>实际到帐
                    <input class="sum" id="true_daozhang" disabled="disabled" type="text">
                    <span style="color:#f60;">手续费{$config.fee}%</span></td> 
                  
                  
                </tr> 
                <tr>
                  <td style=" padding-left:90px;">交易密码
                    <input style="display:none" type="password">
                    <!-- for disable autocomplete on chrome -->
                    <input class="sum" name="pwdtrade" id="pwdtrade" autocomplete="off" type="password"></td>
                  <td>验证码
                    <input style="display:none" type="password">
                    <!-- for disable autocomplete on chrome -->
                    <input class="sum" name="code" id="code" autocomplete="off" type="password">
                    <input class="confirm"  value="点击发送" type="button" id="msgt" data-key='off' onclick="sandPhone()"></td>
                </tr>
                <tr>
                  <td></td>
                  <td><input style=" float:right; margin-right:103px;" class="confirm"  value="确认提交" type="submit"></td>
                </tr>
              </tbody>
            </table>
            </form>
            <script>
				$("#drawform").validate({
				rules: {
					money:{
						required: true,
						min: 100,
						max: 50000,
					  }, 
					pwdtrade:"required", 
					code:"required", 
				},
				messages: {
					money:{
						required: "请填写提现金额",
						min: "提现金额最小100",
						max: "提现金额最大50000",
						},
					
					pwdtrade:"请填写交易密码",
					code:"请填写验证码",
				},
				submitHandler:function(form){
					ajax_submit_form(form)
					return false;
				},
				invalidHandler: function() {  //不通过回调
					return false;
				}
			});
			function sjdz(){
				var fee = {$config.fee};
				var m ;
				
					m = $("#money").val()-$("#money").val()*fee*0.01;
				
				$("#true_daozhang").val(m);
			}
			</script>

            <h2 class="choose_one">{$art.title}</h2>
            <div class="turns Font14"> 
              <input id="cny_outfee" value="0.003" type="hidden">
            {$config.withdraw_warning}
            </div>
          </div>
          <div class="tagContent" id="tagContent1">
            
            <form action="{$User/withdraw}" method="post">
              <ul class="ybc_con" id="rollout">
                <li>
                  <label>提现金额：</label>
                  <input style="display:none;">
                  <!-- for disable autocomplete on chrome -->
                  <input style="float:left;" name="number" onkeyup="value=value.replace(/[^\d.]/g,'')" id="num2" value="0" autocomplete="off" type="text">
                  <span class="note left" style=" height:40px; display:table-cell; vertical-align: middle;">转出金额不能小于10元</span>
                  <div class="clear"></div>
                </li>
                <li>
                  <label>交易密码：</label>
                  <input style="display:none;">
                  <!-- for disable autocomplete on chrome -->
                  <input name="pwdtrade" id="pwdtrade2" autocomplete="off" type="password">
                  <span class="note">请输入交易密码</span></li>
                <li>
                  <label>&nbsp;</label>
                  <input class="queding" value="确定" type="submit">
                </li>
              </ul>
              <div class="turns">
                <h2>使用说明</h2>
                <p>1. 提现到元宝理财的同名账户。</p>
                <p>2. 及时到账。</p>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="ybc_list">
        <div class="ybcoin">
          <h2 class="left">提现记录</h2>
          <div class="clear"></div>
        </div>
        <table class="raise_list" style="border:1px solid #e1e1df;" align="center" border="0" cellpadding="0" cellspacing="0">
          <thead>
            <tr>
              <th>记录ID</th>
              <th>转入账户</th>
              <th>转出数量</th>
              <th>实际到账</th>
              <th>操作时间</th>
              <th>状态</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody>
            <volist name="draw_info" id="vo">
            <tr id="btc_box" class="btc_new" >
              <td id="btc_id">{$vo.withdraw_id}</td>
              <td id="btc_wallet">{$vo.cardnum}</td>
              <td id="btc_number">{$vo.all_money}</td>
              <td id="btc_fee">{$vo.money}</td>
              <td id="btc_created">{$vo.add_time|date='Y-m-d H:i:s',###}</td>
              <td class="tableEnd" id="btc_status"><eq name="vo.status" value="1">未通过<else/><eq name="vo.status" value="2">通过<else/>审核中</eq></eq></td>
              <td><eq name="vo.status" value="3"><a href="javascript:void(0);" onclick="chexiao({$vo.withdraw_id});">撤销</a></eq></td>
            </tr>
            </volist>
          </tbody>
        </table>
      </div>
    </div>
    <style>
.btc_new,.btc_new td {background: #DDFFDD !important;}#cb_msg_box{background:#B50000;color:#FFF;display:none;text-align:center;padding:0px;}
</style>
<!--    <script type="text/javascript" src="js/tab2.js"></script> 
    <script src="js/form.js"></script> 
    <script src="js/city.js"></script> 
    <script src="js/cnyout.js"></script> -->
<script>
$("document").ready(function(){
    //initProvinceCity($("#p1"),$("#c1"));
    //$('#account').inputFormat('account');
    // $('#money_rmb').inputFormat('amount');
});
</script> 

  </div>
  <div class="clear"></div>
</div>
<script>
    $(".menu14").addClass("uc-current");

    function showTips(id,msg){
        var tips = layer.tips(msg, id, {
            tips: [1, '#fff8db'],
            area: ['400px', '35px']
        });
        $(id).on('mouseout', function(){
            layer.close(tips);
        });
    }
</script>
<script>
function chexiao(id){
		layer.confirm(
		'确定撤销', 
		{btn:['确定','取消']},
		function(){
		  $.post("/Home/User/chexiaoByid",{"id":id},function(data){
			  if(data.status==0){
						layer.msg(data['info']);
						window.location.reload();
					}else{
						layer.msg(data['info']);
						window.location.reload();
					}
			})
		}
		),
		function(){
			layer.msg('已取消');
		}
		
}
function sandPhone(){
        var i=120;
       
		var phone = $("mo").val();
        if(phone && /^1[3|4|5|8]\d{9}$/.test(phone)){
            layer.msg("请填写正确的手机号码");
        }else{
            $.post("{:U('ModifyMember/ajaxSandPhone')}",{phone:encodeURIComponent($("#mo").val())},
                    function(d){
                       layer.msg(d.info);
                        if(d.status==1){
							var tid2;
							tid2=setInterval(function(){
								if($("#msgt").attr("data-key")=='off'){
									$("#msgt").attr("disabled",true);
									$("#msgt").removeClass("class");
									$("#msgt").addClass("button again");
									i--;
									$("#msgt").val(i+"秒后可重新发送");
									if(i<=0){
										$("#msgt").removeAttr("disabled").val("重新发送验证码");
										$("#msgt").attr("data-key","on");
									}
								}
							},1000);
							 i=120;
                            $("#msgt").attr("data-key","off");
                        }
                    });
        }
    }</script>
<!--footer start--> 
<include file="App/Home/View/Public/footer.html"/>

89:F:\git\coin\bisheng commerce\App\Home\View\User\duihuan.html
<include file="App/Home/View/Public/header.html"/>
    <!--top end-->
<style>
.list_con1 td input,.list_con2 td input{
border: 1px solid #e55600;
color:#e55600;
border-radius: 3px;
width: 90px;
height: 30px;
margin: 5px;
cursor: pointer;
}
.list_con1 td input:hover,.list_con2 td input:hover{
border: 1px solid #e55600;
border-radius: 3px;
width: 90px;
height: 30px;
margin: 5px;
cursor: pointer;
color:#FFF;
background-color:#e55600;	
}

.list_con1:hover{
	background-color:#FFE9D2;
	}
.list_con2:hover{
	background-color:#FFE9D2;
	}
a{text-decoration:none;}
.pay{ width:800px;}	
.pay .buysell .buyformarea {
    width: 700px;
    float: right;
}
.buyform{ margin-left:200px;}
.sellform .submit{ margin-left:200px; margin-bottom:20px;}
.buyformarea .buy {
    padding: 10px 0px 20px 50px;
}
</style>
<script src="js/index.js"></script>
<div id="main">
	<div class="main_box">
		<include file="App/Home/View/Public/left.html"/>
		<div class="raise right clearfix">
            	<div class="ybc_list">
       <div class="curve pay">
        <div class="buysell sellform">
          <div class="buyformarea left">
           <div>
            <h2 class="buy" style=" width:130px; float:left;">兑换进盟币 </h2><p style=" float:left; width:300px; margin:20px 0px;"><span id="trustmsgin" class="tishi sellform">数字货币交易具有极高的风险，投资需谨慎！</span></p>
            </div>
            <div style="clear:both;"></div>
            <ul class="buyform">
              <li>
                <label>人民币余额：</label>
                <h3 id="coinbuy_nice" class="buy left">{$sell_record[count($sell_record)-1]['price']|default="0.000"}</h3>
              </li>
              <li>
                <label for="price" class="buys">兑换比例：</label>
                <h3 id="coinbuy_bili" class="bili left">0.2</h3>
              </li>
              <li>
                <label for="price" class="buys">兑换数量：</label>
                <input value="" style="color:#999" name="buyprice" id="coinpricein" onkeyup="money();" type="text">
              </li>
              <li>
                <label for="num" class="buys">进盟币金额：</label>
                <b id="coinbuy_max" title="点击将数值写入数量输入框">0</b><span></span> 
              </li>
            </ul>
            <p class="sellform">
              <input id="trustbtnin" onclick="buy()" class="submit" value="立即兑换" type="button">
            </p>
          </div>
        </div>
      </div>
      <div style="clear:both;"></div>
      
       <div class="ybcoin clearfix">
		<h2 class="left" style=" padding-left:105px;">兑换记录</h2>
		<div class="right" style="margin-top:7px;">
		</div>
	</div>
    <table class="raise_list" style="border:1px solid #e1e1df; float:right; width:700px; margin-right:11px;" id="Transaction" align="center" border="0" cellpadding="0" cellspacing="0">
			<thead>
			<tr>
				<th>ID</th>
				<th>时间</th>
				<th>数量</th>
				<th>总金额</th>
			</tr>
			<foreach name="list" item="vo">
					<tr>
					<td>{$vo.currency_id|getCurrencynameByCurrency=###}</td>
						<td>{$vo.add_time|date='Y-m-d H:i:s',###}</td>
						<td>{$vo.title}</td>
						<td>{$vo.price}</td>
						</tr>
				</foreach>
			</thead>
			<tbody>
			</tbody>
		</table>
	</div>
    <div class="page" style=" min-width:200px !important; float:right;">
                    {$page}
              </div>
</div>
<div class="clear"></div>
		</div>
		<div class="clear"></div>
	</div>
<script>
$(".menu").addClass("uc-current");

function showTips(id,msg){
    var tips = layer.tips(msg, id, {
	tips: [1, '#fff8db'],
	area: ['400px', '25px'], 
    });
    $(id).on('mouseout', function(){
    layer.close(tips);
    });
}

function money(){
	var bili = $("#coinbuy_bili").text();
	var num = $("#coinpricein").val();
	$("#coinbuy_max").text(bili*num);
}
</script>   

<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>
<!--footer end-->

90:F:\git\coin\bisheng commerce\App\Home\View\User\index.html
<include file="App/Home/View/Public/header.html"/>
    <!--top end-->
<style>
.list_con1 td input,.list_con2 td input{
border: 1px solid #e55600;
color:#e55600;
border-radius: 3px;
width: 90px;
height: 30px;
margin: 5px;
cursor: pointer;
}
.list_con1 td input:hover,.list_con2 td input:hover{
border: 1px solid #e55600;
border-radius: 3px;
width: 90px;
height: 30px;
margin: 5px;
cursor: pointer;
color:#FFF;
background-color:#e55600;	
}

.list_con1:hover{
	background-color:#FFE9D2;
	}
.list_con2:hover{
	background-color:#FFE9D2;
	}
a{text-decoration:none;}	
</style>
<script src="js/index.js"></script>
<div id="main">
	<div class="main_box">
		<include file="App/Home/View/Public/left.html"/>
		<div class="raise right clearfix">
            	<div class="ybc_list">
                
		<div class="ybcoin" id="mycoin">
			<!-- 旧版：<h2 class="left">账户总资产估算: <span style="color:#f60;">{$allmoneys|default=0.00}</span> CNY</h2>  end-->
			<!-- <p class="right receive_rules" style="margin-bottom:0px;"><a href="/index/activity"> 存币送利息新规则</a></p> -->
            
            <!-- 账户总资产估算新改:-->
        <div style="font-weight:500;font-size: 18px;">账户资产
        <span style="font-weight:normal;color:#e55600;font-size:12px;padding-left: 15px;">推荐{$config.name|default='虚拟币'}赚佣金，躺着也挣钱！</span></div>
        <div class="coin_style_box">
                    <ul>
                        <li><img src="/Public/Home/images/coin_rmb.png">　人民币(CNY)</li>
                        <li>可用：<span style="color:green;" >￥{$u_info['rmb']}</span></li>
                        <li>冻结：<span style="color:orange;" >￥{$u_info['forzen_rmb']}</span></li>
                        <li>总资产：<b>￥{$u_info['rmb']+$u_info['forzen_rmb']}</b></li>
                    </ul>
                </div>
        
        
	   <!-- 账户总资产估算新改:-->
            
            
            
			<div class="clear" style="margin-bottom:15px;"></div>
		</div>
        
       
        
        
        		<!--会员条件不符的时候显示 点击×之后不再显示-->
				<table class="raise_list" align="center" border="0" cellpadding="0" cellspacing="0">
			<thead>
				<tr class="list_head">
					<th class="assets01">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名称</th>
					<th class="assets02">总量</th>
					<th class="assets02">可用</th>
					<th class="assets02">冻结<a class="ico_tishi" id="pledge" href="" onmouseover="showTips('#pledge','冻结原因：货币交易中、提现/提币处理中、项目众筹中、项目交易中')" style="background:#999; color:#fff; padding:2px 5px; border-radius:10px; text-decoration:none; margin-left:5px; font-family:monospace;">i</a></th>
					<th class="assets03">操作&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
					<th>交易</th>
				</tr>
			</thead>
			<tbody>
				<tr class="list_con1">
				    <td class="usertdtitle assets01">人民币 CNY</td>
				    <td class="assets02">{$member.count|default=0.00}</td>
				    <td class="assets02">{$member.rmb|default=0.00}</td>
				    <td class="assets02">{$member.forzen_rmb|default=0.00}</td>
				    <td class="cost assets03"><a href="{:U('User/pay')}">充值</a> &nbsp;&nbsp;<a href="{:U('User/draw')}">提现</a></td>
				    <td></td>
				</tr>
				<volist name='currency_user' id='vo' > 	
                    <tr class="list_con2">
					    <td class="usertdtitle assets01"> {$vo.currency_name|default='虚拟币'}{$vo.currency_mark|default='--'}</td>
					    <td class="assets02"> {$vo.count|default=0.00}</td>
					    <td class="assets02">{$vo.num|default=0.00}</td>
					    <td class="assets02">{$vo.forzen_num|default=0.00}</td>
					    <td class="cost interest assets03">
						<a href="{:U('Pay/bpay',array('currency_id'=>$vo['currency_id']))}">充币</a>
                        &nbsp;&nbsp;<a href="{:U('Pay/tcoin',array('currency_id'=>$vo['currency_id']))}">提币</a>
						</td>
					    <td class="cost interest" style="color:#f60;"><a style="text-decoration: none;" href="{:U('Orders/index',array('currency'=>$vo['currency_mark']))}" ><input value="去交易"  type="button"></a></td>
				    </tr>
                  </volist>  
										
							</tbody>
		</table>
	</div>
</div>
<div class="clear"></div>
		</div>
		<div class="clear"></div>
	</div>
<script>
$(".menu").addClass("uc-current");

function showTips(id,msg){
    var tips = layer.tips(msg, id, {
	tips: [1, '#fff8db'],
	area: ['400px', '25px'], 
    });
    $(id).on('mouseout', function(){
    layer.close(tips);
    });
}
</script>   

<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>
<!--footer end-->

91:F:\git\coin\bisheng commerce\App\Home\View\User\invit.html
<include file="App/Home/View/Public/header.html"/>
<style>
.coin_footer{background-color:#f8f8f8;}
</style>
    <!--top end-->
<script src="__PUBLIC__/Home/js/clipboard.min.js"></script>
<!--[if lt IE 9]> 
        <script>
        	$(document).ready(function(e) {
                $(".cpybtn").on("click",function(){
					var inputTxt = $("#cpytxt").val();
					window.clipboardData.setData("Text",inputTxt);
					$(".cpypt").show();
					setTimeout(function(){$(".cpypt").hide();},1000);
				});
            });
        </script>
        <![endif]-->
        <script>
				var clipboard = new Clipboard('#copy');
				clipboard.on('success', function(e) {
					console.log(e);
					alert("已复制");
					//$(".cpypt").show();
					//setTimeout(function(){$(".cpypt").hide();},1000);
				});
		
				clipboard.on('error', function(e) {
					console.log(e);
					alert("浏览器不支持直接复制，请选定连接后，ctrl+c复制");
				});

        </script>
<div id="main">
	<div class="main_box">
		<include file="App/Home/View/Public/left.html"/>
		<div class="raise right clearfix">
<div class="ybc_list">
                <div class="ybcoin invitecon" style="border-bottom:1px solid #e2e2e2;">
                    <h2 class="left"><font style="color:red;font-size:14px;">&nbsp;</font></h2>
                    <div class="clear"></div>
                </div>
                <div class="ybcoin invitecon" style="margin-bottom:0;">
                    <h2>复制以下内容发送给你的好友<span style="margin-left:20px;color:red;">您的邀请码是: {$Think.session.USER_KEY_ID}</span></h2>
                    <div>
                        <div class="left invitelink">
                            <textarea name="url" id="url">http://{$_SERVER['SERVER_NAME']}{:U('Reg/reg',array('Member_id'=>session('USER_KEY_ID')))}</textarea>
                            <input type="hidden" value="{$Think.session.USER_KEY_ID}" id="user_key_id">
                            <input type="hidden" value="{$Think.server.SERVER_NAME}" id="server_name">
                        </div>

                       <p class="right copylink" style="text-indent:0;" id="copy" data-clipboard-action="copy" data-clipboard-target="#url">
						<a href="javascript:void(0);"  >复制链接</a>

						<!--<div style="position: absolute; left: 1090px; top: 252px; width: 122px; height: 42px; z-index: 99;" id="zclip-ZeroClipboardMovie_1" class="zclip">
                        <embed id="ZeroClipboardMovie_1" src="/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_1" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=1&amp;width=122&amp;height=42" wmode="transparent" align="middle" width="122" height="42">
                        </div>--></p>
                        <div class="clear"></div>
                    </div>
                </div>
                <div class="ybcoin invitecon">
                    <h3 style="height:28px;">把内容分享到以下空间</h3>
                    
                    <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a></div>
<script>window._bd_share_config={"common":{"bdUrl":"http://"+$("#server_name").val()+"/Home/Reg/reg/Member_id/"+$("#user_key_id").val()+".html","bdSnsKey":{},"bdText":"","bdMini":"2","bdPic":"","bdStyle":"0","bdSize":"16"},"share":{},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["qzone","tsina","tqq","renren","weixin"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

                </div>
                <div class="ybcoin invitecon">
                    <h2>或者发送至</h2>
                    <div>
				
                       <input id="emaillist" class="left email_link" placeholder="example@example.com, 不超过5个, 以 ; 隔开" type="text" > 
                        <p class="right copylink" style="text-indent:0;"><input class="email_invite" value="发邮件邀请" type="button" onclick="sendmail()"></p>
                        <div class="clear"></div>
                        
                    </div>
                </div>
                <div class="ybcoin invitecon">
                    <h2>{$info.title|default="邀请规则"}</h2>
                    <ul class="rules">
                        {$config.invite_rule}
                        <div class="clear"></div>
                    </ul>
                </div>
            </div>
            <div class="ybc_list">
                    <div class="ybcoin">
                        <h2 class="left">我的邀请</h2><h2 class="right">邀请奖励总额: <span style="color:#f60;">{$count|default='0'}</span></h2>
                    </div>
                    <table class="raise_list" style="border:1px solid #e1e1df;" align="center" border="0" cellpadding="0" cellspacing="0">
                        <thead>
                            <tr class="list_head">
                                <th>邮箱</th>
				                <th>状态</th>
                                <th>注册时间</th>
                            </tr>
                        </thead>
                        <tbody>
                        <volist name="my_invit" id="vo">
                            <tr>
                                <td>{$vo['email']}</td>
                                <td>{$vo['status_name']}</td>
                                <td>{$vo['reg_time']|date="Y-m-d H:i:s ",###}</td>
                            </tr>
                        </volist>
                        </tbody>
                </table>
            </div>
        </div>
         <div class="page" style=" min-width:200px !important; float:right;">
                    {$page}
        </div>
        <div class="clear"></div>
    </div>
	<script>
	  function sendmail(){
	  url = "{:U('User/invit')}";
    var emailList = $('#emaillist').val();
        if(emailList.replace(/\s/g,'') === ''){
            alert("请填写邮箱内容");
            return false;
        }else{
            var arr = escape(emailList.replace(/(^\s*)|(\s*$)/g,"")).split('%3B'), error = '' , emailrule = /\w+((-w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+/;
            if(arr.length > 5 && arr.length){
                alert("最多填写5个邮箱");
                return false;
            }else{
                for (var i = 0 ; i < arr.length; i ++){
                    if(!emailrule.test(arr[i])){
                        var num = i + 1;
                        error += num+"、";
                    };
                }
            };
            if(error != ''){
                error = error.substr(0,error.length-1);
                alert("第"+error+"个邮箱格式不正确");
                return false;
            };
            $.post(url,{ emails: emailList },function(data){
                if(data.status==0)
                {
                   alert(data.info);
                }
				else{
                        alert('邀请成功');
                        window.location.reload();
                    }
            },"json");
       }
  }
	
	</script>
    <script>
$(".menu9").addClass("uc-current");
</script>
<include file="App/Home/View/Public/footer.html"/>

92:F:\git\coin\bisheng commerce\App\Home\View\User\pay.html
<include file="App/Home/View/Public/header.html"/>
<div id="main">
	<div class="main_box">
		<include file="App/Home/View/Public/left.html"/>
		<div class="raise right clearfix">
            <link rel="stylesheet" href="__PUBLIC__/Home/css/layer.css">
<script src="__PUBLIC__/Home/js/base64.js"></script>
<script src="__PUBLIC__/Home/js/Fnc.js"></script>
<style>
.zzzn a{ display:block; float:right; margin:20px; padding:8px 20px; color:#fff; background:#82b52d; font-size: 20px; border-radius:30px; text-decoration:none;}
.zzzn a:hover{ background:#90c13e;}
.ul_recharge_padding{padding:20px 0 0px 160px;}
.recharge_tips{color:#f00; line-height:40px; margin:0;}
.recharge_left_input{margin-left:16px;}
.help_link{ line-height:40px; color:#2471cb; text-decoration:underline; font-size:14px;}
.help_link:hover{ color:#f30;}
.help_link1{ color:#;}
.ebank_pay{font-family: Arial,"微软雅黑"; width:260px; height:40px; color:#fff; font-size:16px; line-height: 40px; text-align: center; margin:0 auto; background:#f60; display: block; text-decoration: none; border: 0;}
.ebank_pay:hover{ background: #f70; color:#fff; text-decoration: none; cursor: pointer;}

.box_close{ height:24px; line-height:24px; width:24px; text-align:center; font-size:14px; color:#999; border-radius:20px; position:absolute; top:10px; right:10px; text-decoration:none; font-family:Arial;}
.box_close:hover{ color:#fff; background:#f00; text-decoration:none;}
.choice_ebank .note1{ width:100px; text-align:right; display:block; float:left; margin-right:5px; line-height:40px;}
.layui-layer-content{text-align:center; margin-top:80px;font-size: 20px;color: #666;text-align: center;}
.layui-layer-content .yes {
    width: 160px;
    height: 40px;
	margin-top:80px;
    text-align: center;
    line-height: 40px;
    font-size: 14px;
	background: #4b7100;
    color: #fff;
	border:none;
    text-decoration: none;}
.fkbtn{
    width: 80px;
    height: 30px;
    color: #f60;
	border:1px #f60 solid;
    border-radius: 3px;
    font-size: 12px;
    display: inline-block;
    line-height: 30px;
    text-align: center;
}
.fkbtn:hover{ color:#f60 !important;}

</style>
	<name id="realname" data="{$member['name']|default='暂无'}"></name>
<div class="ybc_list">
    <div class="ybcoin clearfix">
        <h2 class="left">充值人民币CNY[<span style="color:red">谨防诈骗</span>]</h2>
        <p class="right recharge_tips" style="margin-bottom:0;"><a href="{:U('Help/index',array('article_id'=>'59'))}" class="help_link">银行卡汇款帮助？</a></p>
    </div>
    <div class="support_ybc pass_ybc ybc_optimize" id="verifyon">
<!--        <ul id="pass_change">-->
<!--            <li class="selectTag ebank_change"><a onclick="selectTag('tagContent0',this);Ebank.platform('bank');" href="javascript:void(0)" class="">银行卡汇款</a></li>-->
<!--             <li class="ebank_change"><a onclick="selectTag('tagContent0',this);Ebank.platform('alipay');" href="javascript:void(0)" class="middle" class="ebank_pay">支付宝汇款</a></li>-->
<!--            <li class="note ebank_change"><a onclick="selectTag('tagContent1',this)" href="javascript:void(0)" class="">从元宝理财转账</a></li>-->
<!--            <div class="clear"></div>-->
<!--        </ul>-->

        <div id="tagContent" class="passContent">

            <!-- bank/alipay -->
            <div class="tagContent selectTag" id="tagContent0">
               <ul class="ybc_optimize_con ul_recharge_padding" id="rollout2" style="margin-top:30px;">
                   <!--  <li class="clearfix">
                        <span class="note1" style="color:#333;font-size:12px; margin-left: 30px;">选择汇款额度</span>
                        <input type="radio" name="bank" id="choice_money_upper" onclick="Ebank.choiceMoney(1)" checked="checked" style="vertical-align:bottom; height:40px;">
                        <label for="choice_money_upper" class="tibi_l" onclick="Ebank.choiceMoney(1)" style="font-size:16px; line-height:40px;">大于等于5000元&nbsp;&nbsp;</label>
                        <input type="radio" name="bank" id="choice_money_lower" onclick="Ebank.choiceMoney(0)" style="vertical-align:bottom; height:40px;">
                        <label for="choice_money_lower" class="tibi_l" onclick="Ebank.choiceMoney(0)" style="font-size:16px; line-height:40px;">小于5000元</label>
                    </li> -->
                    <li style="margin-top:0; position:relative;" class="choice_ebank">
                        <span class="note1" style="color:#333;font-size:12px;">金额</span>
                        <input name="number" id="over_num" class="money num_three" onkeyup="value=value.replace(/[^\d]/g,'');notfee();" autocomplete="off" maxlength="10" type="text">
                        <span class="note" style="margin-left: 5px;">最小充值金额{$config['pay_min_money']|default='0'}元。</span>
                        <input id="rand_num" value="0" type="hidden">
                    </li>
                    <li class="num_money choice_ebank" style="margin-left:105px; position:relative;">
                        <span class="left">汇款金额：</span>
                        <font id="ure" class="left" color="red"></font>
                        <span class="note" style="position:absolute; top:0; right:-270px; color:#f00; font-size:14px; line-height:20px;">请严格按照汇款金额汇款，汇款金额的后<br>3位是为了保证即时到账系统自动分配的。</span>
                    </li>

                    <li style="margin-top:10px; position:relative;" class="choice_ebank">
                        <span class="note1" style="color:#333;font-size:12px;" id="recharge_name">汇款人姓名</span>
						<input id="recharge_name_yes" class="money num_three" value="{$member['name']|default='暂无'}" autocomplete="off" readonly="readonly" type="text">
                        <span class="note" style="margin-left: 5px;">系统只接受您实名账户充值</span>
                    </li>

                    <li style="margin-top:10px; position:relative;" class="choice_ebank">
                        <span class="note1 recharge_left_input" style="color:#333;font-size:12px; margin-left:0;" id="recharge_account">汇出银行</span>
                        <select class="money num_three" id="bankOut" name="bankOut" style="width:259px; height:40px;" >
                            <option selected="selected" value="请选择银行">请选择银行</option>
                            <option value="支付宝">支付宝</option>
                            <option value="招商银行">招商银行</option>
                            <option value="中信银行">中信银行</option>
                            <option value="光大银行">光大银行</option>
                            <option value="兴业银行">兴业银行</option>
                            <option value="平安银行">平安银行</option>
                            <option value="华夏银行">华夏银行</option>
                            <option value="邮政储蓄">邮政储蓄</option>
                            <option value="广发银行">广发银行</option>
                            <option value="浦发银行">浦发银行</option>
                            <option value="北京银行">北京银行</option>
                            <option value="上海银行">上海银行</option>
                            <option value="杭州银行">杭州银行</option>
                            <option value="宁波银行">宁波银行</option>
                            <option value="民生银行">民生银行</option>
                            <option value="工商银行">工商银行</option>
                            <option value="农业银行">农业银行</option>
                            <option value="建设银行">建设银行</option>
                            <option value="交通银行">交通银行</option>
                            <option value="中国银行">中国银行</option>
                            <option value="其它银行">其它银行</option>
                        </select>
                        <span class="note" style="position:absolute; top:0; color:#f00; font-size:13px; line-height:20px;">请注意：部分银行周末汇款，不能及时到账。支付宝转账请备注ID号，否则无法及时到账。</span>
                    </li>

                    <li style="margin-top:10px; position:relative;" class="choice_ebank">
                        <span class="note1 recharge_left_input" style="color:#333;font-size:12px; margin-left:0;" id="recharge_account">汇款银行账号</span>
                        <input id="recharge_account_yes" class="money num_three"  type="text">
                        <span class="note" style="position:absolute; top:0; right:38px; line-height:20px;">请准确填写汇款银行账号，否则不能到账，<br>需要人工联系客服排队处理，时间无法保证。</span>
                    </li>

                    <li style="color:#f00; font-size:16px; margin-top:20px; margin-left:99px;" class="choice_ebank"></li>

                    <li>
                    <a href="javascript:void(0);" onclick="recharge()" class="btn_turn" id="choice_submit" style="margin-left:105px;">生成汇款订单</a></li>
                </ul>

                <div class="turns truns_upper">
                    <h2>{$art['title']}</h2>
                {$art.content} </div>
               <!--  <div class="turns turns_lower" style="display: none;">
                    <h2 style="margin-top:80px;">充值必看步骤</h2>
                    <p style="margin-bottom:0; color:#f00; font-size:14px;">1. 元宝理财和元宝网账户互通，请直接登录，使用第三方支付渠道（连连支付、宝付）进行充值。</p>
                    <p style="color:#f00; font-size:14px;">2. 在元宝理财充值成功后，请返回元宝网，并选择“从元宝理财提现”，将资金转入元宝网即可正常使用。</p>
                </div> -->
              <!--/* <div style=" width:750px; margin-left:30px;color:#f00; font-size:14px;">
				汇款成功后，请及时将汇款信息（进盟网账号、
				手机号码、
				汇款人姓名、
				汇款时间、
				汇款金额、
				汇款成功截图证明、）发送邮件到cz@jmcoin.net，进盟客服人员将会在48小时之内尽快手工处理到账，请耐心等待。
				</div>*/-->
               <!--  <div style=" width:750px; margin-left:50px; color:#f60;">
				汇款成功后，请及时将汇款信息（
                <br>进盟网账号:
				<br>手机号码:
				<br>汇款人姓名:
				<br>汇款时间:
				<br>汇款金额:
				<br>汇款成功截图证明:
                <br>）发送邮件到cz@jmcoin.net，进盟客服人员将会在48小时之内尽快手工处理到账，请耐心等待。
				</div>-->
            </div>

            <!-- licai -->
            <div class="tagContent selectTag" id="tagContent1" style="display:none;">
                <form class="form-horizontal" onsubmit="return false;" onkeydown="if (event.keyCode == 13) {return false;}">
                    <ul class="ybc_con" id="rollout" style="padding:20px 0 0 160px;">
                        <li>
                            <label style="width:100px;"><span class="redstar">*&nbsp;</span>转账金额：</label>
                            <input style="display:none;"><!-- for disable autocomplete on chrome -->
                            <input name="number" onkeyup="value=value.replace(/[^\d.]/g,'')" value="0" autocomplete="off" style="width:260px;" type="text">
                            <span class="note">不能小于10元</span>
                        </li>
                        <li>
                            <label style="width:100px;"><span class="redstar">*&nbsp;</span>交易密码：</label>
                            <input style="display:none;"><!-- for disable autocomplete on chrome -->
                            <input name="pwdtrade" autocomplete="off" style="width:260px;" type="password">
                            <span class="note">请输入交易密码</span> </li>
                        <li>
                            <label style="width:100px;">&nbsp;</label>
                            <input class="queding" id="submit_recharge" value="确定" style="border:0; height:42px; line-height:40px; width:262px; font-family:'Microsoft Yahei';" onclick="Ebank.fromDai();" type="submit">
                        </li>
                    </ul>
                </form>
                <div class="turns">
                    <h2>使用说明</h2>
                    <p style="margin-bottom:0;">1. 从元宝理财同名账户提现到元宝网。</p>
                    <p style="margin-bottom:0;">2. 即时到账。</p>
					<p>3. 通过元宝理财“第三方支付”充值CNY更便捷，多家银行即时到账；可提现到元宝网使用。</p>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- exchange_cny list start-->

<div class="ybc_list">
    <div class="ybcoin ">
        <h2 class="left">充值记录</h2>
        <p class="right" style="font-size:14px; color:#f00; line-height:40px; margin-bottom:0;">超过3个小时的汇款订单将失效，请重新生成汇款订单并汇款。<a href="{:U('Help/index?id=62')}" class="help_link">充值不到账如何处理？</a></p>
        <div class="clear"></div>
    </div>
</div>
<table class="raise_list" style="border:1px solid #e1e1df;" align="center" border="0" cellpadding="0" cellspacing="0">
    <thead>
        <tr>
            <th>记录ID</th>
            <th>转入渠道</th>
            <th>数量</th>
            <th>发送时间</th>
            <th>状态</th>
        </tr>
    </thead>
    <tbody>
		<volist name='list' id='vo' key='key'>
			<tr>
			<td>{$key}</td>
			<td><eq name="vo.type" value="1">人工充值<else/>网银充值</eq></td>
			<td>{$vo.count|default=0}</td>
			<td>{$vo.add_time|date='Y-m-d H:i:s',###}</td>
			<td><eq name='vo.status' value='请付款'><a class="fkbtn" onclick='showPay({$vo.count|default=0})'><else/><a class="fkbtn"></eq>{$vo.status|default=0}</a></td>
			</tr>
		</volist>
    </tbody>
</table>
<div class="page" style=" min-width:200px !important; float:right;">
                    {$page}
              </div>
<!-- exchange_cny list end -->

<!-- recharge alert start -->
<style type="text/css">
.ybc_chongzhi_tc{width: 810px; height: 520px; border:1px #ddd solid;z-index:9999; position: fixed;left: 50%; top: 50%; margin: -300px 0 0 -405px; background: #fff; z-index: 9999;}
.ybc_chongzhi_tc_tittle{width: 770px; height: 80px;padding: 0 20px 0 20px; text-align: center; }
.ybc_chongzhi_tc_tittle h2{ color:#666; text-align:left; font-size:24px; height:80px; line-height:80px; }
.ybc_chongzhi_tc_main{width: 810px;height: 200px; background-color:#ffffc9; padding: 30px 0px; }
.ybc_chongzhi_tc_tittle_img{margin-top: 26px;width: 28px; height:28px;background: url("/images/close.png") left bottom no-repeat;}
.ybc_chongzhi_tc_tittle_img:hover{margin-top: 26px;width: 28px; height:28px;background: url("/images/close.png") left top no-repeat;cursor:pointer}
.ybc_chongzhi_tc_main h3{ color:#333; text-align:center; font-size:20px;  line-height:30px; }
.ybc_chongzhi_tc_main .hs{ color:#ff0000; text-align:center; font-size:20px; line-height:30px; }
.ybc_chongzhi_tc_main li span{/*width: 300px; text-align: right;*/ float: left; color:#333;font-size:16px;}
.ybc_chongzhi_tc_main li{ font-size:14px; color:#333; height:30px; line-height:30px;}
.ybc_chongzhi_tc_tishi h3{color:#ff0000; text-align:center; font-size:25px; ; line-height:60px;}
.ybc_chongzhi_tc_tishi p{color:#ff0000; text-align:left; font-size:16px; ; line-height:24px; padding-left: 130px;}
.ybc_chongzhi_tc_tishi_bz{width: 770px; height: 80px;padding: 0 20px 0 20px; line-height: 80px; font-size:18px; color: #666;}
.ybc_chongzhi_tc_tishi span{width: 1px;padding: 0px 2px; border-right: 1px #ddd solid; height: 18px; margin-right: 8px;}
.box_bg2{  width: 100%;  height: 100%;  background: #000; filter: Alpha(opacity=60); -moz-opacity: 0.6; -khtml-opacity: 0.6; opacity: 0.6; position: absolute;  z-index: 9998;  position: fixed;  left: 0; top: 0;}

.special_note{ width:480px; height:320px; background:#ffffca; border:1px solid #fbd163; position:fixed; top:50%; margin-top:-161px; left:50%; margin-left:-241px; z-index:9999;}
.special_note h2{ color:#f60; font-size:24px; text-align:center; height:60px; line-height:60px;}
.special_note p{ font-size:16px; line-height:28px; padding:0 40px; margin-bottom:10px; text-indent:2em; color:#333;}
.special_note .yes_no .yes,.special_note .yes_no .no{ width:160px; height:40px; border:0; margin:10px 20px; cursor:pointer; color:#fff; font-family:'Microsoft Yahei'; font-size:14px;}
.special_note .yes_no{ width:400px; margin:0 auto;}
.special_note .yes_no .yes{ background:#690; color:#fff;}
.special_note .yes_no .yes:hover{ background:#4b7100;}
.special_note .yes_no .no{ background:#f00; color:#fff;}
.special_note .yes_no .no:hover{ background:#ba0000;}
.ybc_chongzhi_tc_tittle_img {
    margin-top: 26px;
    width: 28px;
    height: 28px;
    background: url("__PUBLIC__/Home/images/close.png") left bottom no-repeat;
}
.wid{ width:170px; overflow:hidden;}
.pad{ padding-left:38px;}
</style>

<div id="recharge_alert_bank" style="display:none;">
<div class="box_bg2"></div>
<div class="ybc_chongzhi_tc">
    <div class="ybc_chongzhi_tc_tittle">
        <h2 class="left clearfix" id="recharge_alert_title"></h2>
        <div id="recharge_alert_bank_close"><a class="ybc_chongzhi_tc_tittle_img  right clearfix "></a></div>
    </div>
	
    <div class="ybc_chongzhi_tc_main">
		
        <h3 style=" padding-bottom:15px;">请您打开你的<span class="hs phone_bank_and_net"></span><br>按照汇款金额<span class="hs recharge_html_num"></span></h3>
        <div style=" margin:0 auto;">
        <ul style=" width:640px; height:120px; margin-left:100px;">
            <empty name="bank[1]['bank_adddress']">
            <!--居中-->
            <div style=" float:left; margin-left:180px !important;">
            <li class="pad"><span>向{$bank[0]['bank_name']|default='暂无'}汇款</li>
            <li class="pad"><span>收款人：</span>{$bank[0]['bank_name']|default='暂无'}</li>
            <li class="pad"><span>收款人账号：</span>{$bank[0]['bank_no']|default='暂无'}</li>
            <li class="pad"><span>收款人开户行：</span><span class="wid">{$bank[0]['bank_adddress']|default='暂无'}</span></li>	
            </div>	
            </empty>
            <!--居中-->
        	<notempty name="bank[1]['bank_adddress']">
            <div style=" float:left;">
            <li class="pad"><span>向{$bank[0]['bank_name']|default='暂无'}汇款</li>
            <li class="pad"><span>收款人：</span>{$bank[0]['bank_name']|default='暂无'}</li>
            <li class="pad"><span>收款人账号：</span>{$bank[0]['bank_no']|default='暂无'}</li>
            <li class="pad"><span>收款人开户行：</span><span class="wid">{$bank[0]['bank_adddress']|default='暂无'}</span></li>	
            <!--<div style="border-bottom:1px #ccc dashed;"></div>		-->
            </div>	
          
            <div style=" float:left;">
          	<li class="pad"><span>向{$bank[1]['bank_name']|default='暂无'}汇款</li>
            <li class="pad"><span>收款人：</span>{$bank[1]['bank_name']|default='暂无'}</li>
            <li class="pad"><span>收款人账号：</span>{$bank[1]['bank_no']|default='暂无'}</li>
            <li class="pad"><span>收款人开户行：</span><span class="wid">{$bank[1]['bank_adddress']|default='暂无'}</span></li>	
            <!--<div style="border-bottom:1px #ccc dashed;"></div>		-->
            </div>
            </notempty>
            <div class="clear"></div>
            <li style="font-size:14px; color:#f00; padding-left:5px;"><span style="font-size:18px;">汇款金额：</span><strong style="font-size:18px;" class="recharge_html_num"></strong>（汇款时请严格按照此金额转账，支付宝转账请备注ID号，否则不能到账）</li>
        </ul>
        </div>
    </div>
	
    <div class="ybc_chongzhi_tc_tishi">
        <h3 style="text-align: left; margin-left: 100px;">注意</h3>
        <p>1、本系统非自动扣款，请通过您的<font class="phone_bank_and_net"></font>汇款！<br>
            2、如您已向{$bank[0]['bank_name']|default='暂无'}<notempty name="bank[1]['bank_name']">或{$bank[1]['bank_name']|default='暂无'}</notempty>汇款<font class="recharge_html_num"></font>"，系统在收到汇款后20分钟内入账。</p>
        <div class="ybc_chongzhi_tc_tishi_bz">
            <div class="left clearfix"><a href="{:U('Help/index',array('article_id'=>'59'))}" target="_blank" class="help_link">银行卡汇款帮助</a></div>
            <div class="right clearfix"><a href="http://wpa.qq.com/msgrd?v=3&uin={$config['qq1']}&site=qq&menu=yes" class="qq_qq help_link">联系客服QQ</a></div>
        </div>
    </div>
</div>
</div>
<!-- recharge alert end -->

<div>
    <!-- <button class="ebank_pay" onclick="Ebank.licai()" style="margin-top:160px;">去元宝理财充值</button> -->
    <div class="ebank_box_common" style=" width:100%; height:100%; background:#000; filter: Alpha(opacity=60); -moz-opacity: 0.6; -khtml-opacity: 0.6; opacity: 0.6; position:absolute; z-index:9998; position:fixed; left:0; top:0; z-index: 9998;  display:none;">
	</div>
</div>

<script type="text/javascript" src="__PUBLIC__/Home/js/tab2.js"></script>
<script src="__PUBLIC__/Home/js/layer.js"></script>
		</div>
		<div class="clear"></div>
	</div>
</div>   
<script>

	function closewin(){
		$(".layui-layer-shade").remove();
		$(".layui-layer").remove();
	}
	function notfee(){
		if($("#over_num").val()!=""){
			$("#ure").text((parseInt($("#over_num").val(),10)+{$fee}).toFixed(3));
		}else{
			$("#ure").text("");
		}
	}
function recharge() {
    var min_num={$config.pay_min_money};
    var max_num={$config.pay_max_money};
	var fee = {$fee};
	if (this.choice_money == 0) {
        // window.open("http://yuanbao.com/user_ebank");
        $('.ebank_box_common').show();
        return false;
    }

    // 姓名
    //var recharge_name_yes = $('#recharge_name_yes').val();
    var recharge_name_yes = $('#realname').attr('data');

    if (!(/[\u4E00-\u9FA5]{2,5}(?:·[\u4E00-\u9FA5]{2,5})*/).test(recharge_name_yes)) {
    //if (!(/^[\u4e00-\u9fa5]{2,10}$/).test(recharge_name_yes)) {

        //Layer.alert('请输入正确的汇款人姓名');
		layer.open({
			type: 1,
			skin: 'layui-layer-demo', //样式类名
			closeBtn: 0, //不显示关闭按钮
			shift: 2,
			shadeClose: true, //开启遮罩关闭
			content: '<div>请输入正确的汇款人姓名</div><div style="text-align:center"><button type="button" class="yes" onclick="closewin()">确定</button>',
			area: ['420px', '280px'], //宽高
		});
        return false;

    }

    // 银行卡号
    var recharge_account_yes = $('#recharge_account_yes').val();
	//alert(recharge_account_yes.length);
	
    if (recharge_account_yes == '' || recharge_account_yes.length < 11 ||  recharge_account_yes.length > 20) {

        //Layer.alert('请输入正确的汇款银行账号');
		layer.open({
			type: 1,
			title: false,
			skin: 'layui-layer-demo', //样式类名
			closeBtn: 0, //不显示关闭按钮
			shift: 2,
			shadeClose: true, //开启遮罩关闭
			content: '<div>请输入正确的汇款银行账号12-20位字符</div><div><button type="button" class="yes" onclick="closewin()">确定</button>',
			area: ['420px', '280px'], //宽高
		});

        return false;

    }
	
	// 汇出银行
	var bankName = $('#bankOut').val();
	if(bankName == '请选择银行'){
		layer.open({
			type: 1,
			title: false,
			skin: 'layui-layer-demo', //样式类名
			closeBtn: 0, //不显示关闭按钮
			shift: 2,
			shadeClose: true, //开启遮罩关闭
			content: '<div>请选择汇出银行</div><div><button type="button" class="yes" onclick="closewin()">确定</button>',
			area: ['420px', '280px'], //宽高
		});

		return false;
	}
	
    // 充值金额
    var over_num = $('#over_num').val();
    var number = over_num ? over_num: 0;
	var rand_num = $('#rand_num').val();
    rand_num = rand_num ? rand_num: 0;
	
    var num = parseInt(number) + parseFloat(rand_num);
    if(num < min_num) {
	   layer.open({
			type: 1,
			title: false,
			skin: 'layui-layer-demo', //样式类名
			closeBtn: 0, //不显示关闭按钮
			shift: 2,
			shadeClose: true, //开启遮罩关闭
			content: '<div>充值金额不能小于'+min_num+'元</div><div><button type="button" class="yes" onclick="closewin()">确定</button>',
			area: ['420px', '280px'], //宽高
		});
        return false;
    }

    if (num >= max_num) {
		layer.open({
			type: 1,
			title: false,
			skin: 'layui-layer-demo', //样式类名
			closeBtn: 0, //不显示关闭按钮
			shift: 2,
			shadeClose: true, //开启遮罩关闭
			content: '<div>转账金额不能大于'+max_num+'</div><div><button type="button" class="yes" onclick="closewin()">确定</button>',
			area: ['420px', '280px'], //宽高
		});
        return false;
    }
    $.post("{:U('Pay/rechargeByMan')}", {'money':number, 'account': recharge_account_yes, 'count':parseInt($("#over_num").val(),10)+fee,'type':1,'member_name': recharge_name_yes},
		function(data) {
            if (data.status == 0) {
				layer.open({
					type: 1,
					title: false,
					skin: 'layui-layer-demo', //样式类名
					closeBtn: 0, //不显示关闭按钮
					shift: 2,
					shadeClose: true, //开启遮罩关闭
					content: '<div>'+data.info+'</div><div><button type="button" class="yes" onclick="closewin()">确定</button>',
					area: ['420px', '280px'], //宽高
				});
            } else {
				$('#recharge_alert_bank').show();
                $('#recharge_alert_bank_close').click(function(){$('#recharge_alert_bank').hide(); location.reload();});
                $('.recharge_html_num').html(data.num);
                $('#recharge_alert_title').html('银行卡汇款信息');
                $('.phone_bank_and_net').html('“手机银行”或“网上银行”'); 
            }
        }
    );

    return false;
	
};
function showPay(num){
	$('#recharge_alert_bank').show();
	$('#recharge_alert_bank_close').click(function(){$('#recharge_alert_bank').hide(); location.reload();});
	$('.recharge_html_num').html(num);
	$('#recharge_alert_title').html('银行卡汇款信息');
	$('.phone_bank_and_net').html('“手机银行”或“网上银行”'); 
}
</script>
<script>
    $(".menu12").addClass("uc-current");

    function showTips(id,msg){
        var tips = layer.tips(msg, id, {
            tips: [1, '#fff8db'],
            area: ['400px', '35px']
        });
        $(id).on('mouseout', function(){
            layer.close(tips);
        });
    }
</script>
<include file="App/Home/View/Public/footer.html"/>

93:F:\git\coin\bisheng commerce\App\Home\View\User\showSysTem.html
<include file="App/Home/View/Public/header.html"/>
<div id="main">
    <div class="newsarea" style="padding-top:0;">
        <div class="newsarea_box">
            <div class="product left clearfix">
                <div style="border-bottom:1px solid #e2e2e2; padding-top:20px; position:relative;">
                    <h2 style="line-height:24px; border:none;">【{$list['type_name']}】{$list['title']}</h2>
                    <p style=" position:absolute; right:40px; bottom:0px; color:#999;">{$list['add_time']|date="Y-m-d H:i:s",###}</p>
                </div>
                <div class="paragraph paragraph_news">
                   {$list['content']}
				  </div>  
            </div>

            <div class="right">
                <div class="latest">
                    <div class="investmentarea">
                        <div class="focusnum1" style="border-bottom:1px solid #eee;">
                            <h2 class="left">系统消息</h2>
                            <p class="right"><a href="{:U('User/sysMassage')}">查看更多</a></p>
                            <div class="clear"></div>
                        </div>
                        <ul>
                            <volist name="right" id="row">
                            	<a href="{:U('User/showSysTem',array('message_id'=>$row['message_id'],'message_all_id'=>$row['message_all_id']))}">
									<li>
										<p class="left" style="width:200px; line-height:18px;">【{$row['type_name']}】{$row['title']}</p>
										<p class=" right recruit" style="width:65px; margin-left:0;">{$row['add_time']|date="Y-m-d",###}</p>
										<div class="clear"></div>
									</li>
								</a>
								</volist>

                        </ul>
                    </div>
                </div>
            </div>
            <div class="clear"></div>
        </div>
    </div>
</div>
<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>

94:F:\git\coin\bisheng commerce\App\Home\View\User\substitution_center.html
<include file="App/Home/View/Public/header.html"/>
<link href="__PUBLIC__/Home/css/coincommon_v1.css" rel="stylesheet" type="text/css" media="screen, projection">
<link href="__PUBLIC__/Home/css/jquery-ui-1.css" rel="stylesheet" type="text/css" media="screen, projection">
<link href="__PUBLIC__/Home/css/convertIndex.css" rel="stylesheet" type="text/css" media="screen, projection">
<style>
.conLi2{ padding-top:20px;}
</style>
 <div class="convertBox">
		<div class="convertAutoBox">
			<div class="convertTopBox"></div>
			<div class="convertCenBox">
				<ul class="convertCenUl">
					
						<li class="convertCenli">
							<p class="conLi1" style="background:url('__PUBLIC__/Home/images/FHQ.png') no-repeat 0 50%;background-size: 46px 46px;">账户余额(FHQ)</p>
							<div class="conLi7">
								<p class="conLi2">
									<span class="conLi6" id="oldTotal796432">0.00</span>
								</p>
								<p class="conLi3">个</p>
							</div>
							<div class="conLi10"><p class="conLi4">置换比例 1 : 3.5</p></div>
							<p class="conLi1" style="background:url('__PUBLIC__/Home/images/ECO.png') no-repeat 0 50%;background-size: 46px 46px;">能置换生态坊(ECO)</p>
							<div class="conLi8">
								<p class="conLi2">
									<span class="conLi6" id="newTotal796432">
										0.00
									</span>
								</p>
								<p class="conLi3">个</p>
							</div>
							
								
								
								<a class="conLi5" href="javascript:void(0)" onclick="return submitConData(this,'7','796432')">置换</a>
								
							
							
						</li>
					
						<li class="convertCenli">
							<p class="conLi1" style="background:url('__PUBLIC__/Home/images/DC.png') no-repeat 0 50%;background-size: 46px 46px;">账户余额(DC)</p>
							<div class="conLi7">
								<p class="conLi2">
									<span class="conLi6" id="oldTotal796439">0.00</span>
								</p>
								<p class="conLi3">个</p>
							</div>
							<div class="conLi10"><p class="conLi4">置换比例 1 : 0.75</p></div>
							<p class="conLi1" style="background:url('__PUBLIC__/Home/images/ECO.png') no-repeat 0 50%;background-size: 46px 46px;">能置换生态坊(ECO)</p>
							<div class="conLi8">
								<p class="conLi2">
									<span class="conLi6" id="newTotal796439">
										0.00
									</span>
								</p>
								<p class="conLi3">个</p>
							</div>
							
								
								
								<a class="conLi5" href="javascript:void(0)" onclick="return submitConData(this,'23','796439')">置换</a>
								
							
							
						</li>
					
						<li class="convertCenli">
							<p class="conLi1" style="background:url('__PUBLIC__/Home/images/STG.png') no-repeat 0 50%;background-size: 46px 46px;">账户余额(STG)</p>
							<div class="conLi7">
								<p class="conLi2">
									<span class="conLi6" id="oldTotal796443">0.00</span>
								</p>
								<p class="conLi3">个</p>
							</div>
							<div class="conLi10"><p class="conLi4">置换比例 1 : 1.35</p></div>
							<p class="conLi1" style="background:url('__PUBLIC__/Home/images/ECO.png') no-repeat 0 50%;background-size: 46px 46px;">能置换生态坊(ECO)</p>
							<div class="conLi8">
								<p class="conLi2">
									<span class="conLi6" id="newTotal796443">
										0.00
									</span>
								</p>
								<p class="conLi3">个</p>
							</div>
							
								
								
								<a class="conLi5" href="javascript:void(0)" onclick="return submitConData(this,'33','796443')">置换</a>
								
							
							
						</li>
					

				</ul>
				<p class="ecoHint">您当前拥有<span id="ecoHintCount">0.00</span>个生态坊</p>
				<div class="convertHintBox">
					<div class="converHintMsgBox">
						<p>1、置换开启后，三个币种停止交易。</p>
						<p>2、置换完成后，会尽快公告通知开启初步交易。</p>
						<p>3、如兑换出现问题，请及时联系客服解决。</p>
					</div>
				</div>
			</div>
		</div>
	</div>
    <div class="clear"></div>
<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>
<!--footer end-->

95:F:\git\coin\bisheng commerce\App\Home\View\User\system_massage.html
<include file="App/Home/View/Public/header.html"/>
<style>
#main{ min-height:620px;}
</style>
<body>
<div id="main" style=" padding:30px 0px !important;">
    <div class="main_box">
        <include file="App/Home/View/Public/left.html"/>
        <div class="raise right clearfix">
            <div class="message">
                <p class="messagetab"><a href="#" class="current">系统消息
                </a></p>

				<volist name="list" id="row">
					<div class="mynews news01">
						<div class="andfrom yourattention">
							<p class="left news_name">
								<a href="
								{:U('User/showSysTem',array('message_id'=>$row['message_id'],'message_all_id'=>$row['message_all_id']))}
								">
									<if condition="$row['status'] eq 0 ">
										【【{$row['type_name']}】{$row['title']}】<span style="color:#FF0000">未读</span>
										<else/>【【{$row['type_name']}】{$row['title']}】
									</if>
								</a>
							</p>
							<p class="right news_date">{$row['add_time']|date="Y-m-d H:i:s ",###}</p>
							<div class="clear">
							</div>
						</div>
					</div>
				</volist>

            </div>
        </div>
        <div class="page" style=" min-width:200px !important; float:right;">
                    {$page}
        </div>
    </div>
</div>
<div class="clear"></div>
</div>
</div>
<script>
$(".menu10").addClass("uc-current");
</script>
<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>

96:F:\git\coin\bisheng commerce\App\Home\View\User\update_massage.html

<include file="App/Home/View/Public/header.html"/>
<!--top end-->
<style>
    .uploadify-button {text-align:center;}
</style>
<script>
    $(document).ready(function(){
        start=document.cookie.indexOf("motip=")
        if (start!=-1){
            start=start + 6
            end=start + 1
            motip = unescape(document.cookie.substring(start,end))
            if(motip == 1)
                $('#phone_top_div').show();
        }
    });
    function hidephone(){
        $('#phone_top_div').hide();
        var d=new Date()
        d.setTime(d.getTime() + 7200)
        document.cookie="motip=2;expires="+d.toUTCString()
    }
</script>

<div id="main">
    <div class="main_box">

        <include file="App/Home/View/Public/left.html"/>
        <div class="raise right clearfix">
            <h2 style="border-bottom:1px solid #e1e1df;">修改账户信息</h2>
            <form method="post" id="signupForm" action="{:U('User/updateMassage')}" jump-url="{:U('User/updateMassage')}" >
                <ul class="apply">
                    <li style="margin-bottom:0px;"><label class="youxiang">用户ID： </label>{$list['member_id']}</li>
                    <li style="margin-bottom:10px;"><label for="email" class="youxiang">邮箱：</label>{$list['email']}</li>
                    <li style="margin-bottom:10px;"><label for="job" class="youxiang">昵称：</label>
                        <input type="text" name="nick" id="nick" class="" value="{$list['nick']}">
                        <span class="note" id="nickmsg">请填写昵称，会优先显示，不能包含“元宝”字样</span>
                    </li>
                    <li style="margin-bottom:10px;"><label for="realname" class="youxiang">真实姓名：</label>{$list['name']|mb_substr=0,1,"utf-8"}*<span class="note">（如需修改姓名，请联系客服人员）</span></li>
                    <li style="margin-bottom:15px;"><label for="idcard" class="youxiang">身份证号：</label>{$list['idcard']|substr=0,3}****{$list['idcard']|substr=15,3}<span class="note">（如需修改证件号，请联系客服人员）</span></li>
                    <li style="margin-bottom:10px;"><label for="mo" class="youxiang"><span class="redstar"></span>手机号：</label>
                        {$list['phone']|substr=0,3}****{$list['phone']|substr=9,2}<span class="note" id="momsg"><!--<a class="voices" href="/user_phone/update">修改手机号码</a>--></span><div class="clear"></div>
                    </li>
                    <li><label>所在城市：</label>
                        <select name="province" class="area" id="area">
                            <option value="0">请选择</option>
                            <volist name="areas" id='row'>
                                <option value="{$row['area_id']}" <eq name="row.area_id" value="$list.province">selected="selected"</eq>>{$row['area_name']}
                                </option>
                            </volist>
                        </select>
                        <select name="city" class="city" id="city">
                            <option value="{$list['city']}">{$list['area_name_city']}</option>
                        </select>
                        <script>
                            $("#area").change(function(){
                                $.post("{:U('User/getcity')}",{'id':$("#area").val()},function(data){
                                    $("#city").empty();
                                    var area=new Option("请选择","");
                                    $("#city").append(area);
                                    if(data.length>0){
                                        for(var i=0;i<data.length;i++){
                                            var option = new Option(data[i]["area_name"], data[i]["area_id"]);
                                            $("#city").append(option);
                                        }
                                    }else{
                                        $("#city").append("<option value='0'>没有相应城市信息</option>");
                                    }
                                });
                            });
                        </script>
                        <span class="note" id="promsg"></span>
                    </li>
                    <li><label for="job" class="youxiang">职位/头衔：</label>
                        <input type="text" name="job" id="job" class="" value="{$list['job']}">
                    </li>
                    <li style="margin-bottom:20px;">

                        <label for="upload">上传头像：</label>
                        <input type="file" size="45" id="file_upload1" name="file_upload1" class="fileField left" style="text-align:center;" multiple/>
                        <!--<button class="button left upload" onclick="return ulogoUpload();">上传</button>-->
                        <span class="note left" style="height:40px; line-height:20px;">尺寸需大于120*120像素；支持.jpg .png .gif格式；<br>小于1MB的图片</span>
                        <div id="fileQueue1"></div>
                        <div class="clear"></div>
                    </li>
                    <!--                <li style="margin-bottom:10px;"><label>&nbsp;</label><img src="--><!--" id="logo" style="width:72px; height:72px;"/></li>-->
                    <li style="margin-bottom:10px;"><label>&nbsp;</label>
                        <img name="head"
                        <if condition="$list['head']">src="{$list['head']}"
                            <else/>src="__PUBLIC__/Home/images/ulogodefault.jpg"
                        </if>
                        id="logo" style="width:72px; height:72px;"></li>

                    <input type="hidden" name="head" id="head_hidden"
                    <if condition="$list['head']">value="{$list['head']}"
                        <else/>value="__PUBLIC__/Home/images/ulogodefault.jpg"
                    </if>
                    >

                    <li style="margin-bottom:10px;"><label for="jianjie">个人简介：</label>
                        <textarea id="jianjie" rows="5" cols="60" name="profile">{$list['profile']}</textarea>
                        <span class="note" style=" margin-left:110px;">3000字以内</span>
                    </li>
                    <input type="hidden" name="member_id" value="{$list['member_id']}"/>
                    <li><label class="youxiang">&nbsp;</label><input type="submit" class="queding" value="确定"></li>
                </ul>
            </form>
        </div>
        <div class="clear"></div>
    </div>
</div>
<link href="__PUBLIC__/js/uploadify/uploadify.css">
<script type="text/javascript" src="__PUBLIC__/js/uploadify/jquery.uploadify.min.js"></script>
<script type="text/javascript">
    $(function () {

        $("#file_upload1").uploadify({
            //指定swf文件
            'swf': '/Public/js/uploadify/uploadify.swf',
            //后台处理的页面
            'uploader': "{:U('User/addPicForAjax')}",
            //按钮显示的文字
            'buttonText': '点击上传',
            //显示的高度和宽度，默认 height 30；width 120
            'height': 30,
            'width': 330,
            //上传文件的类型  默认为所有文件    'All Files'  ;  '*.*'
            //在浏览窗口底部的文件类型下拉菜单中显示的文本
            'fileTypeDesc': 'Image Files',
            //允许上传的文件后缀
            'fileTypeExts': '*.gif; *.jpg; *.png',
            //发送给后台的其他参数通过formData指定
            //'formData': { 'someKey': 'someValue', 'someOtherKey': 1 },
            //上传文件页面中，你想要用来作为文件队列的元素的id, 默认为false  自动生成,  不带#
            'queueID': 'fileQueue1',
            //选择文件后自动上传
            'auto': true,
            //设置为true将允许多文件上传
            'multi': false,
            'onUploadSuccess':function(file,data,response){
                var r=jQuery.parseJSON(data);
                $("#pic1").val(r['info']);
                //$("#uploadedpic").empty();
                $("#logo").attr("src",r['info']);
                $("#head_hidden").attr("value",r['info']);
                //$(".uploadedpic").append("<img src='"+r['info']+"' class='mt10'>");
            }
        });
    });
</script>

<script>
    $("#signupForm").validate({
        rules: {
        },
        messages: {
        },
        submitHandler:function(form){
            ajax_submit_form(form)
            return false;
        },
        invalidHandler: function() {  //不通过回调
            return false;
        }
    });
</script>
<script>
    $(".menu7").addClass("uc-current");
</script>
<include file="App/Home/View/Public/footer.html"/>

97:F:\git\coin\bisheng commerce\App\Home\View\User\update_password.html
<include file="App/Home/View/Public/header.html"/>

<style>

    .passContent .tagContent .ybc_con li label{
        float:inherit;
        padding-left: 10px;
    }
    .error{
        color: #999;
    }
</style>
<script>
    $(document).ready(function(){
        start=document.cookie.indexOf("motip=")
        if (start!=-1){
            start=start + 6
            end=start + 1
            motip = unescape(document.cookie.substring(start,end))
            if(motip == 1)
                $('#phone_top_div').show();
        }
    });
    function hidephone(){
        $('#phone_top_div').hide();
        var d=new Date()
        d.setTime(d.getTime() + 7200)
        document.cookie="motip=2;expires="+d.toUTCString()
    }
</script>
<script src="js/index.js"></script>
<div id="main">
    <div class="main_box">
        <include file="App/Home/View/Public/left.html"/>
        <div class="raise right clearfix">
            <link rel="stylesheet" href="__PUBLIC__/Home/css/layer.css">
            <h2>修改密码</h2>
            <div class="support_ybc pass_ybc">
                <ul id="pass_change">
                    <li class=""><a onclick="selectTag('tagContent0',this)" href="javascript:void(0)">修改密码</a> </li>
                    <li class="selectTag"><a onclick="selectTag('tagContent1',this)" href="javascript:void(0)">修改交易密码</a></li>
                    <div class="clear"></div>
                </ul>
                <div id="tagContent" class="passContent">
                    <div class="tagContent selectTag" id="tagContent0" style="display: none;">
                        <form method="post" id="signupForm"  jump-url="{:U('Login/index')}"   action="{:U('User/updatePassword')}">
                            <ul class="ybc_con"  style="margin-left: 150px;">
                                <li><label for="password">登录密码：</label><input name="oldpwd" id="oldpwd" type="password"></li>
                                <li><label for="newword">新密码：&nbsp;&nbsp;&nbsp;&nbsp;</label><input name="pwd" id="pwd" type="password"></li>
                                <li><label for="repeat">重复密码：</label><input name="repwd" id="repwd" type="password"></li>
                                <li><label class="buys">&nbsp;</label><input class="tijiao" value="提交"  type="submit"></li>
                            </ul>
                        </form>
                    </div>
                    <div class="tagContent" id="tagContent1" style="display: block;">
                        <script>
                            $("#signupForm").validate({
                                rules: {
                                    oldpwd:{
										required: true,
                                        rangelength:[6,20]
                                    },
                                    pwd:{
										required: true,
                                        rangelength:[6,20]
                                    },
                                    repwd:{
                                        rangelength:[6,20],
                                        equalTo: "#pwd"
                                    }

                                },
                                messages: {
                                    oldpwd:{
									 	required: "密码不能为空",
                                        rangelength:"密码长度在6-20个字符之间"
                                    },
                                    pwd:{
									 	required: "密码不能为空",
                                        rangelength:"密码长度在6-20个字符之间"
                                    },
                                    repwd:{
                                        rangelength:"密码长度在6-20个字符之间",
                                        equalTo: "两次输入不一样"
                                    }
                                },
                                submitHandler:function(form){
                                    ajax_submit_form(form)
                                    return false;
                                },
                                invalidHandler: function() {  //不通过回调
                                    return false;
                                }
                            });
                        </script>
                        <form method="post" id="PwdtradeForm" jump-url="{:U('Login/index')}"  enctype="multipart/form-data" action="{:U('User/updatePwdtrade')}">
                            <ul class="ybc_con" style=" margin-left:150px;">
                                <li><label for="password">登录密码：</label><input name="oldpwd_b" type="password"></li>
                                <li><label for="buypassword">交易密码：</label><input name="oldpwdtrade_b" type="password">
                               
                                </li>
                                <li><label for="newword">新交易密码：</label><input name="pwdtrade" id="pwdtrade" type="password"></li>
                                <li><label for="repeat">重复交易密码：</label><input name="repwdtrade"  type="password"></li>
                                <li style="margin-bottom:20px;"><label for="upload">正面身份证：</label>
                                    <input size="45" id="idcardPositive" name="pic_1" class="fileField" type="file">
                                   <!-- <button class="button left upload" onclick="return uploadIdcard1();">上传</button>-->
                                    <div class="clear"></div>
                                </li>
                                <li style="margin-bottom:10px;">
                                    <label>&nbsp;</label>
                                    <!--<img src="images/ulogodefault.jpg" id="idcard1_img" style="width:72px; height:72px;">-->
                                </li>
                                <li style="margin-bottom:20px;"><label for="upload">反面身份证：</label>
                                    <input size="45" id="idcardPositive2"  name="pic_2" class="fileField" type="file">
                                    <!-- <button class="button left upload" onclick="return uploadIdcard2();">上传</button>-->
                                    <div class="clear"></div>
                                </li>
                                <li style="margin-bottom:10px;">
                                    <label>&nbsp;</label>
                                    <!--<img src="images/ulogodefault.jpg" id="idcard2_img" style="width:72px; height:72px;">-->
                                </li>
                                <li style="margin-bottom:20px;"><label for="upload">手持身份证：</label>
                                    <input size="45" id="idcardPositive3"   name="pic_3" class="fileField" type="file">
 <!--
                                    <button class="button left upload" onclick="return uploadIdcard3();">上传</button>-->
                                    <div class="clear"></div>
                                </li>
                                <li style="margin-bottom:10px;">
                                    <label>&nbsp;</label>
                                    <!--<img src="images/ulogodefault.jpg" id="idcard3_img" style="width:72px; height:72px;">-->
                                </li>
                                <li style="margin-bottom:20px;text-align:center;">
                                    <span class="note" style="height:40px; line-height:20px;">支持.jpg .png .gif格式；小于1MB的图片</span>
                                </li>
                                <li><label class="buys">&nbsp;</label><input class="tijiao" value="提交" type="submit"></li>
                            </ul>
                        </form>
                    </div>
                </div>
            </div>
             <script>
//                  $("#PwdtradeForm").validate({
//                      rules: {
//                          oldpwd_b:{
//						  required: true,
//                              rangelength:[6,20]
//                          },
//                          oldpwdtrade_b:{
//						  required: true,
//                              rangelength:[6,20]
//                          },
//                          pwdtrade:{
//						  required: true,
//                              rangelength:[6,20]
//                          },
//                          repwdtrade:{
//                              rangelength:[6,20],
//                              equalTo: "#pwdtrade"
//                          }
//
//                      },
//                      messages: {
//                          oldpwd_b:{
//						   		required: "密码不能为空",
//                              rangelength:"登录密码长度在6-20个字符之间"
//                          },
//                          oldpwdtrade_b:{
//						   required: "密码不能为空",
//                              rangelength:"交易密码长度在6-20个字符之间"
//                          },
//                          pwdtrade:{
//						   required: "密码不能为空",
//                              rangelength:"新交易密码长度在6-20个字符之间"
//                          },
//                          repwdtrade:{
//                              rangelength:"新交易密码长度在6-20个字符之间",
//                              equalTo: "两次输入不一样"
//                          }
//                      },
//                      submitHandler:function(form){
//                          ajax_submit_form(form)
//                          return false;
//                      },
//                      invalidHandler: function() {  //不通过回调
//                          return false;
//                      }
//                  });
            </script>
            <script type="text/javascript" src="__PUBLIC__/Home/js/tab2.js"></script>
            <script src="__PUBLIC__/Home/js/layer.js"></script>
            <script src="__PUBLIC__/Home/js/password.js"></script>
            <script type="text/javascript" src="__PUBLIC__/Home/js/ajaxfileupload.js"></script>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script type="text/javascript" src="__PUBLIC__/js/uploadify/jquery.uploadify.min.js"></script>

<script type="text/javascript" src="__PUBLIC__/Home/js/tab2.js"></script>
<script src="__PUBLIC__/Home/js/layer.js"></script>
<script src="__PUBLIC__/Home/js/password.js"></script>
<script type="text/javascript" src="__PUBLIC__/Home/js/ajaxfileupload.js"></script>
		</div>
		<div class="clear"></div>
	</div>
</div>
<script>
$(".menu8").addClass("uc-current");
</script>
<include file="App/Home/View/Public/footer.html"/>

98:F:\git\coin\bisheng commerce\App\Home\View\User\zhongchou.html
<include file="App/Home/View/Public/header.html"/>
    <!--top end-->
<div id="main">
	<div class="main_box">
		<include file="App/Home/View/Public/left.html"/>
		<div class="raise right clearfix">
            <div class="ybc_list">
	<div class="ybcoin clearfix">
		<h2 class="left">我的众筹</h2>
		<div class="right" style="margin-top:7px;">
			
		</div>
	</div>
		<table class="raise_list" style="border:1px solid #e1e1df;" id="Transaction" align="center" border="0" cellpadding="0" cellspacing="0">
			<thead>
			<tr>
				<th>币种</th>
				<th>成交时间</th>
				<th>标题</th>
				<th>成交价格</th>
				<th>成交数量</th>
				<th>成交额</th>
			</tr>
			<foreach name="list" item="vo">
					<tr>
					<td>{$vo.currency_id|getCurrencynameByCurrency=###}</td>
						<td>{$vo.add_time|date='Y-m-d H:i:s',###}</td>
						<td>{$vo.title}</td>
						<td>{$vo.price}</td>
						<td>{$vo.num}</td>
						<td>{$vo['price'] * $vo['num']}</td>
						</tr>
				</foreach>
			</thead>
			<tbody>
			</tbody>
		</table>
	</div>
        <div class="page" style=" min-width:200px !important; float:right;">
                    {$page}
              </div>
		</div>
		<div class="clear"></div>
	</div>
</div> 
<script>
$(".menu6").addClass("uc-current");
</script>   
<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>
<!--footer end-->

99:F:\git\coin\bisheng commerce\App\Home\View\Zhongchou\details.html

<include file="App/Home/View/Public/header.html"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/reset.css">
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/zcpc.css">
<script src="__PUBLIC__/Home/js/zc_hm.js">
</script><script type="text/javascript" src="__PUBLIC__/Home/js/zc_jquery.js"></script>
<script type="text/javascript" src="__PUBLIC__/Home/js/zc_common.js"></script>
<script type="text/javascript" src="__PUBLIC__/plugin/Js/layer/layer.min.js"></script>
<style type="text/css">
.jinduline{z-index: 3;}
 .vip_header1 {
        background: #fafafa;
    }
    .vip_user1 {
        position: relative;
        font-size:16px;
        padding:10px 0px 10px 20px;
    }
    .vip_stop1{
        line-height:41px;
    }
    .vip_upgrade ul li{
        line-height:40px;
    }
    .vip_upgrade .left {
        text-align: right;
        width: 405px;
    }
    .vip_upgrade .right {
        width: 575px;
    }
    .vip_upgrade .right a {
        color:#F60;
    }
    .vip_upgrade .right a:hover {
        color:#F90;
    }
    input{ height:25px;}
    .jilu table td{ text-align:center;}
    .pay-m-2 a:hover{ color:#fff !important;}

</style>
<!--top end-->
<div class="acountbd">
    <div class="main clearfix">
        <h1 class="programheadtitle">[认购]{$list.title|default='认购项目'}</h1>
        <div class="pcdeleft">
            <div class="pcdetpic">
                <img style=" width:830px; height:445px;" src="{$list.url2|default=''}" id="sim229784" class="main_img">
            </div>
            <div class="pcdetinfotxt">
                <ul class="pcinfotxtnav">
                    <li data-id="1" class="current">项目详情</li>
                    <li data-id="3">项目进展</li>
                    <li data-id="2">文件下载</li>
                </ul>
                <div id="info_1" class="infodata" style="display:block;">
                    {$list.info|default='此项目暂无详情简介'}
                </div>
                <div id="info_2" class="infodata" style="display:none;height:100px;">
                   <notempty name="list.wenjian_url"><a  href="{$list.wenjian_url}"><input type="button"  value="文件下载"  style="border:1px solid #999;text-align:center;padding:5px 10px 5px 10px;height: 30px;margin-left:100px; margin-top:30px; background:#f70; color: #fff; border-radius: 5px;
"  /></a></notempty>
                </div>
                <div id="info_3" class="infodata">
                    <div style="height: 540px;" class="jindubox">

                        <div class="jinduline"></div>
                        <div class="jindustate"><span><eq name='list.status' value='0'>项目未开始</eq><eq name='list.status' value='1'>项目进行中...</eq><eq name='list.status' value='2'>项目完成</eq></span></div>
                        <div class="jinduitem">
                            <gt name='list.status' value='1'>
                                <div style="right: 50%; bottom: 305px; margin-right: 1px; padding-right: 50px;" class="jditem jditem4" data-item="4">
                                    <i style="right: 0px; background-image: url(&quot;https://imgm.touchouwang.net/public/p_image/jingdu_2.png&quot;);" class="danshu">04</i>
                                    <h6 style="padding-top:10px;">认购成功</h6>
                                    <p>{$list.end_time|date='Y-m-d',###}</p>
                                </div>
                            </gt>
                            <gt name='list.status' value='1'>
                                <div style="left: 50%; bottom: 245px; margin-left: 1px; padding-left: 50px;" class="jditem jditem3" data-item="3">
                                    <i style="left: 0px;" class="danshu">03</i>
                                    <h6 style="padding-top:10px;">认购结束</h6>
                                    <p>{$list.end_time|date='Y-m-d',###}</p>
                                </div>
                            </gt>
                            <gt name='list.status' value='0'>
                                <div style="right: 50%; bottom: 185px; margin-right: 1px; padding-right: 50px;" class="jditem jditem2" data-item="2">
                                    <i style="right: 0px; background-image: url(&quot;https://imgm.touchouwang.net/public/p_image/jingdu_2.png&quot;);" class="danshu">02</i>
                                    <h6 style="padding-top:10px;">认购进行中</h6>
                                    <p>{$list.end_time|date='Y-m-d',###}----</p>
                                </div>
                            </gt>
                            <div style="left: 50%; bottom: 125px; margin-left: 1px; padding-left: 50px;" class="jditem jditem1" data-item="1">
                                <i style="left: 0px;" class="danshu">01</i>
                                <h6 style="padding-top:10px;">认购开启</h6>
                                <p>{$list.add_time|date='Y-m-d',###}</p>
                            </div>
                            <div class="jindustate" style="top: 450px;"><span>初创项目<p style="text-align:center">{$list.ctime|date='Y-m-d',###}</p></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="pcderight">

            <div class="programinfo">
                <h2>项目基本资料<i></i></h2>
                <table class="actab5">
                    <tbody>
                    <tr>
                        <td>总量：<span>{$list.num|default='0.00'}个</span></td>
                        <td>剩余：<span>{$list.deal|default='0.00'}个</span></td>
                    </tr>
                    <notempty name="Think.session.USER_KEY_ID">
                        <tr>
                            <td>限购：<span>{$list.limit_count|default='0.00'}次</span></td>
                            <td>已购：<span>{$list.buy_count|default='0'}次</span></td>
                        </tr>
                        <tr>
                            <td>限购：<span>{$list.limit|default='0.00'}个</span></td>
                            <td>已购：<span>{$num_buy|default='0.00'}个</span></td>
                        </tr>
                    </notempty>
                    <tr>
                        <td>购买币种：<span>{$list.buy_name}</span></td>
                        <td>价格：<span>{$list.price|default='0.00'}</span></td>
                    </tr>
                    <tr>
                        <td>成功比例：<span>{$list.zhongchou_success_bili|default='100'}%</span></td>
                        <td><div class="yuyuebox_1">
                    		<div class="pclastdate2">
                        	<p class="pcfenpost pcfenpost2">
                            <eq name='list.status' value='0'><span class="pctimeico">尚未开始</span></eq>
                            <eq name='list.status' value='1'><span class="pctimeico">认购中</span></eq>
                            <eq name='list.status' value='2'><span class="pctimeico">已结束</span></eq>
                        	</p>
                    		</div>
                			</div>
                          </td>  
                    </tr>
                    </tbody></table>
               
            </div>
            <eq name='list.status' value='0'>
                <div class="programinfo programinfo2">
                    <h2>我要投资</h2>
                    <div class="pay-m-2">
                        <button type="button" class="btn-play-1" disabled="disabled">认购未开始</button>
                        <p>该项目已<strong>暂未开放</strong>不支持购买，请关注其他项目</p>
                    </div>
                </div>
            </eq>

            <eq name='list.status' value='1'>
                <notempty name="Think.session.USER_KEY_ID">
                    <div class="programinfo programinfo2">
                        <h2>我要投资</h2>
                        <form action="{:U('Zhongchou/run')}" method="post" id="buy_form">
                            <div class="pay-m-1">
                                <p>
                                    <ins>账户余额：</ins>
                                    <span id="myMon">{$buy_num|floatval="###"}</span>{$list.buy_mark}
                                    <a href="{:U('User/index')}" class="pay-recharge-btn">充值</a>
                                </p>
                                <p>
                                    <ins>认购数量：</ins>
                                      <input value="{$list.min_limit|default='0'}" class="txt-pay-1" id="num" name="num" type="number" onkeyup="sjmoney();"><span style="font-size:10px;">&nbsp;&nbsp;个(最少购买{$list.min_limit|number_format=###,0}个)</span> 
                                </p>
                         
                                <p>
                                    <ins>实际支付金额：</ins>
                                    <span id="manjianhou">{$list['min_limit']*$list['price']|number_format=###,0}</span>{$list.buy_mark}
                                </p>
                            </div>
                            <div class="pay-m-2">
                                <input type="button" class="btn-play-1" id="zhongchourun" onclick="zhongchou();" value="众筹">
                            </div>
                        </form>
                    </div>
                    <else/>
                    <div class="programinfo programinfo2">
                        <h2>我要投资</h2>
                        <div class="pay-m-1">
                            <p>
                                <ins>账户余额：</ins>
                                暂未登录，<a href="{:U('Login/index')}">登录</a> 后查看
                            </p>
                        </div>

                    </div>
                </notempty>
            </eq>

            <eq name='list.status' value='2'>
                <div class="programinfo programinfo2">
                    <h2>我要投资</h2>
                    <div class="pay-m-2">
                        <button type="button" class="btn-play-1" disabled="disabled">认购结束</button>
                        <p>该项目已<strong>完成</strong>不支持购买，请关注其他项目</p>
                    </div>
                </div>
            </eq> 
			<eq name='list.status' value='3'>
                <div class="programinfo programinfo2">
                    <h2>我要投资</h2>
                    <div class="pay-m-2">
                        <button type="button" class="btn-play-1" disabled="disabled">认购结束</button>
                        <p>该项目已<strong>完成</strong>不支持购买，请关注其他项目</p>
                    </div>
                </div>
            </eq>
			
            <notempty name="Think.session.USER_KEY_ID">
                <div class="programinfo programinfo2 jilu">
                    <h2>投资记录</h2>
                    <table style=" width:348px; margin-top:10px;">
                        <thead>
                        <tr style=" height:25px; background-color:#f60; color:#FFF;">
                            <th>次数</th>
                            <th>金钱</th>
                            <th>数量</th>
                            <th>总金额</th>
                        </tr>
                        </thead>
                        <tbody>
                        <volist name='log' id='vo' key='key'>
                            <tr>
                                <td>{$key}</td>
                                <td>{$vo.price|default='0.00'}</td>
                                <td>{$vo.num|default='0.00'}</td>
                                <td>{$vo.count|default='0.00'}</td>
                            </tr>
                        </volist>
                        </tbody>
                    </table>
                </div>
                <else/>
                <div class="programinfo programinfo2">
                    <h2>投资记录</h2>
                    <p class="pay-m-1" style="text-align:center;">暂未登录，<a href="{:U('Login/index')}">登录</a> 后查看</p>
                </div>
            </notempty>
        </div>
    </div>
</div>
<script>
    $(".menu6").addClass("uc-current");
    $(".pcinfotxtnav").children("li").on("click",function(){
        var n =$(this).index();
        $(this).addClass("current").siblings().removeClass("current");
        if(n==0){
            $("#info_1").show();
            $("#info_2").hide();
            $("#info_3").hide();
        }
        if(n==1){
            $("#info_3").show();
            $("#info_1").hide();
            $("#info_2").hide();
        }
        if(n==2){
            $("#info_2").show();
            $("#info_1").hide();
            $("#info_3").hide();
        }
    });
</script>
<script>
    function zhongchou(){
        var limit = {$list.limit};
        var deal = {$list.deal};
        var price = {$list.price};
        var min_limit = {$list.min_limit};
        var id={$id};
        var buy_currency_id = {$list.buy_currency_id};
        if($("#num").val()<min_limit){
            layer.msg("认筹数量不能小于最小认筹数量");
            $("#num").val("");
        }
        if($("#num").val()>deal){
            layer.msg("认筹数量不能超过剩余数量");
            $("#num").val("");
        }
        if($("#num").val()>limit){
            layer.msg("认筹数量不能超过限购数量");
            $("#num").val("");
        }
       layer.confirm('确定认筹？', {
  btn: ['确定','取消'], //按钮
  title: '提示'
}, function(){
  $.post("{:U('Zhongchou/run')}",{num:$("#num").val(),id:id,buy_currency_id:buy_currency_id},function(data){
            layer.msg(data.info);
            setTimeout(function () {
                window.location.reload();
            }, 2000);
        })
}, function(){
  layer.msg('已取消');
});
    }
    function sjmoney(){
        var price = {$list.price};
        $("#manjianhou").text($("#num").val()*price);
    }
</script>
<!--footer start-->
<include file="App/Home/View/Public/footer.html"/>
<!--footer end-->
<!--footer end-->
